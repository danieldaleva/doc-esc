/* Education Strategy Consulting, Inc.: web-standard-TBD, 2020-03-23-13-33-00 */
!function(e){"use strict";var t,i;!function(e){e.de="de",e.en="en",e.en_US="en-US",e.en_GB="en-GB",e.es="es",e.es_419="es-419",e.pt="pt",e.pt_BR="pt-BR"}(t||(t={}));class n extends Map{constructor(e){super(null==e||"function"==typeof e?void 0:e.entries),this.generator=(null==e||"function"==typeof e?e:e.generator)||null}compute(e){let t=this.get(e);if(void 0!==t||!this.generator||this.has(e))return t;let i=this.generator(e);return void 0!==i&&this.set(e,i),i}}!function(e){e.date="date",e.time="time",e.dateTime="date-time",e.timeNoSec="time-nosec",e.dateTimeNoSec="date-time-nosec",e.dateUtc="date-utc",e.timeUtc="time-utc",e.dateTimeUtc="date-time-utc",e.timeNoSecUtc="time-nosec-utc",e.dateTimeNoSecUtc="date-time-nosec-utc",e.datePad="date-pad",e.timePad="time-pad",e.dateTimePad="date-time-pad",e.timeNoSecPad="time-nosec-pad",e.dateTimeNoSecPad="date-time-nosec-pad",e.dateUtcPad="date-utc-pad",e.timeUtcPad="time-utc-pad",e.dateTimeUtcPad="date-time-utc-pad",e.timeUtcNoSecPad="time-nosec-utc-pad",e.dateTimeNoSecUtcPad="date-time-nosec-utc-pad"}(i||(i={}));function s(e){return null===e||"null"===e?null:void 0===e||"undefined"===e?void 0:r(e)?e.substring(1,e.length-1):e}function r(e){if(e.length<2)return!1;if("null"===e||"undefined"===e)return!0;let t=e.charAt(0);return("'"===t||'"'===t)&&(e.charAt(e.length-1)===t&&r(e.substring(1,e.length-1)))}const o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},l=e=>o[e];function a(e){return" "===e||"\t"===e||"\n"===e||"\r"===e||"\f"===e||"\v"===e}function h(e,t){let i=e.toString();for(;i.length<t;)i="0"+i;return i}function u(e){if(void 0===e)return"undefined";let t=new Set;return JSON.stringify(e,(e,i)=>{if(void 0===i)return"undefined";if(i instanceof RegExp)return i.source;if(i instanceof Date)return i.toUTCString();let n=typeof i;return"number"!==n||Number.isFinite(i)?"function"===n||"symbol"===n?i.toString():"object"===n&&null!=i?t.has(i)?"_circular_":(t.add(i),i):i:i.toString()})}function c(e,t,i=" ..."){return t=Math.max(t,i.length),null==e||e.length<=t?e:`${e.substring(0,t-i.length)}${i}`}function d(e){if(null==e)return e;let t=0,i=1;for(;e*i%1;)i*=10,t++;return t}function f(e){if("number"!=typeof e)return e;if(!Number.isFinite(e))return{base:e,power:0};let t=0,i=1;for(;e*i%1;)i*=10,t--;return{base:e*i,power:t}}function m(e){if(null==e)return e;if(null==e.base||null==e.power)throw new Error(`Invalid decimal: ${u(e)}`);if(Number.isFinite(e.base)){let t=1,i=e.base,n=e.power;for(;i%(10*t)==0&&n<0;)t*=10,n++;return i/=t,{base:i,power:n}}return{base:e.base,power:0}}function p(e,t){return null==e?e:e.power===t?e.base:e.power>=t?e.base*Math.pow(10,e.power-t):e.base/Math.pow(10,t-e.power)}function g(e){if(null==e)return e;let t=e.power,i=1,n=10;if(Math.abs(e.base)>=10)for(;e.base%n==0;)i=n,n*=10,t++;return{base:e.base/i,power:t}}function b(e){return null==e||"number"==typeof e?e:e.power<0?e.base/Math.pow(10,-e.power):e.base*Math.pow(10,e.power)}function w(e,t){if(e.power>0||t.power>0)throw new Error(`Addition of multiples of 10 is currently not supported: ${u(e)} + ${u(t)}`);let i=Math.min(e.power,t.power);return m({base:p(e,i)+p(t,i),power:i})}function v(e,t,i,n=!1){e=f(e),t=f(t),i=f(i);let s=(o=i,null==(r=e)||null==o?r===o:(r=m(r),o=m(o),r.base===o.base&&r.power===o.power));var r,o;if(!Number.isFinite(e.base)||!Number.isFinite(i.base)||!Number.isFinite(t.base)||!s&&0===t.base)throw new Error(`Invalid sequence: ${u(e)} : ${u(t)} : ${u(i)}`);if(s)return[];e=g(e),t=g(t),i=g(i);let l,a=Math.min(0===e.base?Number.POSITIVE_INFINITY:e.power,t.power,0===i.base?Number.POSITIVE_INFINITY:i.power),h=p(e,a),c=p(t,a),d=p(i,a),b=[],w=-1;if(c<0)if(n)for(;(l=h+c*++w)>=d;)b.push({base:l,power:a});else for(;(l=h+c*++w)>d;)b.push({base:l,power:a});else if(n)for(;(l=h+c*++w)<=d;)b.push({base:l,power:a});else for(;(l=h+c*++w)<d;)b.push({base:l,power:a});return b}function y(e,t){return z(e,t,C)}function x(e,t){return z(e,t,I)}function S(e,t){return z(e,t,M)}function E(e,t){return b(y(e,t))}function k(e,t){return b(x(e,t))}function N(e,t){return b(S(e,t))}const C=(e,t)=>{let i=Math.floor(e/t)*t,n=i+t;return n-e<=e-i?n:i},I=(e,t)=>Math.floor(e/t)*t,M=(e,t)=>Math.ceil(e/t)*t;function z(e,t,i){if(null!=(t=f(t))&&(t.base<=0||!Number.isFinite(t.base)))throw new Error(`Invalid step size: ${u(t)}.`);if(e=f(e),null==t||null==e||!Number.isFinite(e.base))return e;let n=Math.min(e.power,t.power),s=p(e,n);s=i(s,p(t,n));let r=m({base:s,power:n});return 0===r.base&&e.base<0&&(r.base=-0),r}function A(e){return O(e,L)}function T(e){return O(e,$)}const L=e=>e>=5?5:e>=2?2:1,$=e=>e<=1?1:e<=2?2:e<=5?5:10;function O(e,t){if(null==e)return e;let i=function(e){if(null==e)return e;if("number"==typeof e){if(0===e||!Number.isFinite(e))return{base:e,power:0}}else if(0===e.base||!Number.isFinite(e.base))return{base:e.base,power:0};let t="number"==typeof e?e:e.base,i="number"==typeof e?0:e.power,n=Math.sign(t);if(t=Math.abs(t),t<1){let e=1;for(;t*e<1;)e*=10,i--;t*=n*e}else{let e=1;for(;t/e>=10;)e*=10,i++;t/=n*e}return{base:t,power:i}}(e);if(0===i.base||!Number.isFinite(i.base))return i;let n=t(Math.abs(i.base));return 10===n&&(n=1,i.power++),i.base=Math.sign(i.base)*n,i.power>0&&(i.base*=Math.pow(10,i.power),i.power=0),i}function D(e,t,i,n){if((n=f(n)).base<=0||!Number.isFinite(n.base))throw new Error(`Invalid step size: ${u(n)}.`);if(null==e||Number.isNaN(e.base))return e;let s=b(e),r=b(t),o=b(i);return t=f(t),i=f(i),null!=o&&s>o&&(s=b(e=x(i,n))),null!=r&&s<r&&(e=S(t,n)),e}const P=new class{constructor(e){this.lang=e.lang,this.units1000=e.units1000,this._number=new n(e=>new Intl.NumberFormat([this.lang],{useGrouping:!0,minimumIntegerDigits:1,minimumFractionDigits:null==e?0:e,maximumFractionDigits:null==e?16:e})),this._numberNoGroup=new n(e=>new Intl.NumberFormat([this.lang],{useGrouping:!1,minimumIntegerDigits:1,minimumFractionDigits:null==e?0:e,maximumFractionDigits:null==e?16:e})),this._currency=new n(e=>{let t=e.split("_",2),i=t[1]?parseInt(t[1]):0,n=t[1]?i:16;return new Intl.NumberFormat([this.lang],{style:"currency",currency:t[0],useGrouping:!0,minimumIntegerDigits:1,minimumFractionDigits:i,maximumFractionDigits:n})})}number(e,t){if(null==e)return"";return null!=t&&(e=E(e,{base:1,power:-t}),t=Math.max(0,t)),this._number.compute(null==t?void 0:t).format(e)}numberNoGroup(e,t){if(null==e)return"";return null!=t&&(e=E(e,{base:1,power:-t}),t=Math.max(0,t)),this._numberNoGroup.compute(null==t?void 0:t).format(e)}percent(e,t){if(null==e)return"";if(null!=t){let i=y(e,{base:1,power:-t});i.power+=2,e=b(i),t=Math.max(0,t-2)}else e*=100;return this._number.compute(null==t?void 0:t).format(e)+"%"}illion(e,t){if(null==e)return"";let i,n;return null!=t&&(e=E(e,{base:1,power:-t})),null==t?(n=1,e<1e6?(e/=1e3,i=this.units1000.thousand):e<=1e9?(e/=1e6,i=this.units1000.million):e<=1e12?(e/=1e9,i=this.units1000.billion):(e/=1e12,i=this.units1000.trillion)):t>=0?(i="",n=t):(t<=-10?(e/=1e12,i=this.units1000.trillion):t<=-7?(e/=1e9,i=this.units1000.billion):t<=-4?(e/=1e6,i=this.units1000.million):(e/=1e3,i=this.units1000.thousand),n=t%3),this._number.compute(n).format(e)+(i&&" "+i)}thousand(e,t){return null==e?"":this.number(e,t)+" "+this.units1000.thousand}million(e,t){return null==e?"":this.number(e,t)+" "+this.units1000.million}billion(e,t){return null==e?"":this.number(e,t)+" "+this.units1000.billion}trillion(e,t){return null==e?"":this.number(e,t)+" "+this.units1000.trillion}currency(e,t,i){if(null==t)return"";return null!=i&&(t=E(t,{base:1,power:-i}),i=Math.max(0,i)),this._currency.compute(`${e}_${null==i?"":i}`).format(t)}bytes(e){if(null==e)return"";let t;return e<1048576?(e/=1024,t="KB"):e<=1073741824?(e/=1048576,t="MB"):e<=1099511627776?(e/=1073741824,t="GB"):e<=0x4000000000000?(e/=1099511627776,t="TB"):(e/=0x4000000000000,t="PB"),e=E(e,{base:1,power:-2}),this._number.compute(void 0).format(e)+(t&&" "+t)}}({lang:t.en_US,units1000:{thousand:"k",million:"m",billion:"bn",trillion:"tn"}}),_={add:"Add",cancel:"Cancel",clear:"Clear",close:"Close",edit:"Edit",remove:"Remove",reset:"Reset",submit:"Submit",dateFormats:new class{constructor(e){this.formatters=new n(t=>new Intl.DateTimeFormat(e,this.format2options(t)))}format(e,t){return null==e?"":this.formatters.compute(t||i.dateTime).format(this.normalize(e))}normalize(e){return"string"==typeof e?new Date(e):e}format2options(e){let t=e.includes("-nosec"),i=e.includes("-pad"),n=e.includes("-utc"),s={};return e.startsWith("date")&&(s.year="numeric",s.month=i?"2-digit":"numeric",s.day=i?"2-digit":"numeric"),(e.startsWith("time")||e.startsWith("date-time"))&&(s.hour=i?"2-digit":"numeric",s.hour12=!i&&void 0,s.minute="2-digit",s.second=t?void 0:"2-digit",s.timeZoneName=n?"short":void 0),s.timeZone=n?"UTC":void 0,s}}(t.en_US),numericFormats:P,formatBoolean:e=>null==e?"":e?"Yes":"No"},F={dateFormats:_.dateFormats,numericFormats:_.numericFormats,boolean:_.formatBoolean},R={format:e=>_.numericFormats.number(e)},B={includeNull:"Include Missing",includeNaN:"Include NaN",includeNegInf:"Include -∞",includePosInf:"Include +∞",countFormat:e=>_.numericFormats.number(e),valueFormat:(e,t)=>_.numericFormats.number(e,t)},H={valueFormat:(e,t)=>_.numericFormats.number(e,t)};function j(e){if(null==e)return e;if(!(e=e.trim()))return null;let t=Number(e);return Number.isInteger(t)?t:null}function q(e){if(null==e)return e;if(!(e=e.trim()))return null;let t=Number(e);return Number.isNaN(t)&&"NaN"!=e.trim()?null:t}const U={format:(e,t)=>new Intl.NumberFormat(["en-US"],{useGrouping:!0,minimumIntegerDigits:1,minimumFractionDigits:t,maximumFractionDigits:t}).format(e),parse:e=>function(e,t,i){if(null==e)return e;let n="";for(let s of e)t.includes(s)||(i.includes(s)?n+=".":n+=s);return q(n)}(e,",",".")},Z=new Intl.NumberFormat(["en-US"],{useGrouping:!0,minimumIntegerDigits:1,minimumFractionDigits:2,maximumFractionDigits:2}),Y={"format.boolean":e=>e?"Yes":"No","format.number":e=>Z.format(e)},G=new Intl.NumberFormat(["en-US"],{useGrouping:!0,minimumIntegerDigits:1,minimumFractionDigits:2,maximumFractionDigits:2}),V={"format.boolean":e=>e?"Yes":"No","format.number":e=>G.format(e)},X={bookmark:"Bookmark",cancel:_.cancel,edit:_.edit,remove:_.remove,submit:_.submit},W={close:_.close},K={lang:t.en_US,"esc.format.runtime":F,"esc.validate.runtime":{required:"Please enter a value.",minLengthText:e=>1===e?"At least one character is required.":`At least ${e} characters are required.`,maxLengthText:e=>1===e?"At most one character is allowed.":`At most ${e} characters are allowed.`,email:"The value must be a valid email address.",emailList:"The value must be one or more valid email addresses (separated by commata).",minLengthMultiChoices:e=>1===e?"At least one option must be selected.":`At least ${e} options must be selected.`,maxLengthMultiChoices:e=>1===e?"At most one option may be selected.":`At most ${e} options may be selected.`},"esc.error.remote.runtime":{"error.title":"Data Access Failure","error.403":"You are no longer authorized. Try refreshing the page.","error.fallback":e=>`Some unexpected error occurred (${e}). Let us know if this problem persists.`},"esc.widgets.control.choices.runtime":R,"esc.widgets.control.slider.runtime":H,"esc.widgets.control.spinner.runtime":U,"esc.widgets.control.range.runtime":B,"esc.widgets.data.comp-table.runtime":Y,"esc.widgets.data.lazy-table.runtime":V,"esc.widgets.misc.statemanager.runtime":X,"esc.widgets.panel.modal.render":W};let Q;function J(){return Q}window&&window.console&&console.log("\n%cBig Data ≠ Dull Data\n\n\n%c    ⇒ Join our team!\n\n    %chttps://www.escmatrix.com%c \n\n","font-family: Heebo, Helvetica Neue, sans-serif; font-size: 16px; line-height: 1.2rem; color: rgb(153, 151, 162)","font-family: Heebo, Helvetica Neue, sans-serif; font-size: 32px; color: rgb(50, 145, 255)","font-family: Heebo, Helvetica Neue, sans-serif; font-size: 11px; line-height: 1.2rem; color: rgb(153, 151, 162)",""),function(e){let t;e.implementation=function(i){return t=i,e};let i=!0,n=!1,s=!1;const r=[],o=[],l=[],a=[];function u(t,h=!0){return t=t||{},h||(r.length=0,o.length=0,l.length=0,a.length=0,n=!1,s=!1),c(t.debug,r),c(t.info,o),c(t.warn,l),c(t.error,a),i=0===r.length&&0===o.length&&0===l.length&&0===a.length,null!=t.showTime&&(n=t.showTime),null!=t.showTrace&&(s=t.showTrace),function(){for(let e in g)v(e,g[e]);f.forEach(e=>e())}(),e}function c(e,t){if(null!=e)for(let i of e)i.length>1&&i.endsWith("*")&&(i=i.substring(0,i.length-1)),t.includes(i)||t.push(i)}function d(e,t){if(null==t)return!0;for(let i of t){for(;i.endsWith("*");)i=i.substring(0,i.length-1);if(0===i.length||i.length<=e.length&&i===e.substring(0,i.length))return!0}return!1}e.debug=function(...e){return u({debug:null==e||0===e.length?["*"]:e},!1)},e.info=function(...e){return u({info:null==e||0===e.length?["*"]:e},!1)},e.warn=function(...e){return u({warn:null==e||0===e.length?["*"]:e},!1)},e.error=function(...e){return u({error:null==e||0===e.length?["*"]:e},!1)},e.showTime=function(e=!0){return u({showTime:!0===e},!0)},e.showTrace=function(e=!0){return u({showTrace:!0===e},!0)},e.configure=u,e.configuration=function(){return{debug:r.slice(),info:o.slice(),warn:l.slice(),error:a.slice(),showTime:n,showTrace:s}};const f=new Set;let m;function p(e){return i?null:d(e,r)?m.debug:d(e,o)?m.info:d(e,l)?m.warn:d(e,a)?m.error:null}e.onUpdate=function(t){return t&&f.add(t),e},function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error"}(m=e.LogLevel||(e.LogLevel={})),e.determineLogLevel=p;const g=Object.create(null);function b(e){return function(...i){if(null==t)return;let r=n?`${function(){let e=new Date;return h(e.getHours(),2)+":"+h(e.getMinutes(),2)+":"+h(e.getSeconds(),2)+","+h(e.getMilliseconds(),3)}()} ${e}`:e;i.length>0&&"string"==typeof i[0]?i[0]=`${r} - ${i[0]}`:i.unshift(r),t(i,s)}}e.logger=function(e){let t=g[e];return null==t&&(t={log:w,debug:w,info:w,warn:w,error:w,isDebugEnabled:!1,isInfoEnabled:!1,isWarnEnabled:!1,isErrorEnabled:!1},v(e,t),g[e]=t),t};const w=function(){};function v(e,t){let i=p(e);t.isDebugEnabled=null!=i&&i<=m.debug,t.debug=t.isDebugEnabled?b(`[DEBUG] ${e}`):w,t.isInfoEnabled=null!=i&&i<=m.info,t.info=t.isInfoEnabled?b(`[INFO]  ${e}`):w,t.isWarnEnabled=null!=i&&i<=m.warn,t.warn=t.isWarnEnabled?b(`[WARN]  ${e}`):w,t.isErrorEnabled=null!=i&&i<=m.error,t.error=t.isErrorEnabled?b(`[ERROR] ${e}`):w}}(e.log||(e.log={}));var ee=e.log.LogLevel;if(window&&window.console){const t=function(){};console.log||(console.log=t),console.trace||(console.trace=t);const i=console.debug,n=console.info,s=console.warn,r=console.error;e.log.implementation((e,t)=>{t?console.trace(...e):console.log(...e)}),e.log.onUpdate((function(){let o=e.log.determineLogLevel("console");console.debug=null!=o&&o<=ee.debug?i:t,console.info=null!=o&&o<=ee.info?n:t,console.warn=null!=o&&o<=ee.warn?s:t,console.error=null!=o&&o<=ee.error?r:t}));const o=/[?&]+debug(?:Logs?)?=([^&]*)/gi.exec(window.location.search),l=/[?&]+info(?:Logs?)?=([^&]*)/gi.exec(window.location.search),a=/[?&]+warn(?:Logs?)?=([^&]*)/gi.exec(window.location.search),h=/[?&]+error(?:Logs?)?=([^&]*)/gi.exec(window.location.search),u=/[?&]+showTime(?:=([^&]*))?(?:&|$)/gi.exec(window.location.search),c=/[?&]+showTrace(?:=([^&]*))?(?:&|$)/gi.exec(window.location.search);function te(e){if(!e)return null;if(null==e[1])return!0;let t=e[1].toLocaleLowerCase();return""===t||"true"===t||"false"!==t&&null}e.log.configure({debug:o&&o[1].split(","),info:l&&l[1].split(","),warn:a&&a[1].split(","),error:null==h?["*"]:h[1].split(","),showTime:te(u),showTrace:te(c)})}function ie(e){return null!=e&&"object"==typeof e&&"parentsUntil"in e}function ne(t,i){return null==i?e.$$(t).first():e.$$(t,i).first()}e.$=ne;class se extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,se),this.name="AssertionError"}}const re="http://www.w3.org/2000/svg",oe={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};oe.tbody=oe.tfoot=oe.colgroup=oe.caption=oe.thead,oe.th=oe.td;const le=new Set(["circle","clippath","componenttransferfunction","defs","desc","ellipse","feblend","fecolormatrix","fecomponenttransfer","fecomposite","feconvolvematrix","fediffuselighting","fedisplacementmap","fedistantlight","feflood","fefunca","fefuncb","fefuncg","fefuncr","fegaussianblur","feimage","femerge","femergenode","femorphology","feoffset","fepointlight","fespecularlighting","fespotlight","fetile","feturbulence","filter","foreignobject","g","gradient","image","line","lineargradient","marker","mask","metadata","path","pattern","polygon","polyline","radialgradient","rect","svg","stop","switch","symbol","tspan","textcontent","text","textpath","textpositioning","use","view"]);function ae(e){if(null==e)return e;let t=he(e);if(1!==t.length)throw new Error(`HTML does not create unique element: ${e}`);return t[0]}function he(e){if(null==e)return e;let t=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i.exec(e),i=t?t[1].toLowerCase():"";if(le.has(i)){let t=document.createElementNS(re,"svg");return t.innerHTML=e,t.childNodes}{let t=oe[i]||oe._default,n=document.createElement("div");n.innerHTML=t[1]+function(e){return e.replace(/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,"<$1></$2>")}(e)+t[2];let s=t[0];for(;s--;)n=n.lastChild;return n.childNodes}}function ue(e,t){if(null!=e)if(e instanceof Node)t.appendChild(e);else for(let i of e)t.appendChild(i)}function ce(e,t){if(null==e)return;let i=t.firstChild;if(e instanceof Node)t.insertBefore(e,i);else for(let n of e)t.insertBefore(n,i)}function de(e,t){if(null==e)return;let i=t.parentElement;if(!i)throw new Error("Cannot insert before an orphaned element: "+t);if(e instanceof Node)i.insertBefore(e,t);else for(let n of e)i.insertBefore(n,t)}function fe(e,t){if(null==e)return;let i=t.parentElement;if(!i)throw new Error("Cannot insert after an orphaned element: "+t);let n=t.nextSibling;if(e instanceof Node)i.insertBefore(e,n);else for(let t of e)i.insertBefore(t,n)}function me(e,t){let i=[];for(let n of e.children)n.nodeType!==Node.ELEMENT_NODE||null!=t&&!n.matches(t)||i.push(n);return i}function pe(e,t,i){let n=me(e,t);if(0===n.length)return null;if(1===n.length){let e=n[0];if(!i||e instanceof i)return e;throw new Error(`Child selector '${t}' is not of type ${i}.`)}throw new Error(`Child selector '${t}' is ambiguous.`)}function ge(e,t,i){let n=pe(e,t,i);if(!n)throw new Error(`Child selector '${t}' not found.`);return n}function be(e,t,i){let n=(e||document).querySelectorAll(t);if(0===n.length)return null;if(1===n.length){let e=n.item(0);if(!i||e instanceof i)return e;throw new Error(`Selector '${t}' is not of type ${i}.`)}throw new Error(`Selector '${t}' is ambiguous.`)}function we(e,t,i){let n=be(e,t,i);if(!n)throw new Error(`Selector '${t}' not found.`);return n}function ve(e,t,i){let n;for(n=null==i?()=>!1:i instanceof Element?e=>e===i:e=>e.matches(i);null!=e&&!n(e);){if(e.matches(t))return e;e=e.parentElement}return null}const ye=(e,t)=>{t.appendChild(e)};function xe(e){let t=[];for(let i of e){let e=i.parentElement;null==e||t.includes(e)||t.push(e)}return t}function Se(e,t){for(let i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1}function Ee(e,t){return null==t||e instanceof Element&&e.matches(t)}class ke{constructor(e,t,i){if(i=!0===i,"string"==typeof e)if(i){let i=ke.select(e,t);this.elements=null==i?[]:[i]}else this.elements=Array.from(ke.selectAll(e,t));else if(e instanceof Element)this.elements=[e];else{if(!(Array.isArray(e)||e instanceof NodeList))throw new Error(`Cannot build selector for element: ${e}`);this.elements=Array.from(e)}}get length(){return this.elements.length}get(e){return null==e?this.elements.slice():this.elements[e]}first(){return this.eq(0)}last(){return this.eq(this.elements.length-1)}eq(e){let t=this.elements[e];return new this.constructor(null==t?[]:t)}add(e,t){"string"==typeof e&&(e=new this.constructor(e,t));let i=Array.from(this.elements);return i.push(...e.elements),new this.constructor(i)}find(e){let t=[];for(let i of this.elements){if(!(i instanceof Element))continue;let n=i.querySelectorAll(e);for(let e of n)t.push(e)}return new this.constructor(t)}contents(e){let t=[];for(let i of this.elements){i instanceof HTMLTemplateElement&&(i=document.importNode(i.content,!0));for(let n of i.childNodes)if(Ee(n,e))switch(n.nodeType){case Node.ELEMENT_NODE:case Node.TEXT_NODE:case Node.COMMENT_NODE:t.push(n)}}return new this.constructor(t)}children(e){let t=[];for(let i of this.elements)if(i instanceof Element)for(let n of i.children)n.nodeType===Node.ELEMENT_NODE&&Ee(n,e)&&t.push(n);return new this.constructor(t)}parent(e){let t=[];for(let i of this.elements){let n=i.parentElement;null!=n&&!t.includes(n)&&Ee(n,e)&&t.push(n)}return new this.constructor(t)}parents(e){return this.parentsUntil(e)}parentsUntil(e,t){"string"==typeof e&&(e=new this.constructor(e));let i=[],n=Array.from(this.elements);for(;(n=xe(n)).length>0;)for(let s=n.length-1;s>=0;s--){let r=n[s];null!=e&&Se(r,e.elements)>=0?n.splice(s,1):!i.includes(r)&&Ee(r,t)&&i.push(r)}return new this.constructor(i)}closest(e){let t=[],i=Array.from(this.elements);do{for(let n=i.length-1;n>=0;n--){let s=i[n];Ee(s,e)&&(t.push(s),i.splice(n,1))}}while((i=xe(i)).length>0);return new this.constructor(t)}contentToThis(e,t){"string"==typeof e&&(e=new ke(e));for(let i=0,n=this.elements.length;i<n;i++){let s=i<n-1,r=this.elements[i];for(let i of e.elements)t(s?i.cloneNode(s):i,r)}return this}prev(e){let t=[];for(let i of this.elements){let n=i.previousSibling;null!=n&&Ee(n,e)&&t.push(n)}return new this.constructor(t)}next(e){let t=[];for(let i of this.elements){let n=i.nextSibling;null!=n&&Ee(n,e)&&t.push(n)}return new this.constructor(t)}append(e){return this.contentToThis(e,ye)}appendTo(e){return e.append(this),this}prepend(e){return this.contentToThis(e,ce)}prependTo(e){return e.prepend(this),this}after(e){return this.contentToThis(e,fe)}insertAfter(e){return e.after(this),this}before(e){return this.contentToThis(e,de)}insertBefore(e){return e.before(this),this}empty(){return this.contents().remove(),this}remove(e){let t=[];for(let i of this.elements)Ee(i,e)&&i.parentNode?i.parentNode.removeChild(i):t.push(i);return this.elements=t,this}replaceWith(e){let t;return this.contentToThis(e,(e,i)=>{t?fe(e,t):function(e,t){if(!e.parentElement)throw new Error("Cannot replace an orphaned element: "+e);e.parentElement.replaceChild(t,e)}(i,e),t=e})}attr(e,t){if(void 0===t){if(0===this.elements.length)return;if(this.elements.length>1)throw new Error("Attribute access is not supported for multi-element selections.");let t=this.elements[0];if(!(t instanceof Element))return;if(void 0===e){let e=t.attributes,i=Object.create(null);for(let t=0,n=e.length;t<n;t++){let n=e[t];i[n.name.toLowerCase()]=n.nodeValue}return i}return t.getAttribute(e)||void 0}if(void 0!==e)for(let i of this.elements)i instanceof Element&&(null==t?i.removeAttribute(e):i.setAttribute(e,""+t));return this}prop(e,t){if(void 0===t){if(0===this.elements.length)return;if(this.elements.length>1)throw new Error("Property access is not supported for multi-element selections.");return this.elements[0][e]}if(void 0!==e)for(let i of this.elements)i[e]=t;return this}hasClass(e){for(let t of this.elements)if(t instanceof Element&&t.classList.contains(e))return!0;return!1}addClass(e){for(let t of this.elements)t instanceof Element&&t.classList.add(...e.split(" "));return this}removeClass(e){for(let t of this.elements)t instanceof Element&&t.classList.remove(...e.split(" "));return this}toggleClass(e,t){for(let i of this.elements)if(i instanceof Element)for(let n of e.split(" "))i.classList.toggle(n,t);return this}css(e,t){if(void 0===t&&"object"!=typeof e){if(0===this.elements.length)return null;if(this.elements.length>1)throw new Error("Attribute access is not supported for multi-element selections.");let t=this.elements[0];if(!(t instanceof Element))return null;let i=getComputedStyle(t);return"string"==typeof e?i.getPropertyValue(e):e.map(e=>i.getPropertyValue(e))}if("string"==typeof e){for(let i of this.elements)i instanceof HTMLElement&&(null==t?i.style.removeProperty(e):i.style.setProperty(e,""+t));return this}if(Array.isArray(e))throw new Error("CSS property array is not allowed when setting a value.");if(void 0!==t)throw new Error("Value argument must not be present when a property map is specified.");for(let i of this.elements){if(!(i instanceof HTMLElement))continue;let n=i.style;Object.keys(e).forEach(i=>{null==t?n.removeProperty(i):n.setProperty(i,""+e[i])})}return this}is(e){for(let t of this.elements)if(Ee(t,e))return!0;return!1}html(e){if(void 0===e){let e="";for(let t of this.elements){if(!(t instanceof Element))continue;let i=t.innerHTML;i&&(e&&(e+="\n"),e+=i)}return e}for(let t of this.elements)t instanceof Element&&(t.innerHTML=e);return this}text(e){if(void 0===e){let e="";for(let t of this.elements){let i=t.textContent;i&&(e&&(e+=" "),e+=i)}return e}for(let t of this.elements)t.textContent=e;return this}clone(){let e=[];for(let t of this.elements)e.push(t.cloneNode(!0));return new this.constructor(e)}static select(e,t){if(e.indexOf("<")>=0){let t=he(e);if(0===t.length)return null;if(t.length>1)throw new Error(`Selection is not unique - consider using selectAll: ${e}`);return t.item(0)}if(null==t)return document.querySelector(e);{t instanceof ke||(t=new ke(t));let i=null;for(let n of t.elements){if(!(n instanceof Element))continue;let t=n.querySelector(e);if(null!=t){if(null!=i)throw new Error(`Selection is not unique - consider using selectAll: ${e}`);i=t}}return i}}static selectAll(e,t){if(e.indexOf("<")>=0){return he(e)}if(null==t)return document.querySelectorAll(e);{t instanceof ke||(t=new ke(t));let i=[];for(let n of t.elements){if(!(n instanceof Element))continue;let t=n.querySelectorAll(e);for(let e of t)i.includes(e)||i.push(e)}return i}}on(e,t,i){for(let n of this.elements){if(!(n instanceof HTMLElement))throw new se("Node is not an HTMLElement.");n.addEventListener(e,t,i)}return this}off(e,t,i){for(let n of this.elements){if(!(n instanceof HTMLElement))throw new se("Node is not an HTMLElement.");n.removeEventListener(e,t,i)}return this}}!function(t){e.$=t||ne}((e,t)=>new ke(e,t,!0)),function(t){e.$$=t}((e,t)=>new ke(e,t,!1));const Ne=new WeakMap;function Ce(e,t){if(null==e)return;let i=Ne.get(e);return t&&null==i&&Ne.set(e,i=Object.create(null)),i}function Ie(e,t,i){let n=Ce(e,!0),s=n[t];return n[t]=i,s}function Me(e,t){let i=Ce(e,!1);return i&&i[t]}function ze(e,t){let i=Ce(e,!1);if(!i)return;let n=i[t];return delete i[t],n}const Ae="esc-is-selected";var Te,Le,$e,Oe,De;function Pe(e){return null==e?e:"string"==typeof e?function(e){if(null==e)throw new Error("DOM id must be non-null to retrieve data.");e.startsWith("#")&&(e=e.substring(1));let t=document.getElementById(e);if(!t)throw new Error(`Element '${e}' not found.`);return t}(e):function(e){if(null==e)return e;if(e instanceof Element)return e;if("string"==typeof e){let t=document.querySelectorAll(e);if(0===t.length)throw new Error(`Selection not found: ${e}`);if(1!==t.length)throw new Error(`Selection is ambiguous: ${e}`);return t.item(0)}if(void 0!==e.length&&void 0!==e.get){if(0===e.length)throw new Error(`DOM selection is empty: ${e}`);if(1!==e.length)throw new Error(`DOM selection is ambiguous: ${e}`);let t=e.get(0);if(t instanceof Element)return t;throw new Error(`DOM selection must yield Element, not ${t}.`)}throw new Error(`Selection must be Element, not ${e}.`)}(e)}function _e(e,t){return Re(e,"esc-controller",t)}function Fe(e,t){return Re(e,"esc-gadget",t)}function Re(e,t,i){return He(e,!1,t,i)}function Be(e,t,i){return He(e,!0,t,i)}function He(e,t,i,n){if(null==e)throw new Error("Selection must be non-null to retrieve data.");let s=Pe(e),r=Me(s,i=i||(s instanceof HTMLScriptElement?"esc-gadget":"esc-controller"));if(null!=n&&!(r instanceof n))throw new Error(`Data '${i}' is not of type '${n}': ${u(r)}`);if(void 0===r&&!t)throw new Error(`Data '${i}' not found for element ${s.id?"'"+s.id+"'":c(s.outerHTML,100," ..")}.`);return r}function je(e){return e?t=>{t.target===t.currentTarget&&e(t)}:e}!function(e){e.inactive="inactive",e.hidden="hidden",e.collapsed="collapsed"}(Te||(Te={})),function(e){e.horizontal="horizontal",e.vertical="vertical"}(Le||(Le={})),function(e){e.strong="strong",e.ghost="ghost",e.subtle="subtle"}($e||($e={})),function(e){e.regular="regular",e.light="light"}(Oe||(Oe={})),function(e){e.row="row",e.column="column",e.grid="grid"}(De||(De={}));class qe extends Event{constructor(){super("esc-destroy",{bubbles:!0,cancelable:!0,composed:!0})}}function Ue(e,t){if(!t)return t;let i=je(t);return e.addEventListener("esc-destroy",i),i}function Ze(e,t=!0){if(e){e instanceof Node?e=[e]:Array.isArray(e)||(e=Array.from(e));for(let i of e)t&&"children"in i&&Ze(i.children,!0),i.dispatchEvent(new qe),i.remove()}}const Ye=e.log.logger("esc.dom.fullscreen");var Ge={get supported(){return null!=(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled)},requestFullscreen:function(e){e&&("requestFullscreen"in e?e.requestFullscreen():"webkitRequestFullscreen"in e?e.webkitRequestFullscreen():"mozRequestFullScreen"in e?e.mozRequestFullScreen():Ye.error("Browser does not support full-screen API: %s",window.navigator.userAgent))},exitFullscreen:function(){null!=this.fullscreenElement&&("exitFullscreen"in document?document.exitFullscreen():"webkitExitFullscreen"in document?document.webkitExitFullscreen():"mozCancelFullScreen"in document&&document.mozCancelFullScreen())},get fullscreenEnabled(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||!1},get fullscreenElement(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||null},get onfullscreenchange(){return document.onfullscreenchange||document.onwebkitfullscreenchange||document.onmozfullscreenchange||null},set onfullscreenchange(e){"onfullscreenchange"in document?document.onfullscreenchange=e:"onwebkitfullscreenchange"in document?document.onwebkitfullscreenchange=e:"onmozfullscreenchange"in document?document.onmozfullscreenchange=e:Ye.error("Browser does not support full-screen API: %s",window.navigator.userAgent)},addChangeListener:function(e,t,i){"onfullscreenchange"in e?e.addEventListener("fullscreenchange",t,i):"onwebkitfullscreenchange"in e?e.addEventListener("webkitfullscreenchange",t,i):"onmozfullscreenchange"in e?e.addEventListener("mozfullscreenchange",t,i):Ye.error("Browser does not support full-screen API: %s",window.navigator.userAgent)},removeChangeListener:function(e,t,i){"onfullscreenchange"in e?e.removeEventListener("fullscreenchange",t,i):"onwebkitfullscreenchange"in e?e.removeEventListener("webkitfullscreenchange",t,i):"onmozfullscreenchange"in e?e.removeEventListener("mozfullscreenchange",t,i):Ye.error("Browser does not support full-screen API: %s",window.navigator.userAgent)},get onfullscreenerror(){return document.onfullscreenerror||document.onwebkitfullscreenerror||document.onmozfullscreenerror||null},set onfullscreenerror(e){"onfullscreenerror"in document?document.onfullscreenerror=e:"onwebkitfullscreenerror"in document?document.onwebkitfullscreenerror=e:"onmozfullscreenerror"in document?document.onmozfullscreenerror=e:Ye.error("Browser does not support full-screen API: %s",window.navigator.userAgent)},addErrorListener:function(e,t,i){"onfullscreenerror"in e?e.addEventListener("fullscreenerror",t,i):"onwebkitfullscreenerror"in e?e.addEventListener("webkitfullscreenerror",t,i):"onmozfullscreenerror"in e?e.addEventListener("mozfullscreenerror",t,i):Ye.error("Browser does not support full-screen API: %s",window.navigator.userAgent)},removeErrorListener:function(e,t,i){"onfullscreenerror"in e?e.removeEventListener("fullscreenerror",t,i):"onwebkitfullscreenerror"in e?e.removeEventListener("webkitfullscreenerror",t,i):"onmozfullscreenerror"in e?e.removeEventListener("mozfullscreenerror",t,i):Ye.error("Browser does not support full-screen API: %s",window.navigator.userAgent)}};const Ve=Object.freeze({fullscreen:Ge});const Xe=Object.freeze({bind:function(e,t,i,n,s,r,o){if(null==e)throw new Error("Selection must be non-null to retrieve data.");let l=Pe(e),a="string"!=typeof t&&"lookup"in t?t:Fe(t);a.bind(i,n,s,r,o),l.addEventListener("esc-destroy",()=>a.unbind(i))},bindSingleton:function(e,t,i,n){if(null==e)throw new Error("Selection must be non-null to retrieve data.");let s=Pe(e),r="string"!=typeof t&&"lookup"in t?t:Fe(t);r.bindSingleton(i,n),s.addEventListener("esc-destroy",()=>r.unbind(i))}});class We extends Error{constructor(e,t){super(function(e,t){if(t instanceof Error&&t.stack){let i=(new Error).stack,n=t.stack;if(i&&(i=i)){let e=i.length-1,t=n.length-1,s=t;for(;e>=0&&t>=0;e--,t--){if(i.charAt(e)!==n.charAt(t)){n=n.substring(0,s);break}"\n"===n.charAt(t)&&(s=t)}}e+="\n"+function(e){return"    "+e.split(/\n/g).join("\n    ")}(n)}else void 0!==t&&(e+="\n"+t);return e}(e,t)),Error.captureStackTrace&&Error.captureStackTrace(this,We),this.name="NestedError"}}function Ke(e,t,i){return t=t.trim(),/return\s+/.test(t)||(t="return "+t),Qe(e,t,i)}function Qe(e,t,i){t=t.trim(),(e=e.slice()).push(t);try{return new Je(...e)}catch(e){throw new We(`Failed to compile ${i||"function"}:\n\t${t.split(/\r?\n/).join("\n\t")}`,e)}}class Je extends Function{constructor(...e){super(...e),this._args=e.slice()}get args(){return this._args.slice()}}function et(e,t,i=e){try{return e.apply(i,t)}catch(i){if(e instanceof Je){let n=e.args,s=n.splice(n.length-1,1)[0];s=s.split(/\r?\n/).join("\n\t\t");for(let e=0;e<n.length;e++){let i=t[e];n[e]=`\n\t\t${n[e]} = ${c(u("symbol"==typeof i?i.toString():i),100)}`}throw new We(`Failed to execute compiled function:\n\t(${n.length?n.join(",")+"\n\t":""}) => {\n\t${s}\n\t}}`,i)}throw new We("Failed to execute compiled function",i)}}function tt(e,t){return(...i)=>e(t(...i))}function it(e){return e}function nt(e,t,i,n,s){let r,o=Qe(["event"],i,`'${t}' listener`);return r=n?e=>{!0===et(o,[e])&&e.stopPropagation()}:e=>et(o,[e]),s&&e.addEventListener(t,r),r}function st(e=document.body){if(e instanceof Element)!function(e){let t=e.attributes,i=!1;for(let n=0,s=t.length;n<s;n++){let s=t[n],r=s.name;if(r.startsWith("data-esc-on")){let t="data-esc-on".length;"-"===r.charAt(t)&&t++;let n=r.substring(t),o=s.nodeValue;if(!o)continue;if(!n)throw new Error(`Event type for callback must be non-naught: ${o}`);nt(e,`esc-${n}`,o,!0,!0),i=!0}}}(e),st(e.children);else if(Symbol.iterator in e)for(let t of e)st(t)}function rt(e,t,i=!1){return JSON.stringify(e,i?ot:lt,t)}function ot(e,t){return"string"==typeof t?ft(t)?`"${t}"`:t:"number"==typeof t?ct(t):t}function lt(e,t){return void 0===t?"undefined":"string"==typeof t?ft(t)?`"${t}"`:t:"number"==typeof t?ct(t):t}function at(e,t=!1){return JSON.parse(e,t?ht:ut)}function ht(e,t){if("undefined"!==t){if("NaN"===t)return Number.NaN;if("Infinity"===t||"+Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if("string"==typeof t&&'"'===t.charAt(0)&&'"'===t.charAt(t.length-1)){let e=t.substring(1,t.length-1);return ft(e)?e:t}return t}}function ut(e,t){if("NaN"===t)return Number.NaN;if("Infinity"===t||"+Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(null==t||"object"!=typeof t||Array.isArray(t))return t;for(let[e,i]of Object.entries(t))if("string"==typeof i)if("undefined"===i)t[e]=void 0;else if('"'===i.charAt(0)&&'"'===i.charAt(i.length-1)){let n=i.substring(1,i.length-1);ft(n)&&(t[e]=n)}return t}function ct(e){return Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e}function dt(e){return"NaN"===e?Number.NaN:"Infinity"===e||"+Infinity"===e?Number.POSITIVE_INFINITY:"-Infinity"===e?Number.NEGATIVE_INFINITY:e}function ft(e){return!(e.length<2)&&("undefined"===e||"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e||'"'===e.charAt(0)&&'"'===e.charAt(e.length-1)&&ft(e.substring(1,e.length-1)))}const mt=e.$,pt=e.log.logger("esc.dom.process"),gt=new Map;function bt(e,t){if(!e)throw new Error("DOM processor name must be non-blank and non-null.");if(null==t)throw new Error(`DOM processor '${e}' must be non-null.`);"process"in t||(t={process:t}),gt.set(e,Object.assign({},t,{name:e}))}function wt(e=document.body){pt.info("Processing DOM with %d processor(s) ...",gt.size),pt.isDebugEnabled&&pt.debug("processors: %s",Array.from(gt.keys()).join()),function(){pt.info("... initializing processors.");let e=[],t=Array.from(gt.values());for(;t.length>0;){let i=t.length;for(let n=i-1;n>=0;n--){let i=t[n];if(vt(i.dependencies,e)&&(e.push(i.name),t.splice(n,1),i.initialize)){pt.debug("... initializing processor '%s'.",i.name);try{i.initialize()}catch(e){throw new We(`Processor '${i.name}' failed to initialize.`,e)}}}if(t.length===i)throw new Error(`Processors contain dependency cycle: ${t.map(e=>e.name).join()}`)}}(),function(e){pt.info("... applying processors.");let t=new Set,i=[];if(function e(t,i,n){t instanceof HTMLElement&&(t=[t]);for(let s of t){let t=s.dataset;for(let e of Object.keys(t)){if(!e.startsWith("escProcess"))continue;let r="";for(let t="escProcess".length;t<e.length;t++){let i=e.charAt(t),n=i.toLowerCase();i!==n&&r&&(r+="-"),r+=n}if(!r)continue;let o=t[e],l=o?at(o):null,a=gt.get(r)||gt.get(r="esc-"+r);if(null==a)throw new Error(`Processor '${r}' not found for element ${s.id?"'"+s.id+"'":c(s.outerHTML,100," ..")}.`);if(void 0===a.dependencies||a.dependencies&&0===a.dependencies.length){pt.debug("... applying processor '%s': %o",r,s);try{a.process(mt(s),l)}catch(e){throw new We(`Processor '${a.name}' failed for element ${s.id?"'"+s.id+"'":c(s.outerHTML,100," ...")}: param=${u(l)}`,e)}}else i.add(a),n.push([a,s,l])}for(let t of s.children)t instanceof HTMLElement&&e(t,i,n)}}(e,t,i),0===i.length)return;let n=[];gt.forEach((e,i)=>{t.has(e)||n.push(i)}),i.reverse();for(;i.length>0;){let e=yt(t,n);if(0===e.length)throw new Error(`Processors contain dependency cycle: ${Array.from(t).map(e=>e.name).join()}`);let s=i.length;for(let t=s-1;t>=0;t--){let[n,s,r]=i[t];if(e.includes(n.name)){i.splice(t,1),pt.debug("... applying processor '%s': %o",n.name,s);try{n.process(mt(s),r)}catch(e){throw new We(`Processor '${n.name}' failed for element ${s.id?"'"+s.id+"'":c(s.outerHTML,100," ...")}: param=${u(r)}`,e)}}}if(i.length===s)throw new se("Cycle in processing deferred tasks.");n.push(...e)}}(e),pt.info("... finalizing processors."),gt.forEach((e,t)=>{if(e.finalize){pt.debug("... finalizing processor '%s'.",t);try{e.finalize()}catch(e){throw new We(`Processor '${t}' failed to finalize.`,e)}}}),pt.info("Done processing DOM.")}function vt(e,t){return!!(void 0===e||e&&0===e.length)||(null===e?Array.from(gt.values()).every(e=>null===e.dependencies||t.includes(e.name)):e.every(e=>t.includes(e)))}function yt(e,t){let i=[];for(let n of e)vt(n.dependencies,t)&&i.push(n.name);return i}function xt(e,t){return i=>{if("y"===t||"both"===t){let t=-i.deltaY;if(t<0){if(e.scrollHeight-e.scrollTop-e.clientHeight<1)return"bottom"}else if(t>0&&0===e.scrollTop)return"top"}if("x"===t||"both"===t){let t=-i.deltaX;if(t<0){if(e.scrollWidth-e.scrollLeft-e.clientWidth<1)return"right"}else if(t>0&&0===e.scrollLeft)return"left"}return null}}class St{constructor(e,t){this.element=e,this.mode=t;let i=xt(this.element,this.mode);this.wheelHandler=e=>{i(e)?e.preventDefault():e.stopImmediatePropagation()},this.element.addEventListener("wheel",this.wheelHandler),Ie(this.element,"__esc-scroll-container__",this)}destroy(){this.element.removeEventListener("wheel",this.wheelHandler),ze(this.element,"__esc-scroll-container__")}}function Et(e,t="both"){let i=Me(e,"__esc-scroll-container__");null!=i&&i.mode===t||(null!=i&&i.destroy(),new St(e,t))}const kt=e.log.logger("esc.scroll.process");function Nt(e=document.body){st(e),wt(e),function(e=document.body){let t=[];e instanceof HTMLElement&&(e=[e]);for(let i of e){let e=i.querySelectorAll(".esc-scroller, .esc-scroller--horizontal, .esc-scroller--vertical");t.push(...Array.from(e))}kt.debug("Starting to process %d scroller(s).",t.length);for(let e of t){kt.debug("... adding scroller.",e);let t=e.classList.contains("esc-scroller--horizontal"),i=e.classList.contains("esc-scroller--vertical");e.classList.contains("esc-scroller")&&(t=i=!0),Et(e,t&&i?"both":t?"x":"y")}kt.debug("Done processing scrollers.")}(e)}function Ct(e){return Object.keys(e).map(t=>e[t])}function It(e,t,i){return null==e?e:e.map(e=>Mt(e,t,i))}function Mt(e,t,i){if(null==t)throw new Error("Enumeration must be non-null.");if(null==e)return i;let n;if("string"==typeof e&&(n=t[e]))return n;for(let i in t)if(e===t[i])return e;throw new Error(`Enum value '${e}' is invalid - permissible values are '${Ct(t).join("', '")}'.`)}function zt(e){return null!=e&&"object"==typeof e&&"encoded"in e&&"content"in e}function At(e,t){Lt(e,t,!1)}function Tt(e,t){Lt(e,t,!0)}function Lt(e,t,i){if(null!=t)if(null==e)t.empty();else if("string"==typeof e)t.text(e);else if(zt(e))!0===e.encoded?t.html(e.content||""):t.text(e.content||"");else if(Array.isArray(e)){t.empty();for(let i of e)t.append(i)}else if(i&&$t(e))t.empty().append(e.contents()),Dt(e.attr(),t);else{if(!ie(e))throw new Error(`Invalid DOM content: ${u(e)}`);t.empty().append(e)}}function $t(e){if(!e||1!==e.length)return!1;let t=(e.get(0).tagName||"").toLowerCase();return"div"===t||"span"===t}function Ot(t){if(null==t)return null;if("string"==typeof t)return e.$("<span/>").text(t);if("object"==typeof t&&"encoded"in t){if(!0===t.encoded){let i=e.$("<div/>").html(t.content||""),n=i.contents();return $t(n)?n:i}return e.$("<span/>").text(t.content||"")}if(Array.isArray(t)){let i=e.$("<div/>");for(let e of t)i.append(e);return i}return t}function Dt(e,t){if(null!=e&&null!=t)for(let i in e){let n=e[i];if("class"===i)n&&t.addClass(n);else if("style"===i){if(n){let e=t.attr("style");e?(e.trim().endsWith(";")||(e+=";"),t.attr("style",e+n)):t.attr("style",n)}}else{let e=t.attr(i)||void 0;if(e&&e!==n)throw new Error(`Cannot copy source attribute '${i}=${n}' - target has '${i}=${e}'.`);e||t.attr(i,n)}}}var Pt;function _t(e,t){if(null==e||null==t)return;let i=function(e){if(null==e)return e;let t,i;return"object"==typeof e&&"element"in e?(t=e.element,i=Mt(e.type,Pt,Pt.replace)):(t=e,i=Pt.replace),{element:t,type:i}}(t);switch(i.type){case Pt.replace:i.element.replaceWith(e);break;case Pt.merge:Dt(i.element.attr(),e),i.element.replaceWith(e);break;case Pt.inject:Dt(e.attr(),i.element),i.element.append(e.contents());break;case Pt.append:i.element.append(e);break;case Pt.prepend:i.element.prepend(e);break;case Pt.before:i.element.before(e);break;case Pt.after:i.element.after(e);break;default:throw new se(`TargetType not recognized: ${i.type}`)}}!function(e){e.replace="replace",e.merge="merge",e.inject="inject",e.append="append",e.prepend="prepend",e.before="before",e.after="after"}(Pt||(Pt={}));const Ft=new Map;function Rt(e){e=e||"esc-id-";let t=Ft.get(e);return null==t&&(t=0),Ft.set(e,++t),e+t}function Bt(e,t,i){!function(e,t,i){if(null!=e)if(null==t){let t=e.attr()||{};for(let i of Object.keys(t))i.startsWith("data-esc-process-")&&e.attr(i,null)}else{if(!t)throw new Error("Processor name must be non-empty.");{t.startsWith("esc-")&&(t=t.substring(4));let n="data-esc-process-"+t;void 0===i?e.attr(n,null):e.attr(n,null==i?"":rt(i))}}}(e,t,i=function(e){if(null==e)return null;let t={},i=!1;for(let[n,s]of Object.entries(e))void 0!==s&&(t[n]=s,i=!0);return i?t:null}(i))}function Ht(e,t){return"string"==typeof e?function(e,t){if(null==e)return e;let i=/^\s*#?([\s\S]*?)\s*(?:::\s*([\s\S]*?)\s*)?(?:::\s*([\s\S]*?)\s*)?$/.exec(e);if(!i[1])throw new Error(`Invalid callback target: ${e}`);return{target:i[1],method:i[2]||t,transform:i[3]||void 0}}(e,t):e}function jt(e,t){if(null==e)return e;let i=new Set,n=[];for(let s of e){let e=Ht(s,t);if(!e)continue;let r=e.target+"::"+e.method;if(i.has(r))throw new Error(`Target with method '${e.method}' has been duplicated: ${e.target}`);i.add(r),n.push(e)}return n.length?n:void 0}const qt=e.log.logger("esc.framework.preRenderCallbacks");function Ut(e,t){if(!e)return;let i=Array.isArray(e)?e:[e],n=[];for(let e of i)if(e){if("string"!=typeof e)throw new Error(`During pre-rendering, only string-valued ${t} callbacks are allowed: ${e}`);qt.info(`Pre-rendered ${t} callbacks may introduce memory leaks to called objects: ${e}`),n.push(e)}return n.length?n:void 0}function Zt(e,t,i){if(i){let e=Ut(i.onDestroy,"esc-destroy");i=Object.assign({},i,{onDestroy:e})}Bt(e,t,i)}var Yt;Yt||(Yt={});var Gt;!function(e){e.error="error",e.warn="warn",e.info="info",e.success="success"}(Gt||(Gt={}));function Vt(e,t){let i=t(`<div class="esc-c-item esc-m-status-${Mt(e.type,Gt,Gt.info)}" tabindex="0" />`);e.id&&i.attr("data-esc-id",e.id),null!=e.ttl&&i.attr("data-esc-ttl",Math.max(-1,e.ttl)),!1!==e.dismissable&&t('<button class="esc-c-remove esc-icon-close esc-icon-button esc-m-type-subtle esc-m-style-light" tabindex="0" />').appendTo(i);let n=t('<div class="esc-c-body" />').appendTo(i);return Tt(e.body,n),i}const Xt=e.log.logger("esc.widgets.misc.statusmanager");function Wt(t){Xt.info("Rendering module 'esc-status-manager'.");let i=!1!==t.live,n=e.$('<div class="esc-status-manager"/>');for(let i of t.messages||[]){Zt(Vt(i,e.$).appendTo(n),"esc-destroyable",{onDestroy:i.onDestroy})}let s={ttl:t.ttl};return i?Yt.init(n,s):Bt(n,"esc-status-manager",s),function(e,t){null!=e&&(Dt(t.attributes,e),_t(e,t.target))}(n,t),n}let Kt,Qt=[];document.addEventListener("DOMContentLoaded",()=>{if(!Kt){let e=Wt({target:{element:mt(document.body),type:Pt.append},live:!0,ttl:2e3,messages:Qt}).get(0);Kt=Re(e)}});const Jt=Object.freeze({send:e=>(Kt?Kt.send(e):Qt.push(e),Jt),remove:e=>(Kt?Kt.remove(e):Qt=Qt.filter(t=>t.id!==e),Jt),clear:()=>(Kt?Kt.clear():Qt.length=0,Jt)});var ei,ti;function ii(t,i){let n=t.children(".esc-c-decorator");if(i&&i.content){n.length||(n=e.$('<span class="esc-c-decorator esc-decorator" />').appendTo(t));let s=Mt(i.status,ei,ei.info);for(let e of Ct(ei))n.toggleClass(`esc-m-status-${e}`,s===e);Tt(null!=i.encoded?i:i.content,n)}else n.remove()}function ni(e,t,i){if(e){if(e.icon){let n=i('<span class="esc-c-icon"/>').appendTo(t);Tt(e.icon,n)}if(e.label){let n=i('<span class="esc-c-label"/>').appendTo(t);Tt(e.label,n)}e.decoration&&ii(t,e.decoration)}}function si(e,t="Element",i){if(1!==e.length)throw new Error(`${t} must be unique.`);let n=e.get(0);if(n instanceof(i||Element))return n;throw new Error(`${t} must be Element.`)}function ri(e,t){if(!(t instanceof Node))return!1;for(let i of e.get())if(t===i||i instanceof HTMLElement&&i.contains(t))return!0;return!1}function oi(e){Promise.resolve().then(e)}!function(e){e.info="info",e.success="success",e.warn="warn",e.error="error"}(ei||(ei={})),ti||(ti={});function li(e,t,i){if(null==t)return;let n=Array.isArray(t)?t:[t];for(let t of n)ai(e,t,i)}function ai(e,t,i){if(null==t)return;let n;if("string"==typeof t)n=nt(e,i,t,!0,!1);else{if("function"!=typeof t)throw new Error(`Type of ${i} callback not recognized: ${typeof t}`);n=t}e.addEventListener(i,je(n))}function hi(e,t,i,n,s,r,o){let l=jt(t,s);if(null!=l)for(let t of l)ui(e,t,i,n,r,o)}function ui(e,t,i,n,s,r){if(!t)return;let o,l=Pe(t.target),a=t.transform?Ke(s?[n,"id","context","BAIL"]:[n,"id","BAIL"],t.transform,"transform"):void 0;r&&oi(()=>{if(o=Re(l),"function"!=typeof o[t.method])throw new Error(`Target of callback does not have method '${t.method}': ${o}`);let r=Re(e);if(null==r)throw new Error(`Cannot trigger ${i} callback - controller not found on element: ${e}`);let h=`get${n.charAt(0).toUpperCase()}${n.substring(1)}`;if("function"!=typeof r[h])throw new Error(`Controller for ${i} callback does not have getter '${h}': ${r}`);let u=r[h]();if(void 0!==u){if(null!=a){let e=Symbol.for("__ESC_BAIL__");if(u=et(a,s?[u,r.getId(),r.getContext(),e]:[u,r.getId(),e]),u===e)return}ci(o,t.method,u,r.getId())}}),function(e,t,i,n,s){let r=t=>{t.target===t.currentTarget&&e.removeEventListener(i,n,s)};t&&t.addEventListener("esc-destroy",r),e.addEventListener(i,n,s)}(e,l,i,e=>{if(e.target!==e.currentTarget)return;if(!o&&(o=Re(l),"function"!=typeof o[t.method]))throw new Error(`Target of callback does not have method '${t.method}': ${o}`);let i=e[n];if(null!=a){let t=Symbol.for("__ESC_BAIL__");if(i=et(a,s?[i,e.id,e.context,t]:[i,e.id,t]),i===t)return}ci(o,t.method,i,e.id)})}function ci(e,t,i,n){var s;t.startsWith("put")&&(null!=(s=t.charAt(3))&&s===s.toUpperCase())?e[t](n,i):e[t](i)}function di(e,t){t&&li(e,t.onDestroy,"esc-destroy")}function fi(e,t){di(si(e,"Destroyable"),t)}bt("esc-destroyable",fi),ti.init=fi;class mi extends Event{constructor(e){super("esc-data",{bubbles:!0,cancelable:!0,composed:!0}),this.id=e.id,this.data=e.data,this.context=e.context}}function pi(e,t,i){!function(e,t){t.onData((t,i,n)=>e.dispatchEvent(new mi({id:i,data:t,context:n})))}(e,t),gi(e,i)}function gi(e,t,i=!1){t&&(li(e,t.onData,"esc-data"),hi(e,t.updatables,"esc-data","data","setData",!0,i))}function bi(e){if(null==e)return e;if("string"!=typeof e)return e;let t=Ke(["data"],e,"data transform");return e=>et(t,[e])}function wi(e){if(null==e)return e;if("string"!=typeof e)return e;let t=Ke(["data","context"],e,"data transform");return(e,i)=>et(t,[e,i])}bt("esc-bind-data",(function(e,t){let i=si(e,"Data-provider binding");gi(Pe(i.getAttribute("data-esc-id")),t,!0),di(i,t)}));function vi(e,t,i=!1){t&&(li(e,t.onSelection,"esc-selection"),hi(e,t.selectables,"esc-selection","selection","setSelection",!1,i))}function yi(e){if(null==e)return e;if("string"!=typeof e)return e;let t=Ke(["selection"],e,"selection transform");return e=>et(t,[e])}function xi(e,t,i){Ei(e,t,i),pi(e,t,i)}function Si(e,t,i){Ei(e,t,i),vi(e,i,!1)}function Ei(e,t,i){let n=i&&i.onDestroy;null!=t&&"function"==typeof t.destroy&&(null==n?n=[]:Array.isArray(n)||(n=[n]),n.push(()=>t.destroy())),di(e,{onDestroy:n}),Ie(e,"esc-gadget",t)}function ki(e){if(null==e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(ki);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);if(e instanceof Set){let t=new Set;for(let i of e.entries())t.add(ki(i));return t}if(e instanceof Map){let t=new Map;for(let i of e.entries())t.set(ki(i[0]),ki(i[1]));return t}{let t=Object.assign({},null);for(let[i,n]of Object.entries(e))t[i]=ki(n);return t}}function Ni(e){return void 0===e?null:e}function Ci(e){return null===e?void 0:e}function Ii(e,t,i=Mi){if(null===e||null===t)return e===t;let n=typeof e;return n===typeof t&&("object"===n?Array.isArray(e)?Array.isArray(t)&&function(e,t,i,n=!0){return Li(e,t,n,(e,t)=>Ii(e,t,i))}(e,t,i,!0):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():e instanceof RegExp?t instanceof RegExp&&e.source===t.source&&e.global===t.global&&e.ignoreCase===t.ignoreCase&&e.multiline===t.multiline:e instanceof Set?t instanceof Set&&function(e,t,i,n=!0){return function(e,t,i=!0,n){if(e.size!=t.size)return!1;if(i){let i=e.entries(),s=t.entries();for(let t=0;t<e.size;t++){let e=i.next().value,t=s.next().value;if(!n(e,t))return!1}}else{let i=Array.from(t);for(let t of e){let e=i.findIndex(e=>n(t,e));if(e<0)return!1;i.splice(e,1)}}return!0}(e,t,n,(e,t)=>Ii(e,t,i))}(e,t,i,!0):e instanceof Map?t instanceof Map&&function(e,t,i,n=!0){return function(e,t,i,n){if(e.size!=t.size)return!1;if(i){let i=e.entries(),s=t.entries();for(let t=0;t<e.size;t++){let e=i.next().value,t=s.next().value;if(e[0]!==t[0]||!n(e[1],t[1]))return!1}}else for(let[i,s]of e.entries())if(!t.has(i)||!n(s,t.get(i)))return!1;return!0}(e,t,n,(e,t)=>Ii(e,t,i))}(e,t,i,!0):!(Array.isArray(t)||t instanceof Date||t instanceof RegExp||t instanceof Set||t instanceof Map)&&i(e,t):"number"===n&&Number.isNaN(e)?Number.isNaN(t):e===t)}function Mi(e,t){return Ai(Object.keys(e),Object.keys(t))&&Object.keys(e).every(i=>i in t&&Ii(e[i],t[i],Mi))}function zi(e,t){return Object.keys(e).every(i=>Ii(e[i],t[i],zi))&&Object.keys(t).every(i=>void 0!==e[i]||void 0===t[i])}function Ai(e,t,i=!0){return Li(e,t,i,$i)}function Ti(e,t,i=!0){return Li(e,t,i,Ii)}function Li(e,t,i,n){if(e.length!=t.length)return!1;if(i)return e.every((e,i)=>n(e,t[i]));t=t.slice();for(let i of e){let e=t.findIndex(e=>n(i,e));if(e<0)return!1;t.splice(e,1)}return!0}function $i(e,t){return e===t}function Oi(e,t){if(e===t)return 0;if(null===e)return void 0===t?-1:1;if(void 0===e)return 1;{if(null==t)return-1;let i=typeof e;if(i!==typeof t)throw new Error(`Objects must be of same type to be sorted (${i} !== ${typeof t}).`);switch(i){case"string":return e.localeCompare(t,"en");case"number":return e-t;case"boolean":return e?-1:1;case"object":if(!(e instanceof Date&&t instanceof Date))throw new Error(`Object of type 'object' cannot be sorted unless it is a Date: ${e instanceof Date?t:e}`);return e.getTime()-t.getTime();default:throw new Error(`Object of type '${i}' cannot be sorted.`)}}}var Di,Pi;function _i(e){return null==e.mode||function(e){if(!e)return!1;switch(e){case Di.wmean:case Di.wsd:return!1;default:return!0}}(e.mode)}function Fi(e){return e&&e.map(e=>Ri(e))}function Ri(e){if("string"!=typeof e)return e;let t=/^\s*(.*?)(?:\s+as\s+(.*?))?\s*$/i.exec(e),i=t[2]||void 0;if(e=t[1],t=/^(first|count|count_distinct|sum|min|max|mean|sd|hist)\s*\(\s*(.*?)\s*\)$/i.exec(e)){let n=t[1].toLowerCase();return{variable:e=t[2].replace(/\\([\s(),\\])/g,"$1"),mode:n,alias:i}}if(t=/^(wmean|wsd)\s*\(\s*(.*?)\s*,\s*(.*?)\s*\)$/i.exec(e)){let n=t[1].toLowerCase(),s=t[2].replace(/\\([\s(),\\])/g,"$1");return{variable:e=t[3].replace(/\\([\s(),\\])/g,"$1"),weight:s,mode:n,alias:i}}return{variable:e,alias:i}}function Bi(e){return null==e?e:e.map(e=>Hi(e)).join(",")}function Hi(e){if(!e||!e.variable)throw new Error("Variable must have non-naught name.");let t,i=e.mode||Di.plain,n=escape(e.variable);if(_i(e))t=i===Di.plain?n:`${i}(${n})`;else{if(!e.weight)throw new Error(`Variable '${e.variable}' must have non-naught weight.`);t=`${i}(${escape(e.weight)},${n})`}return e.alias&&(t+=` as ${escape(e.alias)}`),t}function ji(e){return e&&e.map(e=>function(e){if("string"!=typeof e)return e;let t=/^\s*(.*?)(?:\s*(asc|desc))?\s*$/i.exec(e),i=Ri(t[1]);if(i.alias)throw new Error(`Sort does not support alias: ${e}`);let n=t[2]?t[2].toLowerCase():void 0;return _i(i)?{variable:i.variable,mode:i.mode,direction:n}:{variable:i.variable,mode:i.mode,weight:i.weight,direction:n}}(e))}function qi(e){return null==e?e:e.map(e=>function(e){let t=Hi(e);e.direction===Pi.desc&&(t+="-");return t}(e)).join(",")}function Ui(e,t){return null==e||null==t?e===t:qi(e)===qi(t)}function Zi(e,t){if(null==e)return e;if(null==t||0===t.length)return e.slice();let i=function(e){if(null==e)return e;for(let t of e)if(null!=t.mode&&t.mode!==Di.plain)throw new Error(`Sorting in non-plain variable mode '${t.mode}' is not supported.`);return(t,i)=>{for(let n of e){let e=Oi(t[n.variable],i[n.variable]);if(0!==e)return n.direction===Pi.desc?-e:e}return 0}}(t);return e.slice().sort(i)}bt("esc-bindings",(function(e,t){let i=si(e,"Bindings"),n=function(e){if(null!=(e=e||{}).script){return et(Ke([],e.script),[])}return e.data}(t);return Ei(i,n,t),n})),function(e){e.plain="plain",e.first="first",e.count="count",e.count_distinct="count_distinct",e.sum="sum",e.min="min",e.max="max",e.mean="mean",e.sd="sd",e.wmean="wmean",e.wsd="wsd",e.hist="hist"}(Di||(Di={})),function(e){e.asc="asc",e.desc="desc"}(Pi||(Pi={}));const Yi={eq:"=",ge:">=",gt:">",le:"<=",lt:"<"};function Gi(e){if(null==e)return e;if("not"===e.op){if(!e.filter)throw new Error("Not filter must have non-null base filter.");return{op:"not",filter:Gi(e.filter)}}if("and"===e.op||"or"===e.op){if(!Array.isArray(e.filters))throw new Error(`And/or filter must have array of base filters: ${u(e)}`);return{op:e.op,filters:e.filters.map(e=>Gi(e))}}return function(e){if(!e.variable)throw new Error(`Filter must have non-naught variable name: ${u(e)}`);if("in"===e.op){if(!Array.isArray(e.values))throw new Error(`In-filter must have values array: ${u(e)}`);return{op:"in",variable:e.variable,values:e.values.map(e=>Xi(e))}}if("like"===e.op){if(!e.value||"string"!=typeof e.value)throw new Error(`Like-filter must have non-naught pattern: ${u(e)}`);return{op:"like",variable:e.variable,value:e.value}}if(!Yi[e.op])throw new Error(`Filter type '${e.op}' not recognized.`);return{op:e.op,variable:e.variable,value:Vi(e.value,e.op)}}(e)}function Vi(e,t){return"eq"===t?Xi(e):function(e){if(null==e)throw new Error("Null is not permitted as value of numeric filter.");if("number"==typeof e||e instanceof Date)return e;throw new Error(`Type '${typeof e}' not permitted as value of numeric filter.`)}(e)}function Xi(e){if(null==e)return null;if(e instanceof Date)return e;let t=typeof e;if("string"===t||"boolean"===t||"number"===t)return e;throw new Error(`Type '${t}' not permitted as value of filter.`)}function Wi(e,t){return null==e||null==t?e===t:Ki(e)===Ki(t)}function Ki(e){if(null==e)return e;if("not"===e.op){if(!e.filter)throw new Error(`Not filter must have non-null base filter: ${u(e)}`);return Qi(e.filter,!0)}if("and"===e.op||"or"===e.op){if(!Array.isArray(e.filters))throw new Error(`And/or filter must have array of base filters: ${u(e)}`);let t="";for(let i of e.filters)t&&(t+="and"===e.op?" & ":" | "),"and"===i.op||"or"===i.op?t+="("+Ki(i)+")":t+=Ki(i);return t}return Qi(e,!1)}function Qi(e,t){if(!e.variable)throw new Error(`Filter must have non-naught variable name: ${u(e)}`);let i=e.variable.replace(/([\s=><~!,&|()\\])/g,"\\$1");if(t&&(i+="!"),"in"===e.op){if(!Array.isArray(e.values))throw new Error(`In-filter must have values array: ${u(e)}`);i+="="+e.values.map(e=>Ji(e)).join(",")}else if("like"===e.op){if(!e.value||"string"!=typeof e.value)throw new Error(`Like-filter must have non-naught pattern: ${u(e)}`);i+=(e.caseInsensitive?"~~":"~")+"/"+e.value.replace(/([\/\\])/g,"\\$1")+"/"}else{let t=Yi[e.op];if(!t)throw new Error(`Filter type '${e.op}' not recognized.`);i+=t+Ji(Vi(e.value,e.op))}return i}function Ji(e){if(null==e)return"\\0";let t=typeof e;if("string"===t)return"'"+e.replace(/'/g,"''")+"'";if("boolean"===t||"number"===t)return e.toString();if(e instanceof Date)return"'"+e.toISOString()+"'";throw new Error(`Object type not recognized: ${t}`)}function en(e,t,i,n,s){if(!e)return e;let r=tn(t);if(null!=n&&n<0&&(n=null),null!=s&&s<0&&(s=null),null!=i&&(e=Zi(e,i)),null==n&&null==s)return e.filter(e=>r(t=>e[t]));{null==n&&(n=0),null==s&&(s=Number.MAX_SAFE_INTEGER);let t=[];if(s>0)for(let i of e)if(r(e=>i[e]))if(n>0)n--;else if(t.push(i),--s<=0)break;return t}}function tn(e){if(null==e)return()=>!0;if("not"===e.op){if(!e.filter)throw new Error("Not filter must have non-null base filter.");let t=tn(e.filter);return e=>!t(e)}if("and"===e.op||"or"===e.op){if(!Array.isArray(e.filters))throw new Error(`And/or filter must have array of base filters: ${u(e)}`);let t=e.filters.map(e=>tn(e));return"and"===e.op?e=>t.every(t=>t(e)):e=>t.some(t=>t(e))}return function(e){if(!e.variable)throw new Error(`Filter must have non-naught variable name: ${u(e)}`);if("in"===e.op){let t=e.values.map(e=>Xi(e));return i=>{let n=i(e.variable);return t.some(e=>Ii(e,n))}}if("like"===e.op){if(!e.value||"string"!=typeof e.value)throw new Error(`Like-filter must have non-naught pattern: ${u(e)}`);let n=(t=e.value,i=!!e.caseInsensitive,t=(t=(t=t.replace(/([\\.\\[\\]\\{\\}\\(\\)\\?\\*\\+\\-\\|\\&\\!\\^\\$])/g,"\\\\$1")).replace(/((?:^|[^\\\\])(?:\\\\\\\\)*)_/g,"$1.")).replace(/((?:^|[^\\\\])(?:\\\\\\\\)*)%/g,"$1.*"),new RegExp("^"+t+"$",i?"i":""));return t=>{let i=t(e.variable);if(null==i)return!1;if("string"!=typeof i)throw new Error(`Filter ${u(e)} does not apply to value: ${i}`);return n.test(i)}}{if(!Yi[e.op])throw new Error(`Filter type '${e.op}' not recognized.`);let t=Vi(e.value,e.op),i=t instanceof Date,n=typeof t;return i&&(t=t.getTime()),s=>{let r=s(e.variable);if(null==r)r=null;else if(null!=t&&(i!==r instanceof Date||n!==typeof r))throw new Error(`Filter ${u(e)} does not apply to value: ${r}`);switch(i&&(r=r&&r.getTime()),e.op){case"eq":return t===r;case"ge":return t>=r;case"gt":return t>r;case"le":return t<=r;case"lt":return t<r;default:throw new se(`Filter operation not recognized: '${e.op}'`)}}}var t,i}(e)}var nn;!function(e){e.idempotent="idempotent",e.replay="replay"}(nn||(nn={}));const sn=e.log.logger("esc.data.AbstractDataProvider");class rn{constructor(e){this.dataCallbacks=new Set,this.id=e.id,this.eventMode=e.eventMode||nn.idempotent,this._validateData=e.validateData||null}getId(){return this.id}getContext(){return ki(this.context)}updateData(e,t,i){sn.debug("Setting data for '%s' in context %o (notify=%o): %o",this.getId(),t,i,e),this.context=ki(t),e=this.validateData(e,this.context);let n=this.isChangedData(e);return sn.debug("Data for '%s' has %schanged - old data: %o",this.getId(),n?"":"not ",this.data),n&&(this.data=e),i&&(n||this.eventMode===nn.replay)&&this.fireOnData(this.getData(),this.getContext()),n}validateData(e,t){return null==this._validateData?e:this._validateData(e,t)}isChangedData(e){return void 0===this.data?void 0!==e:!this.equalsData(e,this.data)}equalsData(e,t){return Ii(e,t)}getData(){return ki(this.data)}onData(e){return null!=e&&this.dataCallbacks.add(e),this}offData(e){return null!=e&&this.dataCallbacks.delete(e),this}fireOnData(e,t){sn.debug("Firing onData '%s' for %d callback(s): data=%o, context=%o",this.getId(),this.dataCallbacks.size,e,t),this.doFireOnData(e,t)}doFireOnData(e,t){for(let i of this.dataCallbacks)i(e,this.id,t)}}class on extends rn{constructor(){super(...arguments),this.tasks=new Map}lookupSingleton(e,t){return this._bind(e,t,null,null,null,!0,!1)}lookup(e,t,i,n,s){return this._bind(e,t,Ni(i),Ni(n),Ni(s),!1,!1)}bindSingleton(e,t){return this._bind(e,t,null,null,null,!0,!0)}bind(e,t,i,n,s){return this._bind(e,t,Ni(i),Ni(n),Ni(s),!1,!0)}_bind(e,t,i,n,s,r,o){null!=n&&n<=0&&(n=null),null!=s&&s<0&&(s=null);let l={filter:t,singleton:r,sort:i,offset:n,limit:s};return o&&this.tasks.set(e,l),oi(()=>this.refreshTask(e,l)),this}unbind(e){return this.tasks.delete(e),this}refreshTask(e,t){let i=(0!==t.limit?this.getData():[])||[];if(i=en(i,t.filter,t.sort,t.offset,t.limit),t.singleton){if(i.length>1)throw new Error(`Bound data task expected single datum: ${e}`);e(i.length?i[0]:null)}else e(i)}doFireOnData(e,t){for(let e of this.tasks.entries())this.refreshTask(...e);super.doFireOnData(e,t)}}var ln;function an(e){if(null==e)return e;let t=e.columns;if(new Set(t).size!==t.length)throw new Error(`Dataset with duplicate column names cannot be mapped: ${t.join()}`);let i=e.total,n=t.length;return{data:e.data.map(e=>{let i={};for(let s=0;s<n;s++)i[t[s]]=e[s];return i}),total:i}}function hn(e){return e?{variables:Fi(e.variables),filter:Gi(e.filter),groups:e.groups&&e.groups.slice(),sort:ji(e.sort),offset:e.offset,limit:e.limit,total:e.total}:e}function un(e,t){return null==e||null==t?e===t:(i=e.variables||null,n=t.variables||null,(null==i||null==n?i===n:Bi(i)===Bi(n))&&Wi(e.filter,t.filter)&&Ai(e.groups||[],t.groups||[])&&Ui(e.sort||null,t.sort||null)&&(null==e.offset?0:e.offset).toFixed(0)===(null==t.offset?0:t.offset).toFixed(0)&&(null==e.limit?"":e.limit.toFixed(0))===(null==t.limit?"":t.limit.toFixed(0))&&!0===e.total==(!0===t.total));var i,n}function cn(e){let t={};if(null!=e){let n;(n=Bi(e.variables))&&(t.vars=n),(n=Ki(e.filter))&&(t.filter=n),(n=null==(i=e.groups)?i:Array.from(new Set(i)).filter(e=>!!e).map(e=>e.replace(/([\s,\\])/g,"\\$1")).join(","))&&(t.group=n),(n=qi(e.sort))&&(t.sort=n),null!=e.offset&&(t.offset=e.offset.toFixed(0)),null!=e.limit&&(t.limit=e.limit.toFixed(0)),null!=e.total&&(t.total=e.total.toString())}var i;return t}function dn(e){if(null==e)return"";let t="";return Object.keys(e).forEach(i=>{t&&(t+="&");let n=e[i],s=encodeURIComponent(i);null==n?t+=`${s}=`:"string"==typeof n?t+=`${s}=${encodeURIComponent(n)}`:n.forEach(e=>t+=`${s}=${encodeURIComponent(e)}`)}),t}function fn(e){switch(e){case 401:return"You are not authenticated: Try refreshing this web page.";case 403:return"You are not authorized to perform this operation.";default:return"This webpage cannot connect to the server."}}!function(e){e.STRING="STRING",e.LONG="LONG",e.INTEGER="INTEGER",e.DOUBLE="DOUBLE",e.DECIMAL="DECIMAL",e.BOOLEAN="BOOLEAN",e.TIME="TIME",e.XML="XML",e.STRING_ARRAY="STRING_ARRAY",e.LONG_ARRAY="LONG_ARRAY",e.INTEGER_ARRAY="INTEGER_ARRAY",e.DOUBLE_ARRAY="DOUBLE_ARRAY",e.DECIMAL_ARRAY="DECIMAL_ARRAY",e.BOOLEAN_ARRAY="BOOLEAN_ARRAY",e.TIME_ARRAY="TIME_ARRAY",e.XML_ARRAY="XML_ARRAY",e.OBJECT_ARRAY="OBJECT_ARRAY"}(ln||(ln={}));const mn=e.log.logger("esc.http.HttpRequest");var pn,gn,bn;!function(e){e.HEAD="HEAD",e.GET="GET",e.POST="POST",e.PUT="PUT",e.PATCH="PATCH",e.DELETE="DELETE"}(pn||(pn={})),function(e){e.plain="plain",e.json="json",e.serial="serial",e.formEncoded="form-encoded"}(gn||(gn={})),function(e){e.arraybuffer="arraybuffer",e.blob="blob",e.formdata="formdata",e.json="json",e.text="text"}(bn||(bn={}));const wn=e=>{if(200===e.status)return e.data;throw e.data};class vn{constructor(e){this.options=Object.assign({},e),this.validate()}validate(){if("object"!=typeof this.options)throw new Error("Options must be non-null object.");if(this.options.method||(this.options.method=pn.GET),!this.options.url)throw new Error("Request URL must be non-null and non-empty.");this.options.sendDataInBody=!0===this.options.sendDataInBody}initialize(){if(null!=this.controller)throw new Error(`Request ${this.options.method} ${this.options.url} has been sent already.`);this.controller=new AbortController,this.options.onCancel&&this.options.onCancel(()=>this.abort()),null!=this.options.timeout&&this.options.timeout>0&&(mn.info("Setting timeout of %ims for request %s %s.",this.options.timeout,this.options.method,this.options.url),setTimeout(()=>{mn.info("Request %s %s has timed out - aborting.",this.options.method,this.options.url),this.controller.abort()},this.options.timeout))}send(e,t){mn.info("Requesting %s %s.",this.options.method,this.options.url),this.initialize();let i=this.data();null!=i&&mn.debug("request data=%o",i);let n=this.options.parser||wn;fetch(this.url(),{method:this.options.method||pn.GET,mode:"cors",cache:"default",credentials:!1===this.options.withCredentials?"omit":"same-origin",headers:this.getHeaders(),redirect:"follow",keepalive:!1,body:i,signal:this.controller.signal}).then(i=>{mn.info("Receiving %i response to %s %s: %o",i.status,this.options.method,this.options.url,i),this.extractResponse(i).then(s=>{mn.info("Done extracting response to %s %s (%i) as %s.",this.options.method,this.options.url,i.status,typeof s);let r,o={headers:Array.from(i.headers.entries()),redirected:i.redirected,status:i.status,type:i.type,url:i.url,data:s};try{r=n(o),mn.debug("parsed data=",r)}catch(e){return mn.error("Failed parsing response to %s %s (%i): %o",this.options.method,this.options.url,i.status,"string"==typeof e?c(e,500):e),void t({status:i.status,response:e})}e(r)},e=>{mn.error("Failed parsing response to %s %s (%i): %o",this.options.method,this.options.url,i.status,"string"==typeof e?c(e,500):e),t({status:i.status,response:"Failed to parse response body."})}),i.trailer&&mn.warn("Trailing headers are not supported.")},e=>{mn.error("Failed request %s %s (-1): %o",this.options.method,this.options.url,"string"==typeof e?c(e,500):e),t({status:-1,response:"Failed request."})})}url(){let e=this.options.url;return null==this.options.data||this.options.sendDataInBody||(e=function(e,t){let i,n=dn(t);if(!n)return e;let s="";return(i=e.indexOf("#"))>=0&&(s=e.substring(i),e=e.substring(0,i)),(i=e.indexOf("?"))<0?e+="?":i+1<e.length&&(e+="&"),e+=n+s}(e,this.options.data)),e}getHeaders(){let e=this.options.headers?this.options.headers.slice():[];return!e.some(e=>"Content-Type"===e[0])&&this.options.sendDataInBody&&(this.options.requestType===gn.formEncoded?e.push(["Content-Type","application/x-www-form-urlencoded"]):this.options.requestType!==gn.json&&this.options.requestType!==gn.serial||e.push(["Content-Type","application/json"])),e}data(){return null!=this.options.data&&this.options.sendDataInBody?this.options.requestType===gn.formEncoded?dn(this.options.data)||null:this.options.requestType===gn.json?this.options.data&&JSON.stringify(this.options.data):this.options.requestType===gn.serial?this.options.data&&rt(this.options.data):this.options.data:null}extractResponse(e){let t=this.options.responseType||bn.text;switch(t){case bn.text:return e.text();case bn.json:return e.json();case bn.blob:return e.blob();case bn.arraybuffer:return e.arrayBuffer();case bn.formdata:return e.formData();default:throw new se(`HTTP response type not recognized: ${t}`)}}then(e,t){return new Promise((e,t)=>this.send(e,t)).then(e,t)}abort(){return null!=this.controller&&(mn.info("Aborting request %s %s.",this.options.method,this.options.url),this.controller.abort()),this}}function yn(e){return e instanceof Error?e.message:"string"==typeof e?e:""+e}const xn=e.log.logger("esc.sessionstorage.SessionStorageManager");class Sn{constructor(e){if(!e.namespace)throw new Error("Namespace must be non-naught.");this.namespace=e.namespace,this.checkExpiration()}add(e,t,i=0){let n=Date.now(),s=this.getNextExpiration(),r=null!=t&&i>0;if(!r&&this.getEntry(`${this.namespace}-${e}`,!0)&&(xn.info("Deleting key '%s' in namespace '%s'.",e,this.namespace),sessionStorage.removeItem(e)),this.checkExpiration(n,s),r){let r=n+1e3*i;this.setEntry(`${this.namespace}-${e}`,{value:t,expiration:r}),(null==s||r<s)&&this.setNextExpiration(r)}return this}get(e){this.checkExpiration(),xn.info("Retrieving key '%s' in namespace '%s'.",e,this.namespace);let t=this.getEntry(`${this.namespace}-${e}`);return xn.info("%s key '%s' in namespace '%s'.",t?"Returning value for":"Cannot find",e,this.namespace),t&&t.value}remove(e){return this.checkExpiration(),xn.info("Removing key '%s' in namespace '%s'.",e,this.namespace),sessionStorage.removeItem(`${this.namespace}-${e}`),this}expire(){return this.doExpire(Date.now()),this}getNextExpiration(){let e=sessionStorage.getItem(this.namespace);if(null==e)return;let t=parseInt(e);if(!Number.isInteger(t))throw new Error(`IllegalStateException: Expiration marker is not an integer: '${e}'`);return t}setNextExpiration(e){xn.info("Scheduling expiration check at %i in namespace '%s'.",e,this.namespace);try{sessionStorage.setItem(this.namespace,e.toString())}catch(e){xn.error("Failed to set key next expiration in namespace '%s'.",this.namespace,e)}}checkExpiration(e,t){null==e&&(e=Date.now()),null==t&&(t=this.getNextExpiration()),(null==t||e>t)&&(xn.info("Triggering scheduled expiration check in namespace '%s'.",this.namespace),this.doExpire(e))}doExpire(e){xn.info("Expiring entries in namespace '%s'.",this.namespace);let t=sessionStorage.length,i=Number.MAX_VALUE,n=[];for(let s=0;s<t;s++){let t=sessionStorage.key(s);if(!t.startsWith(`${this.namespace}-`))continue;let r=this.getEntry(t,!0);r.expiration<e?n.push(t):r.expiration<i&&(i=r.expiration)}xn.info("Found %i expired entries in namespace '%s'.",n.length,this.namespace);for(let e of n)sessionStorage.removeItem(e);this.setNextExpiration(i),xn.info("Done expiring entries in namespace '%s'.",this.namespace)}getEntry(e,t=!1){let i=sessionStorage.getItem(e);return this.parse(i,t)}setEntry(e,t){xn.info("Setting key '%s' in namespace '%s'.",e,this.namespace);let i=this.write(t);try{sessionStorage.setItem(e,i)}catch(t){xn.error("Failed to set key '%s' in namespace '%s'.",e,this.namespace,t)}}write(e){return`${e.expiration}:${e.value}`}parse(e,t=!1){if(null==e)return null;let i=e.indexOf(":");if(i<0)throw new se(`Cannot parse storage entry '${e}'.`);return{expiration:parseInt(e.substring(0,i)),value:t?"":e.substring(i+1)}}}const En=e.log.logger("esc.rest.selection.SelectionDao");class kn{constructor(e){let t;t=(e=e||{}).url?e.url.endsWith("/")?e.url.substring(0,e.url.length-1):e.url:"",this.dataParser=e.parser||null,this.httpOptions={url:t,responseType:e.responseType||bn.json,headers:e.headers,withCredentials:e.withCredentials,timeout:e.timeout,onCancel:e.onCancel},this.baseSelection=e.baseSelection||{},this.storage=new Sn({namespace:"_SELECTION-DAO"})}makeResponseParser(e,t){return i=>{let n=function(e){if(200===e.status)return e.data;throw{status:e.status,code:null==e.data.code?-1:e.data.code,userMessage:e.data.userMessge||"The webpage failed to communicate with the server.",developerMessage:e.data.developerMessage||yn(e.data)}}(i),s=this.getMaxAge(i.headers),r=this.request2key(e,t);return this.storage.add(r,n,s),this.json2data(n)}}json2data(e){let t=at(e);return this.dataParser&&(t=this.dataParser(t)),t}request2key(e,t){return t?rt({url:e,data:t}):e}getMaxAge(e){let t=0;if(e)for(let i of e)if("cache-control"===i[0].toLowerCase()){let e=i[1];if(/no-store/i.test(e))return 0;let n=/max-age\s*=\s*(\d+)/i.exec(e);n&&(t=parseInt(n[1]))}return t}url(e){return e?this.httpOptions.url?this.httpOptions.url+"/"+e:e:this.httpOptions.url}selection(e){if(null==e)return this.baseSelection;let t=this.baseSelection.filter;return null!=e.filter&&(t=null==t?e.filter:{op:"and",filters:[t,e.filter]}),{variables:e.variables||this.baseSelection.variables,filter:t,groups:e.groups||this.baseSelection.groups,sort:e.sort||this.baseSelection.sort,total:null!=e.total?e.total:this.baseSelection.total,offset:e.offset,limit:e.limit}}get(e,t){let i=this.url(e),n=cn(t=this.selection(t)),s=this.request2key(i,n),r=this.storage.get(s);return null!=r?(En.info("Resolving data from cache: url=%s, selection=%o",i,n),new Promise(e=>{e(this.json2data(r))})):(En.info("Requesting data: url=%s, selection=%o",i,n),new vn({url:i,method:pn.POST,requestType:gn.serial,responseType:bn.text,headers:this.httpOptions.headers,withCredentials:this.httpOptions.withCredentials,timeout:this.httpOptions.timeout,parser:this.makeResponseParser(i,n),onCancel:this.httpOptions.onCancel,data:n,sendDataInBody:!0}))}}class Nn{constructor(e){e=e||{},this.dao=new kn({url:e.url,headers:e.headers,withCredentials:e.withCredentials,timeout:e.timeout,onCancel:e.onCancel}),this.baseSelection=hn(e.baseSelection)||{},this.parser=e.parser||null}get(e,t){let i={variables:Fi((t=t||{}).variables||this.baseSelection.variables)||void 0,filter:t.filter&&this.baseSelection.filter?{op:"and",filters:[this.baseSelection.filter,t.filter]}:t.filter||this.baseSelection.filter,groups:t.groups||this.baseSelection.groups,sort:ji(t.sort)||this.baseSelection.sort,total:null!=t.total?t.total:this.baseSelection.total,offset:t.offset,limit:t.limit};return new Promise((t,n)=>{this.dao.get(e,i).then(e=>{if(t){let i=this.parseData(e),n=this.parser?this.parser(i):i;t(n)}},n)})}parseData(e){if(null==e)return null;if(null==e.columns)throw new Error("Response must have non-null field 'columns' to be parsed as Dataset.");if(!Array.isArray(e.columns))throw new Error("Response must have array-valued field 'columns' to be parsed as Dataset.");if(null==e.types)throw new Error("Response must have non-null field 'types' to be parsed as Dataset.");if(!Array.isArray(e.types))throw new Error("Response must have array-valued field 'types' to be parsed as Dataset.");if(!Array.isArray(e.data))throw new Error("Response must have array-valued field 'data' to be parsed as Dataset.");let t={columns:e.columns,types:It(e.types,ln),data:e.data,total:e.total};return this.castDataset(t)}castDataset(e){let t=this.needConversion(e.types);if(t.length>0){let i=e.data;for(let n of i)for(let i of t){let t=e.types[i],s=n[i],r=this.convert(s,t);n[i]=r}}return e}needConversion(e){let t=[];for(let i=0;i<e.length;i++){let n=e[i];n!==ln.DOUBLE&&n!==ln.DOUBLE_ARRAY&&n!==ln.TIME&&n!==ln.TIME_ARRAY||t.push(i)}return t}convert(e,t){if(null==e)return null;if(t===ln.DOUBLE)return dt(e);if(t===ln.DOUBLE_ARRAY){if(!Array.isArray(e))throw new Error(`Cannot convert non-array to double_array: ${u(e)}`);return e.map(dt)}if(t===ln.TIME)return new Date(e);if(t===ln.TIME_ARRAY){if(!Array.isArray(e))throw new Error(`Cannot convert non-array to time_array: ${u(e)}`);return e.map(e=>new Date(e))}return e}}var Cn;!function(e){e.idempotent="idempotent",e.replay="replay",e.refresh="refresh"}(Cn||(Cn={}));const In=e.log.logger("esc.rest.dataset.SelectableDataDao");class Mn extends on{constructor(e){super({id:e.id,eventMode:e.eventMode===Cn.refresh||e.eventMode===Cn.replay?nn.replay:nn.idempotent,validateData:e.validateData}),this.counter=0,this.restSelectionMode=e.eventMode||Cn.idempotent,this._validateSelection=e.validateSelection||null,this.dao=new Nn({url:e.url,headers:e.headers,withCredentials:e.withCredentials,timeout:e.timeout,onCancel:e.onCancel,baseSelection:e.baseSelection,parser:e=>null==e?[]:an(e).data}),this.onError=e.onError||void 0}getSelection(){return ki(this.selection)}setSelection(e){In.debug("Setting selection for '%s': %o",this.getId(),e);const t=null==e?void 0:e.context;let i=this.validateSelection(e),n=!un(i,this.selection);if(In.debug("Selection for '%s' has %schanged - old selection: %o",this.getId(),n?"":"not ",this.selection),n&&(this.selection=i),n||this.restSelectionMode===Cn.refresh){const e=++this.counter;this.dao.get(null,this.selection).then(i=>this.onSuccess(i,e,t),i=>this.onFailure(i,e,t))}else this.restSelectionMode===Cn.replay&&void 0!==this.data&&this.fireOnData(this.getData(),t);return this}validateSelection(e){let t=hn(e)||null;return this._validateSelection&&(t=this._validateSelection(t)||null),t}onSuccess(e,t,i){t==this.counter?this.updateData(e,i,!0):In.info("Rejecting stale successful response in context %o (%d != %d): %o",i,t,this.counter,e)}onFailure(e,t,i){t==this.counter?("object"==typeof e&&"status"in e?In.error("Data request failed (%s): %o",e.status,e.response):In.error("Data request failed: %s",e),this.onError&&this.onError(e),this.updateData([],i,!0)):In.info("Rejecting stale failed response in context %o (%d != %d): %o",i,t,this.counter,e)}}function zn(e){return An(e)||""}function An(e){return e.getAttribute("name")||e.getAttribute("data-esc-id")||e.getAttribute("id")}function Tn(e){let t=J(),i=t[e];if(null==i)throw new Error(`Key '${e}' not found in dictionary '${t.lang}'.`);return i}function Ln(e){return Tn("esc.error.remote.runtime")[e]}const $n=new Set,On=t=>{let i,n=t.status;if(!$n.has(n)){switch($n.add(n),n){case 403:i=Ln("error.403");break;default:i=Ln("error.fallback")(n)}Jt.send({type:Gt.error,body:[e.$("<h4/>").text(Ln("error.title")),e.$("<p/>").text(i)],ttl:-1,onDestroy:()=>$n.delete(n)})}};function Dn(e,t){Pn(new Blob([e],{type:"text/bin"}),t)}function Pn(e,t){let i=URL.createObjectURL(e);try{!function(e,t){let i=document.createElement("a");i.download=t,i.href=e,i.target="_self",i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}(i,t)}finally{URL.revokeObjectURL(i)}}bt("esc-dao",(function(e,t){let i=si(e,"Selectable DAO"),n=zn(i),s=function(e){let t=yi(e.validateSelection),i=wi(e.validateData),n=new Mn({id:e.id||"",url:e.url,headers:e.headers,withCredentials:e.withCredentials,timeout:e.timeout,eventMode:e.eventMode,validateSelection:t,baseSelection:e.baseSelection,onError:On,validateData:i});void 0!==e.selection&&n.setSelection(e.selection);return n}(Object.assign({},t,{id:n}));return xi(i,s,t),s}));const _n=e.log.logger("esc.rest.export.SelectableDataExporter");var Fn;!function(e){e.csv="csv",e.csvAnnotated="csv-annotated",e.xlsx="xlsx"}(Fn||(Fn={}));class Rn{constructor(e){if(!e.fileBaseName)throw new Error("Data exporter must have non-naught file name.");this.id=e.url,this.fileBaseName=e.fileBaseName,this.httpOptions={url:e.url,method:pn.POST,headers:e.headers,withCredentials:e.withCredentials,timeout:e.timeout,responseType:bn.blob,onCancel:e.onCancel},this._validateSelection=e.validateSelection||null,this.baseSelection=hn(e.baseSelection)||{},this.format=e.baseSelection&&e.baseSelection.format||Fn.csv,this.selection=this.validateSelection(e.selection),this.onStart=e.onStart||void 0,this.onComplete=e.onComplete||void 0,this.onError=e.onError||void 0}getId(){return this.id}getSelection(){return ki(this.selection)}setSelection(e){return _n.debug("Setting selection: %o",e),this.selection=this.validateSelection(e),this}validateSelection(e){if(!e)return null;let t=hn(e);return t.format=e.format||void 0,this._validateSelection&&(t=this._validateSelection(t)||null),t}download(){let e,t=hn(this.selection||{}),i=t.filter&&this.baseSelection.filter?{op:"and",filters:[this.baseSelection.filter,t.filter]}:t.filter||this.baseSelection.filter,n=this.selection&&this.selection.format||this.format;switch(n){case Fn.csv:case Fn.csvAnnotated:e="csv";break;case Fn.xlsx:e="xlsx";break;default:throw new se("Export format not recognized: "+n)}let s=cn({variables:t.variables||this.baseSelection.variables,filter:i,groups:t.groups||this.baseSelection.groups,sort:t.sort||this.baseSelection.sort,offset:t.offset,limit:t.limit});s.format=n;let r=`${this.fileBaseName}.${e}`;return _n.debug("Scheduling download %s: %o",this.httpOptions.url,this.selection),this.onStart&&this.onStart(),new vn(Object.assign({},this.httpOptions,{requestType:gn.serial,sendDataInBody:!0,data:s})).then(e=>{_n.debug("Downloading %s.",this.httpOptions.url),Dn(e,r),_n.debug("Done downloading  %s.",this.httpOptions.url),this.onComplete&&this.onComplete()},this.onError),this}}function Bn(e){return e&&e.map(Hn)}function Hn(e){if("string"!=typeof e)return e;let t=/^\s*(.*?)(?:\s+as\s+(.*?))?\s*$/i.exec(e),i=t[2]||void 0;return{variable:e=t[1],alias:i}}bt("esc-export-dao",(function(e,t){let i=si(e,"Selectable DAO"),n=function(e){let t=yi(e.validateSelection),i="function"==typeof e.onStart?e.onStart:e.onStart?Qe([],e.onStart):void 0,n="function"==typeof e.onFinish?e.onFinish:e.onFinish?Qe([],e.onFinish):void 0;return new Rn({fileBaseName:e.fileBaseName,url:e.url,headers:e.headers,withCredentials:e.withCredentials,timeout:e.timeout,validateSelection:t,baseSelection:e.baseSelection,selection:e.selection,onStart:i&&(()=>et(i,[])),onComplete:n&&(()=>et(n,[])),onError:On})}(t);return Ei(i,n,t),n}));const jn=e.log.logger("esc.data.SelectableDataProvider");class qn extends on{constructor(e){super(e),this.unfilteredData=[],this._validateSelection=e.validateSelection||null,this.baseSelection=this.validateSelection(e.baseSelection)||{},this.context=null==e.selection?void 0:ki(e.selection.context),this.selection=this.validateSelection(e.selection),void 0!==e.data&&(this.unfilteredData=e.data||[],this.updateData(this.unfilteredData,this.context,!1))}getSelection(){return ki(this.selection)}setSelection(e){return jn.debug("Setting selection for '%s': %o",this.getId(),e),this.context=null==e?void 0:e.context,this.selection=this.validateSelection(e),this.setData(this.unfilteredData),this}validateSelection(e){let t=function(e){return e?{variables:Bn(e.variables),filter:Gi(e.filter),sort:ji(e.sort),offset:e.offset,limit:e.limit}:e}(e)||null;return this._validateSelection&&(t=this._validateSelection(t)||null),t}setData(e){return this.unfilteredData=e||[],this.updateData(this.unfilteredData,this.context,!0),this}validateData(e,t){if(void 0===this.selection)return[];e=super.validateData(e,t);let i=this.selection||{},n=i.variables||this.baseSelection.variables||null,s=en(e,null!=i.filter&&null!=this.baseSelection.filter?{op:"and",filters:[this.baseSelection.filter,i.filter]}:this.baseSelection.filter||i.filter,i.sort||this.baseSelection.sort||null,i.offset,i.limit);return n?s.map(e=>this.mapRow(e,n)):s}mapRow(e,t){let i={};for(let n of t){i[n.alias||n.variable]=e[n.variable]}return i}}function Un(e,t=","){let i;if(null==e)i=e;else{i="";for(let n=0;n<e.length;n++){n>0&&(i+=t);let s=e[n];i+=Zn(s&&s.toString(),t)}}return i}function Zn(e,t){return null==e?e:0===e.length?e:((a(e.charAt(0))||a(e.charAt(e.length-1))||e.indexOf('"')>=0||e.indexOf(t)>=0)&&(e='"'+e.replace(/"/,'""')+'"'),e)}function Yn(e){if(null==e)return e;let t=(e=e.trim()).length;return t>=2&&'"'===e.charAt(0)&&'"'===e.charAt(t-1)&&(e=e.substring(1,t-1)),e=e.replace(/""/g,'"')}function Gn(e){if(!e)return;let t=function(e,t=","){let i;if(null==e)i=e;else{i=[];let n=[],s=e.length;if(s>0){let r=!1,o=0;for(let l=0;l<s;l++){let s=e.charAt(l);if('"'==s)r=!r;else if(!r&&(s==t||"\n"===s)){let t=e.substring(o,l);o=l+1,t=Yn(t),n.push(t),"\n"===s&&(i.push(n),n=[])}}let l=e.substring(o,s);l=Yn(l),n.push(l),i.push(n)}}return i}(e);if(0===t.length)return;let i,n=t.shift();0===t.length?(i=new Array(n.length),i.fill(ln.STRING)):i=It(t.shift(),ln,ln.STRING);let s={columns:n,types:i,data:t,total:t.length};return function(e){if(!e)return;let t=function(e){let t=[];for(let i=0;i<e.length;i++){let n=e[i];null!=n&&n!==ln.STRING&&t.push(i)}return t}(e.types);if(t.length>0){let i=e.data;for(let n of i)for(let i of t){let t=e.types[i],s=Vn(n[i],t);n[i]=s}}}(s),s}function Vn(e,t){if(null==e)return null;if(t!==ln.BOOLEAN){if(t===ln.BOOLEAN_ARRAY){if(!Array.isArray(e))throw new Error(`Cannot convert non-array to ${t}: ${e}`);return e.map(e=>Vn(e,ln.BOOLEAN))}if(t===ln.LONG||t===ln.INTEGER)return j(e);if(t===ln.LONG_ARRAY||t===ln.INTEGER_ARRAY){if(!Array.isArray(e))throw new Error(`Cannot convert non-array to ${t}: ${e}`);return e.map(e=>Vn(e,ln.LONG))}if(t===ln.DOUBLE||t===ln.DECIMAL)return q(e);if(t===ln.DOUBLE_ARRAY||t===ln.DECIMAL_ARRAY){if(!Array.isArray(e))throw new Error(`Cannot convert non-array to ${t}: ${e}`);return e.map(e=>Vn(e,ln.DOUBLE))}if(t===ln.TIME)return new Date(e);if(t===ln.TIME_ARRAY){if(!Array.isArray(e))throw new Error(`Cannot convert non-array to ${t}: ${e}`);return e.map(e=>Vn(e,ln.TIME))}return e}if(e){if("true"===e)return!0;if("false"===e)return!1;throw new Error(`Cannot parse value as ${t}: ${e}`)}}var Xn;bt("esc-filtered-data",(function(e,t){let i=si(e,"Filtered data"),n=zn(i),s=function(e){let t,i=yi((e=e||{}).validateSelection),n=wi(e.validateData),s=new qn({id:e.id||"",eventMode:e.eventMode,validateSelection:i,baseSelection:e.baseSelection,selection:e.selection,validateData:n}),r=!1;if(null!=e.script){r=!0;let i=Ke([],e.script);if(t=et(i,[]),null!=t&&!Array.isArray(t))throw new Error(`Failed to parse JS data:\n${e.script}`)}else"data"in e&&(r=!0,t=e.data);r&&oi(()=>s.setData(t||[]));return s}(Object.assign({},t,{id:n}));return xi(i,s,t),s})),function(e){e.csv="csv",e.serial="serial",e.json="json",e.js="js"}(Xn||(Xn={}));const Wn=e.log.logger("esc.gadgets.filtered-remote-data");bt("esc-filtered-remote-data",(function(e,t){let i=si(e,"Remote CSV data"),n=zn(i),s=function(e){let t=yi(e.validateSelection),i=wi(e.validateData),n=new qn({id:e.id||"",eventMode:e.eventMode,validateSelection:t,baseSelection:e.baseSelection,selection:e.selection||null,validateData:i}),s=e.format||Xn.csv;return new vn({url:e.url,method:pn.GET,responseType:bn.text,headers:e.headers,withCredentials:e.withCredentials,timeout:e.timeout,parser:wn}).then(t=>{let i;switch(Wn.debug("Data request completed (format=%s): %o",e.format,t),s){case Xn.serial:i=at(t);break;case Xn.json:i=JSON.parse(t);break;case Xn.js:i=et(Ke([],t),[]);break;default:let e=Gn(t);i=e&&an(e).data}if(null!=i&&!Array.isArray(i))throw new Error(`Failed to parse ${s} response:\n${t}`);n.setData(i||[])},e=>{Wn.error("Data request failed (%s): %o",e.status,e.response),On(e),n.setData([])}),n}(Object.assign({},t,{id:n}));return xi(i,s,t),s}));const Kn=e.log.logger("esc.rest.dataset.DataDaoLookup");class Qn{constructor(e){this.tasks=new Map,this.id=e.url,this._validateSelection=e.validateSelection||null,this.dao=new Nn({url:e.url,headers:e.headers,withCredentials:e.withCredentials,timeout:e.timeout,baseSelection:e.baseSelection,parser:e=>null==e?[]:an(e).data}),this.onError=e.onError||void 0}getId(){return this.id}getSelection(){return ki(this.selection)}validateSelection(e){let t=hn(e)||null;return this._validateSelection&&(t=this._validateSelection(t)||null),t}setSelection(e){Kn.debug("Setting selection: %o",e);let t=this.validateSelection(e);return un(t,this.selection)||(Kn.debug("Selection has changed - old selection: %o",this.selection),this.selection=t,this.refresh()),this}lookupSingleton(e,t){return this._bind(e,t,null,null,null,!0,!1)}lookup(e,t,i,n,s){return this._bind(e,t,Ni(i),Ni(n),Ni(s),!1,!1)}bindSingleton(e,t){return this._bind(e,t,null,null,null,!0,!0)}bind(e,t,i,n,s){return this._bind(e,t,Ni(i),Ni(n),Ni(s),!1,!0)}_bind(e,t,i,n,s,r,o){null!=n&&n<0&&(n=0),null!=s&&s<0&&(s=null);let l={filter:t,singleton:r,sort:i,offset:n,limit:s,counter:0};return o&&this.tasks.set(e,l),this.refreshTask(e,l),this}unbind(e){return this.tasks.delete(e),this}refresh(){for(let e of this.tasks.entries())this.refreshTask(...e);return this}refreshTask(e,t){const i=++t.counter;let n=t.singleton,s=this.selection&&this.selection.filter||null;s=null!=s&&null!=t.filter?{op:"and",filters:[s,t.filter]}:s||t.filter;let r=Object.assign({},this.selection,{filter:s,sort:t.sort,offset:t.offset,limit:t.limit});this.dao.get(null,r).then(s=>{if(i==t.counter)if(n){if(s.length>1)throw new Error(`Bound data task expected single datum: ${e}`);e(s.length?s[0]:null)}else e(s);else Kn.info("Rejecting stale successful response (%d != %d): %o",i,t.counter,s)},s=>{i==t.counter?(Kn.debug("Data request failed (%s): %o",s.status,s.response),this.onError&&this.onError(s),e(n?null:[])):Kn.info("Rejecting stale failed response (%d != %d): %o",i,t.counter,s)})}}bt("esc-lookup-dao",(function(e,t){let i=si(e,"Lookup DAO"),n=zn(i),s=function(e){let t=yi(e.validateSelection),i=new Qn({url:e.url,headers:e.headers,withCredentials:e.withCredentials,timeout:e.timeout,validateSelection:t,baseSelection:e.baseSelection,onError:On});void 0!==e.selection&&i.setSelection(e.selection);return i}(Object.assign({},t,{id:n}));return Ei(i,s,t),s}));class Jn extends rn{constructor(e){super(e),"data"in e&&(this.data=this.validateData(e.data,void 0))}setData(e){return this.updateData(e,void 0,!0),this}}var es;bt("esc-simple-data",(function(e,t){let i=si(e,"Simple data"),n=zn(i),s=function(e){let t,i=bi((e=e||{}).validateData),n=new Jn({id:e.id||"",eventMode:e.eventMode,validateData:i}),s=!1;if(null!=e.script){s=!0;let i=Ke([],e.script);t=et(i,[])}else"data"in e&&(s=!0,t=e.data);s&&oi(()=>n.setData(t));return n}(Object.assign({},t,{id:n}));return xi(i,s,t),s})),function(e){e.serial="serial",e.json="json",e.js="js"}(es||(es={}));const ts=e.log.logger("esc.gadgets.simple-remote-data");bt("esc-simple-remote-data",(function(e,t){let i=si(e,"Remote JSON data"),n=zn(i),s=function(e){let t=bi(e.validateData),i=new Jn({id:e.id||"",eventMode:e.eventMode,validateData:t}),n=e.format||es.serial;return new vn({url:e.url,method:pn.GET,responseType:bn.text,headers:e.headers,withCredentials:e.withCredentials,timeout:e.timeout,parser:wn}).then(t=>{let s;switch(ts.debug("Data request completed (format=%s): %o",e.format,t),n){case es.js:s=et(Ke([],t),[]);break;case es.json:s=JSON.parse(t);break;default:s=at(t)}i.setData(s)},e=>{ts.error("Data request failed (%s): %o",e.status,e.response),On(e),i.setData(void 0)}),i}(Object.assign({},t,{id:n}));return xi(i,s,t),s}));class is extends Event{constructor(e){super("esc-selection",{bubbles:!0,cancelable:!0,composed:!0}),this.id=e.id,this.selection=e.selection}}var ns;!function(e){e.idempotent="idempotent",e.replay="replay"}(ns||(ns={}));const ss=e.log.logger("esc.selection.AbstractSelectionProvider");class rs{constructor(e){this.selectCallbacks=new Set,this.initialize(e)}initialize(e){this.id=e.id||"",this.eventMode=e.eventMode||ns.idempotent,this._validateSelection=e.validateSelection||null}getId(){return this.id}updateSelection(e,t){ss.debug("Setting selection for '%s' (notify=%o): %o",this.getId(),t,e),e=this.validateSelection(e);let i=this.isChangedSelection(e);return ss.debug("Selection for '%s' has %schanged - old selection: %o",this.getId(),i?"":"not ",this.selection),i&&this._setSelection(e),t&&(i||this.eventMode===ns.replay)&&this.fireOnSelect(this.getSelection()),i}validateSelection(e){return null==this._validateSelection?e:this._validateSelection(e)}_setSelection(e){this.selection=e}isChangedSelection(e){return!this.equalsSelection(e,this.selection)}equalsSelection(e,t){return e===t}getSelection(){return this.selection}onSelection(e){return null!=e&&this.selectCallbacks.add(e),this}offSelection(e){return null!=e&&this.selectCallbacks.delete(e),this}fireOnSelect(e){ss.debug("Firing onSelection '%s' for %d callback(s): %o",this.getId(),this.selectCallbacks.size,e),this.doFireOnSelect(e)}doFireOnSelect(e){for(let t of this.selectCallbacks)t(e,this.id)}}class os extends rs{setSelection(e){return this.updateSelection(e,!0),this}}class ls extends os{constructor(e){super(e)}initialize(e){super.initialize(e),"selection"in e&&(this.selection=this.validateSelection(e.selection))}equalsSelection(e,t){return Ii(e,t)}validateSelection(e){return super.validateSelection(ki(e))}getSelection(){return ki(this.selection)}}class as extends ls{constructor(e){super(null==e.selection?Object.assign({},e,{selection:{}}):e)}initialize(e){this.orderSensitive=!0===e.orderSensitive,this.fields=null==e.fields?void 0:Array.from(e.fields),super.initialize(e)}validateSelection(e){if(e=e||{},this.fields)for(let t of Object.keys(e))if(!this.fields.includes(t))throw new Error(`Field '${t}' is not permitted in aggregate selector '${this.getId()}': ${this.fields.join()}`);return super.validateSelection(e)}putSelection(e,t){if(!e)throw new Error(`Id must be non-naught to add to aggregate selector '${this.getId()}'.`);if("string"!=typeof e)throw new Error(`Id must be string valued to add to aggregate selector '${this.getId()}': ${u(e)}`);if(this.fields&&!this.fields.includes(e))throw new Error(`Field '${e}' is not permitted in aggregate selector '${this.getId()}' with fields ${u(this.fields)}: ${u(e)}`);let i=Object.assign({},this.selection);return i[e]=t,this.updateSelection(i,!0),this}removeSelection(e){if(!e)throw new Error("Id must be non-naught to add selection incrementally.");if(e in this.selection){let t=Object.assign({},this.selection);delete t[e],this.updateSelection(t,!0)}return this}}bt("esc-aggregate-selector",(function(e,t){let i=si(e,"Aggregate selector"),n=zn(i),s=function(e){let t=yi((e=e||{}).validateSelection);return new as({id:e.id||"",fields:e.fields,eventMode:e.eventMode,orderSensitive:e.orderSensitive,validateSelection:t,selection:e.selection})}(Object.assign({},t,{id:n}));return s.onSelection(e=>i.dispatchEvent(new is({id:n,selection:e}))),Si(i,s,t),s}));class hs extends os{constructor(e){super(e)}initialize(e){this.unique=!0===e.unique,this.lifo=!0===e.lifo,this.maxNoSelected=null==e.maxNoSelected?-1:e.maxNoSelected,this.selection=[],super.initialize(e)}addSelection(e){return this.unique&&this.containsSelection(e,this.selection)||this.setSelection([...this.getSelection(),e]),this}removeSelection(e){let t=this.getSelection();for(let i=t.length-1;i>=0;i--)this.equalsSelection([t[i]],[e])&&t.splice(i,1);return this.setSelection(t),this}containsSelection(e,t){let i=[e];return t.some(e=>this.equalsSelection(i,[e]))}validateSelection(e){let t;if(this.unique){t=[];for(let i of e)this.containsSelection(i,t)||t.push(i)}else t=e.slice();if(this.maxNoSelected>=0){let e=t.length-this.maxNoSelected;e>0&&t.splice(this.lifo?this.maxNoSelected:0,e)}return super.validateSelection(t)}equalsSelection(e,t){return Ti(e,t)}getSelection(){return ki(this.selection)}}class us extends hs{constructor(e){super(e)}initialize(e){super.initialize(e),this.selection=this.validateSelection(e.selection||[])}}bt("esc-array-selector",(function(e,t){let i=si(e,"Array selector"),n=zn(i),s=function(e){let t=yi((e=e||{}).validateSelection);return new us({id:e.id||"",eventMode:e.eventMode,unique:!0===e.unique,lifo:!0===e.lifo,maxNoSelected:null==e.maxNoSelected?-1:e.maxNoSelected,validateSelection:t,selection:e.selection})}(Object.assign({},t,{id:n}));return s.onSelection(e=>i.dispatchEvent(new is({id:n,selection:e}))),Si(i,s,t),s})),bt("esc-bind-select",(function(e,t){t=t||{};let i=si(e,"Selection-provider binding");vi(Pe(i.getAttribute("data-esc-id")),t,!0===t.trigger),di(i,t)}));class cs extends as{constructor(e){super(e)}initialize(e){if(this.context=0,e.fields&&e.fields.includes("context"))throw new Error("Field 'context' is reserved in fork selector.");super.initialize(e)}updateContext(){this.context++,this.context>=Number.MAX_SAFE_INTEGER&&(this.context=0)}_setSelection(e){super._setSelection(e),this.updateContext()}getSelection(){let e=super.getSelection();return e.context=this.context,e}}function ds(e){return e?""+e:void 0}function fs(e){let t=window.location.hash;return t&&"#"!==t?decodeURIComponent(t.substr(1)):e||void 0}bt("esc-fork-selector",(function(e,t){let i=si(e,"Fork selector"),n=zn(i),s=function(e){let t=yi((e=e||{}).validateSelection);return new cs({id:e.id||"",fields:e.fields,eventMode:e.eventMode,orderSensitive:e.orderSensitive,validateSelection:t,selection:e.selection})}(Object.assign({},t,{id:n}));return s.onSelection(e=>i.dispatchEvent(new is({id:n,selection:e}))),Si(i,s,t),s})),bt("esc-fragment-selector",(function(e,t){let i=si(e,"Fragment selector"),n=zn(i),s=function(e){let t=(e=e||{}).default,i=yi(e.validateSelection),n=new ls({id:e.id||"",validateSelection:null==i?ds:tt(i,ds),selection:e.selection}).onSelection(e=>window.location.hash=function(e){if(!e)return"";let t="#";for(let i=0;i<e.length;i++){let n=e.charCodeAt(i),s=e.charAt(i),r=!(n>=97&&n<=122||n>=65&&n<=90||n>=48&&n<=57||ms.includes(s));t+=r?"%"+n.toString(16):s}return t}(e));return window.addEventListener("hashchange",()=>n.setSelection(fs(t))),oi(()=>{let i=fs(e.selection||t);i&&n.setSelection(i)}),n}(Object.assign({},t,{id:n}));return s.onSelection(e=>i.dispatchEvent(new is({id:n,selection:e}))),Si(i,s,t),s}));const ms=["!","$","&","'","(",")","*","+",",",";","=","-",".","_","~",":","@","/","?"];function ps(){let e=-1;return t=>{e>=0&&(cancelAnimationFrame(e),e=-1),e=requestAnimationFrame(t)}}function gs(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{try{e()}finally{t=!1}}))}}var bs,ws;function vs(e,t){if("boolean"==typeof e)return e;if(null==e||"null"===e){if(!t)throw new Error("Selection must be non-null.");return null}if("true"===e)return!0;if("false"===e)return!1;throw new Error(`Selection cannot be cast as boolean: ${e} (${typeof e})`)}function ys(e,t){if("number"==typeof e)return e;if(null==e||"null"===e){if(!t)throw new Error("Selection must be non-null.");return null}if(null!=(e=q(e)))return e;throw new Error(`Selection cannot be cast as number: ${e} (${typeof e})`)}function xs(e,t){if(null==e){if(!t)throw new Error("Selection must be non-null.");return null}return e.toString()}function Ss(e,t,i){switch(t){case bs.string:return xs(e,i);case bs.number:return ys(e,i);case bs.boolean:return vs(e,i);default:throw new se(`Selection type not recognized: ${t}`)}}function Es(e,t){if(null==e)return[];if(!Array.isArray(e))throw new Error(`Selection must be array: ${e}`);const{type:i,allowNullValues:n,maxNoSelected:s,lifo:r,unique:o,options:l,filterOptions:a}=t;if(e=e.map("function"==typeof i?i:e=>Ss(e,i,!!n)),o&&(e=Array.from(new Set(e))),null!=l){let t=Array.isArray(l)?e=>l.includes(e):l;if(a)e=e.filter(t);else for(let i of e)if(!t(i))throw Array.isArray(l)?new Error(`Selection ${u(i)} is not available: ${u(l)}`):new Error(`Selection ${u(i)} is not available.`)}if(null!=s&&s>=0){let t=e.length-s;t>0&&e.splice(r?s:0,t)}return e}function ks(e,t){let i=e.id;if(void 0===i)throw new Error("Option must not have undefined id.");if(t.some(e=>e.id===i))throw new Error(`Option id '${i}' is duplicated.`)}function Ns(e){if(!e)return;let t=new Set;for(let i of e){let e=i.id;if(void 0===e)throw new Error("Option must not have undefined id.");if(t.has(e))throw new Error(`Option id '${e}' is duplicated.`);t.add(e)}}!function(e){e.string="string",e.number="number",e.boolean="boolean"}(bs||(bs={})),function(e){e.string="string",e.number="number"}(ws||(ws={}));class Cs extends rs{constructor(e){super(e)}initialize(e){if(!e||!e.element)throw new Error("Target element must be non-null.");super.initialize(e),this.element=e.element,this.id=zn(this.element),this.dispatchEvents=!1!==e.dispatchEvents}doFireOnSelect(e){if(super.doFireOnSelect(e),this.dispatchEvents){let t=new is({id:this.getId(),selection:e});this.element.dispatchEvent(t)}}}class Is extends Cs{constructor(e,t){super(Object.assign({},e,{controlSelector:t}))}initialize(e){this.updateDomEnabled=gs(()=>{this.element.classList.toggle("esc-is-disabled",!this._enabled),this._enabled?(this.element.tabIndex=this.tabIndexElement,this.control.tabIndex=this.tabIndexControl):(this.tabIndexElement=this.element.tabIndex,this.tabIndexControl=this.control.tabIndex,this.element.tabIndex=-1,this.control.tabIndex=-1),this._setControlEnabled(this._enabled)}),super.initialize(e),this.control=this.selectControl(e.controlSelector),this.id=this.control.getAttribute("name")||this.id,this._enabled=!this.element.classList.contains("esc-is-disabled"),this.tabIndexElement=this.element.tabIndex,this.tabIndexControl=this.control.tabIndex,this.updateDomEnabled()}selectControl(e){return e?we(this.element,e):this.element}_setControlEnabled(e){}getEnabled(){return this._enabled}setEnabled(e){return(e=!!e)!==this._enabled&&(this._enabled=e,this.updateDomEnabled()),this}}class Ms extends Is{setSelection(e){return this.updateSelection(e,!0),this}}class zs extends Ms{constructor(e,t){super(e,t),this.skipDomUpdate=!1,this.initializeSelection()}initialize(e){this.updateDomSelection=gs(()=>this._setControlSelection(this.selection)),this.controlChangeListener=()=>this._setSelectionWithoutDomUpdate(this._getControlSelection()),super.initialize(e)}initializeSelection(){this.selection=this.validateSelection(this._getControlSelection())}updateSelection(e,t){let i=super.updateSelection(e,t);return i&&this.updateDomSelection(),i}_setSelectionWithoutDomUpdate(e){this.skipDomUpdate=!0,this.setSelection(e),this.skipDomUpdate=!1}_setSelection(e){super._setSelection(e),this.skipDomUpdate||this.updateDomSelection()}}const As=e.log.logger("esc.widgets.control.AbstractOptionsController");class Ts extends zs{constructor(e,t){super(e,t),this.requestAnimationFrameOnceForDom=ps()}initialize(e){this.type=e.type,super.initialize(e),this.optionIds=[];for(let e of this.getOptions())this.wireOption(e),this.optionIds.push(this.getOptionId(e));Ns(this.optionIds.map(e=>({id:e}))),this.control.addEventListener("keydown",e=>this.handleKey(e)),this.control.addEventListener("click",e=>this.handleClick(e))}handleKey(e){if(!this.getEffectivelyEnabled())return;let t=this.getOption(e.target);t&&this.doHandleKey(t,e.key)&&e.preventDefault()}handleClick(e){if(!this.getEffectivelyEnabled())return;let t=this.getOption(e.target);t&&this.doHandleClick(t)&&e.preventDefault()}wireOption(e){}getOptionIdAttribute(e){for(let t of e.get()){if(!(t instanceof Element))continue;let e=An(t);if(null!=e)return e}throw new Error("Option does not have name attribute.")}getOption(e){for(let t of this.getOptions())if(ri(t,e))return t}getOptionId(e){let t=this.getOptionIdAttribute(e);if(t=s(t),void 0===t)throw new Error("Item has undefined id.");return this.castSelection(t)}getOptionsMap(){return this.options2map(this.getOptions())}options2map(e){let t=new Map;for(let i of e){let e=this.getOptionId(i);t.set(e,i)}return t}getOptions(){let e=[];for(let t of this.control.children)t.classList.contains("esc-c-option")&&e.push(mt(t));return e}getNoOptions(){return this.optionIds.length}getOptionIds(){return this.optionIds.slice()}castSelection(e){return Ss(e,this.type,!0)}_updateDom(e){for(let e of this.getOptions())e.remove();let t=mt(this.control);for(let i of e)t.append(i);this.element.classList.toggle("esc-js-is-empty",0===e.length),this.element.classList.toggle("esc-js-is-singular",1===e.length),this._setControlSelection(this.selection),this._setControlEnabled(this._enabled)}addOptions(e){return void 0===e?this:(As.debug("Adding options.",e),(null===e||Array.isArray(e))&&(e={options:e}),this._setOptions(e.options||[],!0,e.selection,"selection"in e),this)}setOptions(e){return void 0===e?this:(As.debug("Setting options.",e),(null===e||Array.isArray(e))&&(e={options:e}),this._setOptions(e.options||[],!1,e.selection,"selection"in e),this)}removeOptions(e){return void 0===e?this:(As.debug("Removing options.",e),(null===e||Array.isArray(e))&&(e={options:e}),this._removeOptions(e.options,e.selection,"selection"in e),this)}clearOptions(){return As.debug("Removing all options."),this._removeOptions(null,void 0,!1),this}_setOptions(e,t,i,n){let s=e.map(e=>e.id);t&&(s=[...this.optionIds,...s]),Ns(s.map(e=>({id:e})));let r=t?this.getOptions():[];for(let t of e){let e=this.makeOption(t);this.wireOption(e),r.push(e)}this.updateOptions(s,r,i,n)}_removeOptions(e,t,i){e=e||this.optionIds.slice();let n=this.optionIds.filter(t=>!e.includes(t)),s=this.getOptions().filter(t=>!e.includes(this.getOptionId(t)));this.updateOptions(n,s,t,i)}updateOptions(e,t,i,n){i=n?i:this.adjustSelection(e),this.optionIds=e,this.skipDomUpdate=!0,this.setSelection(i),this.skipDomUpdate=!1,this.requestAnimationFrameOnceForDom(()=>this._updateDom(t))}isSelected(e){return e.hasClass(Ae)}setOptionSelection(e,t){e.toggleClass(Ae,t)}_setControlEnabled(e){e=e&&(1!==this.getNoOptions()||void 0===this.selection);for(let t of this.getOptions())this.setOptionEnabled(e,t)}setOptionEnabled(e,t){t.attr("tabindex",e?"0":"-1")}focusOption(e){e&&e.get(0).focus()}}class Ls extends Ts{doHandleKey(e,t){switch(t){case" ":case"Enter":if(this.isSelected(e))this.selectNext();else{let t=this.getOptionId(e);this.setSelection(t)}return!0;case"ArrowRight":case"ArrowDown":return this.selectNext(),!0;case"ArrowLeft":case"ArrowUp":return this.selectPrevious(),!0;default:return!1}}doHandleClick(e){let t=this.getOptionId(e);return this.setSelection(t),!0}validateSelection(e){if(void 0!==e){if(e=this.castSelection(e),!this.optionIds.includes(e))throw new Error(`Selection ${u(e)} is not available: ${u(this.optionIds)}`);return e}}_getControlSelection(){for(let e of this.getOptions())if(this.isSelected(e))return this.getOptionId(e)}_setControlSelection(e){let t,i=!1;for(let n of this.getOptions()){i=i||ri(n,document.activeElement);let s=!1;if(void 0!==e){let i=this.getOptionId(n);s=this.equalsSelection(e,i),s&&(t=n)}this.setOptionSelection(n,s)}i&&this.focusOption(t),this.element.classList.toggle("esc-js-has-selection",void 0!==e)}adjustSelection(e){return void 0!==this.selection&&e.includes(this.selection)?this.selection:void 0}hasPrevious(){return(void 0===this.selection?-1:this.optionIds.indexOf(this.selection))>0}selectPrevious(){return this._selectPrevious(this.selection),this}_selectPrevious(e){let t=this.getNoOptions();if(0===t)return;let i=void 0===e?-1:this.optionIds.indexOf(e);i=i<=0?t-1:i-1,i>=0&&this.setSelection(this.optionIds[i])}hasNext(){let e=this.getNoOptions();return 0!==e&&(void 0===this.selection?-1:this.optionIds.indexOf(this.selection))<e-1}selectNext(){return this._selectNext(this.selection),this}_selectNext(e){let t=this.getNoOptions();if(0===t)return;let i=void 0===e?-1:this.optionIds.indexOf(e);i=i<0||i>=t-1?0:i+1,i>=0&&this.setSelection(this.optionIds[i])}selectFirst(){return this.optionIds.length>0&&this.setSelection(this.optionIds[0]),this}selectLast(){return this.optionIds.length>0&&this.setSelection(this.optionIds[this.optionIds.length-1]),this}getEffectivelyEnabled(){return this.getEnabled()&&(1!==this.getNoOptions()||void 0===this.selection)}}var $s,Os,Ds;!function(e){e.reverse="reverse",e.resume="resume",e.stop="stop"}($s||($s={})),function(e){e.forward="forward",e.backward="backward",e.stop="stop"}(Os||(Os={})),function(e){e.reset="reset",e.loop="loop",e.stop="stop"}(Ds||(Ds={}));class Ps extends os{constructor(e){super(Object.assign({},e,{eventMode:ns.replay}))}initialize(e){super.initialize(e),this.selector=e.selector,this.interval=null==e.interval?-1:e.interval,this.async=!0===e.async,this.interruptMode=e.interruptMode||$s.stop,this.terminateMode=e.terminateMode||Ds.stop,this.selection=this.validateSelection(e.selection||Os.stop),this.resetSchedule=!1,this.scheduledTime=-1,this.timerHandle=-1;let t=this.selector.getSelection();this.index=null==t?-1:this.selector.getOptionIds().indexOf(t),this.selectorListener=e=>{let t=this.selector.getOptionIds(),i=t.indexOf(e),n=this.selection;if(this.interruptMode===$s.reverse)n!==Os.stop&&(this.index<0||(this.index<i?n=Os.forward:this.index>i&&(n=Os.backward)),n!==this.selection&&this.schedule());else if(this.interruptMode===$s.resume);else{let e=i-this.index;n===Os.forward?1===e||0===i&&this.index===t.length-1||(n=Os.stop):n===Os.backward&&(-1===e||i===t.length-1&&0===this.index||(n=Os.stop))}this.index=i,this.updateSelection(n,!0)},this.selector.onSelection(this.selectorListener),this.schedule(),this.next()}forward(){return this.setSelection(Os.forward)}backward(){return this.setSelection(Os.backward)}stop(){return this.setSelection(Os.stop)}validateSelection(e){let t=Mt(e,Os,Os.stop);return this.terminateMode!==Ds.loop&&this.selection!==Os.stop&&(t!==Os.forward||this.selector.hasNext()||(t=Os.stop),t!==Os.backward||this.selector.hasPrevious()||(t=Os.stop)),t}setSelection(e){return this.resetSchedule=!0,super.setSelection(e||Os.stop),this.resetSchedule=!1,this}_setSelection(e){let t=this.selection;super._setSelection(e),this.resetSchedule&&(this.scheduledTime=-1),this.selection===Os.stop?(this.cancelNext(),this.terminateMode===Ds.reset&&(t===Os.forward?this.timerHandle=window.setTimeout(()=>this.selector.selectFirst(),this.interval):t===Os.backward&&(this.timerHandle=window.setTimeout(()=>this.selector.selectLast(),this.interval)))):this.next()}next(){if(this.selection!==Os.stop&&this.timerHandle<0){let e=Math.max(0,this.scheduledTime-(new Date).getTime());this.timerHandle=window.setTimeout(()=>this._next(),e)}return this.scheduledTime=-1,this}cancelNext(){this.timerHandle>=0&&(window.clearTimeout(this.timerHandle),this.timerHandle=-1)}_next(){this.selection===Os.forward?this.selector.selectNext():this.selection===Os.backward&&this.selector.selectPrevious(),this.timerHandle=-1,this.schedule(),this.async||this.next()}schedule(){this.scheduledTime=(new Date).getTime()+this.interval}destroy(){return this.selector.offSelection(this.selectorListener),this}}bt("esc-sequence-selector",{dependencies:["esc-carousel","esc-choices","esc-select","esc-slider-discrete","esc-switcher","esc-tabs"],process:function(e,t){let i=si(e,"Sequence selector"),n=zn(i),s=_e(t.selector,Ls),r=function(e){return new Ps(e)}(Object.assign({},t,{selector:s}));return r.onSelection(e=>i.dispatchEvent(new is({id:n,selection:e}))),i.addEventListener("esc-destroy",()=>r.destroy()),Si(i,r,t),r}}),bt("esc-simple-selector",(function(e,t){let i=si(e,"Simple selector"),n=zn(i),s=function(e){let t=yi((e=e||{}).validateSelection);return new ls({id:e.id||"",eventMode:e.eventMode,validateSelection:t,selection:e.selection})}(Object.assign({},t,{id:n}));return s.onSelection(e=>i.dispatchEvent(new is({id:n,selection:e}))),Si(i,s,t),s}));const _s=e.log.logger("esc.gadgets.selection.stored.StoredSelector");class Fs extends ls{constructor(e){if(super({id:e.id||""}),!e.key)throw new Error("StoredSelector must have non-naught key.");this.key=e.key,this.version=e.version||null;let t,i=!1,n=window.localStorage.getItem(this.key);if(null==n)_s.info("Stored state '%s' not found.",this.key);else{let e=at(n);this.version!==e.version?_s.warn("Stored state '%s' has incompatible versions: required=%s, actual=%s",this.key,this.version,e.version):(_s.info("Stored state '%s' found: %o",this.key,e.value),i=!0,t=e.value)}!i&&"selection"in e&&(i=!0,t=e.selection),i&&oi(()=>{this.disableWrite=!0,this.setSelection(t),this.disableWrite=!1})}_setSelection(e){if(!this.disableWrite)if(null==e)_s.info("Removing stored state '%s'.",this.key),window.localStorage.removeItem(this.key);else{let t={version:this.version,value:e};_s.info("Writing stored state '%s': %o",this.key,t),window.localStorage.setItem(this.key,rt(t))}super._setSelection(e)}}bt("esc-stored-selector",(function(e,t){let i=si(e,"Stored selector"),n=zn(i),s=function(e){let t=yi(e.validateSelection);return new Fs(Object.assign({},e,{validateSelection:t}))}(Object.assign({},t,{id:n}));return s.onSelection(e=>i.dispatchEvent(new is({id:n,selection:e}))),Si(i,s,t),s}));const Rs=e.log.logger("esc.selection.SynchronizingSelectionProvider");class Bs extends ls{constructor(e){super(null==e.selection?Object.assign({},e,{selection:{}}):e),this.pending=new n(()=>({created:Date.now(),aggregate:Object.create(null)}))}initialize(e){this.fields=Array.from(e.fields),this.timeout=Ci(e.timeout),super.initialize(e)}validateSelection(e){if(this.fields)for(let t of Object.keys(e))if(!this.fields.includes(t))throw new Error(`Field '${t}' is not permitted in aggregate selector '${this.getId()}': ${this.fields.join()}`);return super.validateSelection(e)}putSelection(e,t){if(!e)throw new Error(`Id must be non-naught to add to synchronizing selector '${this.getId()}'.`);if("string"!=typeof e)throw new Error(`Id must be string valued to add to synchronizing selector '${this.getId()}': ${u(e)}`);if(!this.fields.includes(e))throw new Error(`Field '${e}' is not permitted in synchronizing selector '${this.getId()}' with fields ${u(this.fields)}: ${u(e)}`);let i=Ni(t&&t.context);Rs.debug("Adding selection '%s' to synchronizing selector '%s' in context %o: %o",e,this.getId(),i,t);let n=this.pending.compute(i);return n.aggregate[e]=t,this.fields.every(e=>e in n.aggregate)?(Rs.debug("Selection synchronization complete for '%s'in context %o: %o",this.getId(),i,this.fields),this.pending.delete(i),this.updateSelection(n.aggregate,!0)):Rs.isDebugEnabled&&Rs.debug("Selection synchronization incomplete for '%s' in context %o: %o out of %o",this.getId(),i,Object.keys(n.aggregate),this.fields),this.expireEntries(),this}expireEntries(){if(null==this.timeout)return;let e=Date.now();for(let[t,i]of this.pending.entries())e-i.created>this.timeout&&(Rs.info("Expiring selection synchronization for context: %o",t),this.pending.delete(t))}}bt("esc-sync-selector",(function(e,t){let i=si(e,"Synchronizing selector"),n=zn(i),s=function(e){let t=yi(e.validateSelection);return new Bs({id:e.id||"",fields:e.fields,timeout:e.timeout,eventMode:e.eventMode,validateSelection:t,selection:e.selection})}(Object.assign({},t,{id:n}));return s.onSelection(e=>i.dispatchEvent(new is({id:n,selection:e}))),Si(i,s,t),s}));class Hs extends us{constructor(e){super(Object.assign({},e,{unique:!0})),this.updateElements=gs(()=>this._updateElements())}initialize(e){this.domId=e.domId,this.classes=e.classes.map(e=>(e.startsWith("^")||(e="^"+e),e.endsWith("$")||(e+="$"),e)),super.initialize(e)}_updateElements(){let e=Pe(this.domId);this._updateElement(e)}_updateElement(e){let t=Array.from(e.classList.values()).filter(e=>this.isControlledClass(e)&&!this.selection.includes(e));e.classList.remove(...t),e.classList.add(...this.selection)}_setSelection(e){super._setSelection(e),this.updateElements()}validateSelection(e){if(!(e=super.validateSelection(e)).every(e=>this.isControlledClass(e)))throw new Error(`Selection contains invalid classes: ${JSON.stringify(e)}`);return e}isControlledClass(e){return this.classes.some(t=>new RegExp(t).test(e))}}var js,qs,Us,Zs;bt("esc-classes-selector",(function(e,t){let i=si(e,"Classes selector"),n=zn(i),s=function(e){let t=yi(e.validateSelection);return new Hs({id:e.id||"",domId:e.domId,classes:e.classes,eventMode:e.eventMode,lifo:!0===e.lifo,maxNoSelected:null==e.maxNoSelected?-1:e.maxNoSelected,validateSelection:t,selection:e.selection})}(Object.assign({},t,{id:n}));return s.onSelection(e=>i.dispatchEvent(new is({id:n,selection:e}))),Si(i,s,t),s})),js||(js={});class Ys extends Is{constructor(e){super(e),this.selection=e.value,this.element.addEventListener("click",()=>this.fireOnSelect(this.getSelection()))}_setControlEnabled(e){this.control instanceof HTMLButtonElement&&(this.control.disabled=!e)}setDecoration(e){return requestAnimationFrame(()=>ii(mt(this.element),e)),this}}function Gs(e,t,i){let n=i&&i.onDestroy;"function"==typeof t.destroy&&(null==n?n=[]:Array.isArray(n)||(n=[n]),n.push(()=>t.destroy())),di(e,{onDestroy:n}),Ie(e,"esc-controller",t)}function Vs(e,t,i){Gs(e,t,i),vi(e,i,!1)}function Xs(e,t){let i=be(t,".esc-c-controls > .esc-c-select-opposite");i&&i.setAttribute("tabindex",e?"0":"-1");let n=be(t,".esc-c-controls > .esc-c-select-all");n&&n.setAttribute("tabindex",e?"0":"-1");let s=be(t,".esc-c-controls > .esc-c-deselect-all");s&&s.setAttribute("tabindex",e?"0":"-1")}function Ws(e,t){let i=be(t,".esc-c-controls > .esc-c-select-opposite");i&&i.addEventListener("click",()=>{if(!e.getEnabled())return;let t=e.getSelection(),i=[];if(void 0!==t)for(let n of e.getOptionIds())t&&t.includes(n)||i.push(n);e.setSelection(i)});let n=be(t,".esc-c-controls > .esc-c-select-all");n&&n.addEventListener("click",()=>{e.getEnabled()&&e.setSelection(e.getOptionIds())});let s=be(t,".esc-c-controls > .esc-c-deselect-all");s&&s.addEventListener("click",()=>{e.getEnabled()&&e.setSelection([])})}function Ks(e,t){t=t||{};let i=si(e,"Button field",HTMLElement),n=new Ys({element:i,value:t.value});Vs(n.element,n,t)}bt("esc-button",Ks),js.init=Ks,qs||(qs={});class Qs extends Ls{setDecoration(e,t){const i=this.getOptions().find(t=>this.getOptionIdAttribute(t)===e);return i&&requestAnimationFrame(()=>this._setDecoration(i,t)),this}setDecorations(e){return e=e||{},requestAnimationFrame(()=>{for(let t of this.getOptions()){let i=this.getOptionIdAttribute(t);ii(t,e[i])}}),this}_setDecoration(e,t){ii(e,t)}}function Js(e){return"string"==typeof e?null===(t=e)?"null":void 0===t?"undefined":r(t)?`"${t}"`:t:""+e;var t}class er extends Qs{constructor(e){super(e,".esc-c-options");let t=this.element.querySelector(".esc-c-arrow-container-left > .esc-c-arrow");t&&(t.addEventListener("click",e=>{this.getEnabled()&&(this.selectPrevious(),e.preventDefault())}),t.addEventListener("keydown",e=>{if(this.getEnabled())switch(e.key){case" ":case"Enter":this.selectPrevious(),e.preventDefault()}}));let i=this.element.querySelector(".esc-c-arrow-container-right > .esc-c-arrow");i&&(i.addEventListener("click",e=>{this.getEnabled()&&(this.selectNext(),e.preventDefault())}),i.addEventListener("keydown",e=>{if(this.getEnabled())switch(e.key){case" ":case"Enter":this.selectNext(),e.preventDefault()}}))}getOptions(){let e=[];for(let t of this.control.children)if(t.classList.contains("esc-c-dot")){if(!t.nextElementSibling)throw new Error("Carousel markup is invalid.");e.push(mt([t,t.nextElementSibling]))}return e}makeOption(e){return function(e,t,i){if(void 0===e.id)throw new Error("Option must not have undefined id.");if(!e.label)throw new Error("Option must have non-naught label.");let n=i('<span class="esc-c-dot"/>').attr("data-esc-id",Js(e.id));t&&n.attr("tabindex","0");let s=i('<div class="esc-c-option"/>');return ni(e,s,i),n.add(s)}(e,this.getEnabled(),mt)}_updateDom(e){super._updateDom(e),this.element.style.setProperty("--esc-carousel-number-of-tabs",""+e.length)}isSelected(e){return e.first().hasClass(Ae)}setOptionSelection(e,t){e.first().toggleClass(Ae,t)}setOptionEnabled(e,t){t.first().attr("tabindex",e?"0":"-1")}}function tr(e,t){let i=si(e,"Carousel",HTMLElement),n=new er({element:i,type:t.type});Vs(n.element,n,t)}bt("esc-carousel",tr),qs.init=tr,Us||(Us={});class ir extends zs{constructor(e){super(e,"input[type=checkbox]"),this.control.addEventListener("change",this.controlChangeListener)}_getControlSelection(){return this.control.checked}_setControlSelection(e){this.control.checked=e}_setControlEnabled(e){this.control.disabled=!e}validateSelection(e){return vs(e,!1)}setDecoration(e){return requestAnimationFrame(()=>ii(mt(this.element),e)),this}}function nr(e,t){let i=si(e,"Checkbox field",HTMLElement),n=new ir({element:i});Vs(n.element,n,t)}function sr(e,t,i){return null==e?e:(null!=i&&(e=Math.min(i,e)),null!=t&&(e=Math.max(t,e)),e)}function rr(e,t,i){return e===sr(e,t,i)}function or(e,t,i){return e+i*(t-e)}function lr(e){return null!=e&&e.every(e=>Number.isFinite(e))}function ar(e,t,i){if(null==e)return e;let n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=sr(e[s],null==t||"number"==typeof t?t:t[s],null==i||"number"==typeof i?i:i[s]);return n}function hr(e){return e&&e.slice()}function ur(e,t){return null==e||null==t?e===t:e.length===t.length&&e.every((e,i)=>e===t[i])}function cr(e,t){return Math.sqrt(dr(e,t))}function dr(e,t){let i=0;for(let s=0;s<e.length;s++)i+=(n=e[s]-t[s])*n;var n;return i}function fr(e,t,i){if(0===i)return e;if(1===i)return t;if(2===e.length&&2===t.length)return[or(e[0],t[0],i),or(e[1],t[1],i)];{let n=(i<=.5?e:t).slice();return n[0]=or(e[0],t[0],i),n[1]=or(e[1],t[1],i),n}}function mr(e,t,i){if(0===i)return e;if(1===i)return t;if(e.length!==t.length)throw new Error(`Arrays to interpolate must have same length (${e.length} != ${t.length}).`);return e.map((e,n)=>or(e,t[n],i))}function pr(e,t){let i=new Array(e.length);for(let n=0;n<e.length;n++)i[n]=e[n]+t[n];return i}function gr(e,t,i,n){let s=0;for(let n=0;n<e.length;n++)s+=(e[n]-t[n])*(i[n]-t[n]);return s/=dr(t,i),n&&(s=sr(s,0,1)),s}function br(e,t,i){return cr(e,function(e,t,i,n){return mr(t,i,gr(e,t,i,n))}(e,t,i,!0))}function wr(e){let[t,i]=e;return[Math.sqrt(t*t+i*i),Math.atan2(i,t)]}function vr(e){let[t,i]=e;return[t*Math.cos(i),t*Math.sin(i)]}function yr(e){if(null==e)return e;let t=q(e);if(null==t)throw new Error(`Failed to parse number: '${e}'`);return t}function xr(e){if(null==e)return e;let t=e.trim();t.endsWith("px")&&(t=t.substring(0,t.length-2));let i=q(t);if(null==i)throw new Error(`Failed to parse pixel: '${e}'`);return i}function Sr(e){if(null==e)return e;let t=e.trim(),i=1;t.endsWith("ms")?t=t.substring(0,t.length-2):t.endsWith("s")&&(t=t.substring(0,t.length-1),i=1e3);let n=q(t);if(null==n)throw new Error(`Failed to parse time: '${e}'`);return n*i}function Er(e,t,i){let n=window.getComputedStyle(e).getPropertyValue("--"+t);if(n=n.trim(),!n)return i;let s=n.length;return s>=2&&(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))?n.substring(1,s-1):n}function kr(e,t,i){let n=Er(e,t);if(null==n)return i;try{return function(e){if(null==e)return e;if("true"===(e=e.trim()))return!0;if("false"===e)return!1;throw new Error(`Failed to parse boolean: '${e}'`)}(n)}catch(e){throw new Error(`Failed to parse custom CSS property '${t}' as boolean: '${n}'`)}}function Nr(e,t,i){let n=Er(e,t);if(null==n)return i;try{return yr(n)}catch(e){throw new Error(`Failed to parse custom CSS property '${t}' as number: '${n}'`)}}function Cr(e,t,i){let n=Er(e,t);if(null==n)return i;try{return xr(n)}catch(e){throw new Error(`Failed to parse custom CSS property '${t}' as pixel: '${n}'`)}}function Ir(e,t,i){let n=Er(e,t);if(null==n)return i;try{return Sr(n)}catch(e){throw new Error(`Failed to parse custom CSS property '${t}' as time: '${n}'`)}}function Mr(e,t,i){let n=Er(e,t);return null==n?i:(n=n.trim(),n.split(/\s+/))}function zr(e,t,i){let n=Mr(e,t);if(null==n)return i;try{return n.map(yr)}catch(e){throw new Error(`Failed to parse custom CSS property '${t}' as number array: '${n.join()}'`)}}bt("esc-checkbox",nr),Us.init=nr,Zs||(Zs={});const Ar=["signal-red","signal-yellow","signal-green","temperature-hot","temperature-mild","temperature-cold"];function Tr(e){if(e&&(e=e.trim()))return e.startsWith("esc-color-data-")?(e=e.substring("esc-color-data-".length),Ar.includes(e)?"esc-color-data-"+e:void 0):Ar.includes(e)?"esc-color-data-"+e:void 0}function Lr(e,t){if(!(e=Tr(e)))return e;return function(e){let t=Me(e,"__esc-datacolors__");if(!t){t={};for(let i of Ar){let n="esc-color-data-"+i,s=Er(e,n);if(!s)throw new Error(`CSS fails to define data color '${n}'.`);t[n]=s}Ie(e,"__esc-datacolors__",t)}return t}(t)[e]}function $r(e){if(!e||!(e=e.trim()))return;e.startsWith("esc-colorwheel-")&&(e=e.substring("esc-colorwheel-".length));let t=/^(\d+)-(\d+)$/.exec(e);return!t||parseInt(t[1])>parseInt(t[2])?void 0:"esc-colorwheel-"+e}function Or(e,t){if(!(e=$r(e)))return e;return function(e){let t=Me(e,"__esc-colorwheel__");if(!t){t={};for(let i=1;i<=7;i++)for(let n=0;n<=i;n++){let s="esc-colorwheel-"+n+"-"+i,r=Er(e,s);if(!r)throw new Error(`CSS fails to define wheel color '${s}'.`);t[s]=r}Ie(e,"__esc-colorwheel__",t)}return t}(t)[e]}function Dr(e){return!!e&&/^\s*\d+(\.\d+)?\s*,\s*\d+(\.\d+)?\s*,\s*\d+(\.\d+)?\s*$/.test(e)}function Pr(e){return function(e){return null!=Tr(e)}(e)||function(e){return null!=$r(e)}(e)||Dr(e)||function(e){let t=/^\s*mix\s*\(\s*((?:[^,]*[^\d,][^,]*)|(?:\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?))\s*,\s*((?:[^,]*[^\d,][^,]*)|(?:\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?))\s*,\s*(\d*\.?\d+)\s*\)\s*$/.exec(e||"");return!!t&&(Pr(t[1])&&Pr(t[2])&&Number(t[3])<=1)}(e)}function _r(e){if(!e||!(e=e.trim()))return;let t=Tr(e)||$r(e);return t?`var(--${t})`:Dr(e)?e:void 0}function Fr(e,t){if(!e||!(e=e.trim()))return;if(Dr(e))return e;let i;if(i=Lr(e,t))return i;if(i=Or(e,t))return i;try{if(i=function(e,t){let i=/^\s*mix\s*\(\s*((?:[^,]*[^\d,][^,]*)|(?:\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?))\s*,\s*((?:[^,]*[^\d,][^,]*)|(?:\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?))\s*,\s*(\d*\.?\d+)\s*\)\s*$/.exec(e||"");if(!i)return;let n=Fr(i[1],t);if(!n)return;let s=Fr(i[2],t);if(!s)return;let r=Number(i[3]);if(r>1)throw new Error(`Invalid color mix: ${e}`);return mr(n.split(",").map(Number),s.split(",").map(Number),r).join()}(e,t))return i}catch(e){}throw new Error(`Invalid color: '${e}'`)}function Rr(e,t,i,n,s){if(void 0===t.id)throw new Error("Option must not have undefined id.");let r=Rt(),o=s('<span class="esc-c-option"/>'),l=_r(t.color);l&&o.attr("--esc-choices-option-color",l),n&&o.attr("tabindex","0"),s("<input>").attr("type",e).attr("autocomplete","off").attr("id",r).attr("name",i).attr("value",Js(t.id)).attr("tabindex","-1").appendTo(o);let a=s("<label/>").attr("for",r).attr("tabindex","-1").appendTo(o);return a.append('<span class="esc-c-state" />'),ni(t,a,s),o}function Br(e){let t=e.children("input").attr("value");if(null==t)throw new Error("Option does not have value attribute.");return t}function*Hr(e,t){if(!e)return e;let i=0;for(let n of e)yield t(n,i++)}function jr(e){let t=[];if(!e)return t;if(Symbol.iterator in e)for(let i of e)if("low"in i&&"high"in i){if(i.low!==i.high)throw new Error(`Cannot convert histogram with non-degenerate bin [${i.low}, ${i.high}] to count map.`);t.push({value:i.low,count:i.count})}else t.push({value:i.value,count:i.count});else for(let[i,n]of Object.entries(e)){let e=s(i);void 0!==e&&t.push({value:e,count:n})}if(t.length<=3&&t.every(e=>0===e.value||1===e.value||null===e.value)){let e=t.length;for(let i=0;i<e;i++){let e=t[i];null!==e.value&&t.push({value:1===e.value,count:e.count})}}return t}var qr,Ur,Zr,Yr,Gr,Vr,Xr,Wr,Kr;function Qr(e,t=!0){if(!Jr(e,t))throw new Error(`Invalid min-max range: [${e.min}, ${e.max}]`)}function Jr(e,t=!0){return null==e||Number.isFinite(e.min)&&Number.isFinite(e.max)&&(t?e.min<=e.max:e.min<e.max)}function eo(e,t=qr.finite){if(!e)return e;if(null==t)throw new Error("Finite mode must be non-null.");let i=null,n=null;for(let t of e)null==t||("number"==typeof t?s(t):(s(t.min),s(t.max)));return i=null==i?Number.NaN:i,n=null==n?Number.NaN:n,{min:i,max:n};function s(e){if(null!=e){switch(t){case qr.non_nan:if(Number.isNaN(e))return;break;case qr.finite:if(!Number.isFinite(e))return}(null==i||e<i)&&(i=e),(null==n||e>n)&&(n=e)}}}function to(t,i){if(!i.size)return;let n=jr(t),s=function(e,t=qr.finite){return e&&eo(e,t).max}(Hr(i.keys(),e=>(n.find(t=>t.value===e)||{}).count));Number.isFinite(s)&&0!==s||(s=1);let r=(o="format",Tn("esc.widgets.control.choices.runtime")[o]);var o;for(let[t,o]of i.entries()){let i,l=(n.find(e=>e.value===t)||{}).count;if(Number.isFinite(l)||(l=0),i=o.find(".esc-c-bar"),n.length&&!i.length){let t=e.$('<label class="esc-c-bar-container" />').attr("for",o.children("input").attr("id")).appendTo(o);i=e.$('<span class="esc-c-bar" />').appendTo(t)}i.css("--esc-choices-bar-value",l/s*100+"%"),i=o.find(".esc-c-count"),n.length&&!i.length&&(i=e.$('<label class="esc-c-count" />').attr("for",o.children("input").attr("id")).appendTo(o)),i.text(r(l))}}!function(e){e[e.all=0]="all",e[e.non_nan=1]="non_nan",e[e.finite=2]="finite"}(qr||(qr={}));class io extends Qs{constructor(e){super(e,".esc-c-options"),this.requestAnimationFrameOnceForDistribution=ps(),this.optionName=mt(this.control).find("input").first().attr("name")||this.id||Rt(),e.distribution&&this.setDistribution(e.distribution)}makeOption(e){return Rr("radio",e,this.optionName,this._enabled,mt)}setOptionSelection(e,t){e.children("input").get(0).checked=t}getOptionIdAttribute(e){return Br(e)}isSelected(e){return e.children("input").get(0).checked}_setControlEnabled(e){super._setControlEnabled(e),mt(this.control).find("input").attr("disabled",e?null:"")}setDistribution(e){return void 0!==e&&this.requestAnimationFrameOnceForDistribution(()=>to(e,this.getOptionsMap())),this}_updateDom(e){to(null,this.options2map(e)),super._updateDom(e)}}function no(e,t){let i=si(e,"Choices",HTMLElement),n=new io({element:i,type:t.type,distribution:t.distribution});Vs(n.element,n,t)}bt("esc-choices",no),Zs.init=no,Ur||(Ur={});class so{constructor(e){this.element=e.element,this._enabled=!this.element.classList.contains("esc-is-disabled"),this.tabIndices=new WeakMap;for(let e of this.getElements())this.tabIndices.set(e,e.tabIndex);this.updateDomEnabled=gs(()=>{this.element.classList.toggle("esc-is-disabled",!this._enabled);for(let e of this.getElements())if(this._enabled){let t=this.tabIndices.get(e);null!=t&&(e.tabIndex=t)}else this.tabIndices.set(e,e.tabIndex),e.tabIndex=-1}),new MutationObserver(()=>requestAnimationFrame(()=>this.updateDomEnabled())).observe(this.element,{characterData:!1,attributes:!1,childList:!0,subtree:!0}),this.updateDomEnabled()}getElements(){let e=Array.from(this.element.querySelectorAll("[tabindex], a, button, input, select, textarea"));return e.push(this.element),e}getEnabled(){return this._enabled}setEnabled(e){return(e=!!e)!==this._enabled&&(this._enabled=e,this.updateDomEnabled()),this}}function ro(e,t){let i=si(e,"Enablable",HTMLElement);Vs(i,new so({element:i}),t)}bt("esc-enablable",ro),Ur.init=ro,Zr||(Zr={});class oo{constructor(e){this.element=e.element,this.label=ge(this.element,"label");let t=pe(this.element,".esc-c-validation");t&&(this.errorMessage=mt(t))}initializeInputs(){if(void 0===this.inputs){let e=pe(this.element,".esc-c-input");if(this.inputs=[],this.enablables=[],e){let t=Be(e);null!=t&&(this.inputs.push(e),"setEnabled"in t&&this.enablables.push(t));for(let i of e.children)t=Be(i),null!=t&&(this.inputs.push(i),"setEnabled"in t&&this.enablables.push(t))}}}setErrorAndEnabled(e){return this.setError(e.error),this.setEnabled(e.enabled),this}setError(e){if(void 0!==e){if(this.errorMessage&&"boolean"==typeof e)throw new Error("Field error must be IDomContent, not boolean in message mode.");requestAnimationFrame(()=>{this.errorMessage&&At(e,this.errorMessage),this.element.classList.toggle("esc-is-invalid",!!e),this.initializeInputs();for(let t of this.inputs)t.classList.toggle("esc-is-invalid",!!e)})}return this}getEnabled(){return this._enabled}setEnabled(e){if(null!=e&&e!==this._enabled){this._enabled=e,requestAnimationFrame(()=>{this.element.classList.toggle("esc-is-disabled",!this._enabled)}),this.initializeInputs();for(let e of this.enablables)e.setEnabled(this._enabled)}return this}setDecoration(e){return requestAnimationFrame(()=>ii(mt(this.label),e)),this}}function lo(e,t){let i=si(e,"Field controller");Gs(i,new oo({element:i}),t)}function ao(e,t){let i;return t&&t.length&&(i=t.join(",")),new Promise(t=>{let n=document.createElement("input");n.type="file",n.multiple=e,i&&(n.accept=i),n.style.display="none",n.addEventListener("change",()=>t(n.files||void 0)),document.body.appendChild(n);try{n.click()}finally{document.body.removeChild(n)}})}bt("esc-field",lo),Zr.init=lo,Yr||(Yr={});class ho extends rs{constructor(e){super({eventMode:ns.replay}),this.enabled=!0,this.element=e.element,this.accept=e.accept;let t=e.onDrop,i=(e,t)=>{e&&(e.stopPropagation(),e.preventDefault()),t&&(this.element.classList.remove("esc-is-dragging"),this.element.classList.remove("esc-is-invalid"))};this.element.addEventListener("dragenter",e=>{i(e,!1),this.enabled&&null!=e.dataTransfer&&(this.element.classList.add("esc-is-dragging"),null==this.accept||this.accept(e.dataTransfer.files)||this.element.classList.add("esc-is-invalid"))}),this.element.addEventListener("dragover",e=>i(e,!1)),this.element.addEventListener("dragleave",e=>i(e,!0)),this.element.addEventListener("dragend",()=>i(null,!0)),this.element.addEventListener("drop",e=>{if(i(e,!0),!this.enabled||null==e.dataTransfer)return;let n=e.dataTransfer.files;(null==this.accept||this.accept(n))&&t(n)})}getEnabled(){return this.enabled}setEnabled(e){return this.enabled=e,this}}class uo extends ho{constructor(e){super(Object.assign({},e,{accept:t=>t.length>0&&(null==e.accept||e.accept(t)),onDrop:e=>{e.length>0&&this.updateSelection(Array.from(e),!0)}}))}equalsSelection(e,t){return void 0===e?void 0===t:void 0!==t&&e.length===t.length&&Ai(e.map(e=>e.name).sort(Oi),t.map(e=>e.name).sort(Oi))}}class co extends Is{constructor(e){super(e)}initialize(e){super.initialize(e),this.types=e.types||[],this.handler=e=>{this.getEnabled()&&this.updateSelection(e,!0)},this.element.addEventListener("click",()=>{this.getEnabled()&&this.prompt()}),this.element.addEventListener("keydown",e=>{if(this.getEnabled())switch(e.key){case" ":case"Enter":e.preventDefault(),this.prompt()}})}setDecoration(e){return requestAnimationFrame(()=>ii(mt(this.element),e)),this}}class fo extends co{constructor(e){super(e),this.selection=[],new uo({element:this.element,accept:e=>!this.types.length||Array.from(e).every(e=>this.types.includes(e.type))}).onSelection(this.handler)}prompt(){var e;(e=this.types,ao(!0,e).then(e=>null==e?[]:Array.from(e))).then(this.handler)}updateSelection(e,t){let i=super.updateSelection(e,t);return this.selection=[],i}}function mo(e,t){t=t||{};let i=si(e,"File picker",HTMLElement),n=new fo({element:i,types:t.types});Vs(n.element,n,t)}bt("esc-file-multi-picker",mo),Yr.init=mo,Gr||(Gr={});class po extends ho{constructor(e){super(Object.assign({},e,{accept:t=>1===t.length&&(null==e.accept||e.accept(t[0])),onDrop:e=>{e.length>0&&this.updateSelection(e[0],!0)}}))}}class go extends co{constructor(e){super(e),this.selection=void 0,new po({element:this.element,accept:e=>!this.types.length||this.types.includes(e.type)}).onSelection(this.handler)}prompt(){var e;(e=this.types,ao(!1,e).then(e=>{if(null!=e&&0!==e.length){if(e.length>1)throw new se(`Must have single, unique file, not ${e.length} files.`);return e[0]}})).then(this.handler)}updateSelection(e,t){let i=super.updateSelection(e,t);return this.selection=void 0,i}}function bo(e,t){t=t||{};let i=si(e,"File picker",HTMLElement),n=new go({element:i,types:t.types});Vs(n.element,n,t)}bt("esc-file-picker",bo),Gr.init=bo,Vr||(Vr={});class wo extends Ts{initialize(e){this.allAsUndefined=!0===e.allAsUndefined,this.maxNoSelected=null==e.maxNoSelected?-1:e.maxNoSelected,this.selection=[],super.initialize(e)}doHandleKey(e,t){let i=this.getNoOptions(),n=this.getOptionId(e);switch(t){case" ":case"Enter":return this.toggleSelection(n),!0;case"ArrowRight":case"ArrowDown":{let e=void 0===n?-1:this.optionIds.indexOf(n);return e=e<0||e>=i-1?0:e+1,this.focusOption(this.getOptions()[e]),!0}case"ArrowLeft":case"ArrowUp":{let e=void 0===n?-1:this.optionIds.indexOf(n);return e=e<=0?i-1:e-1,this.focusOption(this.getOptions()[e]),!0}default:return!1}}doHandleClick(e){let t=this.getOptionId(e);return this.toggleSelection(t),!0}toggleSelection(e){this.selection.includes(e)?this.removeSelection(e):this.addSelection(e)}getSelection(){if(this.allAsUndefined&&this.selection.length===this.getNoOptions())return;let e=this.selection.slice();return e.sort(Oi),e}addSelection(e){return this.selection.includes(e)||this.setSelection([...this.selection,e]),this}removeSelection(e){return this.selection.includes(e)&&this.setSelection(this.selection.filter(t=>t!==e)),this}validateSelection(e){let t,i=this.getOptionIds();return t=null==e&&this.allAsUndefined?this.maxNoSelected<0?i:i.slice(0,this.maxNoSelected):Es(e,{options:i,type:this.type,allowNullValues:!0,maxNoSelected:this.maxNoSelected,unique:!0}),this._validateSelection&&(t=this._validateSelection(this.allAsUndefined&&t.length===this.getNoOptions()?void 0:[...t].sort(Oi))||i),t}equalsSelection(e,t){if(null==e||null==t)throw new se("Null selection should have been normalized by validation.");return Ai(e,t,!1)}_getControlSelection(){let e=[];for(let t of this.getOptions())this.isSelected(t)&&e.push(this.getOptionId(t));return e}_setControlSelection(e){for(let t of this.getOptions()){let i=this.getOptionId(t),n=e.includes(i);this.setOptionSelection(t,n)}}adjustSelection(e){return this.allAsUndefined&&this.selection.length===this.getNoOptions()?e:this.selection.filter(t=>e.includes(t))}getEffectivelyEnabled(){return this.getEnabled()&&(0!==this.getNoOptions()||void 0===this.selection)}}class vo extends wo{setDecoration(e,t){const i=this.getOptions().find(t=>this.getOptionIdAttribute(t)===e);return i&&requestAnimationFrame(()=>this._setDecoration(i,t)),this}_setDecoration(e,t){ii(e,t)}setDecorations(e){return e=e||{},requestAnimationFrame(()=>{for(let t of this.getOptions()){let i=this.getOptionIdAttribute(t);ii(t,e[i])}}),this}}class yo extends vo{constructor(e){super(e,".esc-c-options"),this.requestAnimationFrameOnceForDistribution=ps(),this.optionName=mt(this.control).find("input").first().attr("name")||this.id||Rt(),e.distribution&&this.setDistribution(e.distribution),Ws(this,this.element)}makeOption(e){return Rr("checkbox",e,this.optionName,this._enabled,mt)}setOptionSelection(e,t){e.children("input").get(0).checked=t}getOptionIdAttribute(e){return Br(e)}isSelected(e){return e.children("input").get(0).checked}_setControlEnabled(e){super._setControlEnabled(e),mt(this.control).find("input").attr("disabled",e?null:""),Xs(e,this.element)}setDistribution(e){return void 0!==e&&this.requestAnimationFrameOnceForDistribution(()=>to(e,this.getOptionsMap())),this}_updateDom(e){to(null,this.options2map(e)),super._updateDom(e)}}function xo(e,t){let i=si(e,"Multi-choices",HTMLElement),n=new yo({element:i,type:t.type,allAsUndefined:t.allAsUndefined,maxNoSelected:t.maxNoSelected,distribution:t.distribution});Vs(n.element,n,t)}function So(e,t,i){if(void 0===e.id)throw new Error("Option must not have undefined id.");let n=i('<span class="esc-c-option" />').attr("data-esc-id",Js(e.id));t&&n.attr("tabindex","0");let s=_r(e.color);return s&&n.attr("--esc-tabs-option-color",s),ni(e,n,i),n}bt("esc-multi-choices",xo),Vr.init=xo,Xr||(Xr={});class Eo extends vo{constructor(e){super(e)}initialize(e){super.initialize(e),this.stateless=!0===e.stateless}setSelection(e){return super.setSelection(e),this.stateless&&this._setSelection([]),this}makeOption(e){return So(e,this._enabled,mt)}}function ko(e,t){let i=si(e,"MultiTabs",HTMLElement),n=new Eo({element:i,type:t.type,allAsUndefined:t.allAsUndefined,maxNoSelected:t.maxNoSelected,stateless:t.stateless});Vs(n.element,n,t)}bt("esc-multi-tabs",ko),Xr.init=ko,Wr||(Wr={});class No{constructor(){this.sum=0,this.comp=0}update(e){let t=e-this.comp,i=this.sum+t;return this.comp=i-this.sum-t,this.sum=i,this}}function Co(e,t=qr.finite){if(!e)return e;if(null==t)throw new Error("Finite mode must be non-null.");let i=new No,n=0;for(let s of e)if(null!=s){switch(t){case qr.all:if(Number.isNaN(s))return Number.NaN;break;case qr.non_nan:if(Number.isNaN(s))continue;break;case qr.finite:if(!Number.isFinite(s))continue}i.update(s),n++}return 0==n?Number.NaN:i.sum/n}function Io(e){return function(t){return t/=e,Math.abs(t)<=1?.75*(1-t*t)/e:0}}function Mo(e){let t=function(e,t=Kr.sample,i=qr.finite){if(!e)return e;if(null==i)throw new Error("Finite mode must be non-null.");if(null==t)throw new Error("Variance method mode must be non-null.");let n,s=new No,r=new No,o=0;for(let t of e)if(null!=t){switch(i){case qr.non_nan:if(Number.isNaN(t))continue;break;case qr.finite:if(!Number.isFinite(t))continue}o++,n=t-s.sum,s.update(n/o),r.update(n*(t-s.sum))}if(0==o)return{total:o,mean:Number.NaN,variance:Number.NaN};let l=t===Kr.sample?o-1:o;return{total:o,mean:s.sum,variance:0===l?Number.NaN:r.sum/l}}(e,Kr.sample,qr.finite);return function(e,t){return i=>i.map(i=>{let n=0,s=0;for(let r of t)Number.isFinite(r)&&(n+=e(i-r),s++);return[i,0===s?0:n/s]})}(Io(2.34*Math.sqrt(t.variance)/Math.pow(t.total,.2)),e)}function zo(e){let t=function(e,t,i){if(!e)return e;let n,s=new No,r=new No,o=0;for(let t of e){if(!Number.isFinite(t.low)||0===t.count)continue;let e=(t.low+t.high)/2;if(null!=e){switch(i){case qr.non_nan:if(Number.isNaN(e))continue;break;case qr.finite:if(!Number.isFinite(e))continue}o+=t.count,n=e-s.sum,s.update(t.count*n/o),r.update(t.count*n*(e-s.sum))}}return 0===o?{total:o,mean:Number.NaN,variance:Number.NaN}:{total:o,mean:s.sum/o,variance:t===Kr.sample&&o>1?r.sum/(o-1):r.sum/o}}(e,Kr.sample,qr.finite),i=2.34*Math.sqrt(t.variance)/Math.pow(t.total,.2);return i/=2,function(e,t){return i=>i.map(i=>{let n=0,s=0;for(let r of t){if(!Number.isFinite(r.low)||0===r.count)continue;let t=(r.low+r.high)/2;n+=r.count*e(i-t),s+=r.count}return[i,0===s?0:n/s]})}(Io(i),e)}function Ao(e,t){return e.map(e=>"number"==typeof e?[e,t]:[e[0],t])}!function(e){e.population="population",e.sample="sample"}(Kr||(Kr={}));const To=Math.PI/2,Lo=2*Math.PI;function $o(e,t=null){let[i,n]=e,s=i.length,r=n.length;if(0===s||0===r)throw new Error("Cannot pad empty curve.");let o=[],l=[];if(0===s&&0===r)return[o,l];let a=0,h=0,u=!0;for(;;){let[e,c]=Do(i,u?0:a+1,n,u?0:h+1,t);if(a>e||h>c)throw new se("Array padding receeds.");if(!u&&a===e&&h===c)throw new se("Array padding does not proceed.");let d=e-a,f=c-h;if(Oo(i,a,d,f-d,o),Oo(n,h,f,d-f,l),o.length!==l.length)throw new se(`Padded arrays miss target (${o.length} !== ${l.length}).`);if(a=e,h=c,u=!1,e===s-1&&c===r-1)break}if(o.push(i[a++]),l.push(n[h++]),a!==s)throw new se(`Padded array 1 does not use entire source data (${a} !== ${s}).`);if(h!==r)throw new se(`Padded array 2 does not use entire source data (${h} !== ${r}).`);return[o,l]}function Oo(e,t,i,n,s){if(0===i)for(let i=0;i<n;i++)s.push(e[t]);else if(n<=0)for(let n=0;n<i;n++)s.push(e[t++]);else{let r=i+n,o=function(e,t,i){let n=new Array(i),s=0,r=e[t++].slice(0,2);for(let o=0;o<i;o++,t++){let i=e[t].slice(0,2);n[o]=s+=cr(r,i),r=i}return n}(e,t,i),l=o[o.length-1],a=0;for(;!o[a];)a++,t++;let h=1,u=e[t++];s.push(u);for(let i=1;i<=r;i++)if(o[a]<(i+1)/r*l){let n=e[t++];for(let e=1;e<h;e++){let t=e/h,i=(t<=.5?u:n).slice();i[0]=or(u[0],n[0],t),i[1]=or(u[1],n[1],t),s.push(i)}for(i<r&&s.push(n),u=n;a<o.length&&!o[++a];)t++;h=1}else h++}}function Do(e,t,i,n,s){if(s){let r;for(;(r=Po(e,t,void 0,s))>=0;){let o=Po(i,n,s(e[r]),s);if(o>=0)return[r,o];t=r+1}}return[e.length-1,i.length-1]}function Po(e,t,i,n){if(n)for(;t<e.length;){let s=n(e[t]);if(void 0!==s&&(void 0===i||i===s))return t;t++}return-1}function _o(e,t){if(void 0===e||t<=0)return e;let i;return n=>n<=t?void 0===i?i=e(0):i:e(1==n?1:(n-t)/(1-t))}function Fo(e,t){if(t<0||t>=1)return e;let i;return n=>n>=t?void 0===i?i=e(1):i:e(n/t)}function Ro(e,t){if(!e||!t)return e;let i=null==t.delay?0:sr(t.delay,0,1),n=null==t.duration||t.duration<0?1:Math.min(t.duration,1);return 0===i&&1===n&&null==t.easing?e:(i>0&&i<1&&n<1&&(n/=1-i),t.easing&&(e=tt(e,t.easing)),e=_o(e=Fo(e,n),i))}function Bo(e,t){return i=>or(e,t,i)}const Ho=()=>{};function jo(e,t){return e===t?Ho:Bo(e,t)}function qo(e,t){const i=t.amplitude,n=t.frequency,s=null==t.shift?0:t.shift;if("number"==typeof i&&"number"==typeof n)return t=>e+i*Math.sin(Lo*n*(s+t));{const t="number"==typeof i?()=>i:i,r="number"==typeof n?()=>n:n;return i=>e+t(i)*Math.sin(Lo*r(i)*(s+i))}}function Uo(e,t){return i=>mr(e,t,i)}function Zo(e,t){return Ai(e,t)?void 0:Uo(e,t)}function Yo(e){let{start:t,end:i,start0:n,end0:s,interpolator:r}=e;if(t.length!==i.length)throw new Error(`Start and end array must have equal lenghts: ${t.length} !== ${i.length}`);return e=>n&&0===e?n:s&&1===e?s:t.map((t,n)=>r(t,i[n],e))}function Go(e,t,i){let n=(i=i||{}).interpolator||fr,[s,r]=$o([e,t],i.identifier);return Yo({start:s,end:r,start0:e,end0:t,interpolator:n})}function Vo(e){let t=Object.keys(e).filter(t=>void 0!==e[t]);if(0!==t.length){if(1===t.length){let i=t[0],n=e[i];return e=>{let t={};return t[i]=n(e),t}}return i=>{let n={};for(let s of t)n[s]=e[s](i);return n}}}function Xo(e){let t=e.length,i=new Array(t),n=0,s=!0;for(let r=0;r<t;r++){let t=e[r];if(t.duration<=0)throw new Error(`Tween duration is invalid for piece-wise composition: ${t.duration}`);let o=n;n+=t.duration,void 0!==t.tween&&(s=!1),i[r]={start:o,end:n,duration:t.duration,tween:t.tween}}if(!s){for(let e of i)e.start/=n,e.end/=n,e.duration/=n;return e=>{let n=i.find(t=>e<=t.end)||i[t-1];return n.tween&&n.tween((e-n.start)/n.duration)}}}function Wo(e,t,i){return n=>function(e,t,i,n){return 0===n?e:1===n?t:n<=i?e:t}(e,t,i,n)}function Ko(e,t,i){return e===t?void 0:Wo(e,t,i)}const Qo=e.log.logger("esc.animation.Animation");class Jo{constructor(e){if(this.frameId=-1,this.terminated=!1,this.animate=()=>{if(this.terminated)return;let e,t,i,n,s=Date.now();this.frame++,null==this.t0?(e=!0,t=0===this.duration,i=0,n=t?1:0,this.t0=Date.now(),this.t1=this.t0+this.duration,Qo.debug("Starting animation (start=%d, end=%d).",this.t0,this.t1)):s>=this.t1?(e=!1,t=!0,i=s-this.t0,n=1):(e=!1,t=!1,i=s-this.t0,n=i/this.duration,this.easing&&(n=sr(this.easing(n),0,1))),!1===this.callback(n,{start:this.t0,end:this.t1,duration:this.duration,first:e,last:t,elapsed:i,t:n})||t?(Qo.isDebugEnabled&&Qo.debug("Completed animation (fps=%d, start=%d, end=%d, now=%d, discontinued=%s).",Math.round(1e3*this.frame/(s-this.t0)),this.t0,this.t1,s,!t),this.terminated=!0,this.frameId=-1):this.frameId=requestAnimationFrame(this.animate)},null==e.callback)throw new Error("Animation callback must be non-null.");this.callback=e.callback,this.duration=null==e.duration||e.duration<0?0:e.duration,this.easing=e.easing?e.easing:null,this.frame=0,this.frameId=requestAnimationFrame(this.animate)}cancel(){return this.terminated||(Qo.debug("Cancelling animation."),this.terminated=!0,this.frameId>=0&&(cancelAnimationFrame(this.frameId),this.frameId=-1)),this}}const el=e.log.logger("esc.animation.AnimationQueue");class tl{constructor(e){this.animations=[],this.animation=null,e=e||{},this.duration=null==e.duration||e.duration<0?0:e.duration,this.easing=e.easing||null,this.stopOnEmpty=!0===e.stopOnEmpty,this.stopped=!0;for(let t of e.animations||[])this.add(t.callback,t.duration,t.easing);this.stopped=!1===e.started,this.next()}isRunning(){return this.animations.length>0||null!=this.animation}add(e,t,i){if(null==e)throw new Error("Animation callback must be non-null.");return el.debug("Adding animation to queue (duration=%s, easing=%o): %o",t,i,e),this.animations.push({callback:e,duration:t,easing:i}),this.next(),this}next(){if(this.stopped||this.animation)return;let e=this.animations.shift();e&&(el.debug("Advancing to next animation (duration=%s, easing=%o, queue=%d): %o",e.duration,e.easing,this.animations.length,e.callback),this.animation=new Jo({callback:(t,i)=>{let n=e.callback(t,i);return(!1===n||i.last)&&(el.debug("Queued animation is complete."),this.animation=null,this.stopOnEmpty&&0===this.animations.length&&(this.stopped=!0),this.next()),n},duration:null==e.duration?this.duration:e.duration,easing:null==e.easing?this.easing:e.easing}))}start(){return this.stopped&&(el.debug("Starting animation queue."),this.stopped=!1,this.next()),this}clear(){return el.debug("Clearing animation queue (size=%d).",this.animations.length),this.animations.length=0,this}cancel(){return this.clear(),this.animation&&(el.debug("Cancelling current animation."),this.animation.cancel(),this.animation=null),this}}class il{constructor(e){if(this.animationQueue=new tl({duration:e.duration,easing:null}),this.lifecycleCallback=e.lifecycleCallback||void 0,this.monitorCallback=e.monitorCallback||void 0,e.destroyable){let t=e.destroyable,i=()=>this.cancel();t.addEventListener("esc-destroy",i),this.onDestroy=()=>t.removeEventListener("esc-destroy",i)}}isRunning(){return null!=this.animationQueue&&this.animationQueue.isRunning()}_queue(e,t,i){if(this.animationQueue&&e){let n=this.lifecycleCallback||this.monitorCallback?(t,i)=>{let n=e(t,i);return this.lifecycleCallback&&(i.first||i.last)&&this.lifecycleCallback(i),this.monitorCallback&&this.monitorCallback(i),n}:e;this.animationQueue.add(n,t,i)}}cancel(){return this.animationQueue&&this.animationQueue.cancel(),this}destroy(){return this.animationQueue&&(this.cancel(),this.animationQueue=null,this.onDestroy&&this.onDestroy()),this}}class nl extends il{update(e,t,i){return this.animationQueue&&(this.animationQueue.cancel(),this.queue(e,t,i)),this}queue(e,t,i){if(this.animationQueue){const n=this.makeCallback(e);this._queue(n,t,i)}return this}}class sl extends nl{constructor(e){var t;super(e),this.effectFactory="function"==typeof(t=e.effect)?t:e=>t.animate(e)}makeCallback(e){return this.effectFactory(e)}}class rl{constructor(e){this.current=e.current,this.tweenFactory=e.tweenFactory,this.render=e.render}animate(e){let t;return(i,n)=>{if(n.first&&(t=this.tweenFactory(this.current,e),!t))return!1;let s=t(i),r=this.render(s);return this.current=r||s,!0}}}function ol(e){return function(e,t){let i="";e=e||[];let n=!0;for(let s=0;s<e.length;s++){let r=t(e[s]);r&&Number.isFinite(r[0])&&Number.isFinite(r[1])?n?(i+=(i?" ":"")+ll(r),n=!1):i+=" "+al(r):n=!0}return i}(e,it)}function ll(e){return`M ${e[0]} ${e[1]}`}function al(e){return`L ${e[0]} ${e[1]}`}const hl=e.log.logger("esc.dom..drag.DragController");class ul{constructor(e){if(this.startDragListener=e=>this.startDrag(e),this.buttons=-1,this.dragListener=e=>this.drag(e),this.endDragListener=()=>this.endDrag(),this.dragging=!1,null==e)throw new Error("Options must be non-null.");if(null==e.element)throw new Error("Drag element is missing.");this.element=e.element,this.onStart=e.onStart,this.onProgress=e.onProgress,this.onEnd=e.onEnd,this.element.addEventListener("mousedown",this.startDragListener)}startDrag(e){if(this.buttons=e.buttons,this.dragging)return;hl.debug("Start dragging."),document.addEventListener("mouseup",this.endDragListener),document.addEventListener("mousemove",this.dragListener),this.element.classList.add("esc-is-dragging");let t=window.getComputedStyle(this.element).cursor;t&&(this.oldCursor=document.body.style.cursor,document.body.style.cursor=t),this.dragging=!0,this.onStart&&this.onStart()}drag(e){(e.buttons&this.buttons)===this.buttons?this._drag(e):this.endDrag()}_drag(e){hl.debug("Dragging: %o",e),this.onProgress&&!1===this.onProgress(e)&&(hl.debug("Dragging cancelled."),this.endDrag())}endDrag(){return this.dragging&&(hl.debug("End dragging."),this.buttons=-1,document.removeEventListener("mouseup",this.endDragListener),document.removeEventListener("mousemove",this.dragListener),void 0!==this.oldCursor&&(document.body.style.cursor=this.oldCursor,this.oldCursor=void 0),this.dragging=!1,this.element.classList.remove("esc-is-dragging"),this.onEnd&&this.onEnd()),this}}function cl(e,t,i,n){if(null==e)return e;if(e===i.min)return null==n?0:n.min;if(e===i.max)return null==n?1:n.max;{let s="function"==typeof t?t:t.fu,r=s(i.min),o=s(i.max),l=(s(e)-r)/(o-r);return null==n?l:n.min+l*(n.max-n.min)}}function dl(e,t,i,n){if(null==e)return e;if(e===(null==n?0:n.min))return i.min;if(e===(null==n?1:n.max))return i.max;{let s=null==n?e:(e-n.min)/(n.max-n.min),r=t.fu(i.min),o=r+s*(t.fu(i.max)-r);return t.inverse(o)}}function fl(e){return Tn("esc.format.runtime")[e]}const ml={number:"number",number_no_group:"numberNoGroup",percent:"percent",illion:"illion",thousand:"thousand",million:"million",billion:"billion",trillion:"trillion"};function pl(e){return null!=e&&(!!(e=e.trim())&&("bytes"===e||"boolean"===e||gl(e)||function(e){return null!=yl(e)}(e)))}function gl(e){return null!=vl(e)}const bl=new n((function(e){let t=vl(e);if(null!=t)return"currency"===t.style?function(e,t,i){return xl=xl||fl("numericFormats"),void 0===t?(t,n)=>{if(null!=t&&"number"!=typeof t)throw new Error(`Format '${i}' not applicable to '${typeof t}' value: ${t}`);return xl.currency(e,t,n)}:n=>{if(null!=n&&"number"!=typeof n)throw new Error(`Format '${i}' not applicable to '${typeof n}' value: ${n}`);return xl.currency(e,n,t)}}(t.currency,t.precision,e):El(ml[t.style],t.precision,e);let i=yl(e);if(null!=i)return function(e,t){return Sl=Sl||fl("dateFormats"),i=>{if(null!=i&&"number"!=typeof i&&!(i instanceof Date))throw new Error(`Format '${t}' not applicable to '${typeof i}' value: ${i}`);return Sl.format(i,e)}}(i,e);if("bytes"===e)return El("bytes",void 0,e);if("boolean"===e)return function(){let e=fl("boolean");return t=>{if(null!=t&&"boolean"!=typeof t)throw new Error(`Format 'boolean' not applicable to '${typeof t}' value: ${t}`);return e(t)}}();throw new Error(`Format not recognized: '${e}'`)}));function wl(e){if(null==e)return e;if(!(e=e.trim()))throw new Error("Format must be non-empty.");return bl.compute(e)}function vl(e){if(null==e)return null;if(e&&(e=e.trim()),!e)return null;let t=/^(number|number_no_group|percent|illion|thousand|million|billion|trillion)(?:\s*\(\s*([+\-\d]+)\s*\))?$/.exec(e);if(null!=t){return{style:t[1],precision:i(t[2])}}if(t=/^currency\s*\(\s*([A-Z]{3,3})\s*(?:,\s*([+\-\d]+)\s*)?\)$/.exec(e),null!=t){let e=i(t[2]);return{style:"currency",currency:t[1],precision:e}}return null;function i(t){if(null==t)return;let i=j(t);if(null==i)throw new Error(`Invalid format: '${e}'`);return i}}function yl(e){if(null==e)return null;if(e&&(e=e.trim()),!e)return null;let t=/^(date|time|date-time)(?:\s*\(((?:\s*(?:utc|UTC|pad|nosec)\s*,)*(?:\s*(?:utc|UTC|pad|nosec)\s*))?\)\s*)?$/.exec(e);if(!t)return null;let i=t[2].split(",").map(e=>e.trim().toLowerCase()),n=t[1];return i.includes("nosec")&&(n+="-nosec"),i.includes("utc")&&(n+="-utc"),i.includes("pad")&&(n+="-pad"),n}let xl,Sl;function El(e,t,i){return xl=xl||fl("numericFormats"),void 0===t?(t,n)=>{if(null!=t&&"number"!=typeof t)throw new Error(`Format '${i}' not applicable to '${typeof t}' value: ${t}`);return xl[e](t,n)}:n=>{if(null!=n&&"number"!=typeof n)throw new Error(`Format '${i}' not applicable to '${typeof n}' value: ${n}`);return xl[e](n,t)}}function kl(e){if(null==e)return e;if("string"!=typeof e)return e;if(gl(e)){return wl(e)}let t=Ke(["datum","precision"],e,"numeric formatter");return(e,i)=>et(t,[e,i])}var Nl;!function(e){e.identity="identity",e.ln="ln",e.log10="log10",e.e="e",e.p10="p10"}(Nl||(Nl={}));const Cl=Object.freeze({fu:it,inverse:it});function Il(e){if(e&&"string"!=typeof e)return e;return function(e){switch(e){case Nl.identity:return{fu:it,inverse:it};case Nl.ln:return{fu:Math.log,inverse:Math.exp};case Nl.log10:return{fu:Math.log10,inverse:e=>Math.pow(10,e)};case Nl.e:return{fu:Math.exp,inverse:Math.log};case Nl.p10:return{fu:e=>Math.pow(10,e),inverse:Math.log10};default:throw new Error(`Scale type not recognized: ${e}`)}}(Mt(e,Nl,Nl.identity))}function Ml(e,t=[],i){if(i=i?i+" ":"",null==e.min&&t.includes("min")||null!=e.min&&!Number.isFinite(e.min))throw zl("minimum",e,i);if(null==e.max&&t.includes("max")||null!=e.max&&!Number.isFinite(e.max))throw zl("maximum",e,i);if(null==e.step&&t.includes("step")||null!=e.step&&(!Number.isFinite(e.step)||e.step<=0))throw zl("step",e,i);if(null==e.default&&t.includes("default")||null!=e.default&&!Number.isFinite(e.default))throw zl("default "+e.default,e,i);if(null==e.selection&&t.includes("selection")||null!=e.selection&&!Number.isFinite(e.selection))throw zl("selection "+e.selection,e,i);let n=Ni(e.step),s=k(Ni(e.min),n),r=N(Ni(e.max),n),o=sr(E(Ni(e.default),n),s,r);return{min:s,max:r,step:n,default:o,selection:null==e.selection?o:sr(E(Ni(e.selection),n),s,r)}}function zl(e,t,i){return i=i?i+" "+e:e,new Error(`Invalid ${i} for range [${t.min} : ${t.step} : ${t.max}].`)}function Al(e){return Tn("esc.widgets.control.spinner.runtime")[e]}class Tl extends zs{constructor(e){super(e,".esc-c-value"),this.monitorKeys=()=>{if(null==this.lastKey||!this.getEnabled())return;Date.now()-this.lastKey>=this.delay?(this.lastKey=void 0,this.setSelection(this.controlSelection)):requestAnimationFrame(this.monitorKeys)}}initialize(e){if(!Number.isFinite(e.step)||e.step<=0)throw new Error(`Invalid spinner increment: ${e.step}`);this.min=Ci(e.min),this.max=Ci(e.max),this.default=Ci(e.default),this.step=e.step,this.delay=null==e.delay?0:Math.max(0,e.delay),this.precision=-f(this.step).power,this.formatter=function(e,t){return(i,n)=>null==i?e||"":t(i,n)}(e.placeholder,e.format||Al("format")),this.parser=e.parse||Al("parse"),super.initialize(e),this.selection=this.controlSelection=e.selection,this.controlChangeListener=()=>{if(this.lastKey=void 0,!this.getEnabled())return;let e=this._getControlSelection();null!=e&&this._setSelectionWithoutDomUpdate(e),this.updateDomSelection()},this.control.addEventListener("change",this.controlChangeListener),this.upButton=we(this.element,".esc-c-spin-up",HTMLButtonElement),this.upButton.addEventListener("click",()=>this.handleUp()),this.downButton=we(this.element,".esc-c-spin-down",HTMLButtonElement),this.downButton.addEventListener("click",()=>this.handleDown()),this.element.addEventListener("keydown",e=>{if(this.getEnabled())switch(e.key){case"ArrowDown":case"ArrowLeft":this.handleDown(),e.preventDefault();break;case"ArrowUp":case"ArrowRight":this.handleUp(),e.preventDefault();break;case" ":case"Enter":this.control instanceof HTMLInputElement||(this.handleUp(),e.preventDefault())}})}initializeSelection(){}addIncrement(e){let t=this.computeIncrement(e);null!=t&&this.setSelection(t)}computeIncrement(e){let t=this.controlSelection;if(e){if(null==t)return null!=this.min?this.min:this.max;t+=this.step}else{if(null==t)return null!=this.max?this.max:this.min;t-=this.step}return t=this.validateSelection(t),t}_getControlSelection(){return this.control instanceof HTMLInputElement?this.parseAsNumber(this.control.value):void 0}_setControlSelection(e){this.controlSelection=e;let t=this.formatter(e,this.precision);this.control instanceof HTMLInputElement?this.control.value=t:this.control.innerHTML=t}_setControlEnabled(e){this.control instanceof HTMLInputElement&&(this.control.disabled=!e),this.upButton.disabled=!e,this.downButton.disabled=!e}validateSelection(e){if(null==e)return this.default;if(e=ys(e,!0),!Number.isFinite(e))throw new Error(`Selection must be finite: ${e}`);return e=sr(e=E(e,this.step),this.min,this.max)}setRange(e){if(void 0!==e){let t=Ml({min:void 0===e.min?this.min:e.min,max:void 0===e.max?this.max:e.max,step:void 0===e.step?this.step:e.step,default:this.default},["step"],"spinner");this.min=Ci(t.min),this.max=Ci(t.max),this.step=t.step,this.default=Ci(t.default),this.precision=-f(this.step).power,this._setSelectionWithoutDomUpdate(this.getSelection()),this.updateDomSelection()}return this}parseAsNumber(e){if(null==e)return;let t;try{t=this.parser(e)}catch(e){}return Number.isFinite(t)?t:void 0}handleUp(){if(this.getEnabled())if(this.delay>0){let e=this.computeIncrement(!0);if(null==e)return;this.lastKey=Date.now(),requestAnimationFrame(()=>{this._setControlSelection(e),this.monitorKeys()})}else this.selectNext()}handleDown(){if(this.getEnabled())if(this.delay>0){let e=this.computeIncrement(!1);if(null==e)return;this.lastKey=Date.now(),requestAnimationFrame(()=>{this._setControlSelection(e),this.monitorKeys()})}else this.selectPrevious()}selectPrevious(){return this.addIncrement(!1),this}selectNext(){return this.addIncrement(!0),this}selectFirst(){return null!=this.min&&this.setSelection(this.min),this}selectLast(){return null!=this.max&&this.setSelection(this.max),this}}function Ll(e){return Tn("esc.widgets.control.range.runtime")[e]}function $l(e,t,i,n){null!=t.min&&null!=t.max&&Qr(t,!1);let s={isNull:null==e||e.isNull,isNaN:null==e||e.isNaN,isPosInf:null==e||e.isPosInf,isNegInf:null==e||e.isNegInf,ranges:[]};if(0===(e=e||{ranges:[]}).ranges.length)(!n||n<=0)&&(n=2),function(e,t,i,n){if(null!=i&&(t.min!==k(t.min,i)||t.max!==N(t.max,i)))throw new Error(`Min-max conflicts with step size ${i}: [${t.min}, ${t.max}]`);let s=t.min,r=(t.max-t.min)/(n+1);for(let o=0;o<=n;o++){let l=s+r;l=o===n?t.max:E(l,i),e.push({low:s,high:l,selected:!0}),s=l}}(s.ranges,t,i,n);else{for(let t of e.ranges)if(t){if(null==t.low||null==t.high||!Number.isFinite(t.low)||!Number.isFinite(t.high)||t.low>t.high)throw new Error(`Invalid range selection: [${t.low}, ${t.high}]`);s.ranges.push({low:t.low,high:t.high,selected:!1!==t.selected})}!function(e){e.sort((e,t)=>{let i=e.low-t.low;return 0===i?e.high-t.high:i});for(let t=e.length-1;t>=1;t--){let i=e[t],n=e[t-1];if(n.high>i.low)throw new Error(`Selected ranges overlap: [${n.low}, ${n.high}], [${i.low}, ${i.high}]`);n.high<i.low&&e.splice(t,0,{low:n.high,high:i.low,selected:!1})}}(s.ranges),Ol(s.ranges,t)}return s}function Ol(e,t){let i=e.length;if(0!==i){for(let n=0;n<i;n++){let i=e[n];if(i.low=t.min,i.low<=i.high)break;i.high=i.low}for(let n=i-1;n>=0;n--){let i=e[n];if(i.high=t.max,i.low<=i.high)break;i.low=i.high}}}function Dl(e,t,i,n,s=[1e3,100]){let r,o=function(e,t,i,n){let[s,r]=n,o=[],l=Number.NEGATIVE_INFINITY;for(let[n,a]of e){if(!Number.isFinite(n)||n<=l||!rr(a,0,1))throw new Error(`Distribution has invalid point [${n}, ${a}].`);n<t.min||t.max<n||(l=n,n=cl(n,i,t),o.push([n*s,(1-a)*r]))}return o}(e||[],i,n,s),l=[],a=[],[h,u]=s,c=0,d=0;for(let e=0,s=t.length;e<s;e++){let f=cl(t[e].high,n,i)*h,m=[],p=[];for(m.push([d,u]),void 0!==r&&m.push([d,r]);c<o.length;){let e=o[c];if(e[0]>f)break;m.push(e),c++}let g=o[c-1]||[0,u];if(g[0]===f)r=g[1];else{let e=o[c]||[h,u],t=e[0]===g[0]?1:(f-g[0])/(e[0]-g[0]);r=t*e[1]+(1-t)*g[1],m.push([f,r])}p.push([f,r]),m.push([f,u]),l.push(m),e<s-1&&(p.push([f,u]),a.push(p)),d=f}return{segments:l,dividers:a}}const Pl=e.log.logger("esc.widgets.control.range.RangeController");class _l extends Ms{constructor(e){super(e),this.updating=!1,this.distribution=null,this.redrawDom=gs(()=>{this.redrawSegments(),this.segmentDividers=this.redrawDividers(this.segmentDividers,this.segmentsSvg),this.redrawBars(),this.barDividers=this.redrawDividers(this.barDividers,this.barsSvg),this.redrawMarkers(),this.updateSpecialValueCounts()}),this.resizeDom=gs(()=>{this.resizeSegmentsAndDividers(),this.resizeBars(),this.resizeBarDividers(),this.resizeMarkers()}),this.dragRanges=null}initialize(e){super.initialize(e),this.segmentsSvg=we(this.element,".esc-c-segments"),this.segments=this.segmentsSvg.querySelectorAll(".esc-c-segment"),this.segmentDividers=this.segmentsSvg.querySelectorAll(".esc-c-divider"),this.barsSvg=we(this.element,".esc-c-bars"),this.bars=this.barsSvg.querySelectorAll(".esc-c-bar"),this.barDividers=this.barsSvg.querySelectorAll(".esc-c-divider"),this.markersDiv=we(this.element,".esc-c-markers",HTMLElement),this.markers=this.markersDiv.querySelectorAll(".esc-c-marker"),this.effectiveMinMax={min:e.cutpoints[0],max:e.cutpoints[e.cutpoints.length-1]},this.minMax=Object.assign({},this.effectiveMinMax),this.step=Ni(e.step),this.stepPrecision=d(this.step),this.formatter=kl(e.format)||Ll("valueFormat"),this.scale=Il(e.scale),this.selection={ranges:[]};for(let t=0;t<this.bars.length;t++){let i=this.bars.item(t);this.selection.ranges.push({low:e.cutpoints[t],high:e.cutpoints[t+1],selected:i.classList.contains(Ae)})}for(let e=0;e<this.markers.length;e++){let t=this.markers.item(e);this.wireMarker(t,e)}let t=we(this.element,".esc-c-selectors",HTMLElement);this.specialValuesController=new yo({element:t,type:bs.string,dispatchEvents:!1}).onSelection(()=>this.handleSpecialValueChanges()),Object.assign(this.selection,this.getSpecialValuesSelection()),this.specialCounts={noPosInf:0,noNegInf:0,noNaN:0,noNull:0},(t=be(this.element,".esc-c-spinner",HTMLElement))&&(this.noMarkersController=new Tl({element:t,dispatchEvents:!1,min:1,max:5,step:1,selection:this.markers.length}).onSelection(()=>this.handleNoMarkerChanges()),this.noMarkers=this.noMarkersController.getSelection()||-1),this.invertButton=this.element.querySelector(".esc-c-select-opposite"),this.invertButton&&this.invertButton.addEventListener("click",()=>this.invertSelection()),this.resetButton=this.element.querySelector(".esc-c-reset"),this.resetButton.addEventListener("click",()=>this.resetSelection()),this.element.addEventListener("click",e=>{if(!(this.getEnabled()&&e.target instanceof Element))return;let t=ve(e.target,".esc-c-bar, .esc-c-segment",this.element);if(!t)return;let i=Array.from(t.classList.contains("esc-c-bar")?this.bars:this.segments).indexOf(t);i<0||this.select(e,i)}),this.element.addEventListener("keydown",e=>{if(!(this.getEnabled()&&e.target instanceof Element))return;let t=ve(e.target,".esc-c-bar, .esc-c-segment",this.element);if(!t)return;let i=Array.from(t.classList.contains("esc-c-bar")?this.bars:this.segments).indexOf(t);if(i<0)return;let n=this.bars.length;switch(e.key){case" ":case"Enter":this.select(e,i),e.preventDefault();break;case"ArrowRight":i=i<0||i>=n-1?0:i+1,this.bars[i].focus(),e.preventDefault();break;case"ArrowLeft":i=i<=0?n-1:i-1,this.bars[i].focus(),e.preventDefault()}}),this.animator=new sl({effect:new rl({current:null,tweenFactory:(e,t)=>this.makeTween(e,t),render:e=>this.renderDistribution(e)}),duration:Ir(this.element,"esc-range-animation-duration",700),easing:null,destroyable:this.element})}getSelection(){let e=Object.assign({},this.selection);return e.ranges=e.ranges.map(e=>Object.assign({},e)),e}validateSelection(e){let t=$l(e,this.effectiveMinMax,this.step,this.noMarkers),i=this.getSpecialValuesSelection();return t.isNull=null==i.isNull?void 0:!!t.isNull,t.isNaN=null==i.isNaN?void 0:!!t.isNaN,t.isPosInf=null==i.isPosInf?void 0:!!t.isPosInf,t.isNegInf=null==i.isNegInf?void 0:!!t.isNegInf,t}equalsSelection(e,t){return Ii(e,t)}_setSelection(e){super._setSelection(e),this.updating=!0,this.setSpecialValuesSelection(e),this.noMarkersController&&this.noMarkersController.setSelection(e.ranges.length-1),this.updating=!1,this.updateDom()}invertSelection(){let e=this.getSelection();this.setSelection({isNull:!e.isNull,isNaN:!e.isNaN,isPosInf:!e.isPosInf,isNegInf:!e.isNegInf,ranges:e.ranges.map(e=>({low:e.low,high:e.high,selected:!e.selected}))})}resetSelection(){this.setSelection({isNull:!0,isNaN:!0,isPosInf:!0,isNegInf:!0,ranges:[]})}setRange(e){if(void 0===e)return this;let t=this.specialValuesController.getOptionIds(),i={min:e.min,max:e.max,enableNull:t.includes("null"),enableNaN:t.includes("nan"),enablePosInf:t.includes("pos-inf"),enableNegInf:t.includes("neg-inf")};return this.setState(i)}setState(t){if(void 0===t)return this;let i={min:null==(t=t||{}).min?void 0:t.min,max:null==t.max?void 0:t.max};null!=i.min&&null!=i.max&&Qr(i,!1);let n=this.getSelection();return this.updating=!0,this.specialValuesController.setOptions(function(t,i,n){let s=[];if(t.enableNegInf){let t=e.$('<span class="esc-c-count esc-c-count-neg-inf" />');i&&null!=i.noNegInf&&t.text(n?n(i.noNegInf):""+i.noNegInf),s.push({id:"neg-inf",label:e.$('<span class="esc-c-label"/>').text(Ll("includeNegInf")).add(t)})}if(t.enablePosInf){let t=e.$('<span class="esc-c-count esc-c-count-pos-inf" />');i&&null!=i.noPosInf&&t.text(n?n(i.noPosInf):""+i.noPosInf),s.push({id:"pos-inf",label:e.$('<span class="esc-c-label"/>').text(Ll("includePosInf")).add(t)})}if(t.enableNaN){let t=e.$('<span class="esc-c-count esc-c-count-nan" />');i&&null!=i.noNaN&&t.text(n?n(i.noNaN):""+i.noNaN),s.push({id:"nan",label:e.$('<span class="esc-c-label"/>').text(Ll("includeNaN")).add(t)})}if(t.enableNull){let t=e.$('<span class="esc-c-count esc-c-count-null" />');i&&null!=i.noNull&&t.text(n?n(i.noNull):""+i.noNull),s.push({id:"null",label:e.$('<span class="esc-c-label"/>').text(Ll("includeNull")).add(t)})}return s}(t,this.specialCounts,Ll("countFormat"))),this.updating=!1,this.minMax=i,this.determineEffectiveRange(this.effectiveMinMax)&&(Ol(n.ranges,this.effectiveMinMax),this.updateDom()),this.setSelection(n)}determineEffectiveRange(e){if(null==e||!Jr(e,!1))return!1;let t=e.min,i=e.max;return null!=this.minMax.min&&t!==this.minMax.min&&(t=this.minMax.min),null!=this.minMax.max&&i!==this.minMax.max&&(i=this.minMax.max),!(t>=i)&&(t=k(t,this.step),i=N(i,this.step),(this.effectiveMinMax.min!==t||this.effectiveMinMax.max!==i)&&(this.effectiveMinMax={min:t,max:i},!0))}handleSpecialValueChanges(){this.updating||this.setSelection(Object.assign(this.getSelection(),this.getSpecialValuesSelection()))}handleNoMarkerChanges(){if(this.updating||!this.noMarkersController)return;let e=this.noMarkersController.getSelection();this.noMarkers=null==e||e<0?-1:e,this.setSelection(Object.assign({},this.getSpecialValuesSelection(),{ranges:[]}))}setHistogram(e){if(void 0===e)return this;let t=zo(e=e||[]),i=function(e){if(!e)return e;let t=0,i=0,n=0,s=0;for(let r of e){let e=r.low;null==e?s+=r.count:Number.isNaN(e)?n+=r.count:e===Number.POSITIVE_INFINITY?t+=r.count:e===Number.NEGATIVE_INFINITY&&(i+=r.count)}return{noPosInf:t,noNegInf:i,noNaN:n,noNull:s}}(e),n=function(e,t=qr.finite){if(!e)return e;if(null==t)throw new Error("Finite mode must be non-null.");let i=null,n=null;for(let s of e)if(null!=s.low&&0!==s.count){switch(t){case qr.non_nan:if(Number.isNaN(s.low))continue;break;case qr.finite:if(!Number.isFinite(s.low))continue}(null==i||s.low<i)&&(i=s.low),(null==n||s.high>n)&&(n=s.high)}return i=null==i?Number.NaN:i,n=null==n?Number.NaN:n,{min:i,max:n}}(e);return this.setData({distribution:t,specialCounts:i,range:n})}setSample(e){if(void 0===e)return this;let t=Mo(e=e||[]),i=function(e){if(!e)return e;let t=0,i=0,n=0,s=0;for(let r of e)null==r?s++:Number.isNaN(r)?n++:r===Number.POSITIVE_INFINITY?t++:r===Number.NEGATIVE_INFINITY&&i++;return{noPosInf:t,noNegInf:i,noNaN:n,noNull:s}}(e),n=eo(e);return this.setData({distribution:t,specialCounts:i,range:n})}setData(e){if(e=e||{},this.distribution=e.distribution||null,this.specialCounts=e.specialCounts||{noPosInf:0,noNegInf:0,noNaN:0,noNull:0},this.determineEffectiveRange(e.range)){let e=this.getSelection();Ol(e.ranges,this.effectiveMinMax),this.setSelection(e)}return this.updateDom(),this}updateDom(){this.endDrag(!1),this.redrawDom(),this.resizeDom()}makeTicks(){let e=function(e,t,i,n=!1){return v(e,t,i,n).map(b)}(this.effectiveMinMax.min,(this.effectiveMinMax.max-this.effectiveMinMax.min)/200,this.effectiveMinMax.max);return e[e.length-1]=this.effectiveMinMax.max,e}renderDistribution(e){let t=Dl(e,this.getEffectiveRanges(),this.effectiveMinMax,this.scale);for(let e=0;e<this.segments.length;e++){let i=null==t?"":ol(t.segments[e]);this.segments.item(e).setAttribute("d",i)}for(let e=0;e<this.segmentDividers.length;e++){let i=null==t?"":ol(t.dividers[e]);this.segmentDividers.item(e).setAttribute("d",i)}}makeTween(e,t){return null==e&&null==t?null:Go(e=e||Ao(t,0),t=t||Ao(e,0))}redrawSegments(){let e=this.selection.ranges.length,t=!1;for(;e<this.segments.length;)this.removeSegment(this.segments.item(e++)),t=!0;for(let i=this.segments.length;i<e;i++)this.addSegment(),t=!0;t&&(this.segments=this.segmentsSvg.querySelectorAll(".esc-c-segment"))}addSegment(){let e=document.createElementNS(re,"path");return e.classList.add("esc-c-segment"),this.segmentsSvg.appendChild(e),e}removeSegment(e){e.remove()}resizeSegmentsAndDividers(){let e=this.getEffectiveRanges();for(let t=0;t<this.segments.length;t++){let i=e[t];this.segments.item(t).classList.toggle(Ae,i.selected)}let t=this.distribution&&function(e){let t=e.reduce((e,t)=>t[1]>e?t[1]:e,0);return e.map(e=>{let[i,n]=e;if(!Number.isFinite(n)||n<0)throw new Error(`Distribution has invalid point [${i}, ${n}].`);return t>0&&(n/=t),[i,n]})}(this.distribution(this.makeTicks()));this.animator.update(t)}redrawDividers(e,t){let i=this.selection.ranges.length-1,n=!1;for(;i<e.length;)e.item(i++).remove(),n=!0;for(let s=e.length;s<i;s++)this.addDivider(t),n=!0;return n?t.querySelectorAll(".esc-c-divider"):e}resizeBarDividers(){let e=function(e,t,i,n=[1e3,100]){let s=[],[r,o]=n;for(let n=0;n<e.length-1;n++){let l=cl(e[n].high,i,t)*r,a=ol([[l,0],[l,o]]);s.push(a)}return s}(this.getEffectiveRanges(),this.effectiveMinMax,this.scale);for(let t=0;t<this.barDividers.length;t++)this.barDividers.item(t).setAttribute("d",e[t])}addDivider(e){let t=document.createElementNS(re,"path");return t.classList.add("esc-c-divider"),e.appendChild(t),t}redrawBars(){let e=this.selection.ranges.length,t=!1;for(;e<this.bars.length;)this.removeBar(this.bars.item(e++)),t=!0;for(let i=this.bars.length;i<e;i++)this.addBar(),t=!0;t&&(this.bars=this.barsSvg.querySelectorAll(".esc-c-bar"))}resizeBars(){let e=this.getEffectiveRanges(),t=function(e,t,i,n=[1e3,100]){let s=[],[r,o]=n,l=0;for(let n of e){let e=cl(n.high,i,t)*r,a=ol([[l,o],[l,0],[e,0],[e,o]]);s.push(a),l=e}return s}(e,this.effectiveMinMax,this.scale);for(let i=0;i<this.bars.length;i++){let n=e[i],s=this.bars.item(i);s.classList.toggle(Ae,n.selected),s.setAttribute("d",t[i])}}addBar(){let e=document.createElementNS(re,"path");return e.classList.add("esc-c-bar"),this.getEnabled()&&(e.tabIndex=0),this.barsSvg.appendChild(e),e}removeBar(e){e.remove()}redrawMarkers(){let e=this.selection.ranges.length-1,t=!1;for(;e<this.markers.length;)this.removeMarker(this.markers.item(e++)),t=!0;for(let i=this.markers.length;i<e;i++)this.addMarker(i),t=!0;t&&(this.markers=this.markersDiv.querySelectorAll(".esc-c-marker"))}resizeMarkers(){let e=this.getEffectiveRanges();for(let t=0;t<this.markers.length;t++){let i=e[t],n=this.markers.item(t),s=cl(i.high,this.scale,this.effectiveMinMax);n.style.left=100*s+"%",n.innerText=this.formatter(i.high,this.stepPrecision)}}addMarker(e){let t=document.createElement("div");return t.classList.add("esc-c-marker"),this.wireMarker(t,e),this.markersDiv.appendChild(t),t}removeMarker(e){Me(e,"__esc-drag-controller__").endDrag(),e.remove()}wireMarker(e,t){Ie(e,"__esc-drag-controller__",new ul({element:e,onProgress:e=>this.drag(e,t),onEnd:()=>this.endDrag(!0)}))}select(e,t){if(!this.getEnabled())return;let i=this.getSelection();i.ranges[t].selected=!i.ranges[t].selected,this.setSelection(i)}getEffectiveRanges(){if(null==this.selection)throw new se("Selection is null when effective ranges are required.");return this.dragRanges||this.selection.ranges}drag(e,t){if(!this.getEnabled())return;let i=this.markersDiv.getBoundingClientRect(),n=e.clientX-i.left,s=i.width,r=Math.max(0,Math.min(1,n/s));Number.isNaN(r)?Pl.warn("Failed to calculate drag ratio."):(Pl.debug("Dragging - ratio=%f.",r,e),this.dragRanges=this.adjustRanges(t,r),this.resizeDom())}endDrag(e){if(Pl.debug("Ending drag (commit=%s): %o",e,this.dragRanges),null!=this.dragRanges){let t=this.dragRanges;this.dragRanges=null,e&&this.setSelection(Object.assign({},this.selection,{ranges:t}))}}adjustRanges(e,t){let i=this.selection.ranges.length,n=dl(t,this.scale,this.effectiveMinMax);n=E(n,this.step);let s=this.getSelection().ranges;s[e].high=n;for(let t=e;t>=0;t--){let e=s[t];if(e.low<=e.high)break;e.low=e.high;let i=s[t-1];i&&i.high!==e.low&&(i.high=e.low)}for(let t=e+1;t<i;t++){let e=s[t-1],i=s[t];if(e.high!==i.low){if(i.low=e.high,!(i.low>i.high))break;i.high=i.low}}return s}setSpecialValuesSelection(e){let t=[];e.isPosInf&&t.push("pos-inf"),e.isNegInf&&t.push("neg-inf"),e.isNaN&&t.push("nan"),e.isNull&&t.push("null"),this.specialValuesController.setSelection(t)}getSpecialValuesSelection(){let e={},t=this.specialValuesController.getOptionIds(),i=this.specialValuesController.getSelection()||[];return e.isPosInf=t.includes("pos-inf")?i.includes("pos-inf"):void 0,e.isNegInf=t.includes("neg-inf")?i.includes("neg-inf"):void 0,e.isNaN=t.includes("nan")?i.includes("nan"):void 0,e.isNull=t.includes("null")?i.includes("null"):void 0,e}updateSpecialValueCounts(){let e;(e=this.specialValuesController.element.querySelector(".esc-c-count-pos-inf"))&&(e.innerText=null==this.specialCounts?"":Ll("countFormat")(this.specialCounts.noPosInf)),(e=this.specialValuesController.element.querySelector(".esc-c-count-neg-inf"))&&(e.innerText=null==this.specialCounts?"":Ll("countFormat")(this.specialCounts.noNegInf)),(e=this.specialValuesController.element.querySelector(".esc-c-count-nan"))&&(e.innerText=null==this.specialCounts?"":Ll("countFormat")(this.specialCounts.noNaN)),(e=this.specialValuesController.element.querySelector(".esc-c-count-null"))&&(e.innerText=null==this.specialCounts?"":Ll("countFormat")(this.specialCounts.noNull))}_setControlEnabled(e){super._setControlEnabled(e);for(let t of this.bars)t.setAttribute("tabindex",e?"0":"-1");this.specialValuesController.setEnabled(e),this.noMarkersController&&this.noMarkersController.setEnabled(e),this.invertButton&&this.invertButton.setAttribute("tabindex",e?"0":"-1"),this.resetButton.setAttribute("tabindex",e?"0":"-1")}}function Fl(e,t){let i=si(e,"Range field",HTMLElement),n=new _l(Object.assign({},t,{element:i}));Vs(n.element,n,t)}function Rl(e){if(null==e)return e;if("string"==typeof e){let t=Ke(["datum"],e,"data accessor");return e=>et(t,[e])}return e}var Bl,Hl,jl;bt("esc-range",Fl),Wr.init=Fl,Bl||(Bl={});class ql{constructor(e){this.grid=e}up(e){for(let t=0;t<this.grid.length;t++){let i=this.grid[t].indexOf(e);if(i>=0)return 0===t?null:this.grid[t-1][i]||null}return null}down(e){for(let t=0,i=this.grid.length;t<i;t++){let n=this.grid[t].indexOf(e);if(n>=0)return t===i-1?null:this.grid[t+1][n]||null}return null}left(e){for(let t of this.grid){let i=t.indexOf(e);if(i>=0)return t[i-1]||null}return null}right(e){for(let t of this.grid){let i=t.indexOf(e);if(i>=0)return t[i+1]||null}return null}first(){return(this.grid[0]||[])[0]||null}last(){let e=this.grid[this.grid.length-1];return e&&e[e.length-1]||null}has(e){for(let t of this.grid){if(t.indexOf(e)>=0)return!0}return!1}}class Ul{constructor(e){this.elements=e}up(e){let t=this.elements.indexOf(e);return t<0?null:this.elements[t-1]||null}down(e){let t=this.elements.indexOf(e);return t<0?null:this.elements[t+1]||null}left(e){return this.up(e)}right(e){return this.down(e)}first(){return this.elements[0]||null}last(){return this.elements[this.elements.length-1]||null}has(e){return this.elements.includes(e)}}!function(e){e.both="both",e.horizontal="horizontal",e.vertical="vertical"}(Hl||(Hl={})),function(e){e.up="up",e.down="down",e.left="left",e.right="right"}(jl||(jl={}));class Zl{constructor(e){this.keydownListener=e=>{switch(e.key){case"ArrowLeft":case"ArrowRight":case"ArrowDown":case"ArrowUp":break;default:return}let t=this.modelProvider();if(!this.accept(e))return;let i=null;"ArrowLeft"===e.key?this.direction!==Hl.vertical&&(i=this.left(e.target,t)):"ArrowRight"===e.key?this.direction!==Hl.vertical&&(i=this.right(e.target,t)):"ArrowDown"===e.key?this.direction!==Hl.horizontal&&(i=this.down(e.target,t)):this.direction!==Hl.horizontal&&(i=this.up(e.target,t)),e.preventDefault(),this.navigateTo(i)},this.element=e.element,this.modelProvider="function"==typeof e.model?e.model:()=>e.model,this.selector=e.selector||null,this.interceptor=e.interceptor||null,this.direction=e.direction,this.wrap=e.wrap||null,this.element.addEventListener("keydown",this.keydownListener)}accept(e){return e.target instanceof HTMLElement&&e.target.tabIndex>=0&&(!this.interceptor||this.interceptor(e))}navigateTo(e){return e&&requestAnimationFrame(()=>{e.focus(),this.onNavigate&&this.onNavigate(e)}),this}left(e,t){let i=t.left(e);for(;i&&this.selector&&!this.selector(i,e,jl.left);)i=t.left(i);if(!i&&this.wrap&&this.wrap(e,jl.left)){let n=t.right(e);for(;n;)this.selector&&!this.selector(n,e,jl.left)||(i=n),n=t.right(n)}return i}right(e,t){let i=t.right(e);for(;i&&this.selector&&!this.selector(i,e,jl.right);)i=t.right(i);if(!i&&this.wrap&&this.wrap(e,jl.right)){let n=t.left(e);for(;n;)this.selector&&!this.selector(n,e,jl.right)||(i=n),n=t.left(n)}return i}up(e,t){let i=t.up(e);for(;i&&this.selector&&!this.selector(i,e,jl.up);)i=t.up(i);if(!i&&this.wrap&&this.wrap(e,jl.up)){let n=t.down(e);for(;n;)this.selector&&!this.selector(n,e,jl.up)||(i=n),n=t.down(n)}return i}down(e,t){let i=t.down(e);for(;i&&this.selector&&!this.selector(i,e,jl.down);)i=t.down(i);if(!i&&this.wrap&&this.wrap(e,jl.down)){let n=t.up(e);for(;n;)this.selector&&!this.selector(n,e,jl.down)||(i=n),n=t.up(n)}return i}moveToFirst(){return this.navigateTo(this.modelProvider().first())}moveToLast(){return this.navigateTo(this.modelProvider().last())}destroy(){return this.element.removeEventListener("keydown",this.keydownListener),this}}const Yl=e.log.logger("esc.data.Paginator");class Gl{constructor(e){if(this._hasEnded=!1,this.queue=[],this.lookup=e.lookup,this.callback=e.callback,null==e.pageSize||e.pageSize<=0)throw new Error(`Page size must be non-null and positive: ${e.pageSize}`);this.pageSize=e.pageSize,this.pageIndex=null==e.pageIndex?-1:Math.max(-1,e.pageIndex),void 0!==e.filter&&(this.filter=e.filter),void 0!==e.sort&&(this.sort=e.sort),this.stateful=!0===e.stateful,this.pageIndex>=0&&this.refresh()}getFilter(){return this.filter}setFilter(e){return this.setPointers({filter:e})}getSort(){return this.sort}setSort(e){return this.setPointers({sort:e})}getPageSize(){return this.pageSize}setPageSize(e){return this.setPointers({pageSize:e})}getPageIndex(){return this.pageIndex}setPageIndex(e){return this.setPointers({pageIndex:e})}setPointers(e){let t=!1;if(void 0===e.filter||Wi(e.filter,this.filter)||(t=!0,this.filter=e.filter,this.pageIndex=0),void 0===e.sort||Ui(e.sort,this.sort)||(t=!0,this.sort=e.sort,this.pageIndex=0),null!=e.pageSize){if(e.pageSize<=0)throw new Error(`Page size must be positive: ${e.pageSize}`);this.pageSize!==e.pageSize&&(t=!0,this.pageSize=e.pageSize,this.pageIndex=0)}if(null!=e.pageIndex){if(e.pageIndex<0)throw new Error(`Page index must be non-negative: ${e.pageIndex}`);this.pageIndex!==e.pageIndex&&(t=!0,this.pageIndex=e.pageIndex)}return t&&(this._hasEnded=!1,this.queue.length=0,this.refresh()),this}initialize(e){if(e=e||{},this.pageIndex=null==e.pageIndex?-1:Math.max(-1,e.pageIndex),void 0!==e.pageSize){if(e.pageSize<=0)throw new Error(`Page size must be positive: ${e.pageSize}`);this.pageSize=e.pageSize}return void 0!==e.filter&&(this.filter=e.filter),this._hasEnded=!1,this.queue.length=0,this}hasEnded(){return this._hasEnded}nextPage(){return this._hasEnded?this:this.addTask({pageIndex:this.pageIndex+1,pageSize:this.pageSize})}previousPage(){return this.pageIndex<=0?this:this.addTask({pageIndex:this.pageIndex-1,pageSize:this.pageSize})}top(){return this.pageIndex<=0?this:this.addTask({pageIndex:0,pageSize:this.pageSize})}refresh(){return this.pageIndex<0?this:this.addTask({pageIndex:this.pageIndex,pageSize:this.pageSize})}addTask(e){let t=this.queue[this.queue.length-1];return t&&t.pageIndex===e.pageIndex?this:(Yl.info("Queueing request for pageIndex=%d, pageSize=%d (queue=%d, filter=%o).",e.pageIndex,e.pageSize,this.queue.length,this.filter),this.queue.push(e),1===this.queue.length&&this.request(e),this)}request(e){Yl.info("Requesting data page for pageIndex=%d, pageSize=%d, filter=%o.",e.pageIndex,e.pageSize,this.filter);let t=e.pageIndex*e.pageSize;this.lookup.lookup(t=>this.receive(t,e),this.filter,this.sort,t,e.pageSize)}receive(e,t){if(t.pageSize>=0&&e.length>t.pageSize)throw new Error(`Received ${e.length} data point(s) but requested only ${t.pageSize}.`);let i=t.pageSize>=0&&e.length<t.pageSize,n=t.pageIndex*t.pageSize;this.queue[0]!==t?Yl.info("Receiving cancelled data page for pageIndex=%d, pageSize=%d, filter=%o: %o",t.pageIndex,t.pageSize,this.filter,this.queue):(Yl.info("Receiving %s data page for pageIndex=%d, pageSize=%d, filter=%o: %o",i?"truncated":"full",t.pageIndex,t.pageSize,this.filter,e),this.queue.shift(),this.pageIndex<t.pageIndex?e.length>0&&(this.pageIndex=t.pageIndex):this.pageIndex>t.pageIndex&&(i&&Yl.warn("Received truncated data page when paging backwards."),this.pageIndex=t.pageIndex),this.stateful&&(this._hasEnded=i),this.callback(e,n,t.pageSize),this.queue.length&&this.request(this.queue[0]))}}const Vl=e.log.logger("esc.widgets.ScrollPaginator");var Xl,Wl,Kl;!function(e){e.vertical="vertical",e.horizontal="horizontal"}(Xl||(Xl={}));class Ql{constructor(e){this.forward=!0,this.truncatedBottom=!1,this.element=e.element,this.selectContent=e.selectContent,this.appendContent=e.appendContent,this.pageSize=e.pageSize,this.direction=e.direction,this.beforeData=e.beforeData||null,this.itemFactory=e.itemFactory,this.afterData=e.afterData||null,this.previousButton=e.previousButton||null,this.nextButton=e.nextButton||null,this.paginator=new Gl({lookup:e.lookup,callback:(e,t)=>this.setData(e,t),pageSize:this.pageSize,pageIndex:e.pageIndex,filter:e.filter,sort:e.sort,stateful:e.stateful});let t=xt(this.element,this.direction===Xl.horizontal?"x":"y");this.element.addEventListener("wheel",e=>{switch(t(e)){case"top":case"left":Vl.debug("Scroll triggers previous page."),this.forward=!1,this.paginator.previousPage();break;case"bottom":case"right":Vl.debug("Scroll triggers next page."),this.forward=!0,this.paginator.nextPage()}})}setFilter(e){return this.setFilterAndSort({filter:e})}getFilter(){return this.paginator.getFilter()}setSort(e){return this.setFilterAndSort({sort:e})}getSort(){return this.paginator.getSort()}setFilterAndSort(e){return void 0===(e=e||{}).filter&&void 0===e.sort||(this.markAsProcessing(!0),this.paginator.setPointers({sort:e.sort,filter:e.filter,pageIndex:this.paginator.getPageIndex()<0?0:void 0})),this}markAsProcessing(e){requestAnimationFrame(()=>{this.element.classList.toggle("esc-js-is-processing",e)})}setData(e,t){requestAnimationFrame(()=>{Vl.debug("Displaying %d data with offset=%d: %o",e.length,t,e),this.truncatedBottom=!this.forward||this.pageSize>=0&&e.length===this.pageSize,this.element.classList.remove("esc-js-is-processing"),this.element.classList.toggle("esc-js-is-truncated-top",t>0),this.previousButton&&this.previousButton.classList.toggle("esc-js-is-truncated",t>0),this.element.classList.toggle("esc-js-is-truncated-bottom",this.truncatedBottom),this.nextButton&&this.nextButton.classList.toggle("esc-js-is-truncated",this.truncatedBottom),this.beforeData&&this.beforeData(e);let i,n=this.selectContent(),s=!1;for(let e of n)if(e.contains(document.activeElement)){s=!0;break}for(let n=0;n<e.length;n++){let r=this.itemFactory(e[n],t+n);if(null==r)continue;let o=Ot(r);this.appendContent(o),s&&(i=this.forward?i||this.getFirstFocusable(o):this.getFirstFocusable(o)||i)}i&&i.focus(),Ze(n),this.afterData&&this.afterData(e),this.direction===Xl.horizontal?this.element.scrollLeft=this.forward?0:this.element.scrollWidth-this.element.clientWidth:this.element.scrollTop=this.forward?0:this.element.scrollHeight-this.element.clientHeight})}getFirstFocusable(e){for(let t of e.get())if(t instanceof HTMLElement&&t.tabIndex>=0)return t;return e.find('[tabindex="0"]').get(0)||null}next(){return this.paginator.hasEnded()||(this.markAsProcessing(!0),this.forward=!0,this.paginator.nextPage()),this}previous(){return this.paginator.getPageIndex()>0&&(this.markAsProcessing(!0),this.forward=!1,this.paginator.previousPage()),this}top(){return this.paginator.getPageIndex()>0&&(this.markAsProcessing(!0),this.forward=!0,this.paginator.top()),this}refresh(){return this.paginator.getPageIndex()>=0&&(this.markAsProcessing(!0),this.paginator.refresh()),this}initialize(e){return this.paginator.initialize(e),requestAnimationFrame(()=>{Vl.debug("Clearing data."),Ze(this.selectContent()),this.forward=!0,this.truncatedBottom=!0,this.element.classList.remove("esc-js-is-processing"),this.element.classList.remove("esc-js-is-truncated-top"),this.previousButton&&this.previousButton.classList.remove("esc-js-is-truncated"),this.element.classList.toggle("esc-js-is-truncated-bottom",this.truncatedBottom),this.nextButton&&this.nextButton.classList.toggle("esc-js-is-truncated-bottom",this.truncatedBottom)}),this}}class Jl extends zs{constructor(e){super(e,"input, textarea"),this.monitorKeys=()=>{if(null==this.lastKey||!this.getEnabled())return;Date.now()-this.lastKey>=this.delay?this.commit():requestAnimationFrame(this.monitorKeys)},this.canCommit=!0}initialize(e){this.trim=!0===e.trim,this.delay=null==e.delay?-1:e.delay,super.initialize(e);let t=gs(()=>{this._setControlSelection(this.selection),this.canCommit=!0});this.updateDomSelection=()=>{this.canCommit=!1,t()};let i=be(this.element,".esc-c-clear");i&&i.addEventListener("click",()=>{this.getEnabled()&&this.clear()}),this.control.addEventListener("keydown",e=>{this.getEnabled()&&("Enter"===e.key?(this.commit(),e.preventDefault()):this.delay>=0&&(this.lastKey=Date.now(),requestAnimationFrame(this.monitorKeys)))}),this.control.addEventListener("change",()=>{this.getEnabled()&&(this.skipDomUpdate||this.commit())}),this.element.addEventListener("focusout",e=>{this.getEnabled()&&(e.relatedTarget instanceof Node&&this.element.contains(e.relatedTarget)||this.commit())})}_getControlSelection(){return this.control.value}_setControlSelection(e){this.control.value=e}_setControlEnabled(e){this.control.disabled=!e}validateSelection(e){return e=xs(e,!0)||"",this.trim?e.trim():e}commit(){return this.lastKey=void 0,this.canCommit&&this.controlChangeListener(),this}clear(){return this.lastKey=void 0,this.setSelection(""),this}}!function(e){e.none="none",e.contains="contains",e.startsWith="starts-with"}(Wl||(Wl={})),Kl||(Kl={});const ea="esc.widgets.control.select-lazy.SelectLazyController",ta=e.log.logger(ea);class ia extends Ms{constructor(e){super(e,".esc-c-options"),this.filter=null,this.searchOpen=!1,this.menuOpen=!1}initialize(e){super.initialize(e),this.stateless=!0===e.stateless,this.isDropUp=this.element.classList.contains("esc-m-drop-up"),this.matching=e.matching||Wl.none,this.caseSensitive=!0===e.caseSensitive,this.idField=e.idField,this.nameField=e.nameField,this.lookup=e.lookup,this.itemFactory=e.itemFactory;let t=3*Nr(this.control,"esc-select-display-options",5),i=this.control.querySelector(".esc-c-previous");i.addEventListener("click",()=>this.paginator.previous());let n=this.control.querySelector(".esc-c-next");n.addEventListener("click",()=>this.paginator.next());let s=mt(n);this.paginator=new Ql({element:this.control,previousButton:i,nextButton:n,selectContent:()=>me(this.control,".esc-c-option"),appendContent:e=>e.insertBefore(s),direction:Xl.vertical,lookup:this.lookup,itemFactory:e=>this.makeOptionForMenu(e),afterData:e=>{this.notFoundMessage&&this.notFoundMessage.classList.toggle("esc-js-is-hidden",e.length>0)},pageSize:t,stateful:!0}),Et(this.control,"both"),this.notFoundMessage=pe(this.control,".esc-c-not-found"),this.element.addEventListener("focusout",e=>{e.relatedTarget instanceof Node&&this.element.contains(e.relatedTarget)||this.closeInput()});let r=ge(this.element,".esc-c-wrapper");this.display=ge(r,".esc-c-display",HTMLElement),this.display.addEventListener("click",()=>this.toggleMenu()),this.displayContent=mt(ge(this.display,".esc-c-display-content")).on("click",e=>{e.stopPropagation(),this.searchBox?this.openInput():this.toggleInput()}),this.placeholder=mt(ge(this.display,".esc-c-display-placeholder"));let o=be(r,".esc-c-search");o&&(this.searchBox=_e(o,Jl).onSelection(e=>this.search(e))),this.control.addEventListener("click",e=>this.commitOption(ve(e.target,".esc-c-option",this.control))),this.element.addEventListener("keydown",e=>{switch(e.key){case"Enter":e.preventDefault(),e.target===this.display?this.toggleInput():this.searchBox&&e.target===this.searchBox.control?requestAnimationFrame(()=>this.commitOption(this.control.querySelector(".esc-c-option"))):this.commitOption(ve(e.target,".esc-c-option",this.control));break;case" ":e.target===this.display?this.toggleInput():this.commitOption(ve(e.target,".esc-c-option",this.control));break;case"Escape":e.preventDefault(),this.closeInput();break;case"ArrowUp":this.isDropUp&&this.openMenu();break;case"ArrowDown":this.isDropUp||this.openMenu()}}),this.navigableList=new Zl({element:this.element,model:()=>{let e=me(this.control,".esc-c-option");return this.searchBox&&e.unshift(this.searchBox.control),e.unshift(this.display),new Ul(e)},selector:(e,t,i)=>(!(t===this.display||this.searchBox&&t===this.searchBox.control)||(this.isDropUp?i!==jl.down:i!==jl.up))&&(e===this.display?!this.searchOpen&&(this.isDropUp?i===jl.down&&!this.control.classList.contains("esc-js-is-truncated-bottom"):i===jl.up&&!this.control.classList.contains("esc-js-is-truncated-top")):!this.searchBox||e!==this.searchBox.control||!!this.searchOpen&&(this.isDropUp?i===jl.down&&!this.control.classList.contains("esc-js-is-truncated-bottom"):i===jl.up&&!this.control.classList.contains("esc-js-is-truncated-top"))),direction:Hl.vertical,wrap:(e,t)=>(!this.menuOpen||e===this.display||this.searchBox&&e===this.searchBox.control||(t===jl.down?this.paginator.next():t===jl.up&&this.paginator.previous()),!1)}),this.updateDomSelection=gs(()=>this._setControlSelection(this.selection)),this.setSelection(e.selection)}setSelection(e){return super.setSelection(e),this.stateless&&this._setSelection(void 0),this.updateDomSelection(),this}_setControlSelection(e){let t;this.doCloseInput(),this.displayContent.empty().toggleClass(Ae,void 0!==e);for(let i of me(this.control,".esc-c-option")){let n=this.getOptionValue(i)===e;this.setOptionSelection(i,n),n&&(ta.info("Selection found in DOM: %s",e),t=mt(i))}void 0===e&&(t=this.placeholder),t?this.displayContent.append(t.contents().clone()):void 0!==e&&(this.displayContent.append('<span class="esc-processing" />'),this.lookup.lookupSingleton(t=>{if(null==t)throw this.setSelection(void 0),new Error(`Selection ${u(e)} is not available.`);if(this.isChangedSelection(e))ta.debug("Outdated selection data found: %o",t);else{ta.debug("Up-to-date selection data found found: %o",t);let e=this.makeOption(t);this.displayContent.empty().toggleClass(Ae,!0).append(e)}},{op:"eq",variable:this.idField,value:e}))}_setControlEnabled(e){super._setControlEnabled(e),this.display.tabIndex=e?0:-1,this.searchBox&&(this.searchBox.control.tabIndex=e?0:-1),e||this.doCloseInput()}makeOptionForMenu(e){if(!this.menuOpen)return null;return this.element.classList.add("esc-js-is-open"),this.makeOption(e).attr("tabindex","0")}makeOption(e){let t=e[this.idField];if(void 0===t)throw new Error(`Search result must not have undefined id: ${u(e)}`);let i=mt('<div class="esc-c-option" />');return Ie(i.get(0),ea+".option-id",t),Tt(this.itemFactory(e),i),i}getOptionValue(e){return Me(e,ea+".option-id")}setOptionSelection(e,t){e.classList.toggle(Ae,t)}commitOption(e){if(!e)return;let t=this.getOptionValue(e);this.isChangedSelection(t)?this.setSelection(t):this.closeInput()}search(e){ta.debug('Triggering search: "%s"',e),this.filter=e?{op:"like",variable:this.nameField,value:this.matching===Wl.startsWith?`${e}%`:`%${e}%`,caseInsensitive:!this.caseSensitive}:null,this.menuOpen?this.paginator.setFilter(this.filter):this.openMenu()}openInput(){requestAnimationFrame(()=>this.doOpenInput())}doOpenInput(){this.setMenuOpen(!0),this.setSearchOpen(!0)}closeInput(){requestAnimationFrame(()=>this.doCloseInput())}doCloseInput(){this.setSearchOpen(!1),this.setMenuOpen(!1)}toggleInput(){requestAnimationFrame(()=>this.doToggleInput())}doToggleInput(){this.menuOpen?this.doCloseInput():this.setMenuOpen(!0)}setSearchOpen(e){this.searchBox&&this.searchOpen!==e&&(this.searchOpen=e,this.element.classList.toggle("esc-js-is-searching",this.searchOpen),e?this.searchBox.control.focus():(this.searchBox.clear(),this.display.focus()))}openSearch(){requestAnimationFrame(()=>this.setSearchOpen(!0))}closeSearch(){requestAnimationFrame(()=>this.setSearchOpen(!1))}setMenuOpen(e){e!==this.menuOpen&&(this.menuOpen=e,this.menuOpen?(this.control.scrollTop=0,this.paginator.initialize({filter:this.filter}).next()):(this.element.classList.remove("esc-js-is-open"),this.paginator.initialize({filter:this.filter})))}openMenu(){return requestAnimationFrame(()=>this.setMenuOpen(!0)),this}closeMenu(){return requestAnimationFrame(()=>this.setMenuOpen(!1)),this}toggleMenu(){let e=!this.menuOpen;return requestAnimationFrame(()=>this.setMenuOpen(e)),this}}function na(e,t){let i,n=si(e,"SelectLazy",HTMLElement);if(i="string"==typeof t.lookup?Re(t.lookup):t.lookup,!("lookup"in i))throw new Error(`Element '${t.lookup}' is not a IDataLookup.`);let s=new ia(Object.assign({},t,{element:n,lookup:i,itemFactory:Rl(t.itemFactory)}));Vs(s.element,s,t)}bt("esc-select-lazy",{dependencies:["esc-textbox"],process:na}),Bl.init=na;class sa extends Qs{constructor(e){super(e,".esc-c-options"),this.charIndex=0,this.searchOpen=!1,this.menuOpen=!1}initialize(e){super.initialize(e),this.stateless=!0===e.stateless,this.isDropUp=this.element.classList.contains("esc-m-drop-up"),this.matching=e.matching||Wl.none,this.caseSensitive=!0===e.caseSensitive,Et(this.control,"both"),this.element.addEventListener("focusout",e=>{this.getEffectivelyEnabled()&&(e.relatedTarget instanceof Node&&this.element.contains(e.relatedTarget)||this.closeInput())}),this.notFoundMessage=pe(this.control,".esc-c-not-found");let t=ge(this.element,".esc-c-wrapper");this.display=ge(t,".esc-c-display",HTMLElement),this.display.addEventListener("click",()=>this.toggleMenu()),this.displayContent=mt(ge(this.display,".esc-c-display-content")).on("click",e=>{e.stopPropagation(),this.getEffectivelyEnabled()&&(this.searchBox?this.openInput():this.toggleInput())}),this.placeholder=mt(ge(this.display,".esc-c-display-placeholder"));let i=be(t,".esc-c-search");i?this.searchBox=_e(i,Jl).onSelection(e=>this.search(e)):this.element.addEventListener("keypress",e=>{if(!this.getEffectivelyEnabled())return;let t=e.key;t&&1===t.length&&32<=t.charCodeAt(0)&&t.charCodeAt(0)<=126&&this.advanceTo(t)}),this.control.addEventListener("click",e=>{this.getEffectivelyEnabled()&&this.commitOption(ve(e.target,".esc-c-option",this.control))}),this.element.addEventListener("keydown",e=>{if(this.getEffectivelyEnabled())switch(e.key){case"Enter":e.preventDefault(),e.target===this.display?this.toggleInput():this.searchBox&&e.target===this.searchBox.control?requestAnimationFrame(()=>this.commitOption(this.control.querySelector(".esc-c-option:not(.esc-js-is-hidden)"))):this.commitOption(ve(e.target,".esc-c-option",this.control));break;case" ":e.target===this.display?this.toggleInput():this.commitOption(ve(e.target,".esc-c-option",this.control));break;case"Escape":e.preventDefault(),this.closeInput();break;case"ArrowUp":this.isDropUp&&this.openMenu();break;case"ArrowDown":this.isDropUp||this.openMenu()}}),this.navigableList=new Zl({element:this.element,model:()=>this.navigatorModel,selector:(e,t,i)=>(!(t===this.display||this.searchBox&&t===this.searchBox.control)||(this.isDropUp?i!==jl.down:i!==jl.up))&&(e===this.display?!this.searchOpen&&(this.isDropUp?i===jl.down:i===jl.up):this.searchBox&&e===this.searchBox.control?this.searchOpen&&(this.isDropUp?i===jl.down:i===jl.up):e.matches(".esc-c-option:not(.esc-js-is-hidden)")),direction:Hl.vertical,wrap:()=>!0}),this.updateNavigatorModel(),this.lookup=[],this.updateLookup()}doHandleKey(e,t){return!1}doHandleClick(e){return!1}updateNavigatorModel(){let e=Array.from(this.control.children);this.searchBox&&e.unshift(this.searchBox.control),e.unshift(this.display),this.navigatorModel=new Ul(e)}updateLookup(){this.lookup.length=0;for(let e of this.getOptions()){let t=this.getOptionId(e),i=e.text();this.lookup.push({id:t,name:i})}}_updateDom(e){super._updateDom(e),this.updateNavigatorModel(),this.updateLookup()}setSelection(e){return super.setSelection(e),this.stateless&&this._setSelection(void 0),this}makeOption(e){return So(e,!1,mt)}_setControlSelection(e){let t;this.doCloseInput(),this.displayContent.empty();for(let i of this.getOptions()){let n=this.getOptionId(i)===e;this.setOptionSelection(i,n),n&&(t=i)}this.element.classList.toggle("esc-js-has-selection",void 0!==e),t||(t=this.placeholder),this.displayContent.toggleClass(Ae,null!=e).append(t.contents().clone())}_setControlEnabled(e){super._setControlEnabled(e),this.display.tabIndex=e?0:-1,this.searchBox&&(this.searchBox.control.tabIndex=e?0:-1),e||this.doCloseInput()}commitOption(e){if(!e)return;let t=this.getOptionId(mt(e));this.isChangedSelection(t)?this.setSelection(t):this.closeInput()}advanceTo(e){this.lastChar===e?this.charIndex++:(this.lastChar=e,this.charIndex=0);let t={op:"like",variable:"name",value:`${e}%`,caseInsensitive:!0},i=en(this.lookup,t);if(0===i.length)return;let n,s=i[Math.min(this.charIndex,i.length-1)].id;for(let e of this.getOptions()){if(this.getOptionId(e)===s){n=e;break}}if(!n)return;let r=n.get(0);requestAnimationFrame(()=>{this.setMenuOpen(!0),r.scrollIntoView(),r.focus()})}search(e){if(!this.searchOpen)return;let t=e?{op:"like",variable:"name",value:this.matching===Wl.startsWith?`${e}%`:`%${e}%`,caseInsensitive:!this.caseSensitive}:null,i=en(this.lookup,t).map(e=>e.id);requestAnimationFrame(()=>{for(let e of this.getOptions()){let t=this.getOptionId(e),n=!i.includes(t);e.toggleClass("esc-js-is-hidden",n)}this.notFoundMessage&&this.notFoundMessage.classList.toggle("esc-js-is-hidden",i.length>0),this.setMenuOpen(!0)})}openInput(){requestAnimationFrame(()=>this.doOpenInput())}doOpenInput(){this.setMenuOpen(!0),this.setSearchOpen(!0)}closeInput(){requestAnimationFrame(()=>this.doCloseInput())}doCloseInput(){this.lastChar=void 0,this.setMenuOpen(!1),this.setSearchOpen(!1)}toggleInput(){requestAnimationFrame(()=>this.doToggleInput())}doToggleInput(){this.menuOpen?this.doCloseInput():this.setMenuOpen(!0)}setSearchOpen(e){if(this.searchBox&&this.searchOpen!==e)if(this.searchOpen=e,this.element.classList.toggle("esc-js-is-searching",this.searchOpen),this.searchOpen)this.searchBox.control.focus();else{this.searchBox.clear(),this.display.focus();for(let e of this.getOptions())e.removeClass("esc-js-is-hidden");this.notFoundMessage&&this.notFoundMessage.classList.add("esc-js-is-hidden")}}openSearch(){requestAnimationFrame(()=>this.setSearchOpen(!0))}closeSearch(){requestAnimationFrame(()=>this.setSearchOpen(!1))}setMenuOpen(e){if(e!==this.menuOpen){this.menuOpen=e,this.element.classList.toggle("esc-js-is-open",this.menuOpen);for(let e of this.getOptions())e.attr("tabindex",this.menuOpen?"0":"-1");this.control.scrollTop=0}}openMenu(){return requestAnimationFrame(()=>this.setMenuOpen(!0)),this}closeMenu(){return requestAnimationFrame(()=>this.setMenuOpen(!1)),this}toggleMenu(){let e=!this.menuOpen;return requestAnimationFrame(()=>this.setMenuOpen(e)),this}}function ra(e,t){let i=si(e,"Select",HTMLElement),n=new sa(Object.assign({},t,{element:i}));Vs(n.element,n,t)}var oa;bt("esc-select",{dependencies:["esc-textbox"],process:ra}),Kl.init=ra,oa||(oa={});const la=e.log.logger("esc.widgets.control.slider.SliderController");class aa extends Ms{constructor(e){super(e),this.updateDom=gs(()=>{this.endDrag(!1);let e=null!=this.dragSelection?this.dragSelection:this.getSelection();this.updateBar(e)}),this.updateNativeDom=gs(()=>{let e=null!=this.dragSelection?this.dragSelection:this.getSelection();this.updateBar(e)}),this.dragSelection=null}initialize(e){var t;super.initialize(e),this.bar=ge(this.element,".esc-c-bar",HTMLElement),this.barFill=ge(this.bar,".esc-c-bar-fill",HTMLElement),this.handle=ge(this.bar,".esc-c-handle",HTMLElement),this.label=ge(this.bar,".esc-c-label",HTMLElement),this.minMax={min:e.min,max:e.max},this.step=Ni(e.step),this.stepPrecision=d(this.step),this.formatter=kl(e.format)||(t="valueFormat",Tn("esc.widgets.control.slider.runtime")[t]),this.scale=Il(e.scale),this.selection=this.validateSelection(e.selection);let i=new ul({element:this.handle,onStart:()=>this.startDrag(),onProgress:e=>this.drag(e),onEnd:()=>this.endDrag(!0)});Ie(this.handle,"__esc-drag-controller__",i),this.control.addEventListener("keydown",e=>{if(this.getEnabled())switch(e.key){case"ArrowLeft":if(null!=this.step){let e=null==this.selection?this.minMax.max:this.selection-this.step;null!=e&&this.setSelection(e)}e.preventDefault();break;case"ArrowRight":if(null!=this.step){let e=null==this.selection?this.minMax.min:this.selection+this.step;null!=e&&this.setSelection(e)}e.preventDefault()}}),this.bar.addEventListener("click",e=>{if(!this.getEnabled())return;let t=this.event2position(e);if(Number.isNaN(t))return void la.warn("Failed to calculate click position.");let i=this.adjustSlider(t);this.setSelection(i)})}validateSelection(e){if(null!=e)return e=sr(e=E(e,this.step),this.minMax.min,this.minMax.max)}_setSelection(e){super._setSelection(e),this.updateDom()}setRange(e){if(void 0!==e){let t=Ml({min:void 0===e.min?this.minMax.min:e.min,max:void 0===e.max?this.minMax.max:e.max,step:void 0===e.step?this.step:e.step},["min","max"],"slider");this.step=t.step,this.stepPrecision=d(this.step),this.setSelection(this.getSelection()),this.minMax={min:t.min,max:t.max},this.updateDom()}return this}selection2Position(e){return cl(null==e?this.minMax.min:e,this.scale,this.minMax)}updateBar(e){let t=(100*this.selection2Position(e)).toFixed(2)+"%";this.barFill.style.width=t,this.handle.style.left=t,this.label.style.left=t,this.label.innerText=null==e?"":this.formatter(e,this.stepPrecision),this.barFill.classList.toggle("esc-is-disabled",null==e),this.handle.classList.toggle("esc-is-disabled",null==e)}startDrag(){this.bar.classList.add("esc-is-dragging")}drag(e){if(!this.getEnabled())return;let t=this.event2position(e);Number.isNaN(t)?la.warn("Failed to calculate drag ratio."):(la.debug("Dragging - ratio=%f.",t,e),this.dragSelection=this.adjustSlider(t),this.updateNativeDom())}endDrag(e){if(la.debug("Ending drag (commit=%s): %s",e,this.dragSelection),this.bar.classList.remove("esc-is-dragging"),null!=this.dragSelection){let t=this.dragSelection;this.dragSelection=null,e&&this.setSelection(t)}}adjustSlider(e){let t=dl(e,this.scale,this.minMax);return t=E(t,this.step),t}event2position(e){let t=this.element.getBoundingClientRect(),i=e.clientX-t.left,n=t.width;return Math.max(0,Math.min(1,i/n))}}function ha(e,t){let i=si(e,"Slider",HTMLElement),n=new aa(Object.assign({},t,{element:i}));Vs(n.element,n,t)}var ua,ca,da;function fa(e,t,i){if(i){if(null!=i.validateSelection&&"string"!=typeof i.validateSelection)throw new Error(`During pre-rendering, selection validators must be string-valued: ${i.validateSelection}`);let e=Ut(i.onSelection,"esc-selection"),t=function(e,t){return e&&e.map(e=>function(e,t){if(null==e)return e;let i=e.method===t?"":e.method;return e.transform?`${e.target}::${i}::${e.transform}`:i?`${e.target}::${i}`:e.target}(e,t))}(jt(i.selectables,n="setSelection"),n)||void 0;i=Object.assign({},i,{onSelection:e,selectables:t})}var n;Zt(e,t,i)}bt("esc-slider",ha),oa.init=ha,ua||(ua={}),function(e){e.cycle="cycle",e.bounce="bounce"}(ca||(ca={})),da||(da={});e.log.logger("esc.widgets.control.button");function ma(e,t,i,n){let s=n('<button class="esc-c-option"/>').attr("tabindex",i?"0":"-1").attr("data-esc-id",Js(e.id));return function(e,t,i,n,s,r){ni(t,e,r);let o="esc-"+(!t.label&&!!t.icon?"icon-":"")+"button";e.addClass(o),i!==$e.strong&&e.addClass(`esc-m-type-${i}`),n!==Oe.regular&&e.addClass(`esc-m-style-${n}`),s!==Le.horizontal&&e.addClass(`esc-m-orientation-${s}`)}(s,e,e.visualType||t.visualType,e.style||t.style,e.orientation||t.orientation,n),s}class pa extends Qs{constructor(e){super(e)}initialize(e){super.initialize(e),this.cycleMode=e.cycleMode||ca.cycle,this.goToNext=!0;let t=this.element.classList;this.defaultStyles={visualType:t.contains(`esc-m-type-${$e.subtle}`)?$e.subtle:`esc-m-type-${$e.ghost}`?$e.ghost:$e.strong,style:t.contains(`esc-m-style-${Oe.light}`)?Oe.light:Oe.regular,orientation:t.contains(`esc-m-orientation-${Le.vertical}`)?Le.vertical:Le.horizontal}}doHandleKey(e,t){switch(t){case" ":case"Enter":return this.doHandleClick(e);default:return super.doHandleKey(e,t)}}doHandleClick(e){let t;return this.cycleMode!==ca.bounce||(t=void 0===this.selection?-1:this.optionIds.indexOf(this.selection))<0||this.goToNext&&t<this.optionIds.length-1||!this.goToNext&&0===t?this.selectNext():this.selectPrevious(),!0}makeOption(e){return ma(e,this.defaultStyles,!1,mt)}_setControlSelection(e){super._setControlSelection(e),this._setControlEnabled(this._enabled)}setOptionSelection(e,t){super.setOptionSelection(e,t),e.attr("tabindex",t?"0":"-1")}setOptionEnabled(e,t){e=e&&this.isSelected(t),t.attr("tabindex",e?"0":"-1")}selectPrevious(){return this.goToNext=!1,super.selectPrevious()}selectNext(){return this.goToNext=!0,super.selectNext()}}const ga=e.log.logger("esc.widgets.control.slider-discrete.SliderDiscreteController");class ba extends Qs{constructor(e){super(e,".esc-c-options"),this.dragPosition=void 0,this.updateDomDrag=gs(()=>{let e=null!=this.dragPosition?this.dragPosition:this.selection2Position(this.getSelection());this.updateBar(e)}),this.body=ge(this.element,".esc-c-body",HTMLElement),this.bar=ge(this.body,".esc-c-bar",HTMLElement),this.barFill=ge(this.bar,".esc-c-bar-fill",HTMLElement),this.handle=ge(this.bar,".esc-c-handle",HTMLElement);let t=new ul({element:this.handle,onStart:()=>this.startDrag(),onProgress:e=>this.drag(e),onEnd:()=>this.endDrag(!0)});Ie(this.handle,"__esc-drag-controller__",t),this.bar.addEventListener("click",e=>{if(!this.getEnabled())return;let t=this.event2position(e);if(Number.isNaN(t))return void ga.warn("Failed to calculate click position.");let i=this.position2Selection(t);this.setSelection(i),e.preventDefault()});let i=pe(this.body,".esc-c-play",HTMLElement);if(i){let t=!0===e.playAsync,n=new pa({element:i,dispatchEvents:!1,type:"string"});this.sequencer=new Ps({selector:this,interruptMode:$s.resume,async:t,interval:Nr(this.element,"esc-slider-discrete-play-interval",1500)}).onSelection(e=>n.setSelection(e)),n.onSelection(e=>this.sequencer.setSelection(e))}}next(){return this.sequencer&&this.sequencer.next(),this}makeOption(e){return function(e,t,i){if(void 0===e.id)throw new Error("Option must not have undefined id.");let n=i('<span class="esc-c-option"/>').attr("data-esc-id",Js(e.id));return t&&n.attr("tabindex","0"),!0===e.minor&&i('<span class="esc-c-preview"/>').appendTo(n),ni(e,i('<span class="esc-c-full"/>').appendTo(n),i),n}(e,this.getEnabled(),mt)}_setControlSelection(e){super._setControlSelection(e),this.endDrag(!1);let t=this.selection2Position(this.getSelection());this.updateBar(t)}selection2Position(e){if(void 0===e)return-1;let t=this.getOptionIds(),i=t.indexOf(e);if(i<0)return-1;let n=t.length;return i===n-1?1:0===i?0:n<=1?0:1/(2*n-2)*(2*i)}position2Selection(e){if(null==e||e<0)return;let t=this.getOptionIds(),i=t.length,n=Math.round(e*(i-1));if(n<0||i<n)throw new Error(`IllegalStateException: index=${n}, position=${e}, ids=${t.join()}`);return t[n]}updateBar(e){let t=(100*Math.max(0,e)).toFixed(2)+"%";this.barFill.style.width=t,this.handle.style.left=t,this.barFill.classList.toggle(Ae,e>=0),this.handle.classList.toggle(Ae,e>=0)}_updateDom(e){super._updateDom(e),this.element.style.setProperty("--esc-slider-discrete-number-of-options",""+e.length)}startDrag(){this.bar.classList.add("esc-is-dragging")}drag(e){if(!this.getEnabled())return;let t=this.event2position(e);Number.isNaN(t)?ga.warn("Failed to calculate drag position."):(ga.debug("Dragging - position=%f.",t,e),this.dragPosition=t,this.updateDomDrag())}endDrag(e){if(ga.debug("Ending drag (commit=%s): %f",e,this.dragPosition),this.bar.classList.remove("esc-is-dragging"),null!=this.dragPosition){let t=this.position2Selection(this.dragPosition);this.dragPosition=void 0,e&&this.setSelection(t)}this.updateDomDrag()}event2position(e){let t=this.bar.getBoundingClientRect();return Math.max(0,Math.min(1,(e.clientX-t.left)/t.width))}}function wa(e,t){let i=si(e,"SliderDiscrete",HTMLElement),n=new ba({element:i,type:t.type,playAsync:t.playAsync});Vs(n.element,n,t)}var va,ya,xa;function Sa(e,t){let i=si(e,"Spinner field",HTMLElement),n=kl(t.format),s=function(e){if(null==e||"string"!=typeof e)return e;let t=Ke(["datum"],e,"numeric parser");return e=>et(t,[e])}(t.parse),r=new Tl(Object.assign({},t,{element:i,format:n,parse:s}));Vs(r.element,r,t)}function Ea(e,t){let i=si(e,"Switcher",HTMLElement),n=new pa(Object.assign({},t,{element:i}));Vs(n.element,n,t)}bt("esc-slider-discrete",wa),ua.init=wa,va||(va={}),bt("esc-spinner",Sa),va.init=Sa,bt("esc-switcher",Ea),da.init=Ea,ya||(ya={});class ka extends Qs{constructor(e){super(e)}initialize(e){super.initialize(e),this.stateless=!0===e.stateless}setSelection(e){return super.setSelection(e),this.stateless&&this._setSelection(void 0),this}makeOption(e){return So(e,this.getEnabled(),mt)}}function Na(e,t){let i=si(e,"Tabs",HTMLElement),n=new ka({element:i,type:t.type,stateless:t.stateless});Vs(n.element,n,t)}bt("esc-tabs",Na),ya.init=Na,xa||(xa={});class Ca extends Is{constructor(e,t){super(e,t)}initialize(e){this.unique=!1!==e.unique,this.orderSensitive=!1!==e.orderSensitive,this.type=e.type,this.allAsUndefined=!0===e.allAsUndefined,this.maxNoSelected=null==e.maxNoSelected?-1:e.maxNoSelected,super.initialize(e),this.selection=this.validateSelection(e.selection)}setSelection(e){return this.updateSelection(e,!0),this}getSelection(){if(this.allAsUndefined&&this.selection.length===this.getNoOptions())return;let e=this.selection.slice();return this.orderSensitive||e.sort(Oi),e}addSelection(e){return this.unique&&this.selection.includes(e)||this.setSelection([...this.selection,e]),this}removeSelection(e){let t=this.selection.filter(t=>t!==e);return this.setSelection(t),this}validateSelection(e){let t,i=this.getOptionIds();return t=null==e&&this.allAsUndefined?this.maxNoSelected<0?i:i.slice(0,this.maxNoSelected):Es(e,{options:i,type:this.type,allowNullValues:!0,maxNoSelected:this.maxNoSelected,unique:this.unique}),this._validateSelection&&(t=this._validateSelection(this.allAsUndefined&&t.length===this.getNoOptions()?void 0:this.orderSensitive?t:[...t].sort(Oi))||i),t}equalsSelection(e,t){if(null==e||null==t)throw new se("Null selection should have been normalized by validation.");return Ai(e,t,this.orderSensitive)}}class Ia extends Ca{constructor(){super(...arguments),this.skipDomUpdate=!1}initialize(e){this.updateDomSelection=gs(()=>this._setControlSelection(this.selection)),this.controlChangeListener=()=>this._setSelectionWithoutDomUpdate(this._getControlSelection()),super.initialize(e),this.selection=this.validateSelection(this._getControlSelection())}updateSelection(e,t){let i=super.updateSelection(e,t);return i&&this.updateDomSelection(),i}_setSelectionWithoutDomUpdate(e){this.skipDomUpdate=!0,this.setSelection(e),this.skipDomUpdate=!1}_setSelection(e){super._setSelection(e),this.skipDomUpdate||this.updateDomSelection()}}class Ma extends Ia{constructor(e){super(e)}initialize(e){this.itemFactory=e.itemFactory,this.validityPredicate=e.validityPredicate?e.validityPredicate:()=>!0,super.initialize(e),this.spacerDiv=ge(this.element,".esc-c-spacer");let t=pe(this.element,".esc-c-clear");t&&t.addEventListener("click",()=>{this.getEnabled()&&this.setSelection([])}),this.tabIndices=new WeakMap;for(let e of this.getItems())this.wireItem(e);if(null!=e.selection){if(this.selection.length)throw new Error("Collection with pre-rendered items does not accept selection.");this.updateSelection(e.selection,!1)}this.element.addEventListener("click",e=>{if(!this.getEnabled())return;if(!(e.target instanceof HTMLElement&&e.target.classList.contains("esc-c-remove")))return;let t=ve(e.target,".esc-c-item",this.element);if(!t)return;let i=this.getItemId(t);this.removeSelection(i)})}getOptionIds(){throw new se("UnsupportedOperation")}getNoOptions(){throw new se("UnsupportedOperation")}validateSelection(e){let t=Es(e,{options:this.validityPredicate,type:this.type,allowNullValues:!0,maxNoSelected:this.maxNoSelected,unique:this.unique});return this._validateSelection&&(t=this._validateSelection(this.orderSensitive?t:[...t].sort(Oi))),t}resfresh(){return this._setControlSelection(this.selection),this}getItems(){return me(this.element,".esc-c-item")}_getControlSelection(){return this.getItems().map(e=>this.getItemId(e))}getItemId(e){let t=An(e);if(null==t)throw new Error("Item does not have id.");if(t=s(t),void 0===t)throw new Error("Item has undefined id.");return Ss(t,this.type,!0)}getElements(e){return e.querySelectorAll("[tabindex], a, button, input, select, textarea")}_setControlSelection(e){e=e||[];let t=this.getItems();for(let e=t.length-1;e>=0;e--)t[e].remove();for(let t of e){let i=this.itemFactory(t,e.slice());if(!i)throw new Error(`Selected id '${t}' not found.`);let n=this.makeItem({id:t,content:i});this.element.insertBefore(n,this.spacerDiv)}this.element.setAttribute("data-esc-no-items",e.length.toString())}_setControlEnabled(e){super._setControlEnabled(e);for(let e of this.getItems())for(let t of this.getElements(e))if(this._enabled){let e=this.tabIndices.get(t);null!=e&&(t.tabIndex=e)}else this.tabIndices.set(t,t.tabIndex),t.tabIndex=-1}makeItem(e){let t=function(e,t,i=!0){if(void 0===e.id)throw new Error("Option must not have undefined id.");if(!e.content)throw new Error("Option must have non-naught content.");let n=t('<div class="esc-c-item" />').attr("data-esc-id",Js(e.id)),s=n.append('<div class="esc-c-content" />').children();return i?Tt(e.content,s):At(e.content,s),n.append('<button class="esc-c-remove esc-icon-button esc-m-type-subtle esc-icon-remove" />'),n}(e,mt,!1).get(0);return this.wireItem(t),t}wireItem(e){for(let t of this.getElements(e))this.tabIndices.set(t,t.tabIndex),this.getEnabled()||(t.tabIndex=-1)}}function za(e,t){let i=si(e,"Collection",HTMLElement),n=new Ma(function(e,t){let i,n;if("string"==typeof t.itemFactory){let e=Ke(["id","selection"],t.itemFactory,"item factory");i=(t,i)=>et(e,[t,i])}else i=t.itemFactory;if(t.validityPredicate)if("string"==typeof t.validityPredicate){let e=Ke(["id"],t.validityPredicate,"validity predicate");n=t=>et(e,[t])}else n=t.validityPredicate;return{element:e,type:t.type,itemFactory:i,validityPredicate:n,selection:t.selection,unique:t.unique,orderSensitive:t.orderSensitive,maxNoSelected:t.maxNoSelected}}(i,t));Vs(n.element,n,t)}var Aa,Ta,La;function $a(e,t){t=t||{};let i=si(e,"Textbox field",HTMLElement),n=new Jl({element:i,trim:t.trim,delay:t.delay});Vs(n.element,n,t)}function Oa(e,t){let i=si(e,"Checkbox field",HTMLElement),n=new ir({element:i});Vs(n.element,n,t)}function Da(e){return Tn("esc.widgets.data.comp-table.runtime")[e]}function Pa(e){if(null==e)return null;let t=new Map;for(let i of Object.keys(e)){let n=_a(e[i]);n&&t.set(i,n)}return t}function _a(e){if(null==e)return e;if(!e)return null;if("string"!=typeof e)return e;if(pl(e)){let t=wl(e);return e=>t(e)}let t=Ke(["datum","context"],e,"formatter");return(e,i)=>et(t,[e,i])}bt("esc-tags",za),xa.init=za,Aa||(Aa={}),bt("esc-textbox",$a),Aa.init=$a,Ta||(Ta={}),bt("esc-toggle",Oa),Ta.init=Oa,La||(La={});class Fa{constructor(e){this.columns=e.columns||null,this.rows=e.rows||null}format(e,t,i,n){let s=this.columns&&i&&this.columns.get(i)||void 0,r=this.rows&&t&&this.rows.get(t)||void 0;null==(e=this.content2dom(e))&&(e=null);let o=e,l=!1;return s&&(void 0===(e=s(e,{datum:e,raw:o,rowId:t,columnId:i,cell:n}))||e===n?e=o:l=!0),r&&(void 0===(e=r(e,{datum:e,raw:o,rowId:t,columnId:i,cell:n}))||e===n?e=o:l=!0),l||(e=this.datum2str(e)),e}content2dom(t){if(Array.isArray(t)&&t.length){let e;for(let i of t){if(!ie(i))return t;if(e)for(let t=0;t<i.length;t++)e=e.add(i.eq(t));else{e=i.eq(0);for(let t=1;t<i.length;t++)e=e.add(i.eq(t))}}return e}return zt(t)?t.encoded?e.$(t.content):t.content:t}datum2str(e,t=!1){if(null==e)return"";if(ie(e))return e;let i=typeof e;if("string"===i)return e;if("number"===i){return Da("format.number")(e)}if("boolean"===i)return Da("format.boolean")(e);if(Array.isArray(e)){let i=e.map(e=>this.datum2str(e,!0)).join();return t&&(i="["+i+"]"),i}return e.toString()}}e.log.logger("esc.widgets.data.comp-table");function Ra(e){return e?e.reduce((e,t)=>(t.rows&&e.push(...t.rows),e),[]):e}function Ba(e,t,i){return{id:Ss(e.id,t,!0),label:e.label,rows:e.rows.map(e=>ja(e,i))}}function Ha(e,t,i){return ks(e,t),ja(e,i)}function ja(e,t){let i=Ss(e.id,t,!0);if(null!=e.color&&!Pr(e.color))throw new Error(`Row/column ${u(e.id)} has invalid color: '${e.color}'`);return{id:i,name:e.name,label:e.label,format:_a(e.format),color:e.color}}function qa(e,t){let i=new Fa({columns:t.columnFormats,rows:t.rowFormats});e.css("--esc-comp-table-number-of-columns",(t.columns||[]).length),function(e,t){let i=t.selection&&void 0!==t.selection[0]?Js(t.selection[0]):void 0,n=t.selection&&void 0!==t.selection[1]?Js(t.selection[1]):void 0;for(let s=0;s<t.groups.length;s++){let r=t.groups[s];Ya(r).appendTo(e);for(let r of t.columns){let o=null!=t.selection&&void 0===i&&n===r.id,l=0===s?Za(r,!1,o):Ga(r,o);e.append(l)}Ua(e,{group:r,columns:t.columns,accessor:t.accessor,formatter:t.formatter,selection:t.selection})}}(e,{groups:t.groups||[],columns:t.columns||[],accessor:t.accessor,formatter:i,selection:t.selection||null})}function Ua(e,t){let i=t.selection&&void 0!==t.selection[0]?Js(t.selection[0]):void 0,n=t.selection&&void 0!==t.selection[1]?Js(t.selection[1]):void 0;for(let s of t.group.rows||[]){let r=null!=t.selection&&i===s.id&&void 0===t.selection[1];Za(s,!0,r).appendTo(e);for(let o of t.columns)r=!(null==t.selection||void 0!==i&&i!==s.id||void 0!==n&&n!==o.id),Va({groupId:Js(t.group.id),rowId:Js(s.id),columnId:Js(o.id),rowColor:s.color,columnColor:o.color,accessor:t.accessor,formatter:t.formatter,selected:r}).appendTo(e)}}function Za(t,i,n){let s=e.$("<div/>").addClass(i?"esc-c-label esc-c-row":"esc-c-group esc-c-col").toggleClass(Ae,n).attr("data-esc-id",Js(t.id));t.name&&t.name!==t.id&&s.attr("data-esc-variable-name",t.name);let r=e.$("<div/>").appendTo(s);if(t.color){let e=_r(t.color)||t.color;s.hasClass("esc-c-row")?s.css("--esc-comp-table-color-row",e):r.css("--esc-comp-table-color-col",e)}return Tt(t.label,r),s}function Ya(t){let i=e.$('<div class="esc-c-group esc-c-label"/>').attr("data-esc-id",Js(t.id)),n=e.$("<div/>").appendTo(i);return Tt(t.label,n),i}function Ga(t,i){let n=e.$('<div class="esc-c-group"/>').toggleClass(Ae,i),s=e.$("<div/>").appendTo(n);if(t.color){let e=_r(t.color)||t.color;s.css("--esc-comp-table-color-col",e)}return n}function Va(t){let i=e.$('<div class="esc-c-cell"/>').toggleClass(Ae,t.selected);if(t.rowColor){let e=_r(t.rowColor)||t.rowColor;i.css("--esc-comp-table-color-row",e)}let n=e.$("<div/>").appendTo(i);if(t.columnColor){let e=_r(t.columnColor)||t.columnColor;n.css("--esc-comp-table-color-col",e)}return function(e,t){let i=t.accessor(t.rowId,t.columnId),n=e.children();Tt(t.formatter.format(i,t.rowId,t.columnId,n),n)}(i,{rowId:t.rowId,columnId:t.columnId,accessor:t.accessor,formatter:t.formatter}),i}const Xa=e.log.logger("esc.widgets.data.comp-table.CompTableController");class Wa extends Ms{constructor(e){super(e),this.accessor=(e,t)=>{e=this.rowNames.get(e)||e,t=this.columnNames.get(t)||t,this.flipped&&([e,t]=[t,e]);let i=this.data.get(e);return i&&i.get(t)},this.doUpdateDom=gs(()=>this._updateDom()),this.updateSelectionOnly=!1}initialize(e){if(super.initialize(e),!e.idField)throw new Error("CompTable must have id field.");this.groupType=e.groupType,this.rowType=e.rowType,this.columnType=e.columnType,this.idField=e.idField,this.flipped=!0===e.flipped,this.groups=[],this.columns=[],this.rowIds=[],this.columnIds=[],this.rowNames=new Map,this.columnNames=new Map,this.columnFormats=Pa(e.columnFormats)||new Map,this.rowFormats=Pa(e.rowFormats)||new Map,this.rowSelectable=this.element.classList.contains("esc-m-row-selectable"),this.columnSelectable=this.element.classList.contains("esc-m-column-selectable"),this.cellSelectable=this.element.classList.contains("esc-m-cell-selectable"),this.stateless=!0===e.stateless,this.data=new n(()=>new Map);let t,i=[void 0,void 0];for(let e of me(this.element,".esc-c-col")){let t=e.getAttribute("data-esc-id");if(null==t)throw new Error(`Cell is missing 'data-esc-id' attribute: ${e}`);let n=this.castId(t,this.columnType),s=e.getAttribute("data-esc-variable-name")||t,r=mt(e.firstElementChild).contents();this.columns.push({id:n,label:r,color:e.firstElementChild.style.getPropertyValue("--esc-comp-table-color-col")||void 0}),this.columnIds.push(n),this.columnNames.set(t,s),e.classList.contains(Ae)&&(i[0]=void 0,i[1]=n)}for(let e of me(this.element,".esc-c-label")){let n=mt(e.firstElementChild).contents();if(e.classList.contains("esc-c-group")){let i=e.getAttribute("data-esc-id");if(null==i)throw new Error(`Cell is missing 'data-esc-id' attribute: ${e}`);t={id:this.castId(i,this.groupType),label:n,rows:[]},this.groups.push(t)}else{if(!t)throw new Error("Comp table contains cells outside of row grouping.");let s=e.getAttribute("data-esc-id");if(null==s)throw new Error(`Cell is missing 'data-esc-id' attribute: ${e}`);let r=this.castId(s,this.rowType),o=e.getAttribute("data-esc-variable-name")||s;t.rows.push({id:r,name:o,label:n,color:e.style.getPropertyValue("--esc-comp-table-color-row")||void 0,format:this.rowFormats.get(s)}),this.rowIds.push(r),this.rowNames.set(s,o),e.classList.contains(Ae)&&(i[0]=r,i[1]=void 0)}}let s=this.rowIds.length,r=this.columnIds.length,o=me(this.element,".esc-c-cell");for(let e=0;e<s;e++){let t=this.rowIds[e];for(let n=0;n<r;n++){let s=this.columnIds[n];o[e*r+n].classList.contains(Ae)&&(void 0===i[0]&&(i[0]=t),void 0===i[1]&&(i[1]=s))}}this.selection=void 0===i[0]&&void 0===i[1]?void 0:i,Et(this.element,"both"),this.element.addEventListener("click",e=>{let t=this.getCellIndex(e.target);if(this.element.children.item(t).matches(".esc-c-group:not(.esc-c-col)"))return;let i,n=this.getNoColumns()+1,s=t%n,r=this.getColumnIds()[s-1];if(t>=n){let e=this.element.children.item(t-s).getAttribute("data-esc-id");if(null==e)return;i=this.castId(e,this.rowType)}if(null==i){if(void 0===r)return;if(!this.columnSelectable)return}else if(void 0===r){if(!this.rowSelectable)return}else if(!this.cellSelectable){if(this.rowSelectable&&this.cellSelectable)return;this.rowSelectable&&(r=void 0),this.columnSelectable&&(i=void 0)}let o=[i,r];this.equalsSelection(o,this.selection)&&(o=void 0),this.setSelection(o)})}castId(e,t){return Ss(s(e),t,!0)}validateSelection(e){if(null==e||!this.rowSelectable&&!this.columnSelectable&&!this.cellSelectable)return;let t,i;if(!Array.isArray(e)||2!==e.length||void 0!==(t=e[0])&&typeof t!==this.rowType||void 0!==(i=e[1])&&typeof i!==this.columnType)throw new Error(`Selection must be 2-array of form [${this.rowType}, ${this.columnType}] | [${this.rowType}, undefined] | [undefined, ${this.columnType}]: ${u(e)}`);if(void 0!==t||void 0!==i){if(void 0===t){if(!this.columnSelectable)return}else{if(!this.rowSelectable&&!this.cellSelectable)return;if(!this.rowIds.includes(t))throw new Error(`Row not found: ${u(t)}`)}if(void 0===i){if(!this.rowSelectable)return}else{if(!this.columnSelectable&&!this.cellSelectable)return;if(!this.columnIds.includes(i))throw new Error(`Column not found: ${u(i)}`)}return[t,i]}}equalsSelection(e,t){return null==e?null==t:null!=t&&Ai(e,t)}getSelection(){return this.selection&&this.selection.slice()}setSelection(e){return super.setSelection(e),this.stateless&&this._setSelection(void 0),this}_setSelection(e){super._setSelection(e),this.updateDom(!0)}setData(e){return this._setData(e,!1)}addData(e){return this._setData(e,!0)}normalizeData(e,t){if(Xa.debug("Setting data (incremental=%s): %o",t,e),t||this.data.clear(),e)for(let t of e){let e=t[this.idField];if(void 0===e)continue;e=Ss(e,this.flipped?this.columnType:this.rowType,!0);let i=this.data.compute(Js(e));for(let e of Object.keys(t))this.castId(e,this.flipped?this.rowType:this.columnType),i.set(e,t[e])}}keepDataColumns(e){this.flipped?this._keepDataRows(e):this._keepDataColumns(e)}keepDataRows(e){this.flipped?this._keepDataColumns(e):this._keepDataRows(e)}_keepDataColumns(e){for(let t of this.data.values())for(let i of t.keys())e.includes(i)||t.delete(i)}_keepDataRows(e){for(let t of Array.from(this.data.keys()))e.includes(t)||this.data.delete(t)}_setData(e,t){return Xa.debug("Setting data (incremental=%s): %o",t,e),this.normalizeData(e,t),this.updateDom(),this}updateDom(e=!1){this.updateSelectionOnly=e,this.doUpdateDom()}_updateDom(){this.updateSelectionOnly?(Xa.debug("Updating DOM - applying selection."),function(e,t,i){let n=e&&void 0!==e[0]?Js(e[0]):void 0,s=e&&void 0!==e[1]?Js(e[1]):void 0,r=t.children.length/(i+1),o=0,l=[];for(let a=0;a<r;a++){let r=null;for(let h=0;h<i+1;h++){let i,u=t.children[o++];0===h?(r=u.getAttribute("data-esc-id"),i=null):0===a?(i=u.getAttribute("data-esc-id"),l.push(i)):i=l[h-1];let c=!1;null!=e&&(0===a?h>0&&(c=void 0===n&&s===i):c=0===h?n===r&&void 0===s:!(void 0!==n&&n!==r||void 0!==s&&s!==i)),u.classList.toggle(Ae,c)}}}(this.selection,this.element,this.getNoColumns())):(Xa.debug("Updating DOM - replacing content."),Ze(this.element.children),qa(mt(this.element),{groups:this.groups,columns:this.columns,accessor:this.accessor,columnFormats:this.columnFormats,rowFormats:this.rowFormats,selection:this.selection}))}updateRows(){this.rowIds.length=0,this.rowNames.clear(),this.rowFormats.clear();for(let e of this.groups)for(let t of e.rows){this.rowIds.push(t.id);let e=Js(t.id);this.rowNames.set(e,t.name||e),null!=t.format&&this.rowFormats.set(e,t.format)}this.adjustSelection()}updateColumns(){this.columnIds.length=0,this.columnNames.clear(),this.columnFormats.clear();for(let e of this.columns){this.columnIds.push(e.id);let t=Js(e.id);this.columnNames.set(t,e.name||t),null!=e.format&&this.columnFormats.set(t,e.format)}this.adjustSelection()}adjustSelection(){null!=this.selection&&(void 0!==this.selection[0]&&!this.rowIds.includes(this.selection[0])||void 0!==this.selection[1]&&!this.columnIds.includes(this.selection[1]))&&this.setSelection(void 0)}getCellIndex(e){if(!e)return-1;let t=-1;for(let i of this.element.children)if(t++,i.contains(e))return t;return-1}getNoColumns(){return this.columns.length}getColumnIds(){return this.columnIds.slice()}setColumns(e){return Xa.debug("Setting columns: %o",e),this.columns=function(e,t){return Ns(e),e.map(e=>ja(e,t))}(e||[],this.columnType),this.updateColumns(),this.keepDataColumns(Array.from(this.columnNames.values())),this.updateDom(),this}addColumn(e,t=-1){if(null==e)return this;Xa.debug("Adding column at %s: %o",t,e);let i=Ha(e,this.columns,this.columnType);return this.columns.splice(t<0||t>=this.columns.length?this.columns.length:t,0,i),this.updateColumns(),this.updateDom(),this}removeColumn(e){return this._removeColumns([e])}removeColumns(e=null){return this._removeColumns(e)}_removeColumns(e){Xa.debug("Removing columns: %o",e);let t=!1;if(e)for(let i of e){let e=this.getColumnIds().indexOf(i);e<0||(t=!0,this.columns.splice(e,1))}else this.columns.length&&(t=!0),this.columns.length=0;return t&&(this.updateColumns(),this.keepDataColumns(Array.from(this.columnNames.values())),this.updateDom()),this}getNoGroups(){return this.groups.length}getGroupIds(){return this.groups.map(e=>e.id)}setGroups(e){return Xa.debug("Setting groups: %o",e),e=e||[],this.groups=function(e,t,i){return Ns(e),Ns(Ra(e)),e.map(e=>Ba(e,t,i))}(e,this.groupType,this.rowType),this.updateRows(),this.keepDataRows(Array.from(this.rowNames.values())),this.updateDom(),this}addGroup(e,t=-1){if(null==e)return this;Xa.debug("Adding group at %s: %o",t,e);let i=function(e,t,i,n){return ks(e,t),Ns(Ra(t)),Ba(e,i,n)}(e,this.groups,this.groupType,this.rowType);return this.groups.splice(t<0||t>=this.groups.length?this.groups.length:t,0,i),this.updateRows(),this.updateDom(),this}removeGroup(e){return this._removeGroups([e])}removeGroups(e=null){return this._removeGroups(e)}_removeGroups(e){Xa.debug("Removing groups: %o",e);let t=!1;if(e){let i=this.getGroupIds();for(let n of e){let e=i.indexOf(n);e<0||(t=!0,this.groups.splice(e,1))}}else this.groups.length&&(t=!0),this.groups.length=0;return t&&(this.updateRows(),this.keepDataRows(Array.from(this.rowNames.values())),this.updateDom()),this}getNoRows(){return this.rowIds.length}getRowIds(){return this.rowIds.slice()}addRow(e,t,i=-1){if(null==e)return this;let n=this.groups.findIndex(e=>e.id===t);if(n<0)throw new Error(`Cannot add row - group '${t}' not found.`);Xa.debug("Adding row to group %s at %s: %o",t,i,e);let s=Ha(e,Ra(this.groups),this.rowType),r=this.groups[n];return r.rows.splice(i<0||i>=r.rows.length?r.rows.length:i,0,s),this.updateRows(),this.updateDom(),this}removeRow(e){return this._removeRows([e])}removeRows(e=null){return this._removeRows(e)}_removeRows(e){Xa.debug("Removing groups: %o",e);let t=!1;if(e)for(let i of e)for(let e of this.groups){let n=e.rows.findIndex(e=>e.id===i);if(!(n<0)){t=!0,e.rows.splice(n,1);break}}else{this.rowIds.length&&(t=!0);for(let e of this.groups)e.rows.length=0}return t&&(this.updateRows(),this.keepDataRows(Array.from(this.rowNames.values())),this.updateDom()),this}}function Ka(e,t){let i=si(e,"CompTable",HTMLElement);Vs(i,new Wa(Object.assign({},t,{element:i})),t)}bt("esc-comp-table",Ka),La.init=Ka;class Qa extends il{constructor(e){super(e),this.animationProviders=new Set;for(let t of e.onAnimation||[])this.onAnimation(t)}onAnimation(e){return null!=e&&this.animationProviders.add(e),this}offAnimation(e){return this.animationProviders.delete(e),this}update(e,t){return this.animationQueue&&(this.animationQueue.cancel(),this.queue(e,t)),this}queue(e,t){if(this.animationQueue){const i=this.makeCallback();this._queue(i,e,t)}return this}makeCallback(){let e=Array.from(this.animationProviders).map(e=>e()).filter(e=>!!e);return 0===e.length?null:(t,i)=>{for(let n=0;n<e.length;n++){!1===e[n](t,i)&&e.splice(n--,1)}return 0!==e.length}}}function Ja(e){let t=e.getBoundingClientRect(),i=t.width,n=t.height,s=getComputedStyle(e),r=parseFloat(s.borderLeftWidth||"0"),o=parseFloat(s.borderRightWidth||"0"),l=parseFloat(s.borderTopWidth||"0"),a=parseFloat(s.borderBottomWidth||"0"),h=parseFloat(s.paddingLeft||"0"),u=parseFloat(s.paddingRight||"0"),c=parseFloat(s.paddingTop||"0"),d=parseFloat(s.paddingBottom||"0");return i-=r+h+u+o,n-=l+c+d+a,{borderLeft:r,borderRight:o,borderTop:l,borderBottom:a,paddingLeft:h,paddingRight:u,paddingTop:c,paddingBottom:d,innerWidth:i,innerHeight:n}}function eh(e,t=10,i){if(t<1)throw new Error(`Invalid count: ${t}`);if(null==e)return e;let n,s,r;if(e.max===e.min&&(n=A(e.min),r=T(e.max),(e={min:b(n),max:b(r)}).max===e.min))return s={base:0,power:0},{min:n,step:s,max:r};do{if(1===t){n=A(e.min),s=T(b(e.max)-b(n)),r=w(n,s);break}{let o=b(e.max)-b(e.min);if(o/=t,s=T(o),null!=i&&0!==s.base)for(;s.power<i;)s=th(s);n=x(e.min,s),r=S(e.max,s);let l=Math.min(n.power,r.power,s.power),a=p(n,l),h=p(s,l);if((p(r,l)-a)/h<=t)break;t--}}while(t>=1);return{min:n,step:s,max:r}}function th(e){switch(e.base){case 0:throw new se(`Step has zero base: ${u(e)}`);case 1:case 2:case 5:return{base:1,power:e.power+1};default:throw new se(`Step is not nice: ${u(e)}`)}}const ih=e.log.logger("esc.sound.SoundManager");class nh{constructor(e){e=e||{},this.baseUrl=e.baseUrl||null,this.baseUrl&&!this.baseUrl.endsWith("/")&&(this.baseUrl+="/"),this.dirty=!1}setEnabled(e){return this.enabled=e,this}getEnabled(){return this.enabled}setUrl(e){return e=this.resolveUrl(e),this.url!=e&&(this.url=e,this.dirty=!0),this}getUrl(){return this.url}resolveUrl(e){return e?this.baseUrl&&!/^(?:[a-z]+:)?\//i.test(e)?this.baseUrl+e:e:null}play(e){return void 0!==e&&this.setUrl(e),this.enabled&&this.url?(this.audio?this.dirty?(this.audio.src=this.url,this.dirty=!1):(this.audio.pause(),this.audio.currentTime=0):(this.audio=new Audio(this.url),this.dirty=!1),this.audio.play().catch(e=>ih.error(`Failed to play ${this.url}: ${e}`)),this):this}}const sh="web-standard";class rh{constructor(e){this.scale=e.scale,this.domain={min:e.domain.min,max:e.domain.max},this.range=null==e.range?{min:0,max:1}:{min:e.range.min,max:e.range.max},this.intermediate={min:this.scale.fu(e.domain.min),max:this.scale.fu(e.domain.max)}}value2position(e){if(null==e)return e;if(e===this.domain.min)return this.range.min;if(e===this.domain.max)return this.range.max;{let t=(this.scale.fu(e)-this.intermediate.min)/(this.intermediate.max-this.intermediate.min);return this.range.min+t*(this.range.max-this.range.min)}}position2value(e){if(null==e)return e;if(e===this.range.min)return this.domain.min;if(e===this.range.max)return this.domain.max;{let t=(e-this.range.min)/(this.range.max-this.range.min),i=this.intermediate.min+t*(this.intermediate.max-this.intermediate.min);return this.scale.inverse(i)}}}class oh{constructor(e){this.axis=e.axis,this.data={rotated:!1,ticks:new Map,color:null},this.animationProvider=()=>this.axis.animate(this.data)}setData(e){return this.data=e,this}getAnimationProvider(){return this.animationProvider}}var lh;function ah(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}function hh(e){return e*e*e}function uh(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}!function(e){e.top="top",e.bottom="bottom",e.left="left",e.right="right",e.radial="radial"}(lh||(lh={}));Math.PI;function ch(e){return 1-Math.pow(2,-10*e)}var dh=function e(t){function i(e){return((e*=2)<1?e*e*((t+1)*e-t):(e-=2)*e*((t+1)*e+t)+2)/2}return t=+t,i.overshoot=e,i}(1.70158),fh=2*Math.PI,mh=function e(t,i){var n=Math.asin(1/(t=Math.max(1,t)))*(i/=fh);function s(e){return 1-t*Math.pow(2,-10*(e=+e))*Math.sin((e+n)/i)}return s.amplitude=function(t){return e(t,i*fh)},s.period=function(i){return e(t,i)},s}(1,.3);class ph{constructor(e){this.current=function(e){if(null==e)return new Map;if(e instanceof Map)return new Map(e);let t=new Map;for(let i of e||[]){if(!i)continue;let e=i.getId();if(t.has(e))throw new Error(`Duplicate component: ${e}`);t.set(e,i)}return t}(e.current),this.createComponent=e.create;let t=e.effects;if(!t)throw new Error("Render-callback factory must be non-null.");this.effects="function"==typeof t?t:(e,i,n)=>t.makeCallback(e,i,n)}getComponents(){return this.current.values()}getComponent(e){return this.current.get(e)}getNoComponents(){return this.current.size}animate(e){if(!e)return null;let t;return(i,n)=>{if(n.first){t=new Array(this.current.size);let i=0,n=new Set;for(let s of this.current.values()){let r=s.getId(),o=e.get(r);void 0!==o&&n.add(r);let l=this.effects(s.getState(),o,r),a=void 0===o?this.makeExitCallback(r,s,l):this.makeUpdateCallback(s,l);a&&(t[i++]=a)}let s=e.size-n.size;s&&(t.length=i+s,e.forEach((e,s)=>{if(!n.has(s)){let n=this.effects(void 0,e,s);if(!n)throw new Error("On entry, animation effect must produce a render callback.");t[i++]=this.makeEnterCallback(s,n)}})),t.length=i,n=null,e=null}for(let e of t)e(i,n)}}makeEnterCallback(e,t){let i;return(n,s)=>{let r=t(n,s);if(s.first){if(void 0===r)throw new Error(`Callback for entry effect of '${e}' must not return an undefined state.`);i=this.createComponent(e,r),this.current.set(e,i)}else void 0!==r&&i.update(r)}}makeExitCallback(e,t,i){return(n,s)=>{if(s.last)t.remove(),this.current.delete(e);else if(i){let e=i(n,s);void 0!==e&&t.update(e)}}}makeUpdateCallback(e,t){return t?(i,n)=>{let s=t(i,n);void 0!==s&&e.update(s)}:t}}function gh(e,t){return(i,n)=>{if(n.first){if(null==e)return t;let s=e(i,n);if(void 0===s)return;t=Object.assign({},t);for(let e of Object.keys(s)){let i=s[e];void 0!==i&&(t[e]=i)}return t}return e&&e(i,n)}}class bh{constructor(e){this.type=e.type,this.id=e.id,this.element=document.createElement("span"),this.element.classList.add("esc-c-tick"),this.element.setAttribute("data-esc-id",Js(this.id)),e.parent.appendChild(this.element),this.text=this.element,this.state={},this.update(Object.assign({},{text:"",position:[0,0],rotated:!1,opacity:0,color:null,selected:!1},e.state))}getId(){return this.id}getState(){return Object.assign({},this.state,{position:hr(this.state.position)})}update(e){if(null!=e){let t=this.state;null!=e.text&&t.text!==e.text&&(this.text.textContent=t.text=e.text),null==e.position||ur(t.position,e.position)||(t.position=hr(e.position),this.element.style.left=t.position[0]+"px",this.element.style.top=t.position[1]+"px"),void 0!==e.color&&t.color!==e.color&&this.element.style.setProperty("--esc-axis-tick-color",t.color=e.color),null!=e.rotated&&t.rotated!==e.rotated&&this.element.classList.toggle("esc-m-rotated",t.rotated=e.rotated),null!=e.opacity&&t.opacity!==e.opacity&&(this.element.style.opacity=(t.opacity=e.opacity).toString()),null!=e.selected&&t.selected!==e.selected&&this.element.classList.toggle(Ae,t.selected=e.selected)}return this}remove(){return this.element.parentNode&&this.element.parentNode.removeChild(this.element),this}}class wh extends class{constructor(e){this.tickEffects=(e,t)=>{if(void 0===e){if(void 0===t)throw new Error("Effect must have defined start or end point.");return gh(Vo({opacity:Ro(Bo(0,t.opacity),{duration:.8})}),t)}return void 0===t?Ro(Vo({opacity:Bo(e.opacity,0)}),{easing:ch}):Vo({text:Ko(e.text,t.text,.5),position:Ro(Zo(e.position,t.position),{easing:uh}),rotated:Ko(e.rotated,t.rotated,.5),color:Ko(e.color,t.color,.5),opacity:jo(e.opacity,t.opacity),selected:Ko(e.selected,t.selected,.5)})},this.type=e.type,this.initialize(e)}setType(e){return this.type=e,this}getType(){return this.type}initialize(e){this.tickPadding=Cr(this.element,"esc-axis-tick-padding",3),this.effect=new ph({create:(e,t)=>this.createTick(e,t),effects:this.tickEffects})}getTicks(){return this.effect.getComponents()}getTick(e){return this.effect.getComponent(e)}getNoTicks(){return this.effect.getNoComponents()}animate(e){let t=new Map;for(let[i,n]of e.ticks)t.set(i,{text:n.label,position:n.position,rotated:e.rotated,color:this.resolveColor(e.color),opacity:1,selected:n.selected});return this.effect.animate(t)}resolveColor(e){return Fr(e,this.element)||null}measureLabels(e){let t={width:0,height:0},i={width:0,height:0},n={width:0,height:0},s=!0;for(let r of e){let e=this.measure(r);s&&(s=!1,t.width=e.width,t.height=e.height),i.width=e.width,i.height=e.height,n.width=Math.max(n.width,e.width),n.height=Math.max(n.height,e.height)}return{first:t,last:i,max:n}}}{constructor(e){super(e)}initialize(e){e.parent.appendChild(this.element=ae(`<div class="esc-axis-2d esc-m-type-${this.type}" />`)),!0===e.selectable&&this.element.classList.add("esc-m-selectable"),super.initialize(e)}setType(e){return this.type!==e&&(this.element.classList.remove(`esc-m-type-${this.type}`),super.setType(e),this.element.classList.add(`esc-m-type-${this.type}`)),this}createTick(e,t){return new bh({parent:this.element,type:this.type,id:e,state:t})}measure(e){this.measurementTick||(this.measurementTick=this.createTick(Number.NaN,{text:"",position:[0,0],rotated:!1,opacity:0,color:null,selected:!1}),this.measurementTick.text.style.visibility="hidden"),this.measurementTick.text.innerText=e;let t=this.measurementTick.text.getBoundingClientRect();return{width:t.width,height:t.height}}}const vh="__esc-resize-sensor__";class yh{constructor(e){this.listeners=new Set,this.target=e,this.initialize()}initialize(){this.resizeHandler=()=>this.handleResize(),Ie(this.target,vh,this)}handleResize(){let e=this.size();e[0]===this.lastSize[0]&&e[1]===this.lastSize[1]||(this.lastSize=e,this.fireListeners())}fireListeners(){for(let e of this.listeners)et(e,[...this.lastSize,this.target],this.target)}onResize(e){return e&&this.listeners.add(e),this}offResize(e){return e&&this.listeners.delete(e),0===this.listeners.size&&this.destroy(),this}destroy(){this.listeners.clear(),ze(this.target,vh)}}class xh extends yh{constructor(e){super(e)}initialize(){super.initialize(),this.target.addEventListener("resize",this.resizeHandler)}size(){return[this.target.innerWidth,this.target.innerHeight]}destroy(){this.target.removeEventListener("resize",this.resizeHandler),super.destroy()}}class Sh extends yh{constructor(e){super(e)}initialize(){super.initialize(),"static"==getComputedStyle(this.target).position&&(this.oldPosition=this.target.style.position,this.target.style.position="relative"),this.sensor=ae('<div data-role="__esc-resize-sensor__" style="visibility: hidden; opacity: 0; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden;"><div style="display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: auto; background: #eee;"><div></div></div><div style="display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: auto; background: #eee;"><div style="display: block; position: absolute; top: 0; left: 0; height: 200%; width: 200%; overflow: hidden;"></div></div></div>'),this.expand=this.sensor.firstElementChild,this.expandChild=this.expand.firstElementChild,this.contract=this.sensor.lastElementChild,this.contractChild=this.contract.firstElementChild,Ie(this.target,vh,this),this.target.appendChild(this.sensor),this.resetSensor(),this.lastSize=this.size(),this.expand.addEventListener("scroll",this.resizeHandler),this.contract.addEventListener("scroll",this.resizeHandler)}size(){let e=this.target.getBoundingClientRect();return[e.width,e.height]}handleResize(){this.resetSensor(),super.handleResize()}resetSensor(){this.contract.scrollLeft=this.contract.scrollWidth,this.contract.scrollTop=this.contract.scrollHeight,this.expandChild.style.width=this.expand.offsetWidth+1+"px",this.expandChild.style.height=this.expand.offsetHeight+1+"px",this.expand.scrollLeft=this.expand.scrollWidth,this.expand.scrollTop=this.expand.scrollHeight}destroy(){this.expand.removeEventListener("scroll",this.resizeHandler),this.contract.removeEventListener("scroll",this.resizeHandler),super.destroy(),this.target.style.position=this.oldPosition,this.sensor.remove()}}function Eh(e,t,i=!1){if(null==t)return;let n=Me(e,vh);if(null==n)if(e instanceof Window)n=new xh(e);else{if(!(e instanceof HTMLElement))throw new Error(`Cannot add resize listener to element: ${e}`);n=new Sh(e)}i&&et(t,[...n.size(),e],e),n.onResize(t)}const kh=e.log.logger("esc.widgets.misc.LabelController");class Nh extends Cs{constructor(e){if(super(e),this.timer=-1,!this.element.parentElement)throw new Error("Element has no parent.");if(this.parent=this.element.parentElement,!e.parent&&!this.parent)throw new Error("Element has no container.");this.container=e.parent||this.parent,this.selection=!1,this.initialized=!1,"static"==getComputedStyle(this.parent).position&&(kh.info("Setting label's parent position in to 'relative'.",this.parent),this.parent.style.position="relative"),this.updateHandler=()=>requestAnimationFrame(()=>this._update()),new MutationObserver(this.updateHandler).observe(this.element,{characterData:!1,attributes:!1,childList:!0,subtree:!0})}setTarget(e,t,i){this.target=this.normalizeTarget(e),this.target&&this.target.center&&this.lazyInitResizeListener(),this.timer>=0&&window.clearTimeout(this.timer),t>0&&(this.timer=window.setTimeout(()=>this.hide(),t)),requestAnimationFrame(i)}lazyInitResizeListener(){this.initialized||(this.initialized=!0,Eh(this.container,this.updateHandler),Ue(this.element,()=>function(e,t){let i=Me(e,vh);null!=i&&(2===arguments.length?i.offResize(t):i.destroy())}(this.container,this.updateHandler)))}normalizeTarget(e){if(null!=e){if(Array.isArray(e)){let[t,i]=e;return{left:t,right:t,top:i,bottom:i}}if(e instanceof MouseEvent){let t=this.container.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top;return{left:i,right:i,top:n,bottom:n}}if(null!=(t=e)&&("string"==typeof t||t instanceof Element||ie(t))){return{left:0,right:0,top:0,bottom:0,center:Pe(e)}}if(function(e){return null!=e&&"object"==typeof e&&"target"in e}(e)){let t=this.normalizeTarget(e.target);return t.directions=this.normalizeDirection(e.direction),t}if(function(e){return null!=e&&"object"==typeof e&&"center"in e}(e)){let t=this.normalizeTarget(e.center);return t.left+=e.left||0,t.right+=e.right||0,t.top+=e.top||0,t.bottom+=e.bottom||0,t.directions=this.normalizeDirection(e.direction),t}{let{left:t,right:i,top:n,bottom:s,direction:r}=e;return{left:t,right:i,top:n,bottom:s,directions:this.normalizeDirection(r)}}var t}}normalizeDirection(e){if(e)switch(e){case"north":return["north"];case"north-east":return["north","east"];case"north-west":return["north","west"];case"south":return["south"];case"south-east":return["south","east"];case"south-west":return["south","west"];case"east":return["east"];case"west":return["west"];default:throw new Error(`Invalid label direction '${e}'.`)}}getEffectiveTarget(){if(!this.target)return;let e=this.container.getBoundingClientRect();if(this.target.center){let t=this.target.center.getBoundingClientRect();return{left:t.left-e.left-this.target.left,right:t.right-e.left+this.target.right,top:t.top-e.top-this.target.top,bottom:t.bottom-e.top+this.target.bottom,directions:this.target.directions}}{let t=Object.assign({},this.target);return t.left===Number.NEGATIVE_INFINITY?t.left=0:t.left===Number.POSITIVE_INFINITY&&(t.left=e.width),t.right===Number.NEGATIVE_INFINITY?t.right=0:t.right===Number.POSITIVE_INFINITY&&(t.right=e.width),t.top===Number.NEGATIVE_INFINITY?t.top=0:t.top===Number.POSITIVE_INFINITY&&(t.top=e.height),t.bottom===Number.NEGATIVE_INFINITY?t.bottom=0:t.bottom===Number.POSITIVE_INFINITY&&(t.bottom=e.height),t}}setContent(e){this.element.innerHTML="",Tt(e,mt(this.element))}content(e){return requestAnimationFrame(()=>this.setContent(e)),this}move(e,t=-1){return this.setTarget(e,t,()=>{this.element.classList.add(Ae),this._update()}),this.updateSelection(!0,!0),this}show(e,t,i=-1){return null!=e?(this.setTarget(t,i,()=>{this.setContent(e),this.element.classList.add(Ae)}),this.updateSelection(!0,!0)):this.hide(!0),this}hide(e=!1){return this.target&&(this.setTarget(void 0,-1,()=>{e&&this.setContent(null),this.element.classList.remove(Ae)}),this.updateSelection(!1,!0)),this}_update(){let e=this.getEffectiveTarget();if(!e)return;let t,i,n=Ja(this.container),s={left:n.borderLeft+n.paddingLeft,right:n.borderRight+n.paddingRight,top:n.borderTop+n.paddingTop,bottom:n.borderBottom+n.paddingBottom},r=this.container.getBoundingClientRect();if(this.parent===this.container)t=s,i=r;else{let e=Ja(this.parent);t={left:e.borderLeft+e.paddingLeft,right:e.borderRight+e.paddingRight,top:e.borderTop+e.paddingTop,bottom:e.borderBottom+e.paddingBottom},i=this.parent.getBoundingClientRect()}if(this.element.style.left="0px",this.element.style.top="0px",e.directions){let n=this.element.getBoundingClientRect();this.forcedLayout(n.width,n.height,e,r,i,t)}else{let n=-1,o=-1;for(let l=0;l<3;l++){let l=this.element.getBoundingClientRect();if(n===l.width)break;n=l.width,o=l.height,this.layout(n,o,e,r,s,i,t)}}}layout(e,t,i,n,s,r,o){let l,a,h,u=(i.left+i.right)/2,c=e/2-u+s.left,d=e/2+u-n.width+s.right,f=e-i.left+s.left,m=e+i.right-n.width+s.right;if(Math.max(0,c,d)<=Math.max(0,Math.min(f,m))){let n=i.top-t<s.top;h=[n?"south":"north"],l=u-e/2,a=n?i.bottom:i.top-t}else{let r=f<=m;h=[r?"west":"east"];let o=(i.top+i.bottom)/2,u=!1,c=!1;if(o-t/2<s.top)c=!0;else{o+t>n.height-s.bottom&&(u=o-t>s.top)}l=r?i.left-e:i.right,u?(a=o-t,h.push("north")):c?(a=o,h.push("south")):a=o-t/2}this.setPosition(l,a,n,r,o,h)}forcedLayout(e,t,i,n,s,r){let o,l,a=i.directions||[];if(0===a.length||a.length>2)throw new se(`Label directions must have one or two elements: ${u(a)}`);if(1===a.length)if("north"===a[0]||"south"===a[0]){let n="south"===a[0];o=(i.left+i.right-e)/2,l=n?i.bottom:i.top-t}else{o="west"===a[0]?i.left-e:i.right,l=(i.top+i.bottom-t)/2}else{let n=a.includes("west"),s=a.includes("north"),r=a.includes("south"),h=(i.top+i.bottom)/2;o=n?i.left-e:i.right,l=s?h-t:r?h:h-t/2}this.setPosition(o,l,n,s,r,a)}setPosition(e,t,i,n,s,r){this.element.classList.remove("esc-js-north","esc-js-south","esc-js-west","esc-js-east"),this.element.classList.add(...r.map(e=>`esc-js-${e}`)),this.parent!==this.container&&(e+=i.left-(n.left+s.left),t+=i.top-(n.top+s.top)),this.element.style.left=e+"px",this.element.style.top=t+"px"}}class Ch{constructor(e,t){if(!e||!e.element)throw new Error("Plot must have non-null element.");this.element=e.element,this.widgetId=t,this.initialize(e),this.createListeners(),this.resize()}initialize(e){this.initializeCSSProperties(),this.initializeLabel(e.label),this.clickCallback=e.clickCallback||null}createListeners(){this.createResizeListener(),this.clickCallback&&this.createClickListener(),this.createHoverListener()}createResizeListener(){let e=gs(()=>this.resize());Eh(this.element,e)}initializeLabel(e){let t=ge(this.element,".esc-label",HTMLElement);this.label=new Nh({element:t}),this.labelContent=e||void 0}createClickListener(){this.element.addEventListener("click",e=>{let t=this.mouseEvent2UserEvent(e);t&&this.onClick(t.datum)})}createHoverListener(){document.addEventListener("mousemove",e=>{this.element.contains(e.target)||this.onUnhover()}),this.element.addEventListener("mousemove",e=>{this.preventMoveEvent(e)||this.handleMoveEvent(e)})}preventMoveEvent(e){return this.label.element.contains(e.target)}handleMoveEvent(e){let t=this.mouseEvent2UserEvent(e);t?this.onHover(t.datum,t.target):this.onUnhover()}mouseEvent2PlotCoord(e){let t=this.element.getBoundingClientRect();return[e.clientX-t.left,e.clientY-t.top]}onHover(e,t){if(this.labelContent&&t){let i=this.labelContent(e.data,e.type);this.label.show(i,t)}}onUnhover(){this.label.hide(!0)}onClick(e){this.clickCallback&&this.clickCallback(e.data,e.type)}measure(){this.layout=Ja(this.element),this.updatePlotBounds()}updatePlotBounds(){this.plotBounds={left:this.padding.left,right:this.layout.innerWidth-this.padding.right,top:this.padding.top,bottom:this.layout.innerHeight-this.padding.bottom}}initializeCSSProperties(){this.padding={left:this.cssPixelProp("padding-left",0),right:this.cssPixelProp("padding-right",0),top:this.cssPixelProp("padding-top",0),bottom:this.cssPixelProp("padding-bottom",0)}}refreshStyle(){return this.initializeCSSProperties(),this}cssPixelProp(e,t){return Cr(this.element,`esc-${this.widgetId}-${e}`,t)}cssTimeProp(e,t){return Ir(this.element,`esc-${this.widgetId}-${e}`,t)}cssNumberProp(e,t){return Nr(this.element,`esc-${this.widgetId}-${e}`,t)}cssNumbersProp(e,t){return zr(this.element,`esc-${this.widgetId}-${e}`,t)}cssBooleanProp(e,t){return kr(this.element,`esc-${this.widgetId}-${e}`,t)}cssStringProp(e,t){return Er(this.element,`esc-${this.widgetId}-${e}`,t)}}var Ih,Mh,zh,Ah,Th,Lh,$h;!function(e){e.horizontal="horizontal",e.vertical="vertical",e.radial="radial"}(Ih||(Ih={}));class Oh{constructor(e){this.element=e.element,this.animationProvider=()=>this.getAnimation(),this.dataColor=void 0}setColor(e){return this.color=e||void 0,this}getColor(){return this.color}setData(e){if(void 0===e)return this;if(null!=e&&!Number.isFinite(e))throw new Error("Color manager must have finite value.");return this.data=e,this}getAnimationProvider(){return this.animationProvider}getAnimation(){let e=void 0;return null!=this.data&&(e=this.color&&Fr(this.color(this.data),this.element)||null),(t,i)=>e!==this.dataColor&&(void 0===this.dataColor?(this.element.style.setProperty("--esc-gauge-color",(this.dataColor=e)||null),!1):void 0===e?(i.last&&this.element.style.setProperty("--esc-gauge-color",(this.dataColor=e)||null),!0):!(t>.5||i.last)||(this.element.style.setProperty("--esc-gauge-color",this.dataColor=e),!1))}}!function(e){e.smooth="smooth",e.bounce="bounce",e.jitter="jitter",e.random="random",e.none="none"}(Mh||(Mh={}));class Dh extends Ch{constructor(e){super(e,"gauge")}initialize(e){this.wrapper=we(this.element,".esc-c-chart-wrapper",HTMLElement),this.chart=we(this.element,".esc-c-chart",HTMLElement),super.initialize(e),this.ranges=null,this.value=null,this._minMax={min:null,max:null};let t=fl("numericFormats");this.defaultFormat=(e,i)=>t.number(e,i),this.axis=this.makeAxis(),this.initializeSoundManager(e.enableSound),this.colorManager=new Oh({element:this.element}),this.initializeManagers(),this.initializeAnimator(),this.setAnimationEffect(e.animationEffect||Mh.smooth),this.setSoundFile("data","smooth")}initializeLabel(e){}preventMoveEvent(e){return!0}onUnhover(){}mouseEvent2UserEvent(e){}makeAxis(){return new wh({parent:this.chart,type:this.getAxisType()})}getAxisType(){switch(this.layoutType){case Ih.radial:return lh.radial;case Ih.vertical:return lh.right;case Ih.horizontal:default:return lh.top}}setFormat(e){return this.setFormatAux(e)&&this.redraw(!0),this}setFormatAux(e){let t=!1;null!=(e=e||{}).nullValue&&e.nullValue!==this.dialManager.getNullValue()&&(this.dialManager.setNullValue(e.nullValue),null===this.value&&(t=!0)),void 0!==e.precision&&Ci(e.precision)!==this.precision&&(this.precision=Ci(e.precision),t=!0);let i=kl(e.tickFormat),n=function(e){if(null==e)return e;if("string"!=typeof e)return e;if(gl(e)){return wl(e)}let t=Ke(["datum"],e,"numeric formatter");return e=>et(t,[e])}(e.counterFormat);void 0!==i&&(this.tickFormat=i||void 0,t=!0),void 0!==n&&(void 0===this.tickFormat&&(this.tickFormat=n||void 0),this.counterManager.setFormat(n),t=!0);let s=function(e){if(null==e)return e;if("string"!=typeof e)return e;let t=Ke(["datum"],e,"label");return e=>et(t,[e])}(e.label);if(void 0!==s&&(this.counterManager.setLabel(s),t=!0),void 0!==e.ranges){let i=function(e){if(null==e)return e;let t=[],i=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){let s,r=e[n],o=r.color;if("low"in r){if(null==r.low||Number.isNaN(r.low))throw new Error("Range low must not be undefined, null or NaN.");i=r.low}if("high"in r){if(null==r.high||Number.isNaN(r.high))throw new Error("Range high must not be undefined, null or NaN.");s=r.high}else if(n+1<e.length){if(r=e[n+1],!("low"in r))throw new Error("Range subsequent to missing high must define a low.");if(null==r.low||Number.isNaN(r.low))throw new Error("Range low must not be undefined, null or NaN.");s=r.low}else s=Number.POSITIVE_INFINITY;if(i!==s){if(s<i)throw new Error(`Range low must not exceed high: ${i} > ${s}`);o&&t.push({low:i,high:s,color:o}),i=s}}return t.length?t:null}(e.ranges);if(!Ii(this.ranges,i)){this.ranges=i;let e=function(e){return null==e?e:t=>{for(let i of e){if(t<i.low)return null;if(i.low<=t&&t<=i.high)return i.color}return null}}(this.ranges);this.colorManager.setColor(e);let n=this.ranges&&this.ranges.map((e,t)=>Object.assign({id:t},e));this.regionManager.setData(n),t=!0}}return t}updateAxis(){let e=this.niceRange(this.minMax());return this.updateScale(e),this.makeTicks(e)}makeTicks(e){let t=new Map;if(null==e||!this.showTicks)return t;let i=this.makeProtoTicks(e),n=this.axis.measureLabels(i.values());if(!(n.max.width<=this.maxTickWidth&&n.max.height<=this.maxTickHeight))return t;for(let[e,n]of i.entries())t.set(e,{label:n,position:this.value2TickPosition(e),selected:!1});return t}makeProtoTicks(e){let t=new Map;if(null==e||!this.showTicks)return t;let i=v(e.min,e.step,e.max,!0);for(let e of i){let i=b(e),n=(this.tickFormat||this.defaultFormat)(i,-e.power)||"";t.set(i,n)}return t}value2TickPosition(e){let t=this.value2position(e);switch(this.layoutType){case Ih.radial:return pr(vr([this.getSize()+2*this.axis.tickPadding,t]),this.getOrigin());case Ih.vertical:return[this.plotBounds.right,t];case Ih.horizontal:default:return[t,this.plotBounds.top]}}niceRange(e){if(!e)return null;let t;switch(this.layoutType){case Ih.radial:t=(this.endAngle-this.startAngle)/360*Math.PI*Math.min(this.plotBounds.right-this.plotBounds.left,this.plotBounds.bottom-this.plotBounds.top)/this.maxTickWidth+1;break;case Ih.vertical:t=(this.plotBounds.bottom-this.plotBounds.top)/this.maxTickHeight+1;break;case Ih.horizontal:default:t=(this.plotBounds.right-this.plotBounds.left)/this.maxTickWidth+1}return eh(e,Math.max(1,Math.floor(t)),null==this.precision?void 0:-this.precision)}updateScale(e){let t=e&&{min:b(e.min),max:b(e.max)};this.scale=t?new rh({scale:Cl,domain:t}):void 0}getStage(){return{value2position:e=>this.value2position(e),stageBounds:()=>this.plotBounds,origin:()=>this.getOrigin(),size:()=>this.getSize()}}updatePlotBounds(){switch(super.updatePlotBounds(),this.layoutType){case Ih.radial:this.plotBounds.left+=this.maxTickHeight,this.plotBounds.right-=this.maxTickHeight,this.plotBounds.top+=this.maxTickHeight,this.plotBounds.bottom-=this.maxTickHeight;break;case Ih.vertical:this.plotBounds.top+=this.maxTickHeight/2,this.plotBounds.bottom-=this.maxTickHeight/2,this.plotBounds.right-=this.maxTickWidth;break;case Ih.horizontal:default:this.plotBounds.left+=this.maxTickWidth/2,this.plotBounds.right-=this.maxTickWidth/2,this.plotBounds.top+=this.maxTickHeight}}getSize(){switch(this.layoutType){case Ih.radial:return Math.min(this.plotBounds.right-this.plotBounds.left,this.plotBounds.bottom-this.plotBounds.top)/2;case Ih.vertical:return this.plotBounds.right-this.plotBounds.left;case Ih.horizontal:default:return this.plotBounds.bottom-this.plotBounds.top}}getOrigin(){switch(this.layoutType){case Ih.radial:return[(this.plotBounds.left+this.plotBounds.right)/2,(this.plotBounds.top+this.plotBounds.bottom)/2];case Ih.vertical:return[0,0];case Ih.horizontal:default:return[0,this.maxTickHeight]}}value2position(e){let t,i;switch(this.layoutType){case Ih.radial:t=(this.startAngle/180-.5)*Math.PI,i=(this.endAngle/180-.5)*Math.PI;break;case Ih.vertical:t=this.plotBounds.bottom,i=this.plotBounds.top;break;case Ih.horizontal:default:t=this.plotBounds.left,i=this.plotBounds.right}return e===Number.POSITIVE_INFINITY?i:this.scale&&e!==Number.NEGATIVE_INFINITY?or(t,i,this.scale.value2position(e)):t}minMax(){return null!=this._minMax.min&&null!=this._minMax.max?this._minMax:null}setData(e){if(void 0===e)return this;let t={min:void 0!==(e=e||{value:null,min:null,max:null,lines:null}).min?e.min:this._minMax.min,max:void 0!==e.max?e.max:this._minMax.max};if(void 0!==e.min&&(t.min=e.min),void 0!==e.max&&(t.max=e.max),null!=t.min&&null!=t.max)try{Qr(t,!0),this._minMax=t}catch(e){}else this._minMax=t;void 0!==e.lines&&this.lineManager.setData(e.lines),void 0!==e.value&&(this.value=e.value,this.counterManager.setData(e.value),this.colorManager.setData(e.value));let i=this.value;return null!=i&&null!=this._minMax.min&&i<this._minMax.min&&(i=this._minMax.min),null!=i&&null!=this._minMax.max&&this._minMax.max<i&&(i=this._minMax.max),this.dialManager.setData(i),this.redraw(!0),null!=e.value&&this.soundManager.play(),this}initializeSoundManager(e){this.soundManager=new nh({baseUrl:`/static/${sh}/TBD/js/assets/sounds/${this.widgetId}/`}).setEnabled(!0===e)}setEnableSound(e){return this.soundManager.setEnabled(e),this}getEnableSound(){return this.soundManager.getEnabled()}setSoundFile(e,t){this.soundManager.setUrl(t&&`${e}/${t}.mp3`)}initializeAnimator(){this.isAnimating=!1,this.animator=new Qa({lifecycleCallback:e=>{e.last&&(this.isAnimating=!1)},destroyable:this.element}),this.axisManager=new oh({axis:this.axis}),this.animator.onAnimation(this.axisManager.getAnimationProvider()).onAnimation(this.backgroundManager.getAnimationProvider()).onAnimation(this.regionManager.getAnimationProvider()).onAnimation(this.lineManager.getAnimationProvider()).onAnimation(this.dialManager.getAnimationProvider()).onAnimation(this.counterManager.getAnimationProvider()).onAnimation(this.colorManager.getAnimationProvider())}setAnimationEffect(e){return this.dialManager.setAnimationEffect(e),this}getAnimationEffect(){return this.dialManager.getAnimationEffect()}resize(){this.measure(),this.redraw()}measure(){this.layout=Ja(this.chart),this.updatePlotBounds()}redraw(e){void 0!==e&&(this.isAnimating=e);let t=this.updateAxis();this.axisManager.setData({ticks:t,rotated:!1,color:null});let i=this.isAnimating?this.animationDuration:0;this.animator.update(i)}refreshStyle(){return super.refreshStyle(),this.axis.setType(this.getAxisType()),this.backgroundManager.refreshStyle(),this.regionManager.refreshStyle(),this.lineManager.refreshStyle(),this.dialManager.refreshStyle(),this.counterManager.refreshStyle(),this.measure(),this.redraw(!1),this}initializeCSSProperties(){super.initializeCSSProperties(),this.animationDuration=this.cssTimeProp("animation-duration",700),this.layoutType=Mt(this.cssStringProp("layout",Ih.horizontal),Ih,Ih.horizontal),this.showTicks=this.cssBooleanProp("show-ticks",!0),this.maxTickWidth=this.cssPixelProp("tick-max-width",20),this.maxTickHeight=this.cssPixelProp("tick-max-height",20),this.startAngle=this.cssPixelProp("start-angle",0),this.endAngle=this.cssPixelProp("end-angle",360)}}class Ph{constructor(e){this.initialize(e)}initialize(e){this.element=e.element,this.styleId=e.styleId,this.type=e.type,this.animationProvider=()=>this.getAnimation(),this.initializeCssProperties()}getType(){return this.type}getAnimationProvider(){return this.animationProvider}refreshStyle(){return this.initializeCssProperties(),this}initializeCssProperties(){}resolveColor(e){return Fr(e,this.element)}cssNumberProp(e,t){return Nr(this.element,`esc-${this.styleId}-${e}`,t)}cssPixelProp(e,t){return Cr(this.element,`esc-${this.styleId}-${e}`,t)}cssPixelsProp(e,t){return function(e,t,i){let n=Mr(e,t);if(null==n)return i;try{return n.map(xr)}catch(e){throw new Error(`Failed to parse custom CSS property '${t}' as pixel array: '${n.join()}'`)}}(this.element,`esc-${this.styleId}-${e}`,t)}cssTimeProp(e,t){return Ir(this.element,`esc-${this.styleId}-${e}`,t)}cssTimesProp(e,t){return function(e,t,i){let n=Mr(e,t);if(null==n)return i;try{return n.map(Sr)}catch(e){throw new Error(`Failed to parse custom CSS property '${t}' as time array: '${n.join()}'`)}}(this.element,`esc-${this.styleId}-${e}`,t)}cssNumbersProp(e,t){return zr(this.element,`esc-${this.styleId}-${e}`,t)}cssBooleanProp(e,t){return kr(this.element,`esc-${this.styleId}-${e}`,t)}cssStringProp(e,t){return Er(this.element,`esc-${this.styleId}-${e}`,t)}cssStringsProp(e,t){return Mr(this.element,`esc-${this.styleId}-${e}`,t)}}function _h(e,t){return Ro(function(e,t){if(e.value===t.value&&e.opacity===t.opacity)return;let i;i=e.value===t.value||null==t.value?()=>e.value:null==e.value?()=>t.value:Bo(e.value,t.value);return Vo({value:i,opacity:Bo(e.opacity,t.opacity)})}(e,t),{easing:uh})}class Fh extends Ph{constructor(e){super(e),this.data=null,this.state={value:null,opacity:0}}setFormat(e){return this.format=e||void 0,this}getFormat(){return this.format||(e=>fl("numericFormats").number(e))}setLabel(e){return this.label=e||void 0,this}getLabel(){return this.label}setData(e){if(void 0===e)return this;if(null!=e&&!Number.isFinite(e))throw new Error("Counter must have finite value.");return this.data=e,this}getAnimation(){let e={value:this.data,opacity:null==this.data?0:1},t=_h(this.state,e);return(i,n)=>{if(!t)return!1;this.state=n.last?e:t(i);let s=this.state2change(this.state);return this.counter.update(s),!0}}state2change(e){let t=null,i=null;return null!=e.value&&(t=this.format&&this.format(e.value)||null,i=this.label&&this.label(e.value)||null),{value:t,label:i,opacity:e.opacity}}}class Rh{constructor(e){this.counter=mt('<span class="esc-c-counter" style="opacity: 0;"/>').appendTo(mt(e.parent)),this.value=mt('<span class="esc-c-value"/>').appendTo(this.counter),this.indicator=mt('<span class="esc-c-indicator"/>').appendTo(this.counter),this.state={},this.update(Object.assign({value:null,label:null,opacity:0},e.state))}getState(){return ki(this.state)}update(e){if(null!=e){let t=this.state;void 0===e.value||Ii(t.value,e.value,zi)||Tt(t.value=ki(e.value),this.value),void 0===e.label||Ii(t.label,e.label,zi)||Tt(t.label=ki(e.label),this.indicator),null!=e.opacity&&t.opacity!==e.opacity&&this.counter.css("opacity",t.opacity=e.opacity)}return this}}class Bh extends Fh{constructor(e){super(e),this.counter=new Rh({parent:e.parent})}}class Hh{makeCallback(e,t,i){if(void 0===e){if(void 0===t)throw new Error("Effect must have defined start or end point.");return gh(this.makeEntryCallback(t,i),t)}return void 0===t?this.makeExitCallback(e,i):this.makeTransitionCallback(e,t,i)}}function jh(e,t){let i=!0;return n=>{if(i){if(i=!1,!e)return t;let s=e(n),r=Object.assign({},t);for(let e of Object.keys(s)){let t=s[e];void 0!==t&&(r[e]=t)}return r}return e&&e(n)}}!function(e){e.inOnly="in",e.outOnly="out",e.mixed="out-in"}(zh||(zh={}));class qh extends Hh{constructor(e){super(),this.mode=e.mode}makeEntryCallback(e,t){let i=this.makeEntryTween(e,t);return this.mode===zh.inOnly?i:_o(i,.55)}makeExitCallback(e,t){let i=this.makeExitTween(e,t);return this.mode===zh.outOnly?i:Fo(i,.45)}makeTransitionCallback(e,t,i){if(this.mode!==zh.mixed)throw new Error(`UnsupportedOperationException: No transition for in-out effect in mode '${this.mode}'.`);return Xo([{tween:this.makeExitTween(e,i),duration:.5},{duration:.5,tween:jh(this.makeEntryTween(t,i),t)}])}}class Uh extends Ph{constructor(e){super(e)}initialize(e){this.data=new Map,this.effect=new ph({create:(e,t)=>this.createComponent(e,t),effects:(e,t,i)=>this.transitionState(e,t,i)}),super.initialize(e)}getData(){return this.data.values()}getNoData(){return this.data.size}getDataIds(){return Array.from(this.data.keys())}getDatum(e){return this.data.get(e)}getComponents(){return this.effect.getComponents()}getComponent(e){return this.effect.getComponent(e)}getNoComponents(){return this.effect.getNoComponents()}getInOutEffectMode(){return 0===this.data.size?zh.outOnly:0===this.effect.getNoComponents()?zh.inOnly:zh.mixed}getAnimation(){let e=this.makeStates();return this.effect.animate(e)}makeStates(){let e=new Map;for(let t of this.data.values()){let i=this.datum2state(t);null!=i&&e.set(t.id,i)}return e}}function Zh(e,t){if(void 0===e){if(void 0===t)throw new Error("Effect must have defined start or end point.");return gh(function(e){return Ro(Vo({opacity:Bo(0,e.opacity)}),{duration:.8})}(t),t)}return void 0===t?function(e){return Ro(Vo({opacity:Bo(e.opacity,0)}),{easing:ch})}(e):function(e,t){if(e.layout!==t.layout){let i=Ro(Vo({opacity:Bo(e.opacity,0)}),{easing:ch}),n=Vo({layout:()=>t.layout,start:()=>t.start,end:()=>t.end,size:()=>t.size,offset:()=>t.offset,origin:()=>t.origin,color:()=>t.color,opacity:Bo(0,t.opacity)});return i&&n?Xo([{tween:i,duration:.5},{tween:n,duration:.5}]):i||n}return Ro(Vo({start:jo(e.start,t.start),end:jo(e.end,t.end),size:jo(e.size,t.size),offset:jo(e.offset,t.offset),origin:Zo(e.origin,t.origin),color:Ko(e.color,t.color,.5),opacity:jo(e.opacity,t.opacity)}),{easing:uh})}(e,t)}class Yh extends Uh{constructor(e){super(e)}initialize(e){this.stage=e.stage,super.initialize(e)}setData(e){throw new Error("Setting data is unsupported.")}transitionState(e,t){return Zh(e,t)}datum2state(e){let t=this.stage.size(),i=this.stage.value2position(Number.NEGATIVE_INFINITY),n=this.stage.value2position(Number.POSITIVE_INFINITY);return{layout:this.layout,start:or(i,n,e.low),end:or(i,n,e.high),size:e.size*t,offset:e.offset*t,origin:this.stage.origin(),color:this.resolveColor(e.color)||null,opacity:1}}initializeCssProperties(){super.initializeCssProperties(),this.layout=Mt(this.cssStringProp("layout",Ih.horizontal),Ih,Ih.horizontal),this.backgroundLows=this.cssNumbersProp("background-lows",[]).filter(e=>null!=e),this.backgroundHighs=this.cssNumbersProp("background-highs",[]).filter(e=>null!=e),this.backgroundOffsets=this.cssNumbersProp("background-offset-ratios",[]).filter(e=>null!=e),this.backgroundSizes=this.cssNumbersProp("background-size-ratios",[]).filter(e=>null!=e);let e=this.backgroundLows.length;if(this.backgroundHighs.length!==e||this.backgroundOffsets.length!==e||this.backgroundSizes.length!==e)throw new Error("CSS background parameters must be lists of equal length.");this.data.clear();for(let t=0;t<e;t++){let e="_background-"+(t+1);this.data.set(e,{id:e,low:this.backgroundLows[t],high:this.backgroundHighs[t],offset:this.backgroundOffsets[t],size:this.backgroundSizes[t],color:null})}}}function Gh(e,t){return vr([e,t-To])}function Vh(e){let[t,i]=e,n=0!==t?Math.atan(i/t):i>=0?To:-To;return t<0&&(n+=Math.PI),n+=To,n}function Xh(e,t,i){return[Wh(e,t,!i),e]}function Wh(e,t,i){return(i?1:-1)*Math.sqrt(t*t-e*e)}function Kh(e){let{angles:t,outerRadius:i,innerRadius:n,origin:s}=e;if(t[0]>t[1])throw new Error(`Angle pair is invalid: ${t[0]}, ${t[1]}`);if(null!=n&&n>i)throw new Error(`Inner radius exceeds outer radius: : ${n} > ${i}`);if(t[0]===t[1]||0===i)return"";if(0===t[0]&&t[1]===Lo){let e,t,r=[0,i],o=[0,-i];s&&(r=pr(r,s),o=pr(o,s)),n&&(e=[0,n],t=[0,-n],s&&(e=pr(e,s),t=pr(t,s)));let l=`M ${r.join(" ")} A ${i} ${i} 0 0 1 ${o.join(" ")}`;return n&&(l+=` L ${t.join(" ")} A ${n} ${n} 0 0 0 ${e.join(" ")} L ${r.join(" ")} M ${o.join(" ")}`),l+=` A ${-i} ${i} 0 0 1 ${r.join(" ")}`,n&&(l+=` L ${e.join(" ")} A ${n} ${n} 0 0 0 ${t.join(" ")}`),l+=" z",l}{let e,r;t[1]-t[0]<=Math.PI?(e="0 1",r="0 0"):(e="1 1",r="1 0");let o=Gh(i,t[0]),l=Gh(i,t[1]);s&&(o=pr(o,s),l=pr(l,s));let a=`M ${o.join(" ")} A ${i} ${i} 0 ${e} ${l.join(" ")}`;return null!=n&&(n>0?(o=Gh(n,t[0]),l=Gh(n,t[1]),s&&(o=pr(o,s),l=pr(l,s)),a+=` L ${l.join(" ")} A ${n} ${n} 0 ${r} ${o.join(" ")}`):a+=s?` L ${s.join(" ")}`:" L 0 0",a+=" z"),a}}class Qh{constructor(e){this.group=e.group,this.id=e.id,this.styleProvider=e.style,this.region=document.createElementNS(re,"g"),this.region.classList.add("esc-c-region"),this.group.appendChild(this.region),this.leftDelimiter=document.createElementNS(re,"path"),this.leftDelimiter.classList.add("esc-c-left-delimiter"),this.region.appendChild(this.leftDelimiter),this.segment=document.createElementNS(re,"path"),this.segment.classList.add("esc-c-segment"),this.region.appendChild(this.segment),this.rightDelimiter=document.createElementNS(re,"path"),this.rightDelimiter.classList.add("esc-c-right-delimiter"),this.region.appendChild(this.rightDelimiter),this.state={},this.update(Object.assign({layout:Ih.horizontal,start:0,end:0,size:0,offset:0,origin:[0,0],opacity:0,color:null},e.state))}getId(){return this.id}getState(){return Object.assign({},this.state,{origin:hr(this.state.origin)})}update(e){if(null!=e){let t=this.state,i=!1;if(null!=e.layout&&t.layout!==e.layout&&(t.layout=e.layout,i=!0),null!=e.start&&t.start!==e.start&&(t.start=e.start,i=!0),null!=e.end&&t.end!==e.end&&(t.end=e.end,i=!0),null!=e.size&&t.size!==e.size&&(t.size=e.size,i=!0),null!=e.offset&&t.offset!==e.offset&&(t.offset=e.offset,i=!0),null==e.origin||ur(t.origin,e.origin)||(t.origin=hr(e.origin),i=!0),i){let e="",i="",n="";if(0!==t.size&&t.start!==t.end)switch(t.layout){case Ih.radial:e=Kh({angles:[t.start+To,t.end+To],outerRadius:t.offset+t.size,innerRadius:t.offset,origin:t.origin});let s=pr(vr([t.offset,t.start]),t.origin),r=pr(vr([t.offset+t.size,t.start]),t.origin);i=`M ${s.join(" ")} L ${r.join(" ")}`,s=pr(vr([t.offset,t.end]),t.origin),r=pr(vr([t.offset+t.size,t.end]),t.origin),n=`M ${s.join(" ")} L ${r.join(" ")}`;break;case Ih.vertical:let o=t.offset,l=t.offset+t.size;e=`M ${o} ${t.start} L ${o} ${t.end} L ${l} ${t.end} L ${l} ${t.start} z`,i=`M ${o} ${t.start} L ${l} ${t.start}`,n=`M ${o} ${t.end} L ${l} ${t.end}`;break;case Ih.horizontal:default:let a=t.offset+t.size+t.origin[1],h=t.offset+t.origin[1];e=`M ${t.start} ${h} L ${t.end} ${h} L ${t.end} ${a} L ${t.start} ${a} z`,i=`M ${t.start} ${a} L ${t.start} ${h}`,n=`M ${t.end} ${a} L ${t.end} ${h}`}this.segment.setAttribute("d",e),this.leftDelimiter.setAttribute("d",i),this.rightDelimiter.setAttribute("d",n)}null!=e.opacity&&t.opacity!==e.opacity&&(this.region.style.opacity=(t.opacity=e.opacity).toString()),null!=e.color&&t.color!==e.color&&this.region.style.setProperty("--esc-gauge-region-color",t.color=e.color)}return this}remove(){return this.region.parentNode&&this.region.parentNode.removeChild(this.region),this}}class Jh extends Yh{constructor(e){super(e),this.group=e.group}createComponent(e,t){return new Qh({group:this.group,style:()=>({}),id:e,state:t})}}function eu(e){return Vo({layout:()=>e.layout,position:()=>e.position,size:()=>e.size,offset:()=>e.offset,origin:()=>e.origin,bandStart:()=>e.bandStart,bandEnd:()=>e.bandEnd,bandSize:()=>e.bandSize,bandOffset:()=>e.bandOffset,opacity:Bo(0,e.opacity)})}function tu(e){return Ro(Vo({opacity:Bo(e.opacity,0)}),{easing:ch})}function iu(e,t){if(!Number.isNaN(e.position)||!Number.isNaN(t.position)){if(Number.isNaN(e.position))return Ro(eu(t),{duration:.8});if(Number.isNaN(t.position))return tu(e);if(e.layout!==t.layout){let i=tu(e),n=eu(t);return i&&n?Xo([{tween:i,duration:.5},{tween:n,duration:.5}]):i||n}return Vo({position:jo(e.position,t.position),size:jo(e.size,t.size),offset:jo(e.offset,t.offset),origin:Zo(e.origin,t.origin),bandStart:jo(e.bandStart,t.bandStart),bandEnd:jo(e.bandEnd,t.bandEnd),bandSize:jo(e.bandSize,t.bandSize),bandOffset:jo(e.bandOffset,t.bandOffset),opacity:jo(e.opacity,t.opacity)})}}class nu{makeTween(e,t){return function(e,t){return Ro(iu(e,t),{easing:mh})}(e,t)}}class su{makeTween(e,t){return function(e,t){return Ro(iu(e,t),{easing:dh})}(e,t)}}class ru{makeTween(e,t){return function(e,t){return Ro(iu(e,t),{easing:uh})}(e,t)}}class ou{constructor(){let e=3*Math.random();this.effect=e<=1?new nu:e<=2?new su:new ru}makeTween(e,t){return this.effect.makeTween(e,t)}}class lu extends Ph{constructor(e){super(e),this.stage=e.stage,this.animationEffect=Mh.smooth}getNullValue(){return this.nullValue}setNullValue(e){return this.nullValue=e||void 0,this}setData(e){if(void 0===e)return this;if(null!=e&&!Number.isFinite(e))throw new Error("Dial must have finite value.");return this.data=e,this}setAnimationEffect(e){return this.animationEffect=e,this}getAnimationEffect(){return this.animationEffect}transitionState(e,t){return this.makeRenderEffect().makeTween(e,t)}makeRenderEffect(){return this.animationEffect===Mh.random?new ou:this.animationEffect===Mh.bounce?new nu:this.animationEffect===Mh.jitter?new su:new ru}getAnimation(){let e=this.data2state(),t=this.transitionState(this.dial.getState(),e);return(e,i)=>{if(!t)return!1;let n=t(e);return this.dial.update(n),!0}}data2state(){let e=this.stage.size();return{layout:this.layout,position:null!=this.data?this.stage.value2position(this.data):null!=this.nullValue?this.stage.value2position(this.nullValue):Number.NaN,size:this.size*e,offset:this.offset*e,origin:this.stage.origin(),bandStart:this.stage.value2position(Number.NEGATIVE_INFINITY),bandEnd:this.stage.value2position(Number.POSITIVE_INFINITY),bandSize:this.bandSize*e,bandOffset:this.bandOffset*e,opacity:null==this.data&&null==this.nullValue?0:1}}initializeCssProperties(){super.initializeCssProperties(),this.layout=Mt(this.cssStringProp("layout",Ih.horizontal),Ih,Ih.horizontal),this.offset=this.cssNumberProp("pointer-offset-ratio",0),this.size=this.cssNumberProp("pointer-size-ratio",1),this.bandOffset=this.cssNumberProp("band-offset-ratio",0),this.bandSize=this.cssNumberProp("band-size-ratio",1)}}class au{constructor(e){this.styleProvider=e.style,this.pointer=document.createElementNS(re,"path"),this.pointer.classList.add("esc-c-pointer"),e.dialParent.appendChild(this.pointer),this.bands=e.bandParent,this.left=document.createElementNS(re,"path"),this.left.classList.add("esc-c-left"),this.bands.appendChild(this.left),this.right=document.createElementNS(re,"path"),this.right.classList.add("esc-c-right"),this.bands.appendChild(this.right),this.state={},this.update(Object.assign({layout:Ih.horizontal,position:Number.NaN,size:0,offset:0,bandStart:0,bandEnd:0,bandSize:0,bandOffset:0,origin:[0,0],opacity:0},e.state))}getState(){return Object.assign({},this.state,{origin:hr(this.state.origin)})}update(e){if(null!=e){let t=this.state,i=!1,n=!1,s=!1;if(null!=e.layout&&t.layout!==e.layout&&(t.layout=e.layout,i=!0,n=!0,s=!0),null!=e.position&&t.position!==e.position&&(t.position=e.position,i=!0,n=!0,s=!0),null!=e.size&&t.size!==e.size&&(t.size=e.size,i=!0),null!=e.offset&&t.offset!==e.offset&&(t.offset=e.offset,i=!0),null!=e.bandStart&&t.bandStart!==e.bandStart&&(t.bandStart=e.bandStart,n=!0),null!=e.bandEnd&&t.bandEnd!==e.bandEnd&&(t.bandEnd=e.bandEnd,s=!0),null!=e.bandSize&&t.bandSize!==e.bandSize&&(t.bandSize=e.bandSize,n=!0,s=!0),null!=e.bandOffset&&t.bandOffset!==e.bandOffset&&(t.bandOffset=e.bandOffset,n=!0,s=!0),null==e.origin||ur(t.origin,e.origin)||(t.origin=hr(e.origin),i=!0,n=!0,s=!0),i){let e="";if(!Number.isNaN(t.position)&&t.size>0){let i,n;switch(t.layout){case Ih.radial:i=pr(vr([t.offset,t.position]),t.origin),n=pr(vr([t.offset+t.size,t.position]),t.origin);break;case Ih.vertical:i=[t.offset,t.position],n=[t.offset+t.size,t.position];break;case Ih.horizontal:default:i=pr([t.position,t.offset],t.origin),n=pr([t.position,t.offset+t.size],t.origin)}e=`M ${i[0]}, ${i[1]} L ${n[0]}, ${n[1]}`}this.pointer.setAttribute("d",e)}if(n){let e="";if(!Number.isNaN(t.position)&&t.bandSize>0)switch(t.layout){case Ih.radial:e=t.position<=t.bandStart?"":Kh({angles:[t.bandStart+To,t.position+To],outerRadius:t.bandOffset+t.bandSize,innerRadius:t.bandOffset,origin:t.origin});break;case Ih.vertical:let i=t.bandOffset,n=t.bandOffset+t.bandSize;e=`M ${i}, ${t.bandStart} L ${i}, ${t.position} L ${n}, ${t.position} L ${n}, ${t.bandStart} z`;break;case Ih.horizontal:default:let s=t.bandOffset+t.bandSize+t.origin[1],r=t.bandOffset+t.origin[1];e=`M ${t.bandStart}, ${r} L ${t.position}, ${r} L ${t.position}, ${s} L ${t.bandStart}, ${s} z`}this.left.setAttribute("d",e)}if(s){let e="";if(!Number.isNaN(t.position)&&t.bandSize>0)switch(t.layout){case Ih.radial:e=t.position>=t.bandEnd?"":Kh({angles:[t.position+To,t.bandEnd+To],outerRadius:t.bandOffset+t.bandSize,innerRadius:t.bandOffset,origin:t.origin});break;case Ih.vertical:let i=t.bandOffset,n=t.bandOffset+t.bandSize;e=`M ${i}, ${t.position} L ${i}, ${t.bandEnd} L ${n}, ${t.bandEnd} L ${n}, ${t.position} z`;break;case Ih.horizontal:default:let s=t.bandOffset+t.bandSize+t.origin[1],r=t.bandOffset+t.origin[1];e=`M ${t.position}, ${r} L ${t.bandEnd}, ${r} L ${t.bandEnd}, ${s} L ${t.position}, ${s} z`}this.right.setAttribute("d",e)}if(null!=e.opacity&&t.opacity!==e.opacity){let i=(t.opacity=e.opacity).toString();this.bands.style.opacity=i,this.pointer.style.opacity=i}}return this}}class hu extends lu{constructor(e){super(e),this.dial=new au({dialParent:e.dialParent,bandParent:e.bandParent,style:()=>({})})}}function uu(e,t){if(void 0===e){if(void 0===t)throw new Error("Effect must have defined start or end point.");return gh(function(e){return Ro(Vo({opacity:Bo(0,e.opacity)}),{duration:.8})}(t),t)}return void 0===t?function(e){return Ro(Vo({opacity:Bo(e.opacity,0)}),{easing:ch})}(e):function(e,t){if(e.layout!==t.layout){let i=Ro(Vo({opacity:Bo(e.opacity,0)}),{easing:ch}),n=Vo({layout:()=>t.layout,position:()=>t.position,size:()=>t.size,offset:()=>t.offset,origin:()=>t.origin,style:()=>t.style,color:()=>t.color,opacity:Bo(0,t.opacity)});return i&&n?Xo([{tween:i,duration:.5},{tween:n,duration:.5}]):i||n}return Ro(Vo({position:jo(e.position,t.position),size:jo(e.size,t.size),offset:jo(e.offset,t.offset),origin:Zo(e.origin,t.origin),style:Ko(e.style,t.style,.5),color:Ko(e.color,t.color,.5),opacity:jo(e.opacity,t.opacity)}),{easing:uh})}(e,t)}!function(e){e.none="none",e.solid="solid",e.dashed="dashed",e.dotted="dotted"}(Ah||(Ah={}));class cu extends Uh{constructor(e){super(e),this.stage=e.stage}setData(e){if(void 0===e)return this;this.data.clear();for(let t of e||[]){if(void 0===t.id)throw new Error(`Line must not have undefined id: ${u(t)}`);if(this.data.has(t.id))throw new Error(`Line id must be unique: ${u(t.id)}`);if(!Number.isFinite(t.value))throw new Error(`Line ${u(t.id)} must have finite value.`);this.data.set(t.id,ki(t))}return this}transitionState(e,t){return uu(e,t)}datum2state(e){let t=this.stage.size();return{layout:this.layout,position:this.stage.value2position(e.value),size:this.size*t,offset:this.offset*t,origin:this.stage.origin(),style:e.style||Ah.solid,color:this.resolveColor(e.color)||null,opacity:1}}initializeCssProperties(){super.initializeCssProperties(),this.layout=Mt(this.cssStringProp("layout",Ih.horizontal),Ih,Ih.horizontal),this.offset=this.cssNumberProp("line-offset-ratio",0),this.size=this.cssNumberProp("line-size-ratio",1)}}class du{constructor(e){this.group=e.group,this.id=e.id,this.styleProvider=e.style,this.line=document.createElementNS(re,"path"),this.line.classList.add("esc-c-line"),this.group.appendChild(this.line),this.state={},this.update(Object.assign({layout:Ih.horizontal,position:0,size:0,offset:0,origin:[0,0],style:Ah.solid,opacity:0,color:null},e.state))}getId(){return this.id}getState(){return Object.assign({},this.state,{origin:hr(this.state.origin)})}update(e){if(null!=e){let t=this.state,i=!1;if(null!=e.layout&&t.layout!==e.layout&&(t.layout=e.layout,i=!0),null!=e.position&&t.position!==e.position&&(t.position=e.position,i=!0),null!=e.size&&t.size!==e.size&&(t.size=e.size,i=!0),null!=e.offset&&t.offset!==e.offset&&(t.offset=e.offset,i=!0),null==e.origin||ur(t.origin,e.origin)||(t.origin=hr(e.origin),i=!0),i){let e;if(0===t.size)e="";else{let i,n;switch(t.layout){case Ih.radial:i=pr(vr([t.offset,t.position]),t.origin),n=pr(vr([t.offset+t.size,t.position]),t.origin);break;case Ih.vertical:i=[t.offset,t.position],n=[t.offset+t.size,t.position];break;case Ih.horizontal:default:i=pr([t.position,t.offset],t.origin),n=pr([t.position,t.offset+t.size],t.origin)}e=`M ${i.join(" ")} L ${n.join(" ")}`}this.line.setAttribute("d",e)}null!=e.style&&t.style!==e.style&&(this.line.classList.remove(`esc-m-style-${t.style}`),t.style=e.style,this.line.classList.add(`esc-m-style-${t.style}`)),null!=e.opacity&&t.opacity!==e.opacity&&(this.line.style.opacity=(t.opacity=e.opacity).toString()),null!=e.color&&t.color!==e.color&&this.line.style.setProperty("--esc-gauge-line-color",t.color=e.color)}return this}remove(){return this.line.parentNode&&this.line.parentNode.removeChild(this.line),this}}class fu extends cu{constructor(e){super(e),this.group=e.group}createComponent(e,t){return new du({group:this.group,style:()=>({}),id:e,state:t})}}class mu extends Uh{constructor(e){super(e)}initialize(e){this.stage=e.stage,super.initialize(e)}setData(e){if(void 0===e)return this;this.data.clear();for(let t of e||[]){if(void 0===t.id)throw new Error(`Region must not have undefined id: ${u(t)}`);if(this.data.has(t.id))throw new Error(`Region id must be unique: ${u(t.id)}`);if(null==t.low||Number.isNaN(t.low)||null==t.high||Number.isNaN(t.high))throw new Error(`Region ${u(t.id)} must have non-null and non-NaN low and high: ${u(t)}`);this.data.set(t.id,ki(t))}return this}transitionState(e,t){return Zh(e,t)}datum2state(e){let t=this.stage.size();return{layout:this.layout,start:this.stage.value2position(e.low),end:this.stage.value2position(e.high),size:this.size*t,offset:this.offset*t,origin:this.stage.origin(),color:this.resolveColor(e.color)||null,opacity:1}}initializeCssProperties(){super.initializeCssProperties(),this.layout=Mt(this.cssStringProp("layout",Ih.horizontal),Ih,Ih.horizontal),this.offset=this.cssNumberProp("region-offset-ratio",0),this.size=this.cssNumberProp("region-size-ratio",1)}}class pu extends mu{constructor(e){super(e),this.group=e.group}createComponent(e,t){return new Qh({group:this.group,style:()=>({}),id:e,state:t})}}class gu extends Dh{initializeManagers(){this.createSVG(),this.backgroundManager=new Jh({element:this.element,styleId:"gauge",type:"background",group:this.backgrounds,stage:this.getStage()}),this.regionManager=new pu({element:this.element,styleId:"gauge",type:"region",group:this.regions,stage:this.getStage()}),this.lineManager=new fu({element:this.element,styleId:"gauge",type:"line",group:this.lines,stage:this.getStage()}),this.dialManager=new hu({element:this.element,styleId:"gauge",type:"dial",dialParent:this.dial,bandParent:this.bands,stage:this.getStage()}),this.counterManager=new Bh({element:this.element,parent:this.wrapper,styleId:"gauge",type:"counter"})}createSVG(){this.chart.appendChild(this.svg=ae("<svg/>")),this.svg.appendChild(this.backgrounds=ae('<g class="esc-c-backgrounds"/>')),this.svg.appendChild(this.regions=ae('<g class="esc-c-regions"/>')),this.svg.appendChild(this.bands=ae('<g class="esc-c-bands"/>')),this.svg.appendChild(this.lines=ae('<g class="esc-c-lines"/>')),this.svg.appendChild(this.dial=ae('<g class="esc-c-dial"/>'))}redraw(e){super.redraw(e),this.svg.setAttribute("width",this.layout.innerWidth.toString()),this.svg.setAttribute("height",this.layout.innerHeight.toString())}}function bu(e,t){t=t||{};let i=si(e,"Gauge",HTMLElement);Gs(i,new gu({element:i,enableSound:t.enableSound,animationEffect:t.animationEffect}).setFormat(t.format||void 0).setData(t.data||void 0),t)}function wu(e){return Tn("esc.widgets.data.lazy-table.runtime")[e]}function vu(e){if(null==e)return yu;if("string"!=typeof e)return e;if(pl(e)){let t=wl(e);return e=>t(e)}let t=Ke(["datum"],e,"formatter");return e=>et(t,[e])}function yu(e){return function e(t,i=!1){if(null==t)return"";if(ie(t))return t;let n=typeof t;if("string"===n)return t;if("number"===n){return wu("format.number")(t)}if("boolean"===n)return wu("format.boolean")(t);if(Array.isArray(t)){let n=t.map(t=>e(t,!0)).join();return i&&(n="["+n+"]"),n}return t.toString()}(e,!1)}Th||(Th={}),bt("esc-gauge",bu),Th.init=bu,Lh||(Lh={}),function(e){e.none="none",e.row="row",e.cell="cell"}($h||($h={}));const xu="esc.widgets.data.lazy-table.LazyTableController";class Su extends Ms{constructor(e){super(e),this.updateDom=gs(()=>this._setControlSelection(this.selection)),this.counter=0}initialize(e){if(super.initialize(e),!e.idField)throw new Error("CompTable must have id field.");this.type=e.type,this.idField=e.idField;let t=function(e){let t=new Map;if(null!=e)for(let i of Object.keys(e)){let n=vu(e[i]);t.set(i,n)}return t}(e.columns);this.element.classList.contains("esc-m-cell-selectable")?this.selectionMode=$h.cell:this.element.classList.contains("esc-m-row-selectable")?this.selectionMode=$h.row:this.selectionMode=$h.none,this.stateless=!0===e.stateless,this.body=ge(this.element,"tbody",HTMLElement),this.columns=new Map,this.sort=new Map;let i=ge(this.element,"thead");for(let e of i.querySelectorAll("th")){let i=e.getAttribute("data-esc-id"),n=e.getAttribute("data-esc-variable-name")||i,s=t.get(i)||yu,r=[];e.classList.contains("esc-m-index")&&r.push("esc-m-index"),e.classList.contains("esc-m-text")&&r.push("esc-m-text"),e.classList.contains("esc-m-numeric")&&r.push("esc-m-numeric"),(e.classList.contains("esc-is-sort-asc")||null)&&(this.sort.set(i,{variable:n,direction:Pi.asc}),e.addEventListener("click",()=>{let t=this.toggleSort(i);e.classList.toggle("esc-is-sort-asc",t),e.classList.toggle("esc-is-sort-desc",!t),this.paginator.setSort(this.getSort())})),this.columns.set(i,{name:n,format:s,classes:r})}let n=2*Nr(this.element,"esc-table-no-rows",20),s=this.body.querySelector("tr.esc-c-previous");s.querySelector("td > .esc-icon-button").addEventListener("click",()=>this.previous());let r=this.body.querySelector("tr.esc-c-next");r.querySelector("td > .esc-icon-button").addEventListener("click",()=>this.next());let o=mt(r);this.paginator=new Ql({element:this.element,previousButton:s,nextButton:r,selectContent:()=>me(this.body,"tr.esc-c-row"),appendContent:e=>e.insertBefore(o),direction:Xl.vertical,lookup:e.lookup,itemFactory:e=>this.addRow(e),filter:e.filter,sort:this.getSort(),pageSize:n,stateful:!0}),Et(this.element,"both"),this.selectionMode!==$h.none&&(this.element.addEventListener("click",e=>this.selectElement(e.target)),this.element.addEventListener("keydown",e=>{switch(e.key){case"Enter":case" ":e.preventDefault(),this.selectElement(e.target)}})),this.navigableList=new Zl({element:this.element,model:()=>{let e=Array.from(this.body.querySelectorAll("tr.esc-c-row")).map(e=>Array.from(e.children));return new ql(e)},selector:(e,t,i)=>!0,direction:Hl.both,wrap:(e,t)=>t===jl.down?(this.paginator.next(),!1):t!==jl.up||(this.paginator.previous(),!1)}),this.paginator.next()}getRowId(e){let t=Me(e,xu+".row-id");if(!t)throw new se("Row has no id.");return t}getColumnId(e){let t=Array.from(e.parentElement.children).indexOf(e),i=Array.from(this.columns.keys())[t];if(!i)throw new se("Column has no id.");return i}toggleSort(e){let t=this.sort.get(e);if(!t)throw new Error(`Column '${e}' is not sortable.`);t=t.direction===Pi.asc?{variable:t.variable,direction:Pi.desc}:{variable:t.variable,direction:Pi.asc},this.sort.delete(e);let i=Array.from(this.sort.entries());return i.unshift([e,t]),this.sort=new Map(i),t.direction===Pi.asc}getSort(){return Array.from(this.sort.values())}selectElement(e){if(!(e instanceof Element)||e===this.element)return;let t=ve(e,"td",this.element);if(!t)return;let i=t.parentElement;if(!i.classList.contains("esc-c-row"))return;let n=[this.getRowId(i),this.getColumnId(t)];this.equalsSelection(n,this.selection)&&(n=void 0),this.setSelection(n)}validateSelection(e){if(null==e||this.selectionMode===$h.none)return;let t=e[0],i=e[1];if(!Array.isArray(e)||2!==e.length||typeof t!==this.type||"string"!=typeof i)throw new Error(`Selection must be 2-array of form [${this.type}, string]: ${e}`);if(!this.columns.has(i))throw new Error(`Column ${u(i)} not found.`);return[t,i]}equalsSelection(e,t){return null==e?null==t:null!=t&&Ai(e,t)}getSelection(){return this.selection&&this.selection.slice()}setSelection(e){return super.setSelection(e),this.stateless&&this._setSelection(void 0),this}_setSelection(e){super._setSelection(e),this.updateDom()}_setControlSelection(e){let t=Array.from(this.columns.keys()),i=e&&e[0],n=e&&e[1];for(let e of me(this.body,"tr.esc-c-row")){let s=null!=i&&this.getRowId(e)===i;if(e.classList.toggle(Ae,s),this.selectionMode===$h.cell)for(let i=0;i<e.childElementCount;i++)e.children.item(i).classList.toggle(Ae,s&&t[i]===n)}}addRow(e){let t,i=mt('<tr class="esc-c-row"/>');t=this.idField?e[this.idField]:this.type===bs.number?this.counter++:"row-"+this.counter++,t&&Ie(i.get(0),xu+".row-id",t),this.selection&&this.selection[0]===t&&i.addClass(Ae);for(let[n,s]of this.columns){let r=s.format(e[s.name]),o=mt('<td tabindex="0" />').appendTo(i);for(let e of s.classes)o.addClass(e);this.selection&&this.selection[0]===t&&this.selection[1]===n&&o.addClass(Ae),Tt(r,o)}return i}next(){return this.paginator.next(),this}previous(){return this.paginator.previous(),this}top(){return this.paginator.top(),this}getFilter(){return this.paginator.getFilter()}setFilter(e){return this.paginator.setFilter(e),this}}function Eu(e,t){let i,n=si(e,"LazyTable",HTMLElement);if(i="string"==typeof t.lookup?Re(t.lookup):t.lookup,!("lookup"in i))throw new Error(`Element '${t.lookup}' is not a IDataLookup.`);Vs(n,new Su(Object.assign({},t,{element:n,lookup:i})),t)}var ku,Nu;function Cu(e){if(null==e)return null;if("function"==typeof e)return e;{let t=new Set(e);return e=>t.has(e.id)}}function Iu(e){if(null==e)return null;if("function"==typeof e)return e;{let t=Array.from(e);return e=>t.indexOf(e.id)}}bt("esc-lazy-table",Eu),Lh.init=Eu,ku||(ku={});class Mu extends Ch{constructor(e,t){super(e,t)}initialize(e){super.initialize(e),this.initializeSoundManager(e.enableSound),this.initializeAnimator()}initializeSoundManager(e){this.soundManager=new nh({baseUrl:`/static/${sh}/TBD/js/assets/sounds/${this.widgetId}/`}).setEnabled(!0===e)}setEnableSound(e){return this.soundManager.setEnabled(e),this}getEnableSound(){return this.soundManager.getEnabled()}setSoundFile(e,t){this.soundManager.setUrl(t&&`${e}/${t}.mp3`)}initializeAnimator(){this.isAnimating=!1,this.animator=new Qa({lifecycleCallback:e=>{e.first&&this.onAnimationStart(),e.last&&this.onAnimationEnd()},destroyable:this.element})}onAnimationStart(){}onAnimationEnd(){this.isAnimating=!1}resize(){this.measure(),this.redraw()}redraw(e){void 0!==e&&(this.isAnimating=e);let t=this.isAnimating?this.getEffectiveDuration():0;this.animator.update(t)}getEffectiveDuration(){return this.animationDuration}refreshStyle(){return super.refreshStyle(),this.redraw(),this}initializeCSSProperties(){super.initializeCSSProperties(),this.animationDuration=this.cssTimeProp("animation-duration",700)}}class zu extends Mu{initialize(e){super.initialize(e),this.createSVG()}createSVG(){this.element.appendChild(this.svg=ae("<svg/>"))}redraw(e){super.redraw(e),this.svg.setAttribute("width",this.layout.innerWidth.toString()),this.svg.setAttribute("height",this.layout.innerHeight.toString())}}function Au(e,t){let{innerRadius:i,outerRadius:n,lineStartAngleRatio:s,lineStartRadius:r,lineEndRadius:o,lineOffset:l,highlightGap:a,gapRatio:h}=t;o<1.05*r&&(o=r);let u=0,c=[],d=[],f=[],m=[];for(let t of e){let e=t.level||0;if(u=Math.max(u,e+1),void 0===c[e]?c[e]=t.count:c[e]+=t.count,void 0===d[e]?d[e]=1:d[e]++,void 0===f[e]&&(f[e]=0),!0===t.hidden)continue;let i={angles:[0,0],innerRadius:0,outerRadius:0,lineStart:[0,0],lineEnd:[0,0],datum:t};m.push(i)}const p=Math.max(2*a,h*(n-i)/u),g=(n-i-(u-1)*p)/u;for(let e of m){let t=e.datum.level||0,a=c[t],h=d[t],m=f[t],b=a?e.datum.count:1;f[t]+=b,e.angles[0]=m/(a||h)*Lo,e.angles[1]=f[t]/(a||h)*Lo,e.outerRadius=n-t*(g+p),e.innerRadius=t===u-1?i:e.outerRadius-g,e.datum.label&&(e.lineStart[0]=1===u?r:e.outerRadius+Math.min(l,p/3),e.lineStart[1]=or(e.angles[0],e.angles[1],sr(s,0,1)),e.lineEnd[0]=b?o:e.lineStart[0],e.lineEnd[1]=e.lineStart[1])}return function(e,t){let{textHeight:i}=t;const n=e.length;e.sort((e,t)=>{let i=e.angles[1]-t.angles[1];return 0!==i?i:(t.datum.level||0)-(e.datum.level||0)});let s=new Array(n),r=Number.NEGATIVE_INFINITY,o=0;for(let t=0;t<n;t++){let n=e[t].lineStart[1];if(!(n<=Math.PI))break;o++;let l=-Math.cos(n)*e[t].lineEnd[0];s[t]=r=Math.max(l,r+i)}r=Number.NEGATIVE_INFINITY;for(let t=n-1;t>=o;t--){let n=e[t].lineStart[1],o=-Math.cos(n)*e[t].lineEnd[0];s[t]=r=Math.max(o,r+i)}if(o>0){r=Tu(e[o-1],!0)+i;for(let t=o-1;t>=0;t--){if(s[t]+i<=r)break;let n=Tu(e[t],!1);s[t]=r=Math.max(r-i,n)}}if(o<n){r=Tu(e[o],!0)+i;for(let t=o;t<n;t++){if(s[t]+i<=r)break;let n=Tu(e[t],!1);s[t]=r=Math.max(r-i,n)}}for(let t=0;t<n;t++){let i=e[t],n=Vh(Xh(s[t],i.lineEnd[0],t>=o));t>0&&0===n&&(n=Lo),i.lineEnd[1]=n,i.lineStart[1]=sr(n,...i.angles)}}(m.filter(e=>!!e.datum.label&&e.angles[0]!==e.angles[1]),t),m}function Tu(e,t){return Wh(Gh(...e.lineStart)[0],e.lineEnd[0],t)}function Lu(e,t){if(void 0===e){if(void 0===t)throw new Error("Effect must have defined start or end point.");return gh(function(e){return Ro(Vo({opacity:Bo(0,e.opacity)}),{duration:.8})}(t),t)}return void 0===t?function(e){return Ro(Vo({opacity:Bo(e.opacity,0),lineEnd:()=>e.lineStart}),{easing:ch})}(e):function(e,t){return Ro(Vo({center:Zo(e.center,t.center),angles:Zo(e.angles,t.angles),innerRadius:jo(e.innerRadius,t.innerRadius),outerRadius:jo(e.outerRadius,t.outerRadius),lineEnd:Zo(e.lineEnd,t.lineEnd),lineStart:Zo(e.lineStart,t.lineStart),labelRadius:jo(e.labelRadius,t.labelRadius),label:Ko(e.label,t.label,.5),opacity:jo(e.opacity,t.opacity),color:Ko(e.color,t.color,.5),selected:Ko(e.selected,t.selected,.5)}),{easing:uh})}(e,t)}class $u{constructor(e){this.svg=e.svg,this.labelParent=e.labelParent,this.id=e.id,this.styleProvider=e.style,this.line=document.createElementNS(re,"path"),this.line.classList.add("esc-c-line"),e.lines.appendChild(this.line),this.segment=document.createElementNS(re,"g"),this.segment.classList.add("esc-c-segment"),this.segment.setAttribute("data-esc-id",Js(this.id)),Ie(this.segment,"esc-controller",this),e.segments.appendChild(this.segment),this.arc=document.createElementNS(re,"path"),this.arc.classList.add("esc-c-arc"),this.segment.appendChild(this.arc),this.innerOutline=document.createElementNS(re,"path"),this.innerOutline.classList.add("esc-c-inner-outline"),this.segment.appendChild(this.innerOutline),this.outerOutline=document.createElementNS(re,"path"),this.outerOutline.classList.add("esc-c-outer-outline"),this.segment.appendChild(this.outerOutline),this.delimiter=document.createElementNS(re,"path"),this.delimiter.classList.add("esc-c-delimiter"),e.delimiters.appendChild(this.delimiter),this.state={},this.update(Object.assign({center:[0,0],angles:[0,0],innerRadius:0,outerRadius:0,lineStart:[0,0],lineEnd:[0,0],labelRadius:0,label:null,opacity:0,color:null,selected:!1},e.state))}getId(){return this.id}getState(){return Object.assign({},this.state,{center:hr(this.state.center),angles:hr(this.state.angles),lineStart:hr(this.state.lineStart),lineEnd:hr(this.state.lineEnd)})}update(e){if(null!=e){let t=this.state,i=!1;null!=e.selected&&t.selected!==e.selected&&(i=t.selected=e.selected,this.segment.classList.toggle(Ae,t.selected),this.label&&this.label.classList.toggle(Ae,t.selected),t.selected?this.highlight||(this.highlight=document.createElementNS(re,"path"),this.highlight.classList.add("esc-c-highlight"),this.segment.appendChild(this.highlight)):this.highlight&&(this.segment.removeChild(this.highlight),this.highlight=void 0)),null!=e.opacity&&t.opacity!==e.opacity&&(t.opacity=e.opacity,this.segment.setAttribute("opacity",t.opacity.toString()),this.label&&(this.label.style.opacity=t.opacity.toString()));let n=!1,s=!1,r=!1;if(null==e.center||ur(e.center,t.center)||(t.center=hr(e.center),n=!0,s=!0,r=!0),null==e.angles||ur(e.angles,t.angles)||(t.angles=hr(e.angles),n=!0,s=!0),null!=e.innerRadius&&e.innerRadius!==t.innerRadius&&(t.innerRadius=e.innerRadius,n=!0),null!=e.outerRadius&&e.outerRadius!==t.outerRadius&&(t.outerRadius=e.outerRadius,n=!0),n){let e=Kh({angles:t.angles,outerRadius:t.outerRadius,innerRadius:t.innerRadius,origin:t.center});this.arc.setAttribute("d",e),this.innerOutline&&(e=Kh({angles:t.angles,outerRadius:t.innerRadius,origin:t.center}),this.innerOutline.setAttribute("d",e)),this.outerOutline&&(e=Kh({angles:t.angles,outerRadius:t.outerRadius,origin:t.center}),this.outerOutline.setAttribute("d",e)),this.delimiter&&(e=function(e){let{angles:t,outerRadius:i,innerRadius:n,origin:s}=e;if(t[0]<0||t[1]>Lo||t[0]>t[1])throw new Error(`Angle pair is invalid: ${t[0]}, ${t[1]}`);if(n>i)throw new Error(`Inner radius exceeds outer radius: : ${n} > ${i}`);if(t[0]===t[1]||0===i)return"";if(0===t[0]&&t[1]===Lo)return"";{let e=Gh(n,t[1]),r=Gh(i,t[1]);return s&&(e=pr(e,s),r=pr(r,s)),`M ${e.join(" ")} L ${r.join(" ")}`}}({angles:t.angles,outerRadius:t.outerRadius,innerRadius:t.innerRadius,origin:t.center}),this.delimiter.setAttribute("d",e))}if(this.highlight&&(i||n)){let e=this.styleProvider().highlightGap,i=Kh({angles:t.angles,outerRadius:t.outerRadius+e,origin:t.center});this.highlight.setAttribute("d",i)}if(null==e.lineStart||ur(e.lineStart,t.lineStart)||(t.lineStart=hr(e.lineStart),s=!0),null==e.lineEnd||ur(e.lineEnd,t.lineEnd)||(t.lineEnd=hr(e.lineEnd),s=!0,r=!0),s){let e="";if(t.lineStart[0]!==t.lineEnd[0]){e=ol([pr(Gh(...t.lineStart),t.center),pr(Gh(...t.lineEnd),t.center)])}this.line.setAttribute("d",e)}if(void 0!==e.color&&t.color!==e.color&&(t.color=e.color,this.segment.style.setProperty("--esc-pie-chart-segment-color",t.color),this.line.style.setProperty("--esc-pie-chart-segment-color",t.color)),void 0!==e.label&&t.label!==(e.label||null)&&(t.label=e.label||null,t.label?(this.label||(this.label=document.createElement("span"),this.label.classList.add("esc-c-label"),this.label.setAttribute("data-esc-id",Js(this.id)),this.label.classList.toggle(Ae,t.selected),this.label.style.opacity=t.opacity.toString(),Ie(this.label,"esc-controller",this),this.labelParent.appendChild(this.label)),this.label.innerText=t.label):this.label&&(this.label.parentNode&&this.label.parentNode.removeChild(this.label),this.label=void 0)),null!=e.labelRadius&&t.labelRadius!==e.labelRadius&&(t.labelRadius=e.labelRadius,r=!0),r&&this.label){let e=Gh(t.labelRadius,t.lineEnd[1]);e[0]+=t.center[0],e[1]+=t.center[1];let i=t.lineEnd[1]>Math.PI;this.label.style.left=i?null:e[0]+"px",this.label.style.right=i?this.labelParent.getBoundingClientRect().width-e[0]+"px":null,this.label.style.top=e[1]+"px",this.label.classList.toggle("esc-m-left",i),this.label.classList.toggle("esc-m-right",!i)}}return this}remove(){return this.segment.parentNode&&this.segment.parentNode.removeChild(this.segment),this.line.parentNode&&this.line.parentNode.removeChild(this.line),this.delimiter.parentNode&&this.delimiter.parentNode.removeChild(this.delimiter),this.label&&this.label.parentNode&&this.label.parentNode.removeChild(this.label),this}toFront(){let e=this.segment.parentNode;return e&&this.segment.nextElementSibling&&(this.segment.remove(),e.appendChild(this.segment)),this}toBack(){let e=this.segment.parentNode;return e&&this.segment.previousElementSibling&&(this.segment.remove(),e.insertBefore(this.segment,e.firstChild)),this}}class Ou extends zu{constructor(e){super(e,"pie-chart")}initialize(e){super.initialize(e),this.setSoundFile("data","smooth"),this.initializeAnimatorEffects(),this.animator.onAnimation(()=>{let e=this.data2states();return this.segmentEffect.animate(e)}),this.data=new Map}createSVG(){super.createSVG(),this.svg.appendChild(this.lines=ae('<g class="esc-c-lines"/>')),this.svg.appendChild(this.segments=ae('<g class="esc-c-segments"/>')),this.svg.appendChild(this.delimiters=ae('<g class="esc-c-delimiters"/>'))}preventMoveEvent(e){return!1}mouseEvent2UserEvent(e){if(super.mouseEvent2PlotCoord(e),!(e.target instanceof Element))return;let t=ve(e.target,".esc-c-segment, .esc-c-label",this.element);if(!t)return;let i=e.target.classList.contains("esc-c-line")?"line":t.classList.contains("esc-c-segment")?"segment":"label",n=Me(t,"esc-controller"),s=n&&this.getDatum(n.getId());if(!s)return;let[r,o]=this.mouseEvent2PlotCoord(e);return{datum:{type:i,data:s},target:{left:r,right:r,top:o-5,bottom:o+5}}}getDataIds(){return Array.from(this.data.keys())}getNoData(){return this.data.size}getDatum(e){return this.data.get(e)}setData(e){if(void 0===e)return this;this.data.clear(),this.hasLabels=!1,this.noLevels=0;for(let t of e||[])if(null!=t&&void 0!==t.id){if(this.data.has(t.id))throw new Error(`Duplicate data point '${t.id}'.`);if(!Number.isFinite(t.count)||t.count<0)throw new Error(`Data point '${t.id}' must have non-negative count: ${t.count}`);if((t.level||0)<0)throw new Error(`Data point '${t.id}' must have non-negative level: ${t.level}`);this.data.set(t.id,Object.assign({},t)),t.label&&(this.hasLabels=!0),this.noLevels=Math.max(this.noLevels,(t.level||0)+1)}return this.redraw(!0),this.soundManager.play(),this}data2states(){let e=new Map,t=this.getOuterRadius();if(t<=0)return e;let i=t*this.doughnutRatio,n=t*this.lineEndRadiusRatio,s=Math.min(t+this.lineOffset,n),r=Au(this.data.values(),{innerRadius:i,outerRadius:t,lineStartAngleRatio:this.lineStartAngleRatio,lineStartRadius:s,lineEndRadius:n,lineOffset:this.lineOffset,highlightGap:this.highlightGap,gapRatio:this.gapRatio,textHeight:this.textHeight});for(let t of r){let i=t.datum,s={center:[(this.plotBounds.left+this.plotBounds.right)/2,(this.plotBounds.top+this.plotBounds.bottom)/2],angles:t.angles,innerRadius:t.innerRadius,outerRadius:t.outerRadius,lineStart:t.lineStart,lineEnd:t.lineEnd,labelRadius:n,label:t.angles[0]!==t.angles[1]&&i.label?i.label:null,color:_r(i.color)||null,opacity:1,selected:!!this.predicateSelection&&this.predicateSelection(i)};e.set(i.id,s)}return e}initializeAnimatorEffects(){this.segmentEffect=new ph({create:(e,t)=>new $u({svg:this.svg,segments:this.segments,lines:this.lines,delimiters:this.delimiters,labelParent:this.element,id:e,style:()=>({highlightGap:this.highlightGap}),state:t}),effects:Lu})}getOuterRadius(){let e=this.plotBounds.right-this.plotBounds.left,t=this.plotBounds.bottom-this.plotBounds.top,i=this.hasLabels?(t-this.textHeight)/2/this.lineEndRadiusRatio:t/2,n=this.hasLabels?e*this.pieRatio/2/this.lineEndRadiusRatio:e/2;return Math.min(i,n)}select(e){return this.predicateSelection=Cu(e),requestAnimationFrame(()=>{for(let e of this.segmentEffect.getComponents()){let t=this.getDatum(e.getId());if(t){let i=!!this.predicateSelection&&this.predicateSelection(t);e.update({selected:i})}}}),this}initializeCSSProperties(){super.initializeCSSProperties(),this.pieRatio=this.cssNumberProp("ratio",.4),this.lineOffset=this.cssPixelProp("line-offset",4),this.lineStartAngleRatio=this.cssNumberProp("line-start-angle-ratio",.5),this.lineEndRadiusRatio=this.cssNumberProp("line-end-radius-ratio",1.2),this.doughnutRatio=this.cssNumberProp("doughnut-ratio",0),this.highlightGap=this.cssPixelProp("highlight-gap",4),this.gapRatio=this.cssNumberProp("gap-ratio",.1),this.animationDuration=this.cssTimeProp("animation-duration",700),this.textHeight=this.measureTextHeight()}measureTextHeight(){let e=document.createElement("span");e.classList.add("esc-c-label"),e.style.visibility="hidden",e.innerText="Wj",this.element.appendChild(e);let t=e.getBoundingClientRect().height;return this.element.removeChild(e),t}}class Du extends Ca{constructor(e){super(Object.assign({unique:!0},e))}initialize(e){this.initializePlot(e),super.initialize(e),this.plot.select(this.selection.slice())}_setData(e){this.plot.setData(e)}setEnableSound(e){return this.plot.setEnableSound(e),this}getEnableSound(){return this.plot.getEnableSound()}toggleSelection(e){this.selection.includes(e)?this.removeSelection(e):this.addSelection(e)}_setSelection(e){super._setSelection(e),this.plot.select(this.selection.slice())}refreshStyle(){return this.plot.refreshStyle(),this}}function Pu(e){if(null==e)return null;if("string"==typeof e){let t=Ke(["count","total","id"],e,"segment descriptor");return(e,i,n)=>et(t,[e,i,n])}return e}class _u extends Du{constructor(e){super(Object.assign({},e,{orderSensitive:!1}))}initialize(e){super.initialize(e),this.setDistribution(e.distribution),Ws(this,this.element)}initializePlot(e){this.options=[],this.selection=[],this.plot=new Ou({element:we(e.element,".esc-c-chart",HTMLElement),enableSound:e.enableSound,label:(e,t)=>this.label(e,t),clickCallback:e=>this.toggleSelection(e.id)}),this.setOptions(e.options)}label(e,t){return("segment"===t||"label"===t&&!this.multiLevel)&&e.description&&e.description(e.count,e.total,e.id)||null}getOptionIds(){return this.options.map(e=>e.id)}getNoOptions(){return this.options.length}_setControlEnabled(e){super._setControlEnabled(e),Xs(e,this.element)}addOptions(e){return void 0===e?this:((null===e||Array.isArray(e))&&(e={options:e}),this._setOptions(e.options||[],!0,e.selection,"selection"in e),this)}setOptions(e){return void 0===e?this:((null===e||Array.isArray(e))&&(e={options:e}),this._setOptions(e.options||[],!1,e.selection,"selection"in e),this)}removeOptions(e){return void 0===e?this:((null===e||Array.isArray(e))&&(e={options:e}),this._removeOptions(e.options,e.selection,"selection"in e),this)}clearOptions(){return this._removeOptions(null,void 0,!1),this}_setOptions(e,t,i,n){e=e.map(e=>({id:e.id,label:e.label,description:Pu(e.description),color:e.color,level:e.level,hidden:e.hidden})),t&&(e=[...this.options,...e]),Ns(e),this.updateOptions(e,i,n)}_removeOptions(e,t,i){e=e||this.options.map(e=>e.id);let n=this.options.filter(t=>!e.includes(t.id));this.updateOptions(n,t,i)}updateOptions(e,t,i){t=i?t:this.adjustSelection(e.map(e=>e.id));let n=this.options.length;this.options=e,this.setSelection(t),this.options.length!==n&&this.setDistribution(null)}adjustSelection(e){return this.allAsUndefined&&this.selection.length===this.getNoOptions()?e:this.selection.filter(t=>e.includes(t))}effectiveData(e){let t=[],i=this.options.map(i=>{let n=(e.find(e=>e.value===i.id)||{}).count||0,s=Object.assign({total:0,count:n,description:null},i);if(s.count<0)throw new Error(`Option '${s.id} as a negative count: ${s.count}`);let r=s.level||0;return void 0===t[r]?t[r]=s.count:t[r]+=s.count,s});for(let e of i)e.total=t[e.level||0];return this.multiLevel=t.length>1,i}setDistribution(e){e=jr(e);let t=this.effectiveData(e);return this._setData(t),this}}function Fu(e,t){let i=si(e,"PieChartSelector",HTMLElement);Vs(i,new _u(Object.assign({},t,{element:i})),t)}function Ru(e){if(null==e)return null;if("string"==typeof e){let t=Ke(["datum","type"],e,"typed data accessor");return(e,i)=>et(t,[e,i])}return e}bt("esc-pie-chart",Fu),ku.init=Fu,Nu||(Nu={});const Bu=Object.freeze(["kernels","boxes","dots","lines"]);class Hu{constructor(){this.elements=[],this.callbacks=new Set}getElements(){return this.elements.slice()}getNoElements(){return this.elements.length}add(e){if(this.elements.includes(e))throw new Error("Canvas elements must be unique.");return this.elements.push(e),this}addBatch(e){if(e.length!==new Set(e).size||e.some(e=>this.elements.includes(e)))throw new Error("Canvas elements must be unique.");return this.elements.push(...e),this}remove(e){let t=this.elements.indexOf(e);return t>=0&&this.elements.splice(t,1),this}removeBatch(e){for(let t of e){let e=this.elements.indexOf(t);e>=0&&this.elements.splice(e,1)}return this}clear(){return this.elements.length=0,this}toFront(e){let t=this.elements.indexOf(e);return t===this.elements.length-1?this:(t>=0&&this.elements.splice(t,1),this.elements.push(e),this)}toFrontBatch(e){if(e.length!==new Set(e).size)throw new Error("Canvas elements must be unique.");for(let t of e){let e=this.elements.indexOf(t);e>=0&&this.elements.splice(e,1)}return this.elements.push(...e),this}toBack(e){let t=this.elements.indexOf(e);return 0===t?this:(t>=0&&this.elements.splice(t,1),this.elements.unshift(e),this)}toBackBatch(e){if(e.length!==new Set(e).size)throw new Error("Canvas elements must be unique.");for(let t of e){let e=this.elements.indexOf(t);e>=0&&this.elements.splice(e,1)}return this.elements.unshift(...e),this}_render(e){for(let t of this.elements)e.save(),t.render(e),e.restore()}onSchedule(e){return null!=e&&this.callbacks.add(e),this}offSchedule(e){return null!=e&&this.callbacks.delete(e),this}schedule(){for(let e of this.callbacks)e();return this}}class ju extends Hu{render(e){return this._render(e),this}getUITarget(e){let t,i=Number.POSITIVE_INFINITY;for(let n of this.elements){let s=n.getUITarget(e);if(s){if(s.distance<i&&(i=s.distance,t={distance:i,bounds:s.bounds,element:n},0===s.distance))break}else;}return t}}class qu extends Hu{constructor(e){super(),this.context=e.context,this.preRender=e.preRender,this.postRender=e.postRender,this.callback=()=>this.schedule()}schedule(){return this.scheduled||(this.scheduled=!0,oi(()=>{this.scheduled=!1,this.render()})),this}add(e){return super.add(e),e.onSchedule(this.callback),this}addBatch(e){super.addBatch(e);for(let t of e)t.onSchedule(this.callback);return this}remove(e){return super.remove(e),e.offSchedule(this.callback),this}removeBatch(e){super.removeBatch(e);for(let t of e)t.offSchedule(this.callback);return this}clear(){for(let e of this.elements)e.offSchedule(this.callback);return super.clear()}toFront(e){return super.toFront(e),e.onSchedule(this.callback),this}toFrontBatch(e){super.toFrontBatch(e);for(let t of e)t.onSchedule(this.callback);return this}toBack(e){return super.toBack(e),e.onSchedule(this.callback),this}toBackBatch(e){super.toBackBatch(e);for(let t of e)t.onSchedule(this.callback);return this}render(){return this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this.preRender&&this.preRender(this.context),this._render(this.context),this.postRender&&this.postRender(this.context),this}getUITarget(e){let t,i=Number.POSITIVE_INFINITY;for(let n of this.elements){let s=n.getUITarget(e);if(s){if(0===s.distance)return s;s.distance<i&&(i=s.distance,t=s)}else;}return t}}function Uu(e,t){let i=e.getContext("2d",t);if(!i)throw new Error("Canvas is not supported.");return i}function Zu(){return Uu(document.createElement("canvas"))}class Yu extends Uh{constructor(e){super(e),this.stage=e.stage}value2point(e,t){return[this.stage.value2pixel(e[0],t.x),this.stage.value2pixel(e[1],t.y)]}point2value(e,t){return[this.stage.pixel2value(e[0],t.x),this.stage.pixel2value(e[1],t.y)]}}class Gu extends Yu{toFront(e){if(null==e);else if("function"==typeof e)for(let t of this.effect.getComponents()){let i=this.data.get(t.getId());void 0!==i&&!0===e(i)&&t.toFront()}else for(let t of e){let e=void 0===t?void 0:this.effect.getComponent(t);e&&e.toFront()}return this}toBack(e){if(null==e);else if("function"==typeof e)for(let t of this.effect.getComponents()){let i=this.data.get(t.getId());void 0!==i&&!0===e(i)&&t.toBack()}else for(let t of e){let e=void 0===t?void 0:this.effect.getComponent(t);e&&e.toBack()}return this}}function Vu(e){switch(e){case void 0:case null:case"xy":case"x1y1":return{x:"x",y:"y"};case"xy2":case"x1y2":return{x:"x",y:"y2"};case"x2y":case"x2y1":return{x:"x2",y:"y"};case"x2y2":return{x:"x2",y:"y2"};default:throw new Error(`Axes specification is invalid: '${e}'`)}}function Xu(e){return"x"===e||"x2"===e}function Wu(e){if("x"===e)return"x2";if("x2"===e)return"x";if("y"===e)return"y2";if("y2"===e)return"y";throw new Error(`Axis '${e}' not recognized.`)}const Ku=Object.freeze(["x","y","x2","y2"]);function Qu(e){let t={};return Ju(e,t),t}function Ju(e,t){for(let i of Ku){let n=e(i);void 0===n?delete t[i]:t[i]=n}}function ec(){return Qu(()=>null)}function tc(e){let t=ec();for(let i of e||[])nc(i.x,i.y,i.axes,t);return t}function ic(e,t,i,n){sc(e,(i=null!=i&&"object"==typeof i?i:Vu(i)).x,n),sc(t,i.y,n)}function nc(e,t,i,n){i=null!=i&&"object"==typeof i?i:Vu(i),e&&(sc(e.min,i.x,n),sc(e.max,i.x,n)),t&&(sc(t.min,i.y,n),sc(t.max,i.y,n))}function sc(e,t,i){if(null==e||!Number.isFinite(e))return;let n=i[t];null==n?i[t]={min:e,max:e}:(e<n.min&&(n.min=e),e>n.max&&(n.max=e))}function rc(e,t){return null==e||null==t?e:(t.offset||0)+(null==t.scale?1:t.scale)*e}var oc,lc;!function(e){e.x="x",e.y="y",e.xy="xy",e.none="none"}(oc||(oc={})),function(e){e.smooth="smooth",e.fade="fade",e.center="center",e.bounce="bounce",e.pop="pop",e.random="random",e.none="none"}(lc||(lc={}));class ac extends qh{constructor(e){super(e),this.plotBounds=e.plotBounds}}function hc(e){return Ro(Vo({opacity:Bo(0,e.opacity)}),{duration:.8})}function uc(e){return Ro(Vo({opacity:Bo(e.opacity,0)}),{easing:ch})}class cc extends ac{constructor(e){super(e)}makeEntryTween(e){return function(e){return Ro(Vo({yHigh:jo(e.yLow,e.yHigh)}),{easing:mh})}(e)}makeExitTween(e){return function(e){return Ro(Vo({yHigh:jo(e.yHigh,e.yLow)}),{easing:ch})}(e)}}class dc extends ac{constructor(e){super(e)}makeEntryTween(e){return function(e){let t=.5*Math.random();return Ro(Vo({yHigh:jo(e.yLow,e.yHigh)}),{easing:mh,delay:t,duration:.5})}(e)}makeExitTween(e){return function(e){let t=.5*Math.random();return Ro(Vo({yHigh:jo(e.yHigh,e.yLow)}),{easing:ch,delay:t,duration:.1})}(e)}}class fc extends Hh{makeEntryCallback(e){return hc(e)}makeExitCallback(e){return uc(e)}makeTransitionCallback(e,t){return function(e,t){let i,n;return e.hidden?t.hidden||(i=Bo(0,t.opacity),n=Wo(!0,!1,0)):t.hidden?(i=Bo(e.opacity,0),n=Wo(!1,!0,1)):i=Bo(e.opacity,t.opacity),Ro(Vo({xLow:jo(e.xLow,t.xLow),xHigh:jo(e.xHigh,t.xHigh),yLow:jo(e.yLow,t.yLow),yHigh:jo(e.yHigh,t.yHigh),color:Ko(e.color,t.color,.5),opacity:i,hidden:n,selected:Ko(e.selected,t.selected,.5)}),{easing:uh})}(e,t)}}class mc extends ac{constructor(e){super(e)}makeEntryTween(e){return hc(e)}makeExitTween(e){return uc(e)}}class pc{constructor(e){let t=4*Math.random();this.effect=t<=1?new cc(e):t<=2?new dc(e):t<=3?new fc:new mc(e)}makeCallback(e,t,i){return this.effect.makeCallback(e,t,i)}}class gc extends ac{constructor(e){super(e)}makeEntryTween(e){return function(e,t){let i=[(t.left+t.right)/2,(t.top+t.bottom)/2],n=Math.random();return Ro(Vo({xLow:Bo(i[0],e.xLow),xHigh:Bo(i[0],e.xHigh),yLow:Bo(i[1],e.yLow),yHigh:Bo(i[1],e.yHigh)}),{easing:ch,delay:n})}(e,this.plotBounds)}makeExitTween(e){return function(e,t){let i=[(t.left+t.right)/2,(t.top+t.bottom)/2],n=.75*cr([(e.xLow+e.xHigh)/2,(e.yLow+e.yHigh)/2],i)/cr([t.left,t.top],i);return Ro(Vo({xLow:Bo(e.xLow,i[0]),xHigh:Bo(e.xHigh,i[0]),yLow:Bo(e.yLow,i[1]),yHigh:Bo(e.yHigh,i[1])}),{easing:uh,delay:n})}(e,this.plotBounds)}}class bc extends Gu{constructor(e){super(e),this.predicateSelection=null,this.predicateHidden=null,this.animationEffect=lc.smooth,this.hideEffect=!1}setData(e){if(void 0===e)return this;this.data.clear();for(let t of e||[]){if(void 0===t.id)throw new Error(`Bar must not have undefined id: ${u(t)}`);if(this.data.has(t.id))throw new Error(`Bar id must be unique: ${u(t.id)}`);Number.isFinite(t.xLow)&&Number.isFinite(t.xHigh)&&Number.isFinite(t.yLow)&&Number.isFinite(t.yHigh)&&this.data.set(t.id,ki(t))}return this}getMinMax(){return tc(Hr(this.data.values(),e=>({x:{min:Math.min(e.xLow,e.xHigh),max:Math.max(e.xLow,e.xHigh)},y:{min:Math.min(e.yLow,e.yHigh),max:Math.max(e.yLow,e.yHigh)},axes:e.axes})))}setAnimationEffect(e){return this.animationEffect=Mt(e,lc,lc.fade),this}getAnimationEffect(){return this.animationEffect}getDurationMultiplier(){let e=Math.max(this.data.size,this.effect.getNoComponents());if(0===e||this.animationEffect===lc.none)return 0;let t=this.animationEffect!==lc.smooth&&this.getInOutEffectMode()===zh.mixed?1.75:1;return e=sr(Math.sqrt(e),10,100),t*=2-(100-e)/90,t}transitionState(e,t,i){return this.makeRenderEffect().makeCallback(e,t,i)}makeRenderEffect(){if(this.animationEffect===lc.none||this.animationEffect===lc.smooth)return new fc;let e={plotBounds:this.stage.stageBounds(),mode:this.getInOutEffectMode()};return this.animationEffect===lc.random?new pc(e):this.animationEffect===lc.center?new gc(e):this.animationEffect===lc.bounce?new cc(e):this.animationEffect===lc.pop?new dc(e):this.animationEffect===lc.fade?new mc(e):new fc}datum2state(e){let t=Vu(e.axes),[i,n]=this.value2point([e.xLow,e.yLow],t),[s,r]=this.value2point([e.xHigh,e.yHigh],t),o=this.resolveColor(e.color||this.defaultColor),l=!!this.predicateHidden&&!1!==this.predicateHidden(e),a=l&&this.hideEffect?this.opacityMin:1,h=!(!e||!this.predicateSelection)&&this.predicateSelection(e);return{xLow:i,xHigh:s,yLow:n,yHigh:r,color:o,opacity:a,hidden:l&&!this.hideEffect,selected:h,fuzz:e.fuzz||oc.none}}select(e){return this.predicateSelection=Cu(e),this}setHideEffect(e){return this.hideEffect=e,this}getHideEffect(){return this.hideEffect}hide(e){return this.predicateHidden=Cu(e),this}show(e){const t=Cu(e);return this.predicateHidden=t&&(e=>!t(e)),this}initializeCssProperties(){super.initializeCssProperties(),this.defaultColor=this.cssStringProp("box-color","30, 147, 255"),this.opacityMin=this.cssNumberProp("box-opacity-min",.2),this.gap=this.cssPixelProp("box-gap",0),this.thickness=this.cssPixelProp("box-thickness",0),this.fillOpacity=this.cssNumberProp("box-fill-opacity",1),this.highlightGap=this.cssPixelProp("box-highlight-gap",4),this.highlightThickness=this.cssPixelProp("box-highlight-thickness",2)}}class wc{constructor(e){this.styleProvider=e.style,this.templates=new n(e=>{let t=Zu();return this.drawTemplate(e,t),t})}style(){return this._style||(this._style=this.styleProvider()),this._style}reset(){return this.templates.clear(),this._style=void 0,this}render(e,t){if(e.hidden)return this;t.globalAlpha=e.opacity;let i=this.style(),n=Math.min(e.xLow,e.xHigh),s=Math.min(e.yLow,e.yHigh),r=Math.abs(e.xHigh-e.xLow),o=Math.abs(e.yHigh-e.yLow);if(t.translate(n,s),e.selected){let n=i.highlightThickness;if(n){let s=n/2;t.lineWidth=n,t.strokeStyle=`rgb(${e.color})`,t.setLineDash(i.highlightDash),t.strokeRect(s,s,r-n,o-n)}let s=i.highlightGap;t.translate(s,s),t.scale((r-2*s)/4,(o-2*s)/4);let l=this.templates.compute(e.color);t.drawImage(l.canvas,0,0)}else{let n=i.thickness;if(n){let i=n/2;t.lineWidth=n,t.strokeStyle=`rgb(${e.color})`,t.strokeRect(i,i,r-n,o-n)}let s=i.gap;t.translate(s,s),t.scale((r-2*s)/4,(o-2*s)/4);let l=this.templates.compute(e.color),a=i.fillOpacity;1!==a&&(t.globalAlpha=e.opacity*a),t.drawImage(l.canvas,0,0)}return this}drawTemplate(e,t){t.canvas.width=4,t.canvas.height=4,t.fillStyle=`rgb(${e})`,t.beginPath(),t.fillRect(0,0,4,4),t.fill()}getUITarget(e,t){return function(e,t){let[i,n]=e,s=Math.min(t.xLow,t.xHigh),r=Math.max(t.xLow,t.xHigh),o=Math.min(t.yLow,t.yHigh),l=Math.max(t.yLow,t.yHigh),a=s<=i&&i<=r?0:Math.min(Math.abs(i-s),Math.abs(i-r)),h=o<=n&&n<=l?0:Math.min(Math.abs(n-o),Math.abs(n-l)),u=r-s>20||t.fuzz!==oc.x&&t.fuzz!==oc.xy?0:10,c=l-o>20||t.fuzz!==oc.y&&t.fuzz!==oc.xy?0:10;return a>u||h>c?void 0:{distance:Math.max(a,h),bounds:{left:s,right:r,top:o,bottom:l}}}(e,t)}}class vc{constructor(e,t){this.initialize(e,t)}initialize(e,t){this.id=e.id,this.state=Object.assign(t,e.state),this.schedule()}getId(){return this.id}getState(){return ki(this.state)}update(e){if(null!=e){for(let t of Object.keys(e)){if(!(t in this.state))throw new Error(`Cannot update state with property '${t}':\n${u(this.state)}`);{let i=e[t];null!=i&&(this.state[t]=i)}}this.schedule()}return this}}class yc extends vc{constructor(e,t){super(e,t)}initialize(e,t){this.group=e.group,this.group.add(this),this.renderer=e.renderer,super.initialize(e,t)}schedule(){this.group.schedule()}render(e){return this.renderer.render(this.state,e),this}toFront(){return this.group.toFront(this),this.schedule(),this}toBack(){return this.group.toBack(this),this.schedule(),this}remove(){return this.group.remove(this),this.schedule(),this}getUITarget(e){let t=this.renderer.getUITarget(e,this.state);return t&&{distance:t.distance,bounds:t.bounds,element:this}}}class xc extends yc{constructor(e,t){super(e,t),this.manager=e.manager}getData(){let e=this.manager.getDatum(this.id);return void 0===e?void 0:{type:this.manager.getType(),data:e}}}class Sc extends xc{constructor(e){super(e,{xLow:0,xHigh:0,yLow:0,yHigh:0,color:"125, 125, 125",opacity:0,hidden:!1,selected:!1,fuzz:oc.none})}}class Ec extends bc{constructor(e){super(e),this.group=e.group,this.renderer=new wc({style:()=>({gap:this.gap,thickness:this.thickness,fillOpacity:this.fillOpacity,highlightThickness:this.highlightThickness,highlightGap:this.highlightGap,highlightDash:this.highlightDash.slice()})})}createComponent(e,t){return new Sc({group:this.group,renderer:this.renderer,manager:this,id:e,state:t})}refreshStyle(){return this.renderer.reset(),super.refreshStyle()}initializeCssProperties(){super.initializeCssProperties(),this.highlightDash=this.cssNumbersProp("box-highlight-dash",[6]).filter(e=>null!=e)}}class kc extends xc{constructor(e){super(e,{line:[],points:[],areas:[],size:1,color:"125, 125, 125",opacity:0,hidden:!1,selected:!1})}}function Nc(e,t){return null==e||null==t?e===t:e.length===t.length&&e.every((e,i)=>function(e,t){return null==e||null==t?e===t:e[0]===t[0]&&e[1]===t[1]&&e[2]==t[2]&&e[3]==t[3]}(e,t[i]))}class Cc{constructor(e){this.styleProvider=e.style,this.pointTemplates=new n(e=>{let t=Zu();return this.drawTemplate(e,t),t})}style(){return this._style||(this._style=this.styleProvider()),this._style}reset(){return this.pointTemplates.clear(),this._style=void 0,this}render(e,t){return e.hidden?this:(this.drawAreas(e,t),e.line.length>1&&(t.strokeStyle=`rgb(${e.color})`,t.lineCap="round",t.lineJoin="round",e.selected&&this.drawLineBackground(e,t),this.drawLine(e,t)),this.drawPoints(e,t),this)}drawAreas(e,t){if(0===e.areas.length)return;let i=this.style();t.globalAlpha=e.opacity*i.areaOpacity,t.fillStyle=`rgb(${e.color})`;for(let i of e.areas){if(i.length<=1)continue;t.beginPath();let e=!0;for(let n of i)e?(t.moveTo(n[0],n[1]),e=!1):t.lineTo(n[0],n[1]);t.fill()}}lineDash(e,t){if(e<.5)return[];switch(t){case Ah.dashed:return[2*e,2*this.style().lineDashRatio*e];case Ah.dotted:return[0,2*e];default:return[]}}drawLine(e,t){let i,n,s,r=e.line,o=e.size;t.globalAlpha=e.opacity,t.lineWidth=o,t.beginPath();let l=!0,a=r[0];for(let e=1;e<r.length;e++){let h=r[e],u=h[2];u===Ah.none?l=!0:(u===s||(u===Ah.solid?(s&&(t.stroke(),t.beginPath(),l=!0),t.setLineDash([])):u===Ah.dashed?(i=i||this.lineDash(o,u),s&&(t.stroke(),t.beginPath(),l=!0),t.setLineDash(i)):u===Ah.dotted&&(n=n||this.lineDash(o,u),s&&(t.stroke(),t.beginPath(),l=!0),t.setLineDash(n))),l&&t.moveTo(a[0],a[1]),t.lineTo(h[0],h[1]),s=u,l=!1),a=h}t.stroke()}drawLineBackground(e,t){let i=this.style();if(i.backgroundRatio<=0)return;let n=e.line,s=i.backgroundRatio*e.size;t.globalAlpha=e.opacity*i.backgroundOpacity,i.backgroundBlur>0&&(t.filter=`blur(${s*i.backgroundBlur}px)`),t.lineWidth=s,t.beginPath();let r=!0,o=n[0];for(let e=1;e<n.length;e++){let i=n[e];i[2]===Ah.none?r=!0:(r&&t.moveTo(o[0],o[1]),t.lineTo(i[0],i[1]),r=!1),o=i}t.stroke(),i.backgroundBlur>0&&(t.filter="blur(0px)")}drawPoints(e,t){let i=e.points;if(0!==i.length){t.globalAlpha=e.opacity;for(let n of i)t.save(),t.translate(n[0],n[1]),this.renderPoint(n[2],e.color,t),t.restore()}}renderPoint(e,t,i){let n=e/40;i.scale(n,n);let s=this.pointTemplates.compute(t),r=s.canvas.width/2;i.drawImage(s.canvas,-r,-r)}drawTemplate(e,t){let i=this.style(),n=40*i.pointThickness;t.canvas.width=82,t.canvas.height=82,t.fillStyle=`rgb(${i.pointFill})`,t.strokeStyle=`rgb(${e})`,t.lineWidth=n,t.beginPath(),t.arc(41,41,40-n,0,Lo,!1),t.fill(),t.stroke()}getUITarget(e,t){return function(e,t){let i,n=Number.POSITIVE_INFINITY,s=t.points;for(let t=0;t<s.length;t++){let r=s[t].slice(0,2),o=cr(e,r);o<n&&(i=r,n=o)}let r=t.line;if(1===r.length){let t=r[0].slice(0,2),s=cr(e,t);s<n&&(i=t,n=s)}else if(r.length>1){let t=r[0].slice(0,2);for(let s=1;s<r.length;s++){let o=r[s].slice(0,2),l=gr(e,t,o,!0),a=cr(e,mr(t,o,l));a<n&&(i=l<=.5?t:o,n=a),t=o}}if(i&&!(n>10))return{distance:n,bounds:{left:e[0]-5,right:e[0]+5,top:e[1]-5,bottom:e[1]+5}}}(e,t)}}function Ic(e,t){if(void 0===e){if(void 0===t)throw new Error("Effect must have defined start or end point.");return gh(Mc(t),t)}return void 0===t?zc(e):Ac(e,t)}function Mc(e){return Ro(Vo({opacity:Bo(0,e.opacity)}),{duration:.8})}function zc(e){return Ro(Vo({opacity:Bo(e.opacity,0)}),{easing:ch})}function Ac(e,t){let i,n,s;var r,o;let l;return e.hidden?t.hidden||(i=Bo(0,t.opacity),n=Wo(!0,!1,0)):t.hidden?(i=Bo(e.opacity,0),n=Wo(!1,!0,1)):i=Bo(e.opacity,t.opacity),r=e.line,o=t.line,(null==r||null==o?r===o:r.length===o.length&&r.every((e,t)=>function(e,t){return null==e||null==t?e===t:e[0]===t[0]&&e[1]===t[1]&&e[2]==t[2]&&e[3]==t[3]}(e,o[t])))||(s=e.line.length?t.line.length?Lc(e.line,t.line):()=>[]:e=>e<1?[]:t.line),Nc(e.points,t.points)||(l=e.points.length?t.points.length?Dc(e.points,t.points):Dc(e.points,e.points.map(e=>[e[0],e[1],0,e[3]])):Dc(t.points.map(e=>[e[0],e[1],0,e[3]]),t.points)),Ro(Vo({line:s,points:l,areas:Fc(e.areas,t.areas),size:jo(e.size,t.size),color:Ko(e.color,t.color,.5),opacity:i,hidden:n,selected:Ko(e.selected,t.selected,.5)}),{easing:uh})}const Tc={identifier:e=>e[3],interpolator:(e,t,i)=>[or(e[0],t[0],i),or(e[1],t[1],i),i<=.5?e[2]:t[2],i<=.5?e[3]:t[3]]};function Lc(e,t){return Go(e,t,Tc)}function $c(e,t){return Nc(e,t)?void 0:Dc(e,t)}const Oc={identifier:e=>e[3],interpolator:(e,t,i)=>[or(e[0],t[0],i),or(e[1],t[1],i),or(e[2],t[2],i),i<=.5?e[3]:t[3]]};function Dc(e,t){return Go(e,t,Oc)}const Pc=e=>e[2],_c=(e,t,i)=>[or(e[0],t[0],i),or(e[1],t[1],i),i<=.5?e[2]:t[2]];function Fc(e,t){return n=t,(null==(i=e)||null==n?i===n:i.length===n.length&&i.every((e,t)=>function(e,t){return null==e||null==t?e===t:e.length===t.length&&e.every((e,i)=>function(e,t){return null==e||null==t?e===t:e[0]===t[0]&&e[1]===t[1]&&e[2]==t[2]}(e,t[i]))}(e,n[t])))?void 0:function(e,t){let i=e.slice(),n=t.slice(),s=Math.max(i.length,n.length);for(let e=0;e<s;e++)i[e]=i[e]||[],n[e]=n[e]||[],(i[e].length||n[e].length)&&(i[e].length||(i[e]=Rc(n[e])),n[e].length||(n[e]=Rc(i[e])),[i[e],n[e]]=$o([i[e],n[e]],Pc));return Yo({start:i,end:n,start0:e,end0:t,interpolator:(e,t,i)=>e.map((e,n)=>_c(e,t[n],i))})}(e,t);var i,n}function Rc(e){return[[Co(Hr(e,(t,i)=>i===e.length-1?void 0:t[0])),Co(Hr(e,(t,i)=>i===e.length-1?void 0:t[1]))]]}function Bc(e,t,i){return e.map(e=>((e=e.slice())[0]=i.value2pixel(e[0],t.x),e[1]=i.value2pixel(e[1],t.y),e))}function Hc(e,t,i,n){let s=[];for(let r of e)if(null==r);else if(Array.isArray(r))null==r[0]||Number.isNaN(r[0])||null==r[1]||Number.isNaN(r[1])||s.push([r[0],r[1],null==r[2]?t:r[2],r[3]]);else if("function"==typeof r)jc(r,s,t,i,n);else{if("object"!=typeof r)throw new Error(`Datum is not curve configuration: ${u(r)}`);{let e=[];jc(r.points,e,null==r.style?t:r.style,i,n),!0===r.reverse&&e.reverse(),s.push(...e)}}return s}function jc(e,t,i,n,s){Array.isArray(e)||(e=[e]);let r=!1;for(let o of e)if(null==o);else if(Array.isArray(o))null==o[0]||Number.isNaN(o[0])||null==o[1]||Number.isNaN(o[1])||(t.push([o[0],o[1],null==o[2]?i:o[2],o[3]]),r=!1);else{let e=o,l=s.stageBounds(),a=qc(e,{min:s.pixel2value(l.left,n.x),max:s.pixel2value(l.right,n.x)},Math.max(1,Math.round((l.right-l.left)/16)),5,3);for(let e of a)Number.isNaN(e[0])||Number.isNaN(e[1])?r=!0:(t.push([e[0],e[1],r?Ah.none:i]),r=!1)}}function qc(e,t,i,n,s){let r,o=[];if(null==t||t.min===t.max)return o;Qr(t);for(let l=0;l<i;l++){r=Uc(e,l===i-1?t.max:t.min+l/i*(t.max-t.min),r,o,n,0,s)}return o}function Uc(e,t,i,n,s,r,o){let l=function(e,t,i){"number"==typeof t&&(t=[t,e(t)]);let[n,s]=t,[r,o]=i?i.point:[Number.NaN,Number.NaN],l=i&&s!==o?(s-o)/(n-r):0,a=i&&l!==i.slope?(l-i.slope)/(n-r):0;return{point:[n,s],slope:l,slope2:a}}(e,t,i);if(r>=o||Math.abs(l.slope2)<=s)(!Number.isNaN(l.point[1])||i&&!Number.isNaN(i.point[1]))&&n.push(l.point);else{let a=Array.isArray(t)?t[0]:t,h=(i.point[0]+a)/2,u=Uc(e,h,i,n,s,r+1,o);if(h!==u.point[0])throw new se(`Mid-point has not been evaluated: ${h}`);Uc(e,l.point,u,n,s,r+1,o)}return l}class Zc extends Gu{setData(e){if(void 0===e)return this;this.data.clear();for(let t of e||[]){if(void 0===t.id)throw new Error(`Curve must not have undefined id: ${u(t)}`);if(this.data.has(t.id))throw new Error(`Curve id must be unique: ${u(t.id)}`);if(!t.data)throw new Error(`Curve ${u(t.id)} must have non-null data.`);this.data.set(t.id,ki(t))}return this}transitionState(e,t){return Ic(e,t)}datum2state(e){let t=Vu(e.axes),i=Hc(e.data,e.style||Ah.solid,t,this.stage);return i=Bc(i,t,this.stage),0===i.length?void 0:{line:i,points:[],areas:[],size:e.size||1,color:this.resolveColor(e.color||this.defaultColor),opacity:null==e.opacity?1:e.opacity,hidden:!1,selected:!1}}initializeCssProperties(){super.initializeCssProperties(),this.defaultColor=this.cssStringProp("curve-color","125, 125, 125")}}class Yc extends Zc{constructor(e){super(e),this.group=e.group,this.renderer=new Cc({style:()=>({areaOpacity:0,lineDashRatio:this.dashRatio,backgroundRatio:0,backgroundOpacity:0,backgroundBlur:0,pointThickness:0,pointFill:""})})}createComponent(e,t){return new kc({group:this.group,renderer:this.renderer,manager:this,id:e,state:t})}refreshStyle(){return this.renderer.reset(),super.refreshStyle()}initializeCssProperties(){super.initializeCssProperties(),this.dashRatio=this.cssNumberProp("curve-dash-ratio",1)}}var Gc;function Vc(e,t){let i=Math.floor((e+t)/(2*t)),n=i<=1?e/3:(e+t)/i-t;return[n,i<=1?n:t]}!function(e){e.smooth="smooth",e.fade="fade",e.center="center",e.down="down",e.up="up",e.pop="pop",e.random="random",e.none="none"}(Gc||(Gc={}));class Xc extends qh{constructor(e){super(e),this.plotBounds=e.plotBounds}}function Wc(e){return Ro(Vo({opacity:Bo(0,e.opacity),highlightOpacity:Bo(0,e.highlightOpacity)}),{duration:.8})}function Kc(e){return Ro(Vo({opacity:Bo(e.opacity,0),highlightOpacity:Bo(e.highlightOpacity,0)}),{easing:ch})}function Qc(e,t){let i=e.trail,n=t.trail;if(i.length>1&&0===n.length){let e=i.length,t=new Array(e),n=1e-4;for(let s=0;s<e-1;s++){let e=Math.max(1e-4,i[s][2]||cr(i[s].slice(0,2),i[s+1].slice(0,2)));n=Math.min(n,e/10),t[s]={duration:e,tween:Jc(i.slice(s),i.slice(s+1))}}return t[e-1]={duration:n,tween:()=>[]},Xo(t)}if(n.length>1&&0===i.length){let e=n.length,t=new Array(e-1);for(let i=0;i<e-1;i++){let s=e-i-1;t[i]={duration:Math.max(1e-4,n[s][2]||cr(n[s].slice(0,2),n[s-1].slice(0,2))),tween:Jc(n.slice(s),n.slice(s-1))}}return Xo(t)}return 0!==i.length||0!==n.length?Ti(i,n)?void 0:Jc(i.length?i:[[...e.position,0,0,0]],n.length?n:[[...t.position,0,0,0]]):void 0}function Jc(e,t){let[i,n]=function(e,t,i){let n=e.length,s=t.length;if(n===s)return[e,t];let r=Math.min(n,s),o=Math.max(n,s);if(0===r)throw new Error("Cannot pad empty array.");let l=n===r?e:t,a=new Array(o);if("left"===i){let e=o-r;for(let t=0;t<o;t++)a[t]=l[Math.max(0,t-e)]}else{if("right"!==i)throw new Error(`Pad direction not recognized: '${i}'`);for(let e=0;e<o;e++)a[e]=l[Math.min(e,r-1)]}return n===o?[e,a]:[a,t]}(e,t,"left");return Yo({start:i,end:n,start0:e,end0:t,interpolator:mr})}class ed extends Xc{constructor(e){super(e)}makeEntryTween(e){return function(e,t){let i=t.bottom-t.top,n=(t.bottom-e.position[1])/i,s=Math.max(.2,n),r=1-n,o=qo(0,{amplitude:e.size,frequency:3*n,shift:Math.random()}),l=e.position[0]-o(1),a=Bo(t.bottom,e.position[1]),h=Bo(0,e.size);return Ro(t=>({position:[l+o(t),a(t)],size:h(t),trail:e.trail.length?0===t?[]:1===t?e.trail:void 0:void 0}),{easing:ah,delay:r,duration:s})}(e,this.plotBounds)}makeExitTween(e){return function(e,t){let i=t.bottom-t.top,n=1.5*((e.position[1]-t.top)/i),s=Bo(e.size,e.size/4),r=qo(e.position[0],{amplitude:e.size,frequency:2*n,shift:Math.random()}),o=Bo(e.position[1],t.top-e.size);return Ro(e=>({position:[r(e),o(e)],size:s(e),trail:[]}),{easing:hh,duration:n})}(e,this.plotBounds)}}class td extends Xc{constructor(e){super(e)}makeEntryTween(e){return function(e,t){let i=.4*Math.random();return Ro(Vo({position:Uo([e.position[0],-1],e.position),trail:e.trail.length?Jc(e.trail.map(e=>[e[0],-1,0,0,0]),e.trail):void 0}),{easing:uh,delay:i,duration:.6})}(e,this.plotBounds)}makeExitTween(e){return function(e,t){let i=t.bottom-t.top,n=(t.bottom-e.position[1])/i,s=.4*Math.random(),r=1.2*n,o=t.bottom+100;return Ro(Vo({position:Uo(e.position,[e.position[0],o]),trail:e.trail.length?Jc(e.trail,e.trail.map(e=>[e[0],o,0,0,0])):void 0}),{easing:ah,delay:s,duration:r})}(e,this.plotBounds)}}class id extends Xc{constructor(e){super(e)}makeEntryTween(e){return function(e,t){let i=[(t.left+t.right)/2,(t.top+t.bottom)/2],n=Math.random();return Ro(Vo({position:Uo(i,e.position),size:Bo(0,e.size),trail:e.trail.length?Jc([[...i,0,0,0]],e.trail):void 0}),{easing:ch,delay:n})}(e,this.plotBounds)}makeExitTween(e){return function(e,t){let i=[(t.left+t.right)/2,(t.top+t.bottom)/2],n=.75*cr(e.position,i)/cr([t.left,t.top],i);return Ro(Vo({position:Uo(e.position,i),size:Bo(e.size,0),trail:e.trail.length?Jc(e.trail,[[...i,0,0,0]]):void 0}),{easing:uh,delay:n})}(e,this.plotBounds)}}class nd extends Xc{constructor(e){super(e)}makeEntryTween(e){return function(e){let t=.5*Math.random();return Vo({size:Ro(Bo(0,e.size),{easing:mh,delay:t,duration:.5}),trail:0===e.trail.length?void 0:Ro(Wo([],e.trail,1),{delay:t,duration:.5})})}(e)}makeExitTween(e){return function(e){let t=.5*Math.random();return Vo({size:Ro(Bo(e.size,0),{easing:ch,delay:t,duration:.1}),trail:e.trail.length?Ro(Wo(void 0,[],0),{delay:t,duration:.1}):void 0})}(e)}}class sd extends Xc{constructor(e){super(e)}makeEntryTween(e){return Wc(e)}makeExitTween(e){return Kc(e)}}class rd{constructor(e){let t=5*Math.random();this.effect=t<=1?new ed(e):t<=2?new td(e):t<=3?new id(e):t<=4?new nd(e):new sd(e)}makeCallback(e,t,i){return this.effect.makeCallback(e,t,i)}}class od extends Hh{makeEntryCallback(e){return Wc(e)}makeExitCallback(e){return Kc(e)}makeTransitionCallback(e,t){return function(e,t){let i,n,s;return e.hidden?t.hidden||(i=Bo(0,t.opacity),n=Bo(0,t.highlightOpacity),s=Wo(!0,!1,0)):t.hidden?(i=Bo(e.opacity,0),n=Bo(e.highlightOpacity,0),s=Wo(!1,!0,1)):(i=Bo(e.opacity,t.opacity),n=Bo(e.highlightOpacity,t.highlightOpacity)),Ro(Vo({position:Zo(e.position,t.position),size:jo(e.size,t.size),color:Ko(e.color,t.color,.5),opacity:i,highlightOpacity:n,hidden:s,selection:Ko(e.selection,t.selection,.5),trail:Qc(e,t)}),{easing:uh})}(e,t)}}class ld extends Gu{constructor(e){super(e),this.predicateSelection=null,this.predicateHidden=null,this.animationEffect=Gc.smooth,this.hideEffect=!1}setData(e){if(void 0===e)return this;this.data.clear();for(let t of e||[]){if(void 0===t.id)throw new Error(`Dot must not have undefined id: ${u(t)}`);if(this.data.has(t.id))throw new Error(`Dot id must be unique: ${u(t.id)}`);Number.isFinite(t.x)&&Number.isFinite(t.y)&&this.data.set(t.id,ki(t))}return this}setTrails(e){return void 0!==e&&this.data.forEach(t=>t.trail=e?e.get(t.id):void 0),this}getMinMax(){return function(e){let t=ec();for(let i of e||[])ic(i.x,i.y,i.axes,t);return t}(Hr(this.data.values(),e=>({x:e.x,y:e.y,axes:e.axes})))}setAnimationEffect(e){return this.animationEffect=Mt(e,Gc,Gc.fade),this}getAnimationEffect(){return this.animationEffect}getDurationMultiplier(){let e=Math.max(this.data.size,this.effect.getNoComponents());if(0===e||this.animationEffect===Gc.none)return 0;let t=this.animationEffect!==Gc.smooth&&this.getInOutEffectMode()===zh.mixed?1.75:1;return e=sr(Math.sqrt(e),10,100),t*=2-(100-e)/90,t}transitionState(e,t,i){return this.makeRenderEffect().makeCallback(e,t,i)}makeRenderEffect(){if(this.animationEffect===Gc.none||this.animationEffect===Gc.smooth)return new od;let e={plotBounds:this.stage.stageBounds(),mode:this.getInOutEffectMode()};return this.animationEffect===Gc.random?new rd(e):this.animationEffect===Gc.center?new id(e):this.animationEffect===Gc.up?new ed(e):this.animationEffect===Gc.down?new td(e):this.animationEffect===Gc.pop?new nd(e):this.animationEffect===Gc.fade?new sd(e):new od}datum2state(e){let t=Vu(e.axes),i=this.value2point([e.x,e.y],t),n=sr(null==e.size?.5:e.size,0,1),s=this.getBaseSize()*or(this.sizeRatioMin,this.sizeRatioMax,n),r=this.resolveColor(e.color||this.defaultColor),o=!!this.predicateHidden&&!1!==this.predicateHidden(e),l=o&&this.hideEffect?this.opacityMin:this.opacityMax,a=o&&this.hideEffect?this.highlightOpacityMin:this.highlightOpacityMax,h=this.predicateSelection?Math.max(-1,this.predicateSelection(e)):-1,u=function(e,t){if(null==e||!e.length)return[];let i,n=e.length,s=new Array(n),r=0;for(let o=0;o<n;o++){let l=e[o];if(lr(l)){if(r>0){if(i){let e=cr(i,l)/(r+1),[n,a]=Vc(e,t);s[o-r-1][2]=n,s[o-r-1][3]=a;for(let t=0;t<r;t++){let h=mr(i,l,(t+1)/(r+1));s[o-r+t]=[...h,e,n,a]}}else for(let e=0;e<r;e++)s[o-r+e]=[...l,0,0,0];r=0}s[o]=[...l,0,0,0],i=l}else{if(o===n-1&&i)for(let e=o-r;e<=o;e++)s[e]=[...i,0,0,0];r++}}return r===n?[]:s}(e.trail?e.trail.map(e=>lr(e)?this.value2point(e,t):[null,null]):[],this.trailGap);return{position:i,size:s,color:r,opacity:l,highlightOpacity:a,hidden:o&&!this.hideEffect,selection:h,trail:u}}getElementMargin(){if(0===this.getNoData()&&0===this.getNoComponents())return 0;return Math.ceil(1*this.getBaseSize()*(this.highlightRadius*this.sizeRatioMax+this.highlightThickness))}getBaseSize(){return null==this._baseSize?this.defaultBaseSize:this._baseSize}setBaseSize(e){this._baseSize=e}select(e){return this.predicateSelection=Iu(e),this}setHideEffect(e){return this.hideEffect=e,this}getHideEffect(){return this.hideEffect}hide(e){return this.predicateHidden=Cu(e),this}show(e){const t=Cu(e);return this.predicateHidden=t&&(e=>!t(e)),this}initializeCssProperties(){super.initializeCssProperties(),this.defaultColor=this.cssStringProp("dot-color","30, 147, 255"),this.defaultBaseSize=this.cssPixelProp("dot-size",10),this.sizeRatioMin=this.cssNumberProp("dot-size-ratio-min",.2),this.sizeRatioMax=this.cssNumberProp("dot-size-ratio-max",3),this.opacityMin=this.cssNumberProp("dot-opacity-min",.2),this.opacityMax=this.cssNumberProp("dot-opacity-max",.8),this.highlightRadius=this.cssNumberProp("dot-highlight-radius",1.3),this.highlightThickness=this.cssNumberProp("dot-highlight-thickness",.1),this.highlightOpacityMin=this.cssNumberProp("dot-highlight-opacity-min",.4),this.highlightOpacityMax=this.cssNumberProp("dot-highlight-opacity-max",1),this.highlightFill=this.cssStringProp("dot-highlight-fill","255, 255, 255"),this.trailGap=this.cssNumberProp("dot-trail-gap",5)}}class ad extends xc{constructor(e){super(e,{position:[0,0],size:10,color:"125, 125, 125",opacity:0,highlightOpacity:0,hidden:!1,selection:-1,trail:[]})}}const hd={1:"M-0.46875000,4 L-0.46875000,-2.44531250 L-2.47265625,-1.84179688 L-2.47265625,-3.26562500 L1.11328125,-4.53710938 L1.29492188,-4.53710938 L1.29492188,4 Z",2:"M-2.88281250,4 L-2.88281250,2.78710938 L-0.12304688,-0.13085938 C0.26758008,-0.56445529 0.54589761,-0.93066257 0.71191406,-1.22949219 C0.87793052,-1.52832181 0.96093750,-1.79882691 0.96093750,-2.04101562 C0.96093750,-2.41601750 0.86816499,-2.70800677 0.68261719,-2.91699219 C0.49706938,-3.12597761 0.23437670,-3.23046875 -0.10546875,-3.23046875 C-0.34765746,-3.23046875 -0.55761630,-3.16992248 -0.73535156,-3.04882812 C-0.91308683,-2.92773377 -1.04882766,-2.76074325 -1.14257812,-2.54785156 C-1.23632859,-2.33495987 -1.28320312,-2.09375135 -1.28320312,-1.82421875 L-3.05273438,-1.82421875 C-3.05273438,-2.34375260 -2.92968873,-2.81933378 -2.68359375,-3.25097656 C-2.43749877,-3.68261935 -2.08789289,-4.02441280 -1.63476562,-4.27636719 C-1.18163836,-4.52832157 -0.66015920,-4.65429688 -0.07031250,-4.65429688 C0.53125301,-4.65429688 1.04101354,-4.55761815 1.45898438,-4.36425781 C1.87695521,-4.17089747 2.19335830,-3.89160339 2.40820312,-3.52636719 C2.62304795,-3.16113099 2.73046875,-2.72265881 2.73046875,-2.21093750 C2.73046875,-1.83984189 2.65527419,-1.48047049 2.50488281,-1.13281250 C2.35449144,-0.78515451 2.14355604,-0.43847829 1.87207031,-0.09277344 C1.60058458,0.25293142 1.24609594,0.65234148 0.80859375,1.10546875 L-0.59765625,2.57617188 L2.98828125,2.57617188 L2.98828125,4 L-2.88281250,4 Z",3:"M2.53125000,0.37890625 C2.77343871,0.71875170 2.89453125,1.12695074 2.89453125,1.60351562 C2.89453125,2.12304947 2.76172008,2.57226373 2.49609375,2.95117188 C2.23046742,3.33008002 1.86621325,3.61913963 1.40332031,3.81835938 C0.94042737,4.01757912 0.41601855,4.11718750 -0.16992188,4.11718750 C-0.67383064,4.11718750 -1.14941183,4.02636810 -1.59667969,3.84472656 C-2.04394755,3.66308503 -2.40624861,3.38672061 -2.68359375,3.01562500 C-2.96093889,2.64452939 -3.09960938,2.18945582 -3.09960938,1.65039062 L-1.33007812,1.65039062 C-1.33007812,1.84570410 -1.27734428,2.02343670 -1.17187500,2.18359375 C-1.06640572,2.34375080 -0.92187592,2.46874955 -0.73828125,2.55859375 C-0.55468658,2.64843795 -0.34961051,2.69335937 -0.12304688,2.69335937 C0.13476691,2.69335937 0.35839749,2.64550829 0.54785156,2.54980469 C0.73730563,2.45410108 0.88183544,2.32226646 0.98144531,2.15429688 C1.08105519,1.98632729 1.13085938,1.79296984 1.13085938,1.57421875 C1.13085938,0.74608961 0.67969201,0.33203125 -0.22265625,0.33203125 L-1.13671875,0.33203125 L-1.13671875,-1.04492188 L-0.22265625,-1.04492188 C0.17578324,-1.04492188 0.47851459,-1.14648336 0.68554688,-1.34960938 C0.89257916,-1.55273539 0.99609375,-1.83202947 0.99609375,-2.18750000 C0.99609375,-2.49609529 0.90136813,-2.74706935 0.71191406,-2.94042969 C0.52245999,-3.13379003 0.24414246,-3.23046875 -0.12304688,-3.23046875 C-0.31836035,-3.23046875 -0.49999916,-3.19335975 -0.66796875,-3.11914062 C-0.83593834,-3.04492150 -0.96972606,-2.93945381 -1.06933594,-2.80273438 C-1.16894581,-2.66601494 -1.21875000,-2.50781340 -1.21875000,-2.32812500 L-2.98828125,-2.32812500 C-2.98828125,-2.78906480 -2.86230595,-3.19628729 -2.61035156,-3.54980469 C-2.35839718,-3.90332208 -2.01758027,-4.17578029 -1.58789062,-4.36718750 C-1.15820098,-4.55859471 -0.68554945,-4.65429688 -0.16992188,-4.65429688 C0.41601855,-4.65429688 0.92968529,-4.56152437 1.37109375,-4.37597656 C1.81250221,-4.19042876 2.15527222,-3.91504089 2.39941406,-3.54980469 C2.64355591,-3.18456849 2.76562500,-2.74023699 2.76562500,-2.21679688 C2.76562500,-1.83788873 2.65136833,-1.48437664 2.42285156,-1.15625000 C2.19433479,-0.82812336 1.87695516,-0.57031344 1.47070312,-0.38281250 C1.93554920,-0.21484291 2.28906129,0.03906080 2.53125000,0.37890625 Z",4:"M3.12304688,2.16601562 L2.18554688,2.16601562 L2.18554688,4 L0.41601562,4 L0.41601562,2.16601562 L-3.02929688,2.16601562 L-3.11718750,1.04687500 L0.40429687,-4.53125000 L2.18554688,-4.53125000 L2.18554688,0.74218750 L3.12304688,0.74218750 L3.12304688,2.16601562 Z M0.41601562,0.74218750 L0.41601562,-2.13476562 L0.29882812,-1.92968750 L-1.38281250,0.74218750 L0.41601562,0.74218750 Z",5:"M-2.16796875,-4.53125000 L2.66601562,-4.53125000 L2.66601562,-3.07812500 L-0.72070312,-3.07812500 L-0.92578125,-1.29101562 C-0.78515555,-1.37304729 -0.60156363,-1.44726529 -0.37500000,-1.51367188 C-0.14843637,-1.58007846 0.08984250,-1.61328125 0.33984375,-1.61328125 C0.89062775,-1.61328125 1.36132617,-1.50000113 1.75195312,-1.27343750 C2.14258008,-1.04687387 2.44042866,-0.71875215 2.64550781,-0.28906250 C2.85058696,0.14062715 2.95312500,0.65624699 2.95312500,1.25781250 C2.95312500,1.77344008 2.84472765,2.24804471 2.62792969,2.68164062 C2.41113173,3.11523654 2.08496312,3.46288932 1.64941406,3.72460938 C1.21386501,3.98632943 0.67969066,4.11718750 0.04687500,4.11718750 C-0.45703377,4.11718750 -0.92968529,4.01562602 -1.37109375,3.81250000 C-1.81250221,3.60937398 -2.17089706,3.31738472 -2.44628906,2.93652344 C-2.72168106,2.55566216 -2.86328121,2.11133066 -2.87109375,1.60351562 L-1.11328125,1.60351562 C-1.08203109,1.94336107 -0.96386821,2.20995997 -0.75878906,2.40332031 C-0.55370991,2.59668065 -0.28711102,2.69335938 0.04101562,2.69335938 C0.43554885,2.69335938 0.72460846,2.55175923 0.90820312,2.26855469 C1.09179779,1.98535015 1.18359375,1.61133045 1.18359375,1.14648438 C1.18359375,0.69335711 1.07324329,0.33886847 0.85253906,0.08300781 C0.63183483,-0.17285284 0.29883035,-0.30078125 -0.14648438,-0.30078125 C-0.41992324,-0.30078125 -0.63964761,-0.25976604 -0.80566406,-0.17773438 C-0.97168052,-0.09570271 -1.12304619,0.01562430 -1.25976562,0.15625000 L-2.66601563,-0.18945312 L-2.16796875,-4.53125000 Z",6:"M1.95117188,-1.34375000 C2.31445494,-1.08593621 2.58886626,-0.73730688 2.77441406,-0.29785156 C2.95996187,0.14160376 3.05273438,0.63476289 3.05273438,1.18164062 C3.05273438,1.73633090 2.93261839,2.23632590 2.69238281,2.68164062 C2.45214724,3.12695535 2.11133033,3.47753778 1.66992188,3.73339844 C1.22851342,3.98925909 0.72265910,4.11718750 0.15234375,4.11718750 C-0.44922176,4.11718750 -0.97948989,3.97656391 -1.43847656,3.69531250 C-1.89746323,3.41406109 -2.25390498,3.01562758 -2.50781250,2.50000000 C-2.76172002,1.98437242 -2.88867188,1.38672215 -2.88867188,0.70703125 L-2.88867188,0.02734375 C-2.88867188,-0.90234840 -2.70800962,-1.71972304 -2.34667969,-2.42480469 C-1.98534976,-3.12988634 -1.47265957,-3.67480276 -0.80859375,-4.05957031 C-0.14452793,-4.44433786 0.62499562,-4.63671875 1.50000000,-4.63671875 L1.75781250,-4.63671875 L1.75781250,-3.17773438 L1.65234375,-3.17773438 C0.88280865,-3.17773438 0.25976801,-2.99121280 -0.21679688,-2.61816406 C-0.69336176,-2.24511532 -0.98046826,-1.71680029 -1.07812500,-1.03320312 C-0.86718645,-1.25195422 -0.61718895,-1.42285095 -0.32812500,-1.54589844 C-0.03906105,-1.66894593 0.28124824,-1.73046875 0.63281250,-1.73046875 C1.14844008,-1.73046875 1.58788881,-1.60156379 1.95117188,-1.34375000 Z M0.72949219,2.49414062 C0.90722745,2.36523373 1.04492139,2.18750113 1.14257812,1.96093750 C1.24023486,1.73437387 1.28906250,1.47851705 1.28906250,1.19335938 C1.28906250,0.89648289 1.23925831,0.63379021 1.13964844,0.40527344 C1.04003856,0.17675667 0.89843842,0.00000062 0.71484375,-0.12500000 C0.53124908,-0.25000062 0.31640748,-0.31250000 0.07031250,-0.31250000 C-0.20312637,-0.31250000 -0.44433489,-0.24316476 -0.65332031,-0.10449219 C-0.86230573,0.03418038 -1.01757762,0.20898332 -1.11914062,0.41992188 L-1.11914062,0.95312500 C-1.11914062,1.52344035 -1.00976672,1.95507666 -0.79101562,2.24804688 C-0.57226453,2.54101709 -0.26953318,2.68750000 0.11718750,2.68750000 C0.34765740,2.68750000 0.55175692,2.62304752 0.72949219,2.49414062 Z",7:"M-0.31640625,4 L-2.17968750,4 L1.08984375,-3.10742188 L-3.10546875,-3.10742188 L-3.10546875,-4.53125000 L2.95312500,-4.53125000 L2.95312500,-3.54687500 Z",8:"M2.55175781,0.43457031 C2.78808712,0.78808771 2.90625000,1.19531020 2.90625000,1.65625000 C2.90625000,2.18359639 2.78222780,2.63183409 2.53417969,3.00097656 C2.28613157,3.37011903 1.94433812,3.64843656 1.50878906,3.83593750 C1.07324001,4.02343844 0.57226846,4.11718750 0.00585938,4.11718750 C-0.55664344,4.11718750 -1.05761499,4.02343844 -1.49707031,3.83593750 C-1.93652563,3.64843656 -2.28222530,3.37011903 -2.53417969,3.00097656 C-2.78613407,2.63183409 -2.91210938,2.18359639 -2.91210938,1.65625000 C-2.91210938,1.19531020 -2.79296994,0.78711115 -2.55468750,0.43164062 C-2.31640506,0.07617010 -1.98828334,-0.20117088 -1.57031250,-0.40039062 C-1.93359557,-0.59570410 -2.21679586,-0.85351402 -2.41992188,-1.17382812 C-2.62304789,-1.49414223 -2.72460938,-1.85741984 -2.72460938,-2.26367188 C-2.72460938,-2.76758064 -2.60937615,-3.19921695 -2.37890625,-3.55859375 C-2.14843635,-3.91797055 -1.82715050,-4.19042876 -1.41503906,-4.37597656 C-1.00292763,-4.56152437 -0.53125266,-4.65429688 0,-4.65429688 C0.53515893,-4.65429688 1.00878700,-4.56152437 1.42089844,-4.37597656 C1.83300987,-4.19042876 2.15429572,-3.91797055 2.38476562,-3.55859375 C2.61523553,-3.19921695 2.73046875,-2.76758064 2.73046875,-2.26367188 C2.73046875,-1.85741984 2.62890727,-1.49316567 2.42578125,-1.17089844 C2.22265523,-0.84863120 1.93945494,-0.58984473 1.57617188,-0.39453125 C1.99023645,-0.19531150 2.31542851,0.08105292 2.55175781,0.43457031 Z M-0.70312500,-2.94628906 C-0.87109459,-2.75683499 -0.95507812,-2.49804852 -0.95507812,-2.16992188 C-0.95507812,-1.84179523 -0.87011804,-1.57910255 -0.70019531,-1.38183594 C-0.53027259,-1.18456933 -0.29492338,-1.08593750 0.00585938,-1.08593750 C0.30664213,-1.08593750 0.54101479,-1.18359277 0.70898438,-1.37890625 C0.87695396,-1.57421973 0.96093750,-1.83788896 0.96093750,-2.16992188 C0.96093750,-2.49414225 0.87597741,-2.75195217 0.70605469,-2.94335938 C0.53613196,-3.13476658 0.30078275,-3.23046875 0,-3.23046875 C-0.30078275,-3.23046875 -0.53515541,-3.13574313 -0.70312500,-2.94628906 Z M0.83203125,2.37988281 C1.03515727,2.17089739 1.13671875,1.88476744 1.13671875,1.52148438 C1.13671875,1.15429504 1.03320416,0.86621198 0.82617188,0.65722656 C0.61913959,0.44824114 0.34179861,0.34375000 -0.00585938,0.34375000 C-0.34961109,0.34375000 -0.62402241,0.44824114 -0.82910156,0.65722656 C-1.03418071,0.86621198 -1.13671875,1.15429504 -1.13671875,1.52148438 C-1.13671875,1.88086117 -1.03320416,2.16601457 -0.82617188,2.37695312 C-0.61913959,2.58789168 -0.34179861,2.69335938 0.00585938,2.69335938 C0.35351736,2.69335938 0.62890523,2.58886823 0.83203125,2.37988281 Z",9:"M1.45898438,-4.22949219 C1.90039283,-3.94628765 2.24316284,-3.54101826 2.48730469,-3.01367188 C2.73144653,-2.48632549 2.85351562,-1.87109727 2.85351562,-1.16796875 L2.85351562,-0.54101562 C2.85351562,0.41992668 2.68261890,1.24804340 2.34082031,1.94335938 C1.99902173,2.63867535 1.50000328,3.17187314 0.84375000,3.54296875 C0.18749672,3.91406436 -0.60546410,4.09960938 -1.53515625,4.09960938 L-1.66992188,4.09960938 L-1.66992188,2.61718750 L-1.55859375,2.61718750 C-0.74218342,2.61718750 -0.11914277,2.45312664 0.31054688,2.12500000 C0.74023652,1.79687336 0.99023402,1.29687836 1.06054688,0.62500000 C0.85351459,0.82031348 0.62011849,0.97363226 0.36035156,1.08496094 C0.10058464,1.19628962 -0.17187357,1.25195312 -0.45703125,1.25195312 C-0.97656510,1.25195312 -1.42382625,1.12988403 -1.79882812,0.88574219 C-2.17383000,0.64160034 -2.45995995,0.30273654 -2.65722656,-0.13085938 C-2.85449317,-0.56445529 -2.95312500,-1.06249719 -2.95312500,-1.62500000 C-2.95312500,-2.17969027 -2.83203246,-2.68749770 -2.58984375,-3.14843750 C-2.34765504,-3.60937730 -2.00781469,-3.97558458 -1.57031250,-4.24707031 C-1.13281031,-4.51855605 -0.63086221,-4.65429688 -0.06445312,-4.65429688 C0.50976850,-4.65429688 1.01757592,-4.51269673 1.45898438,-4.22949219 Z M0.64746094,-0.28320312 C0.83691501,-0.40820375 0.98242137,-0.56835840 1.08398438,-0.76367188 L1.08398438,-1.49609375 C1.08398438,-2.05859656 0.97851668,-2.48730321 0.76757812,-2.78222656 C0.55663957,-3.07714991 0.27734549,-3.22460938 -0.07031250,-3.22460938 C-0.29687613,-3.22460938 -0.49511634,-3.14941481 -0.66503906,-2.99902344 C-0.83496179,-2.84863206 -0.96484330,-2.65234496 -1.05468750,-2.41015625 C-1.14453170,-2.16796754 -1.18945312,-1.91015762 -1.18945312,-1.63671875 C-1.18945312,-1.18749775 -1.08789164,-0.81836082 -0.88476562,-0.52929688 C-0.68163961,-0.24023293 -0.39062689,-0.09570312 -0.01171875,-0.09570312 C0.23828250,-0.09570312 0.45800687,-0.15820250 0.64746094,-0.28320312 Z"};function ud(e,t,i){let n=hd[e];if(!n)return;n=n.trim();let s=t/9;i.scale(s,s),i.beginPath();let r,o=/([MLCZ])([^MLCZ]*)/g;for(;r=o.exec(n);){let e=r[1],t=r[2].trim(),n=(t?t.split(/[\s,]/):[]).map(e=>+e);switch(e){case"M":i.moveTo(...n);break;case"L":i.lineTo(...n);break;case"C":i.bezierCurveTo(...n);break;case"Z":i.closePath()}}i.fill()}var cd;!function(e){e.ball="ball",e.bubble="bubble",e.circle="circle",e.disk="disk"}(cd||(cd={}));class dd{constructor(e){this.styleProvider=e.style,this.templates=new n(e=>{let t=function(e){let[t,i]=e.split("--",2);return{color:i,selection:t?+t:-1}}(e),i=Zu();return this.drawTemplate(t.color,t.selection>=0,t.selection+1,i),i})}style(){return this._style||(this._style=this.styleProvider()),this._style}reset(){return this.templates.clear(),this._style=void 0,this}render(e,t){return e.hidden?this:(t.globalAlpha=e.opacity,this.drawTrailBackground(e,t),this.drawTrail(e,t),t.translate(...e.position),this.renderDot(e,t),this)}renderDot(e,t){let i=e.size/40;t.scale(i,i);let n=function(e){return(e.selection<0?"":e.selection)+"--"+(e.color||"1-1")}(e),s=this.templates.compute(n),r=s.canvas.width/2;t.drawImage(s.canvas,-r,-r)}drawTrail(e,t){let i=e.trail.length;if(0===i)return;let n=this.style();t.strokeStyle=`rgb(${n.trailColor||e.color})`,t.lineWidth=n.trailThickness,t.lineCap="round",t.lineJoin="round",t.beginPath();let s=e.trail[0],r=!0;for(let n=1;n<i;n++){let i=e.trail[n];r&&(t.moveTo(s[0],s[1]),r=!1);let l=s[2],a=s[3],h=s[4];if(l>=1&&a>=1&&h>=1){let e=Math.floor((l+h)/(a+h));for(let n=1;n<e;n++){let e;e=(n*(a+h)-h)/l,t.lineTo(...o(s,i,e)),e=n*(a+h)/l,t.moveTo(...o(s,i,e))}}t.lineTo(i[0],i[1]),s=i}function o(e,t,i){return[or(e[0],t[0],i),or(e[1],t[1],i)]}t.stroke()}drawTrailBackground(e,t){let i=e.trail.length;if(0===i)return;let n=this.style();t.strokeStyle=`rgb(${n.trailBackgroundColor})`,t.filter=`blur(${n.trailBackgroundThickness/2}px)`,t.lineWidth=n.trailBackgroundThickness,t.lineCap="round",t.lineJoin="round",t.beginPath();let s=e.trail[0],r=!0;for(let n=1;n<i;n++){let i=e.trail[n];r&&(t.moveTo(s[0],s[1]),r=!1),t.lineTo(i[0],i[1]),s=i}t.stroke(),t.filter="blur(0px)"}drawTemplate(e,t,i,n){const s=this.style();let r=Math.max(1,Math.round(40*s.highlightThickness)),o=(t?Math.ceil(40*s.highlightRadius+r/2):40)+1;if(n.canvas.width=2*o,n.canvas.height=2*o,n.translate(o,o),t){let t=s.highlightDash.map(e=>40*e);t.length%2!=0&&t.push(...t);let i=40*Lo,o=t.reduce((e,t)=>e+t,0),l=(i-Math.floor(i/o)*o)/t.length;t=t.map(e=>e+l),n.fillStyle=`rgba(${s.highlightFill}, .5)`,n.strokeStyle=`rgb(${e})`,n.lineWidth=r,n.setLineDash(t),n.beginPath(),n.arc(0,0,40*s.highlightRadius,0,Lo,!1),n.fill(),n.stroke()}switch(s.style){case cd.ball:n.fillStyle=l(e),n.beginPath(),n.arc(0,0,40,0,Lo,!1),n.fill();break;case cd.bubble:n.fillStyle=l(e),n.strokeStyle=`rgb(${e})`,n.lineWidth=r/2,n.beginPath(),n.arc(0,0,40-r/4,0,Lo,!1),n.globalAlpha=.3,n.fill(),n.globalAlpha=1,n.stroke();break;case cd.circle:n.strokeStyle=`rgb(${e})`,n.lineWidth=r,n.beginPath(),n.arc(0,0,40-r/2,0,Lo,!1),n.stroke();break;case cd.disk:default:n.fillStyle=`rgb(${e})`,n.beginPath(),n.arc(0,0,40,0,Lo,!1),n.fill()}function l(e){let t=n.createRadialGradient(-40,-40,0,-12,-12,40),i=e.split(",").map(e=>(127.5+.5*+e).toFixed(0)).join();return t.addColorStop(.05,"#fff"),t.addColorStop(.7,`rgb(${i})`),t.addColorStop(1,`rgb(${e})`),t}i>0&&(n.fillStyle=s.style===cd.bubble||s.style===cd.circle?`rgb(${e})`:`rgb(${s.numberColor})`,ud(i,40,n))}getUITarget(e,t){return function(e,t){let[i,n]=t.position,[s,r]=e,o=t.size;if(!(s<i-o||i+o<s||r<n-o||n+o<r||dr(e,t.position)>Math.pow(o,2)))return{distance:0,bounds:{left:i-o,right:i+o,top:n-o,bottom:n+o}}}(e,t)}}class fd extends ld{constructor(e){super(e),this.group=e.group,this.renderer=new dd({style:()=>({style:this.dotStyle,numberColor:this.numberColor,highlightRadius:this.highlightRadius,highlightThickness:this.highlightThickness,highlightDash:this.highlightDash.slice(),highlightFill:this.highlightFill,trailColor:this.trailColor,trailThickness:this.trailThickness,trailBackgroundColor:this.trailBackgroundColor,trailBackgroundThickness:this.trailBackgroundThickness})})}createComponent(e,t){return new ad({group:this.group,renderer:this.renderer,manager:this,id:e,state:t})}refreshStyle(){return this.renderer.reset(),super.refreshStyle()}initializeCssProperties(){super.initializeCssProperties(),this.dotStyle=Mt(this.cssStringProp("dot-style","ball"),cd,cd.ball),this.highlightDash=this.cssNumbersProp("dot-highlight-dash",[.3,.3]).filter(e=>null!=e),this.numberColor=this.cssStringProp("dot-number-color","255, 255, 255"),this.trailColor=this.cssStringProp("dot-trail-color","125, 125, 125"),this.trailThickness=this.cssNumberProp("dot-trail-thickness",3),this.trailBackgroundColor=this.cssStringProp("dot-trail-background-color","255, 255, 255"),this.trailBackgroundThickness=this.cssNumberProp("dot-trail-background-thickness",7)}}var md;!function(e){e.smooth="smooth",e.fade="fade",e.center="center",e.down="down",e.up="up",e.pop="pop",e.random="random",e.none="none"}(md||(md={}));class pd extends qh{constructor(e){super(e),this.plotBounds=e.plotBounds}}function gd(e){return Ro(Vo({opacity:Bo(0,e.opacity)}),{duration:.8})}function bd(e){return Ro(Vo({opacity:Bo(e.opacity,0)}),{easing:ch})}class wd extends pd{constructor(e){super(e)}makeEntryTween(e){return function(e,t){let i=.4*Math.random(),n=t.bottom+100;return Ro(Vo({center:Uo([e.center[0],n],e.center)}),{easing:ah,delay:i,duration:.6})}(e,this.plotBounds)}makeExitTween(e){return function(e,t){let i=t.bottom-t.top,n=(t.bottom-e.center[1])/i,s=.4*Math.random(),r=1.2*n;return Ro(Vo({center:Uo(e.center,[e.center[0],-100])}),{easing:ah,delay:s,duration:r})}(e,this.plotBounds)}}class vd extends pd{constructor(e){super(e)}makeEntryTween(e){return function(e,t){let i=.4*Math.random();return Ro(Vo({center:Uo([e.center[0],-1],e.center)}),{easing:uh,delay:i,duration:.6})}(e,this.plotBounds)}makeExitTween(e){return function(e,t){let i=t.bottom-t.top,n=(t.bottom-e.center[1])/i,s=.4*Math.random(),r=1.2*n,o=t.bottom+100;return Ro(Vo({center:Uo(e.center,[e.center[0],o])}),{easing:ah,delay:s,duration:r})}(e,this.plotBounds)}}class yd extends pd{constructor(e){super(e)}makeEntryTween(e){return function(e,t){let i=[(t.left+t.right)/2,(t.top+t.bottom)/2],n=Math.random();return Ro(Vo({center:Uo(i,e.center),radii:Uo([0,0],e.radii)}),{easing:ch,delay:n})}(e,this.plotBounds)}makeExitTween(e){return function(e,t){let i=[(t.left+t.right)/2,(t.top+t.bottom)/2],n=.75*cr(e.center,i)/cr([t.left,t.top],i);return Ro(Vo({center:Uo(e.center,i),radii:Uo(e.radii,[0,0])}),{easing:uh,delay:n})}(e,this.plotBounds)}}class xd extends pd{constructor(e){super(e)}makeEntryTween(e){return function(e){let t=.5*Math.random();return Vo({radii:Ro(Uo([0,0],e.radii),{easing:mh,delay:t,duration:.5})})}(e)}makeExitTween(e){return function(e){let t=.5*Math.random();return Vo({radii:Ro(Uo(e.radii,[0,0]),{easing:ch,delay:t,duration:.1})})}(e)}}class Sd extends pd{constructor(e){super(e)}makeEntryTween(e){return gd(e)}makeExitTween(e){return bd(e)}}class Ed{constructor(e){let t=5*Math.random();this.effect=t<=1?new wd(e):t<=2?new vd(e):t<=3?new yd(e):t<=4?new xd(e):new Sd(e)}makeCallback(e,t,i){return this.effect.makeCallback(e,t,i)}}class kd extends Hh{makeEntryCallback(e){return gd(e)}makeExitCallback(e){return bd(e)}makeTransitionCallback(e,t){return function(e,t){let i,n,s;return e.hidden?t.hidden||(i=Bo(0,t.opacity),n=Wo(!0,!1,0)):t.hidden?(i=Bo(e.opacity,0),n=Wo(!1,!0,1)):i=Bo(e.opacity,t.opacity),e.fuzzy?t.fuzzy||(s=Wo(!0,!1,.9)):t.fuzzy&&(s=Wo(!1,!0,.1)),Ro(Vo({center:Zo(e.center,t.center),theta:jo(e.theta,t.theta),radii:Zo(e.radii,t.radii),color:Ko(e.color,t.color,.5),opacity:i,hidden:n,selection:Ko(e.selection,t.selection,.5),fuzzy:s}),{easing:uh})}(e,t)}}class Nd extends Gu{constructor(e){super(e),this.predicateSelection=null,this.predicateHidden=null,this.animationEffect=md.smooth}setData(e){if(void 0===e)return this;this.data.clear();for(let t of e||[]){if(void 0===t.id)throw new Error(`Kernel must not have undefined id: ${u(t)}`);if(this.data.has(t.id))throw new Error(`Kernel id must be unique: ${u(t.id)}`);if(!t.center||!t.radii||null==t.theta)throw new Error(`Kernel ${u(t.id)} must have non-null center, radii, and theta.`);this.data.set(t.id,ki(t))}return this}getMinMax(){return tc(Hr(this.data.values(),e=>{let t=function(e){let t=Math.sqrt(Math.pow(e.radii[0],2)+Math.pow(e.radii[1],2)),i=Math.atan2(e.radii[1],e.radii[0]),n=Math.atan2(e.radii[1],-e.radii[0]);return[[t,i+e.theta],[t,-i+e.theta],[t,n+e.theta],[t,-n+e.theta]].map(vr).map(t=>[e.center[0]+t[0],e.center[1]+t[1]])}(e);return{x:eo(t.map(e=>e[0])),y:eo(t.map(e=>e[1])),axes:e.axes}}))}setAnimationEffect(e){return this.animationEffect=Mt(e,md,md.fade),this}getAnimationEffect(){return this.animationEffect}getDurationMultiplier(){let e=Math.max(this.data.size,this.effect.getNoComponents());if(0===e||this.animationEffect===md.none)return 0;let t=this.animationEffect!==md.smooth&&this.getInOutEffectMode()===zh.mixed?1.75:1;return e=sr(Math.sqrt(e),10,100),t*=2-(100-e)/90,t}transitionState(e,t,i){return this.makeRenderEffect().makeCallback(e,t,i)}makeRenderEffect(){if(this.animationEffect===md.none||this.animationEffect===md.smooth)return new kd;let e={plotBounds:this.stage.stageBounds(),mode:this.getInOutEffectMode()};return this.animationEffect===md.random?new Ed(e):this.animationEffect===md.center?new yd(e):this.animationEffect===md.up?new wd(e):this.animationEffect===md.down?new vd(e):this.animationEffect===md.pop?new xd(e):this.animationEffect===md.fade?new Sd(e):new kd}datum2state(e){if(!e.center||null==e.center[0]||Number.isNaN(e.center[0])||null==e.center[1]||Number.isNaN(e.center[1])||!e.radii||!Number.isFinite(e.radii[0])||!Number.isFinite(e.radii[1])||!Number.isFinite(e.theta))return;let t=!1!==e.fuzzy,i=this.predicateSelection?Math.max(-1,this.predicateSelection(e)):-1,n=t?i<0?or(null==e.opacity?1:e.opacity,this.minOpacity,this.maxOpacity):this.maxOpacity:this.pointOpacity,s=Vu(e.axes),r=t?[this.stage.value2pixel(e.radii[0],s.x)-this.stage.value2pixel(0,s.x),this.stage.value2pixel(0,s.y)-this.stage.value2pixel(e.radii[1],s.y)]:[this.getBaseSize(),this.getBaseSize()],o=!!this.predicateHidden&&!1!==this.predicateHidden(e);return{center:[this.stage.value2pixel(e.center[0],s.x),this.stage.value2pixel(e.center[1],s.y)],radii:r,theta:e.theta,color:this.resolveColor(e.color||this.defaultColor),opacity:n,hidden:o,selection:i,fuzzy:t}}getElementMargin(){return 0===this.getNoData()&&0===this.getNoComponents()?0:this.getBaseSize()}getBaseSize(){return null==this._baseSize?this.defaultBaseSize:this._baseSize}setBaseSize(e){this._baseSize=e}select(e){return this.predicateSelection=Iu(e),this}hide(e){return this.predicateHidden=Cu(e),this}show(e){const t=Cu(e);return this.predicateHidden=t&&(e=>!t(e)),this}initializeCssProperties(){super.initializeCssProperties(),this.defaultColor=this.cssStringProp("kernel-color","125, 125, 125"),this.defaultBaseSize=this.cssPixelProp("kernel-point-radius",4),this.minOpacity=this.cssNumberProp("kernel-min-opacity",.3),this.maxOpacity=this.cssNumberProp("kernel-max-opacity",.8),this.pointOpacity=this.cssNumberProp("kernel-point-opacity",.7)}}class Cd extends xc{constructor(e){super(e,{center:[0,0],theta:0,radii:[0,0],color:"125, 125, 125",opacity:0,hidden:!1,selection:-1,fuzzy:!1})}}function Id(e){let[t,i]=e.split("--",2);return{color:i,selection:t?+t:-1}}class Md{constructor(e){this.styleProvider=e.style,this.kernelTemplates=new n(e=>{let t=Id(e),i=Zu();return this.drawKernelTemplate(t.color,t.selection>=0,i),i}),this.kernelNumberTemplates=new n(e=>{let t=Id(e),i=Zu();return this.drawKernelNumberTemplate(t.color,t.selection>=0,t.selection+1,i),i}),this.dotTemplates=new n(e=>{let t=Id(e),i=Zu();return this.drawDotTemplate(t.color,t.selection>=0,t.selection+1,i),i})}style(){return this._style||(this._style=this.styleProvider()),this._style}reset(){return this.kernelTemplates.clear(),this.dotTemplates.clear(),this._style=void 0,this}render(e,t){if(e.hidden)return this;t.translate(...e.center),t.globalAlpha=e.opacity;let i=function(e){return(e.selection<0?"":e.selection)+"--"+(e.color||"1-1")}(e);if(e.fuzzy){t.rotate(-e.theta),t.scale(e.radii[0]/80,e.radii[1]/80);let n=this.kernelTemplates.compute(i),s=n.canvas.width/2;if(t.drawImage(n.canvas,-s,-s),e.selection>=0){t.resetTransform(),t.translate(...e.center);let r=Math.min(e.radii[0],e.radii[1])/80;t.scale(r,r),n=this.kernelNumberTemplates.compute(i),s=n.canvas.width/2,t.drawImage(n.canvas,-s,-s)}}else{let n=(e.radii[0]+e.radii[1])/40;t.scale(n,n);let s=this.dotTemplates.compute(i),r=s.canvas.width/2;t.drawImage(s.canvas,-r,-r)}return this}drawKernelTemplate(e,t,i){const n=this.style();i.canvas.width=162,i.canvas.height=162,i.translate(81,81);i.filter="blur(12px)",i.fillStyle=`rgba(${e}, .22)`,i.beginPath(),i.arc(0,0,.17*80,0,Lo,!1),i.fill(),i.fillStyle=`rgba(${e}, .56)`,i.beginPath(),i.arc(0,0,40,0,Lo,!1),i.fill(),i.fillStyle=`rgba(${e}, .32)`,i.beginPath(),i.arc(0,0,68,0,Lo,!1),i.fill(),t&&(i.filter="blur(0px)",i.lineWidth=80*n.highlightThickness,i.strokeStyle=`rgb(${e})`,i.beginPath(),i.arc(0,0,80,0,Lo,!1),i.stroke())}drawKernelNumberTemplate(e,t,i,n){if(i<=0)return;const s=this.style();n.canvas.width=162,n.canvas.height=162,n.translate(81,81),n.fillStyle=`rgb(${s.numberColor})`,ud(i,80,n)}drawDotTemplate(e,t,i,n){const s=this.style();let r=Math.max(1,Math.round(20*s.pointHighlightThickness)),o=(t?Math.ceil(20*s.pointHighlightRadius+r/2):20)+1;n.canvas.width=2*o,n.canvas.height=2*o,n.translate(o,o),t&&(n.fillStyle=`rgba(${s.pointHighlightFill}, .5)`,n.strokeStyle=`rgb(${e})`,n.lineWidth=r,n.beginPath(),n.arc(0,0,20*s.pointHighlightRadius,0,Lo,!1),n.fill(),n.stroke()),n.fillStyle=`rgb(${e})`,n.beginPath(),n.arc(0,0,20,0,Lo,!1),n.fill(),i>0&&(n.fillStyle=`rgb(${s.numberColor})`,ud(i,20,n))}getUITarget(e,t){return function(e,t){let[i,n]=t.center,[s,r]=e,[o,l]=t.radii;if(t.fuzzy&&0!==l&&0!==l){let e=Math.max(o,l);if(s<i-e||i+e<s||r<n-e||n+e<r)return;let h=wr([s-i,n-r]);h[1]-=t.theta;const u=1-Math.pow(l/o,2);if(a=h[1],e=l/Math.sqrt(1-u*Math.pow(Math.cos(a),2)),h[0]>e)return;return{distance:e,bounds:{left:s-5,right:s+5,top:r-5,bottom:r+5}}}{let o=5;if(s<i-o||i+o<s||r<n-o||n+o<r||dr(e,t.center)>Math.pow(o,2))return;return{distance:0,bounds:{left:i-o,right:i+o,top:n-o,bottom:n+o}}}var a}(e,t)}}class zd extends Nd{constructor(e){super(e),this.group=e.group,this.renderer=new Md({style:()=>({numberColor:this.numberColor,highlightThickness:this.highlightThickness,pointHighlightRadius:this.pointHighlightRadius,pointHighlightThickness:this.pointHighlightThickness,pointHighlightFill:this.pointHighlightFill})})}createComponent(e,t){return new Cd({group:this.group,renderer:this.renderer,manager:this,id:e,state:t})}refreshStyle(){return this.renderer.reset(),super.refreshStyle()}initializeCssProperties(){super.initializeCssProperties(),this.numberColor=this.cssStringProp("kernel-number-color","255, 255, 255"),this.highlightThickness=this.cssNumberProp("kernel-highlight-thickness",.025),this.pointHighlightRadius=this.cssNumberProp("kernel-point-highlight-radius",1.4),this.pointHighlightThickness=this.cssNumberProp("kernel-point-highlight-thickness",.1),this.pointHighlightFill=this.cssStringProp("kernel-point-highlight-fill","255, 255, 255")}}function Ad(e,t,i){let n=[];for(let s of e){let e=Td(s||[],t,i);e.length&&n.push(e)}return n}function Td(e,t,i){let n=[];for(let s of e)if(null==s);else if(Array.isArray(s))null==s[0]||Number.isNaN(s[0])||null==s[1]||Number.isNaN(s[1])||n.push([s[0],s[1],s[2]]);else if("function"==typeof s)Ld(s,n,t,i);else{if("object"!=typeof s)throw new Error(`Datum is not curve configuration: ${u(s)}`);{let e=[];Ld(s.points,e,t,i),!0===s.reverse&&e.reverse(),n.push(...e)}}return n}function Ld(e,t,i,n){Array.isArray(e)||(e=[e]);for(let s of e)if(null==s);else if(Array.isArray(s))null==s[0]||Number.isNaN(s[0])||null==s[1]||Number.isNaN(s[1])||t.push([s[0],s[1],s[2]]);else{let e=s,r=n.stageBounds(),o=qc(e,{min:n.pixel2value(r.left,i.x),max:n.pixel2value(r.right,i.x)},Math.max(1,Math.round((r.right-r.left)/16)),5,3);for(let e of o)Number.isNaN(e[0])||Number.isNaN(e[1])||t.push(e)}}var $d,Od;!function(e){e.smooth="smooth",e.fade="fade",e.extractCollapse="extract-collapse",e.down="down",e.up="up",e.upDown="up-down",e.pop="pop",e.random="random",e.none="none"}($d||($d={}));class Dd extends qh{constructor(e){super(e),this.plotBounds=e.plotBounds}}function Pd(e,t){let i=t.bottom-t.top,n=(t.bottom-e.line[0][1])/i,s=Math.max(.2,n),r=1-n,o=t.bottom+100;return Ro(Vo({line:Lc(e.line.map(e=>[e[0],o,e[2]]),e.line),points:$c(e.points.map(e=>[e[0],o,e[2],e[3]]),e.points),areas:Fc(e.areas.map(e=>e.map(e=>[e[0],o,e[2]])),e.areas),size:Bo(0,e.size)}),{easing:ah,delay:r,duration:s})}function _d(e,t){let i=t.bottom-t.top,n=(t.bottom-e.line[0][1])/i,s=.4*Math.random(),r=1.2*n,o=t.bottom+100;return Ro(Vo({line:Lc(e.line,e.line.map(e=>[e[0],o,e[2]])),points:$c(e.points,e.points.map(e=>[e[0],o,e[2],e[3]])),areas:Fc(e.areas,e.areas.map(e=>e.map(e=>[e[0],o,e[2]])))}),{easing:ah,delay:s,duration:r})}class Fd extends Dd{constructor(e){super(e)}makeEntryTween(e){return function(e,t){let i=.4*Math.random(),n=t.top-100;return Ro(Vo({line:Lc(e.line.map(e=>[e[0],n,e[2]]),e.line),points:$c(e.points.map(e=>[e[0],n,e[2],e[3]]),e.points),areas:Fc(e.areas.map(e=>e.map(e=>[e[0],n,e[2]])),e.areas)}),{easing:uh,delay:i,duration:.6})}(e,this.plotBounds)}makeExitTween(e){return _d(e,this.plotBounds)}}class Rd extends Dd{constructor(e){super(e)}makeEntryTween(e){return function(e,t){let i=e.line.length;if(0!==i){if(1===i)return Ro(Vo({opacity:Bo(0,e.opacity)}),{duration:.8});{let t=new Array(i-1);for(let n=0;n<i-1;n++){let i=e.line.slice(0,n+1),s=e.line.slice(0,n+2);t[n]={duration:Math.max(1e-4,cr(i[i.length-1].slice(0,2),s[s.length-1].slice(0,2))),tween:Lc(i,s)}}return Ro(Vo({line:Xo(t),points:0===e.points.length?void 0:t=>t<=.99?[]:e.points,areas:0===e.areas.length?void 0:t=>t<=.99?[]:e.areas}),{easing:ch})}}}(e,this.plotBounds)}makeExitTween(e){return function(e,t){let i=e.line.length;if(0!==i){if(1===i)return Ro(Vo({opacity:Bo(0,e.opacity)}),{duration:.8});{let t=new Array(i-1);for(let n=0;n<i-1;n++){let s=e.line.slice(n,i),r=e.line.slice(n+1,i);t[n]={duration:Math.max(1e-4,cr(s[s.length-1].slice(0,2),r[r.length-1].slice(0,2))),tween:Lc(s,r)}}return Ro(Vo({line:Xo(t),points:0===e.points.length?void 0:()=>[],areas:0===e.areas.length?void 0:()=>[],opacity:Ko(e.opacity,0,.99)}),{easing:ch})}}}(e,this.plotBounds)}}class Bd extends Dd{constructor(e){super(e)}makeEntryTween(e){return Mc(e)}makeExitTween(e){return zc(e)}}class Hd extends Dd{constructor(e){super(e)}makeEntryTween(e){return function(e){let t,i=.5*Math.random();return e.areas.length&&(t=Bo(0,e.opacity)),Ro(Vo({size:Bo(0,e.size),points:$c(e.points.map(e=>[e[0],e[1],0,e[3]]),e.points),opacity:t}),{easing:mh,delay:i,duration:.5})}(e)}makeExitTween(e){return function(e){let t=.5*Math.random();return Ro(Vo({size:Bo(e.size,0),points:$c(e.points,e.points.map(e=>[e[0],e[1],0,e[3]])),opacity:Bo(e.opacity,0)}),{easing:ch,delay:t,duration:.1})}(e)}}class jd extends Dd{constructor(e){super(e)}makeEntryTween(e){return Pd(e,this.plotBounds)}makeExitTween(e){return function(e,t){let i=t.bottom-t.top,n=1.5*((e.line[0][1]-t.top)/i),s=t.top-100;return Ro(Vo({line:Lc(e.line,e.line.map(e=>[e[0],s,e[2]])),points:$c(e.points,e.points.map(e=>[e[0],s,e[2],e[3]])),areas:Fc(e.areas,e.areas.map(e=>e.map(e=>[e[0],s,e[2]]))),size:Bo(e.size,0)}),{easing:hh,duration:n})}(e,this.plotBounds)}}class qd extends Dd{constructor(e){super(e)}makeEntryTween(e){return Pd(e,this.plotBounds)}makeExitTween(e){return _d(e,this.plotBounds)}}class Ud{constructor(e){let t=6*Math.random();this.effect=t<=1?new jd(e):t<=2?new Fd(e):t<=3?new qd(e):t<=4?new Rd(e):t<=5?new Hd(e):new Bd(e)}makeCallback(e,t,i){return this.effect.makeCallback(e,t,i)}}class Zd extends Hh{makeEntryCallback(e){return Mc(e)}makeExitCallback(e){return zc(e)}makeTransitionCallback(e,t){return Ac(e,t)}}class Yd extends Gu{constructor(e){super(e),this.predicateSelection=null,this.predicateHidden=null,this.animationEffect=$d.smooth,this.hideEffect=!1}setData(e){if(void 0===e)return this;this.data.clear();for(let t of e||[]){if(void 0===t.id)throw new Error(`Line must not have undefined id: ${u(t)}`);if(this.data.has(t.id))throw new Error(`Line id must be unique: ${u(t.id)}`);if(!t.line&&!t.areas)throw new Error(`Line ${u(t.id)} must have non-null line or areas.`);this.data.set(t.id,ki(t))}return this}getMinMax(){return tc(Hr(this.data.values(),e=>{let t=null,i=null;return"function"!=typeof e.line&&(t=eo(Hr(e.line||null,e=>Array.isArray(e)?e[0]:null)),i=eo(Hr(e.line||null,e=>Array.isArray(e)?e[1]:null))),Array.isArray(e.points)&&(t=eo([t,eo(Hr(e.points,e=>Array.isArray(e)&&Number.isFinite(e[0])&&Number.isFinite(e[1])?e[0]:null))]),i=eo([i,eo(Hr(e.points,e=>Array.isArray(e)&&Number.isFinite(e[0])&&Number.isFinite(e[1])?e[1]:null))])),{x:t,y:i,axes:e.axes}}))}setAnimationEffect(e){return this.animationEffect=Mt(e,$d,$d.fade),this}getAnimationEffect(){return this.animationEffect}getDurationMultiplier(){let e=Math.max(this.data.size,this.effect.getNoComponents());if(0===e||this.animationEffect===$d.none)return 0;let t=this.animationEffect!==$d.smooth&&this.getInOutEffectMode()===zh.mixed?1.75:1;return e=sr(Math.sqrt(e),10,100),t*=2-(100-e)/90,t}transitionState(e,t,i){return this.makeRenderEffect().makeCallback(e,t,i)}makeRenderEffect(){if(this.animationEffect===$d.none||this.animationEffect===$d.smooth)return new Zd;let e={plotBounds:this.stage.stageBounds(),mode:this.getInOutEffectMode()};return this.animationEffect===$d.random?new Ud(e):this.animationEffect===$d.up?new jd(e):this.animationEffect===$d.down?new Fd(e):this.animationEffect===$d.upDown?new qd(e):this.animationEffect===$d.pop?new Hd(e):this.animationEffect===$d.fade?new Bd(e):this.animationEffect===$d.extractCollapse?new Rd(e):new Zd}datum2state(e){let t=Vu(e.axes),i=Hc(e.line||[],e.style||Ah.solid,t,this.stage),n=Bc(i,t,this.stage),s=sr(null==e.size?.5:e.size,0,1),r=this.getBaseSize()*or(this.sizeRatioMin,this.sizeRatioMax,s),o=this.makePoints("boolean"==typeof e.points?!0===e.points?(e.line||[]).map(e=>Array.isArray(e)?[e[0],e[1],null,e[3]]:null):null:e.points,r,t),l=Ad(this.normalizeNeighboringAreas(e.id,i,e.areas||[],t),t,this.stage);l=l.map(e=>Bc(e,t,this.stage));let a=this.resolveColor(e.color||this.defaultColor),h=!!this.predicateHidden&&!1!==this.predicateHidden(e),u=h&&this.hideEffect?this.opacityMin:1,c=!!this.predicateSelection&&this.predicateSelection(e);return{line:n,points:o,areas:l,size:r,color:a,opacity:u,hidden:h&&!this.hideEffect,selected:c}}makePoints(e,t,i){let n=t*this.pointRadius,s=[];for(let t of e||[])if(null!=t&&null!=t[0]&&!Number.isNaN(t[0])&&null!=t[1]&&!Number.isNaN(t[1])){let e=sr(null==t[2]?.5:t[2],0,1);s.push([this.stage.value2pixel(t[0],i.x),this.stage.value2pixel(t[1],i.y),e*n,t[3]])}return s}normalizeNeighboringAreas(e,t,i,n){let s=[];for(let r of i||[]){let i;if(void 0===r||"_none"===r);else if("_top"===r||"_bottom"===r){let e="_top"===r,n=t.length;n>0&&(i=[[t[0][0],t[0][1],"_line_left"],...t.map(e=>[e[0],e[1]]),[t[n-1][0],t[n-1][1],"_line_right"],[t[n-1][0],e?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,"_neighbour_right"],[t[0][0],e?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,"_neighbour_left"]])}else{let s;if("_previous"===r){let t;for(let[i,n]of this.data.entries()){if(i===e){s=t;break}t=n}}else if("_next"===r){let t=!1;for(let[i,n]of this.data.entries()){if(t){s=n;break}i===e&&(t=!0)}}else Array.isArray(r)?i=r:s=this.getDatum(r);if(s&&t.length){let e=Hc(s.line||[],Ah.solid,n,this.stage);if(e.length){let n=t.length,s=e.length;i=[[t[0][0],t[0][1],"_line_left"],...t.map(e=>[e[0],e[1]]),[t[n-1][0],t[n-1][1],"_line_right"],[e[s-1][0],e[s-1][1],"_neighbour_right"],...e.map(e=>[e[0],e[1]]).reverse(),[e[0][0],e[0][1],"_neighbour_left"]]}}}i&&s.push(i)}return s}getElementMargin(){if(0===this.getNoData()&&0===this.getNoComponents())return 0;return Math.ceil(this.getBaseSize()*this.sizeRatioMax*this.pointRadius)}getBaseSize(){return null==this._baseSize?this.defaultBaseSize:this._baseSize}setBaseSize(e){this._baseSize=e}select(e){return this.predicateSelection=Cu(e),this}setHideEffect(e){return e=!0===e,this.hideEffect!==e&&(this.hideEffect=e),this}getHideEffect(){return this.hideEffect}hide(e){return this.predicateHidden=Cu(e),this}show(e){const t=Cu(e);return this.predicateHidden=t&&(e=>!t(e)),this}initializeCssProperties(){super.initializeCssProperties(),this.defaultColor=this.cssStringProp("line-color","125, 125, 125"),this.defaultBaseSize=this.cssPixelProp("line-size",2),this.sizeRatioMin=this.cssNumberProp("line-size-ratio-min",.5),this.sizeRatioMax=this.cssNumberProp("line-size-ratio-max",3),this.opacityMin=this.cssNumberProp("line-opacity-min",.2),this.pointRadius=this.cssNumberProp("line-point-radius",1.6)}}class Gd extends vc{constructor(e){super(e,{line:[],points:[],areas:[],size:1,color:"125, 125, 125",opacity:0,hidden:!1,selected:!1})}initialize(e,t){this.lineElement={render:e=>this.renderLine(e),getUITarget:e=>this.getUITarget(e),getData:()=>this.getData()},this.areaElement={render:e=>this.renderArea(e),getUITarget:()=>{},getData:()=>this.getData()},this.lineGroup=e.lineGroup,this.lineGroup.add(this.lineElement),this.areaGroup=e.areaGroup,this.areaGroup.add(this.areaElement),this.renderer=e.renderer,this.manager=e.manager,super.initialize(e,t)}schedule(){this.lineGroup.schedule(),this.areaGroup.schedule()}renderLine(e){this.renderer.render(Object.assign({},this.state,{areas:[]}),e)}renderArea(e){this.renderer.render(Object.assign({},this.state,{line:[],points:[]}),e)}toFront(){return this.lineGroup.toFront(this.lineElement),this.areaGroup.toFront(this.areaElement),this.schedule(),this}toBack(){return this.lineGroup.toBack(this.lineElement),this.areaGroup.toBack(this.areaElement),this.schedule(),this}remove(){return this.lineGroup.remove(this.lineElement),this.areaGroup.remove(this.areaElement),this.schedule(),this}getUITarget(e){return this.renderer.getUITarget(e,this.state)}getData(){let e=this.manager.getDatum(this.id);if(void 0===e)throw new Error(`Manager cannot find '${this.id}'.`);return{type:this.manager.getType(),data:e}}}class Vd extends Yd{constructor(e){super(e),this.lineGroup=e.lineGroup,this.areaGroup=e.areaGroup,this.renderer=new Cc({style:()=>({areaOpacity:this.areaOpacity,lineDashRatio:this.dashRatio,backgroundRatio:this.backgroundRatio,backgroundOpacity:this.backgroundOpacity,backgroundBlur:this.backgroundBlur,pointThickness:this.pointThickness,pointFill:this.pointFill})})}createComponent(e,t){return new Gd({lineGroup:this.lineGroup,areaGroup:this.areaGroup,renderer:this.renderer,manager:this,id:e,state:t})}refreshStyle(){return this.renderer.reset(),super.refreshStyle()}initializeCssProperties(){super.initializeCssProperties(),this.areaOpacity=this.cssNumberProp("line-area-opacity",.5),this.dashRatio=this.cssNumberProp("line-dash-ratio",1),this.backgroundRatio=this.cssNumberProp("line-background-ratio",2),this.backgroundOpacity=this.cssNumberProp("line-background-opacity",.2),this.backgroundBlur=this.cssNumberProp("line-background-blur",0),this.pointFill=this.cssStringProp("line-point-fill","255, 255, 255"),this.pointThickness=this.cssNumberProp("line-point-thickness",.3)}}class Xd extends Gu{setData(e){if(void 0===e)return this;this.data.clear();for(let t of e||[]){if(void 0===t.id)throw new Error(`Region must not have undefined id: ${u(t)}`);if(this.data.has(t.id))throw new Error(`Region id must be unique: ${u(t.id)}`);if(!t.data)throw new Error(`Region ${u(t.id)} must have non-null data.`);this.data.set(t.id,ki(t))}return this}transitionState(e,t){return Ic(e,t)}datum2state(e){let t=Vu(e.axes),i=Ad(e.data,t,this.stage);return i=i.map(e=>Bc(e,t,this.stage)),0===i.length?void 0:{line:[],points:[],areas:i,size:0,color:this.resolveColor(e.color||this.defaultColor),opacity:null==e.opacity?1:e.opacity,hidden:!1,selected:!1}}initializeCssProperties(){super.initializeCssProperties(),this.defaultColor=this.cssStringProp("region-color","125, 125, 125")}}class Wd extends Xd{constructor(e){super(e),this.group=e.group,this.renderer=new Cc({style:()=>({areaOpacity:1,lineDashRatio:1,backgroundRatio:0,backgroundOpacity:0,backgroundBlur:0,pointThickness:0,pointFill:""})})}createComponent(e,t){return new kc({group:this.group,renderer:this.renderer,manager:this,id:e,state:t})}refreshStyle(){return this.renderer.reset(),super.refreshStyle()}}class Kd{constructor(e){if(this.element=e.element,this.initializeZoom(e),this.initializePan(e),this.onZoom&&(this.element.addEventListener("wheel",e=>{e.preventDefault();let t=[this.zoom[0]+this.stepZoom[0]*(e.deltaY<0?1:-1),this.zoom[1]+this.stepZoom[1]*(e.deltaY<0?1:-1)],i=this.event2position(e);this.fireZoom(t,i)}),this.element.addEventListener("dblclick",e=>{let t=[this.zoom[0]+this.stepZoom[0],this.zoom[1]+this.stepZoom[1]];t[0]>this.maxZoom[0]&&t[1]>this.maxZoom[1]&&(t=hr(this.minZoom));let i=this.event2position(e);this.fireZoom(t,i)})),this.onZoom||this.onPan){let e,t;this.element.addEventListener("touchstart",i=>{if(this.onPan&&1===i.touches.length)e=this.event2position(i.touches.item(0)),t=void 0;else if(this.onZoom&&2===i.touches.length){let n=this.event2position(i.touches.item(0)),s=this.event2position(i.touches.item(1));t=cr(n,s),e=[(n[0]+s[0])/2,(n[1]+s[1])/2],0===t&&(e=t=void 0)}else e=t=void 0}),this.element.addEventListener("touchmove",i=>{if(i.preventDefault(),null!=e)if(null==t){let t=this.event2position(i.touches.item(0)),n=[t[0]-e[0],t[1]-e[1]];e=t.slice(),this.firePan(n,t)}else{let n,s,r=this.event2position(i.touches.item(0)),o=this.event2position(i.touches.item(1));if(this.zoomDirectionally){n=Math.abs(r[0]-o[0]),s=Math.abs(r[1]-o[1]);let e=10;n<e&&s>=e?n=0:n>=e&&s<e?s=0:n=s=cr(r,o)}else n=s=cr(r,o);let l=[this.zoom[0]*n/t,this.zoom[1]*s/t];this.fireZoom(l,hr(e))}}),this.element.addEventListener("touchcancel",()=>{e=t=void 0}),this.element.addEventListener("touchend",()=>{e=t=void 0})}if(this.onPan){let e;new ul({element:this.element,onProgress:t=>{let i=this.event2position(t);if(e){let t=[i[0]-e[0],i[1]-e[1]];e=i.slice(),this.firePan(t,i)}else e=i},onEnd:()=>{e=void 0}})}}setZoom(e){return this.zoom=ar(e,this.minZoom,this.maxZoom),this}initializeZoom(e){if(this.onZoom=e.onZoom||void 0,this.zoom=null==e.initialZoom?[1,1]:"number"==typeof e.initialZoom?[e.initialZoom,e.initialZoom]:e.initialZoom,this.minZoom=null==e.minZoom?this.zoom:"number"==typeof e.minZoom?[e.minZoom,e.minZoom]:e.minZoom,this.stepZoom=null==e.stepZoom?[1,1]:"number"==typeof e.stepZoom?[e.stepZoom,e.stepZoom]:e.stepZoom,this.maxZoom=null==e.maxZoom?[Math.max(this.zoom[0],10*this.stepZoom[0]),Math.max(this.zoom[1],10*this.stepZoom[1])]:"number"==typeof e.maxZoom?[e.maxZoom,e.maxZoom]:e.maxZoom,!lr(this.zoom)||!lr(this.minZoom)||!lr(this.stepZoom)||!lr(this.maxZoom)||this.minZoom[0]>=this.maxZoom[0]||this.minZoom[1]>=this.maxZoom[1])throw new Error(`Zoom range is invalid: [${this.minZoom[0]}, ${this.minZoom[1]}]:[${this.stepZoom[0]}, ${this.stepZoom[1]}]:[${this.maxZoom[0]}, ${this.maxZoom[1]}] ([${this.zoom[0]}, ${this.zoom[1]}])`);this.zoom=ar(this.zoom,this.minZoom,this.maxZoom),this.zoomDirectionally=!0===e.zoomDirectionally}fireZoom(e,t){this.onZoom&&(e=ar(e,this.minZoom,this.maxZoom),ur(this.zoom,e)||(this.zoom=e,this.onZoom(this.zoom,t)))}initializePan(e){this.onPan=e.onPan||void 0}firePan(e,t){!this.onPan||0===e[0]&&0===e[1]||this.onPan(e,t)}event2position(e){let t=this.element.getBoundingClientRect();return[e.clientX-t.left,e.clientY-t.top]}}class Qd{constructor(e){e.parent.appendChild(this.element=ae('<span class="esc-crosshairs-2d" />')),this.element.appendChild(this.xHair=ae('<span class="esc-c-x esc-m-hidden"/>')),this.element.appendChild(this.yHair=ae('<span class="esc-c-y esc-m-hidden"/>'))}show([e,t],i){requestAnimationFrame(()=>{this.xHair.classList.toggle("esc-m-hidden",null==e),this.yHair.classList.toggle("esc-m-hidden",null==t),null!=e&&(this.xHair.style.left=e+"px",this.xHair.style.top=i.top+"px",this.xHair.style.height=i.bottom-i.top+"px"),null!=t&&(this.yHair.style.left=i.left+"px",this.yHair.style.top=t+"px",this.yHair.style.width=i.right-i.left+"px")})}hide(){requestAnimationFrame(()=>{this.xHair.classList.toggle("esc-m-hidden",!0),this.yHair.classList.toggle("esc-m-hidden",!0)})}}function Jd(e){return Math.SQRT2*e.height}function ef(e){return Math.SQRT1_2*(e.width+e.height)}!function(e){e.visible="visible",e.hidden="hidden",e.precise="precise"}(Od||(Od={}));const tf=e.log.logger("esc.chart.framework.plot-2d.AbstractAxesPlot"),nf=Object.freeze({panX:0,panY:0,zoomX:0,zoomY:0});var sf,rf,of;!function(e){e[e.left=1]="left",e[e.right=2]="right",e[e.bottom=4]="bottom",e[e.top=8]="top"}(sf||(sf={}));class lf extends Ch{constructor(e,t){super(e,t)}initialize(e){super.initialize(e),this.onHiddenData=e.onHiddenData||null,this.elementMargins={left:0,right:0,top:0,bottom:0},this.initializeAxes(),this.initializePanZoom(e)}handleMoveEvent(e){this.handleAxisEvent(e)||super.handleMoveEvent(e)}onHover(e,t){this.crosshairs.hide(),super.onHover(e,t)}onUnhover(){this.crosshairs.hide(),super.onUnhover()}handleAxisEvent(e){if(!(e.target instanceof Element))return!0;let t,[i,n]=this.mouseEvent2PlotCoord(e),s=rr(i,this.plotBounds.left,this.plotBounds.right),r=rr(n,this.plotBounds.top,this.plotBounds.bottom);if(this.axisCrosshairs.x&&n>this.plotBounds.bottom&&s?t="x":this.axisCrosshairs.x2&&n<this.plotBounds.top&&s?t="x2":this.axisCrosshairs.y&&i<this.plotBounds.left&&r?t="y":this.axisCrosshairs.y2&&i>this.plotBounds.right&&r&&(t="y2"),t){let e=Xu(t),s=this.pixel2value(e?i:n,t),r=null==this.axisPrecision[t]?d(s):this.axisPrecision[t],o=(this.axisFormatLong[t]||this.defaultFormat)(s,r),l=this.stageBounds(),a="x"===t?{target:[i,l.bottom],direction:"north"}:"x2"===t?{target:[i,l.top],direction:"south"}:"y"===t?{target:[l.left,n],direction:"east"}:{target:[l.right,n],direction:"west"};return this.label.show(o,a,this.axisLabelTimeout),this.crosshairs.show(e?[i,null]:[null,n],l),!0}return(!s||!r)&&(this.onUnhover(),!0)}initializeAxes(){this.axisLabelTimeout=1500;let e=fl("numericFormats");this.defaultFormat=(t,i)=>e.number(t,i),this.axes=Qu(e=>this.makeAxis(e)),this.scales={},this.axisTransform={},this.axisMinMax={},this.dataMinMax={},this.axisCrosshairs={},this.axisVisibility={},this.axisColor={},this.axisRotate={},this.axisPrecision={},this.axisFormatShort={},this.axisFormatLong={},this.hiddenDataFlag=0,this.crosshairs=this.makeCrosshairs()}makeAxis(e){return new wh({parent:this.element,type:"x"===e?lh.bottom:"x2"===e?lh.top:"y"===e?lh.left:lh.right})}makeCrosshairs(){return new Qd({parent:this.element})}_setAxes(e){this.setAxesAux(e)&&this.redrawAxes()}setAxesAux(e){e=e||{};let t=!1;for(let i of Ku)t=this.setAxisAux(i,e[i])||t;return t}setAxisAux(e,t){let i,n,s,r=!1;if(void 0!==(t=t||{}).visibility){let i=Mt(t.visibility,Od,Od.visible);i!==(this.axisVisibility[e]||Od.visible)&&(this.axisVisibility[e]=i,r=!0)}null!=t.min&&null!=t.max?i={min:t.min,max:t.max}:(i=ki(this.axisMinMax[e]))&&(void 0!==t.min&&(i.min=t.min),void 0!==t.max&&(i.max=t.max));try{Qr(i,!0)}catch(n){tf.warn("Received invalid %s-range: %o",e,t,n),i=void 0}if(Ii(i,this.axisMinMax[e])||(this.axisMinMax[e]=i,r=!0),void 0!==t.transform){let i;null==t.transform||null==t.transform.offset&&null==t.transform.scale||(i={offset:t.transform.offset||0,scale:null==t.transform.scale?1:t.transform.scale}),Ii(i,this.axisTransform[e])||(this.axisTransform[e]=i,r=!0)}return null==t.format||"object"!=typeof t.format?n=s=kl(t.format):(n=kl(t.format.short),s=kl(t.format.long)),n=n||s,s=s||n,void 0!==n&&(n||void 0)!==this.axisFormatShort[e]&&(this.axisFormatShort[e]=n||void 0,r=!0),void 0!==s&&(this.axisFormatLong[e]=s||void 0),void 0!==t.precision&&Ci(t.precision)!==this.axisPrecision[e]&&(this.axisPrecision[e]=Ci(t.precision),r=!0),void 0!==t.rotate&&!0===t.rotate!=(!0===this.axisRotate[e])&&(this.axisRotate[e]=!0===t.rotate,r=!0),void 0!==t.color&&(t.color||void 0)!==this.axisColor[e]&&(this.axisColor[e]=t.color||void 0,r=!0),void 0!==t.crosshair&&(this.axisCrosshairs[e]=!0===t.crosshair),r}setDataMinMax(e){Ju(t=>{let i=e[t];return i&&Number.isFinite(i.min)&&Number.isFinite(i.max)?i:void 0},this.dataMinMax)}effectiveMinMax(e){let t=this.axisTransform[e];if(t){let i=Wu(e);if(!this.axisTransform[i]||"x"!==e&&"y"!==e){let e=this.axisMinMax[i]||this.dataMinMax[i];if(e)return function(e,t){return null==e||null==t?e:{min:rc(e.min,t),max:rc(e.max,t)}}(e,t)}}return this.axisMinMax[e]||this.dataMinMax[e]||null}isTransformed(e){if(!this.axisTransform[e])return!1;let t=Wu(e);return(!this.axisTransform[t]||"x"!==e&&"y"!==e)&&null!=(this.axisMinMax[t]||this.dataMinMax[t])}possibleMinMax(e){let t=this.domain(e),i=this.dataMinMax[e];return i?{min:Math.min(t.min,i.min),max:Math.max(t.max,i.max)}:t}initializePanZoom(e){this.panZoom=nf,this.transformZoomX=this.transformZoomY=e=>Math.pow(2,e),this.scaledPanZoom={panX:0,panY:0,zoomX:1,zoomY:1},!0===e.enableZoom&&(this.panZoomController=new Kd({element:this.element,initialZoom:0,minZoom:-Number.MAX_VALUE,maxZoom:Number.MAX_VALUE,stepZoom:e.stepZoom||.25,zoomDirectionally:!0,onZoom:(e,t)=>{let i=this.plotBounds.right-this.plotBounds.left,n=this.plotBounds.top-this.plotBounds.bottom,s=(t[0]-this.plotBounds.left)/i,r=(t[1]-this.plotBounds.bottom)/n,o=(s-this.scaledPanZoom.panX)/this.scaledPanZoom.zoomX,l=(r-this.scaledPanZoom.panY)/this.scaledPanZoom.zoomY,[a,h]=e,u=this.transformZoomX(a),c=this.transformZoomY(h),d=(s-o*u)/u*i,f=(r-l*c)/c*n;this.setPanZoom({zoomX:a,zoomY:h,panX:d,panY:f})},onPan:e=>this.setPanZoom({panX:this.panZoom.panX+e[0],panY:this.panZoom.panY+e[1]})}),this.zoomResetButton=pe(this.element,".esc-c-recenter",HTMLButtonElement),this.zoomResetButton&&this.zoomResetButton.addEventListener("click",()=>this.setPanZoom(null)))}incrementPanZoom(e){e=e||{};let t=this.getPanZoom();for(let i of Object.keys(t)){let n=e[i];null!=n&&(t[i]+=n)}return this.setPanZoom(t)}setPanZoom(e){if(!this.panZoomController)return this;return!Ii(e=null==e?nf:this.validatePanZoom({panX:null==e.panX?this.panZoom.panX:e.panX,panY:null==e.panY?this.panZoom.panY:e.panY,zoomX:null==e.zoomX?this.panZoom.zoomX:e.zoomX,zoomY:null==e.zoomY?this.panZoom.zoomY:e.zoomY}),this.panZoom)&&(this.panZoom=e,this.updateScaledPanZoom(),this.zoomResetButton&&this.zoomResetButton.classList.toggle("esc-is-disabled",Ii(this.panZoom,nf)),this.resize()),this.panZoomController.setZoom([this.panZoom.zoomX,this.panZoom.zoomY]),this}updateScaledPanZoom(){this.scaledPanZoom=this.scalePanZoom(this.panZoom)}scalePanZoom(e){let t=this.transformZoomX(e.zoomX),i=this.transformZoomY(e.zoomY);return{panX:e.panX/(this.plotBounds.right-this.plotBounds.left)*t,panY:e.panY/(this.plotBounds.top-this.plotBounds.bottom)*i,zoomX:t,zoomY:i}}validatePanZoom(e){let t,i,n=this.scalePanZoom(e),s=this.majorXAxis(),r=this.majorYAxis();if(s&&(i=this.scales[s])&&(t=this.possibleMinMax(s))){let s=i.value2position(t.min),r=i.value2position(t.max),o=s>-n.panX/n.zoomX,l=r<(1-n.panX)/n.zoomX;o&&l?(e.panX=this.panZoom.panX,e.zoomX=this.panZoom.zoomX):o?e.panX=-s*(this.plotBounds.right-this.plotBounds.left):l&&(e.panX=(1/n.zoomX-r)*(this.plotBounds.right-this.plotBounds.left))}if(r&&(i=this.scales[r])&&(t=this.possibleMinMax(r))){let s=i.value2position(t.min),r=i.value2position(t.max),o=s>-n.panY/n.zoomY,l=r<(1-n.panY)/n.zoomY;o&&l?(e.panY=this.panZoom.panY,e.zoomY=this.panZoom.zoomY):o?e.panY=-s*(this.plotBounds.top-this.plotBounds.bottom):l&&(e.panY=(1/n.zoomX-r)*(this.plotBounds.top-this.plotBounds.bottom))}return e}getPanZoom(){return Object.assign({},this.panZoom)}majorXAxis(){return this.scales.x?"x":this.scales.x2?"x2":void 0}majorYAxis(){return this.scales.y?"y":this.scales.y2?"y2":void 0}updateAxes(){this.updateScales();let e=this.makeProtoTicks();return this.updateGutter(e),this.updatePlotBounds2(),this.updateElementMargins(),this.crosshairs.hide(),this.makeTicks(e)}updatePlotBounds2(){this.updatePlotBounds(),this.plotBounds.left+=this.gutter.left,this.plotBounds.right-=this.gutter.right,this.plotBounds.top+=this.gutter.top,this.plotBounds.bottom-=this.gutter.bottom}updateGutter(e){let t=Qu(t=>this.axes[t].measureLabels(Array.from(e[t].values()).map(e=>e.label))),i=Math.max(this.axes.x.tickPadding,this.axes.x2.tickPadding),n=Math.max(this.axes.y.tickPadding,this.axes.y2.tickPadding),s=Math.ceil(Math.max((this.axisRotate.y?ef(t.y.max):t.y.max.width)+i,this.axisRotate.x?ef(t.x.first):t.x.first.width/2,this.axisRotate.x2?ef(t.x2.first):t.x2.first.width/2)),r=Math.ceil(Math.max((this.axisRotate.y2?ef(t.y2.max):t.y2.max.width)+i,this.axisRotate.x?Jd(t.x.last):t.x.last.width/2,this.axisRotate.x2?Jd(t.x2.last):t.x2.last.width/2)),o=Math.ceil(Math.max((this.axisRotate.x2?ef(t.x2.max):t.x2.max.height)+n,this.axisRotate.y?Jd(t.y.last):t.y.last.height/2,this.axisRotate.y2?Jd(t.y2.last):t.y2.last.height/2)),l=Math.ceil(Math.max((this.axisRotate.x?ef(t.x.max):t.x.max.height)+n,this.axisRotate.y?ef(t.y.first):t.y.first.height/2,this.axisRotate.y2?ef(t.y2.first):t.y2.first.height/2));this.gutter={left:s,right:r,top:o,bottom:l}}updateElementMargins(){}makeProtoTicks(){return Qu(e=>this.makeProtoTicksFromRange(this.effectiveTickRange(e),e))}makeProtoTicksFromRange(e,t){let i=new Map;if(null==e)return i;if(this.axisVisibility[t]===Od.hidden)return i;if(this.axisVisibility[t]===Od.precise&&null!=this.axisPrecision[t]&&(1!==e.step.base||-e.step.power!==this.axisPrecision[t]))return i;let n=v(e.min,e.step,e.max,!0);for(let e of n){let n=b(e),s=(this.axisFormatShort[t]||this.defaultFormat)(n,-e.power)||"";i.set(n,{label:s,selected:!1})}return i}makeTicks(e){return Qu(t=>{let i=e[t],n=new Map;for(let[e,s]of i.entries())n.set(e,{label:s.label,position:this.value2TickPosition(e,t),selected:s.selected});return n})}value2TickPosition(e,t){let i=this.value2pixel(e,t);return"x"===t?[i,this.plotBounds.bottom]:"x2"===t?[i,this.plotBounds.top]:"y"===t?[this.plotBounds.left,i]:[this.plotBounds.right,i]}effectiveTickRange(e){let t=this.effectiveMinMax(e);if(null==t)return null;let i=Xu(e),n=i?0!==this.scaledPanZoom.panX||1!==this.scaledPanZoom.zoomX:0!==this.scaledPanZoom.panY||1!==this.scaledPanZoom.zoomY;if(n){let n=i?-this.scaledPanZoom.panX/this.scaledPanZoom.zoomX:-this.scaledPanZoom.panY/this.scaledPanZoom.zoomY,s=i?(1-this.scaledPanZoom.panX)/this.scaledPanZoom.zoomX:(1-this.scaledPanZoom.panY)/this.scaledPanZoom.zoomY,r=this.scales[e];if(null==r)throw new se(`Cannot compute effective tick range without ${e} scale.`);t={min:r.position2value(n),max:r.position2value(s)}}let s=this.niceRange(t,e);return(n||this.isTransformed(e))&&(s.min=D(s.min,t.min,t.max,s.step),s.max=D(s.max,t.min,t.max,s.step)),s}niceRange(e,t){if(!e)return null;let i=Xu(t)?this.layout.innerWidth:this.layout.innerHeight;return eh(e,Math.max(1,Math.floor(i/this.tickDistance)),null==this.axisPrecision[t]?void 0:-this.axisPrecision[t])}updateScales(){Ju(e=>this.makeScale(e),this.scales),this.fireHiddenData()}makeScale(e){let t=this.domain(e);return t?new rh({scale:Cl,domain:t}):void 0}domain(e){let t=this.effectiveMinMax(e);if(!t)return null;if(this.isTransformed(e))return t;let i=this.niceRange(t,e);return{min:b(i.min),max:b(i.max)}}value2pixel(e,t){let i=this.scales[t];if(!i)return 0;let n=Xu(t);if(e===Number.NEGATIVE_INFINITY)return n?this.stageBounds().left:this.stageBounds().bottom;if(e===Number.POSITIVE_INFINITY)return n?this.stageBounds().right:this.stageBounds().top;let s=i.value2position(e);s=n?this.scaledPanZoom.panX+s*this.scaledPanZoom.zoomX:this.scaledPanZoom.panY+s*this.scaledPanZoom.zoomY;let r=n?this.plotBounds.left+this.elementMargins.left:this.plotBounds.bottom-this.elementMargins.bottom;return r+s*((n?this.plotBounds.right-this.elementMargins.right:this.plotBounds.top+this.elementMargins.top)-r)}pixel2value(e,t){let i=this.scales[t];if(!i)return Number.NaN;let n=Xu(t),s=n?this.plotBounds.left+this.elementMargins.left:this.plotBounds.bottom-this.elementMargins.bottom,r=(e-s)/((n?this.plotBounds.right-this.elementMargins.right:this.plotBounds.top+this.elementMargins.top)-s);return r=n?(r-this.scaledPanZoom.panX)/this.scaledPanZoom.zoomX:(r-this.scaledPanZoom.panY)/this.scaledPanZoom.zoomY,i.position2value(r)}stageBounds(){return{left:this.scales.y?this.plotBounds.left:this.plotBounds.left-this.gutter.left,right:this.scales.y2?this.plotBounds.right:this.plotBounds.right+this.gutter.right,top:this.scales.x2?this.plotBounds.top:this.plotBounds.top-this.gutter.top,bottom:this.scales.x?this.plotBounds.bottom:this.plotBounds.bottom+this.gutter.bottom}}getStage(){return{value2pixel:(e,t)=>this.value2pixel(e,t),pixel2value:(e,t)=>this.pixel2value(e,t),stageBounds:()=>this.stageBounds()}}fireHiddenData(){let e=0;for(let t of Ku){let i=this.scales[t];if(!i)continue;let n=this.possibleMinMax(t);n&&(Xu(t)?(this.scaledPanZoom.panX+i.value2position(n.min)*this.scaledPanZoom.zoomX<0&&!(e&sf.left)&&(e+=sf.left),this.scaledPanZoom.panX+i.value2position(n.max)*this.scaledPanZoom.zoomX>1&&!(e&sf.right)&&(e+=sf.right)):(this.scaledPanZoom.panY+i.value2position(n.min)*this.scaledPanZoom.zoomY<0&&!(e&sf.bottom)&&(e+=sf.bottom),this.scaledPanZoom.panY+i.value2position(n.max)*this.scaledPanZoom.zoomY>1&&!(e&sf.top)&&(e+=sf.top)))}if(e!==this.hiddenDataFlag){this.hiddenDataFlag=e;let t={left:!!(e&sf.left),right:!!(e&sf.right),top:!!(e&sf.top),bottom:!!(e&sf.bottom)},i=this.element.classList;i.toggle("esc-m-hidden-data-west",t.left),i.toggle("esc-m-hidden-data-east",t.right),i.toggle("esc-m-hidden-data-north",t.top),i.toggle("esc-m-hidden-data-south",t.bottom),this.onHiddenData&&this.onHiddenData(t)}}initializeCSSProperties(){super.initializeCSSProperties(),this.tickDistance=Math.max(20,this.cssPixelProp("tick-distance",20))}}class af extends lf{constructor(e,t){super(e,t)}initialize(e){super.initialize(e),this.initializeSoundManager(e.enableSound),this.initializeAnimator()}initializeSoundManager(e){this.soundManager=new nh({baseUrl:`/static/${sh}/TBD/js/assets/sounds/${this.widgetId}/`}).setEnabled(!0===e)}setEnableSound(e){return this.soundManager.setEnabled(e),this}getEnableSound(){return this.soundManager.getEnabled()}setSoundFile(e,t){this.soundManager.setUrl(t&&`${e}/${t}.mp3`)}initializeAnimator(){this.isAnimating=!1,this.animator=new Qa({lifecycleCallback:e=>{e.first&&this.onAnimationStart(),e.last&&this.onAnimationEnd()},destroyable:this.element}),this.axisManagers=Qu(e=>{let t=new oh({axis:this.axes[e]});return this.animator.onAnimation(t.getAnimationProvider()),t})}onAnimationStart(){}onAnimationEnd(){this.isAnimating=!1}resize(){this.measure(),this.redraw()}redrawAxes(){this.redraw(!0)}redraw(e){void 0!==e&&(this.isAnimating=e);let t=this.updateAxes();for(let e of Ku)this.axisManagers[e].setData({ticks:t[e],rotated:!0===this.axisRotate[e],color:this.axisColor[e]||null});let i=this.isAnimating?this.getEffectiveDuration():0;this.animator.update(i)}getEffectiveDuration(){return this.animationDuration}refreshStyle(){return super.refreshStyle(),this.redraw(),this}initializeCSSProperties(){super.initializeCSSProperties(),this.animationDuration=this.cssTimeProp("animation-duration",700)}}class hf extends af{constructor(e){super(e,"xy-chart")}initialize(e){super.initialize(e),this.setAnimationEffect(e.animationEffect||{});let t=e.hideEffect||{};Bu.forEach(e=>"kernels"!==e&&this.managers[e].setHideEffect(!0===t[e]));let i=e.baseSize||{};Bu.forEach(e=>{"boxes"!==e&&null!=i[e]&&this.managers[e].setBaseSize(i[e])})}mouseEvent2UserEvent(e){let t=this.mouseEvent2PlotCoord(e),i=this.getUITarget(t);if(!i)return;let n=i.element.getData();return void 0===n?void 0:{datum:n,target:i.bounds}}onHover(e,t){super.onHover(e,t),requestAnimationFrame(()=>{let t=this.managers[e.type];t&&t.toFront([e.data.id])})}updateElementMargins(){let e=Math.max(this.managers.kernels.getElementMargin(),this.managers.lines.getElementMargin(),this.managers.dots.getElementMargin());this.elementMargins={left:this.scales.y?e:Math.max(0,e-this.gutter.left),right:this.scales.y2?e:Math.max(0,e-this.gutter.right),top:this.scales.x2?e:Math.max(0,e-this.gutter.top),bottom:this.scales.x?e:Math.max(0,e-this.gutter.bottom)}}setXAxis(e){return void 0===e?this:this.setAxes({x:e})}setYAxis(e){return void 0===e?this:this.setAxes({y:e})}setAxes(e){return this._setAxes(e),this}getIds(e){if(e)return this.managers[e].getDataIds();{let e={};return Bu.forEach(t=>e[t]=this.managers[t].getDataIds()),e}}getDatum(e,t){return this.managers[t].getDatum(e)}setData(e){e=e||{dots:null,trails:null,lines:null,boxes:null,curves:null,kernels:null,regions:null},this.managers.regions.setData(e.regions),this.managers.curves.setData(e.curves),this.managers.kernels.setData(e.kernels),this.managers.boxes.setData(e.boxes),this.managers.dots.setData(e.dots).setTrails(e.trails),this.managers.lines.setData(e.lines);let t=[this.managers.kernels.getMinMax(),this.managers.boxes.getMinMax(),this.managers.dots.getMinMax(),this.managers.lines.getMinMax()],i=Qu(e=>eo(t.map(t=>t[e])));return this.setDataMinMax(i),this.redraw(!0),void 0!==e.dots&&this.soundManager.play(),this}setAnimationEffect(e){return(e=e||{}).kernels&&this.managers.kernels.setAnimationEffect(e.kernels),e.boxes&&this.managers.boxes.setAnimationEffect(e.boxes),e.dots&&this.managers.dots.setAnimationEffect(e.dots),e.lines&&this.managers.lines.setAnimationEffect(e.lines),this}getAnimationEffect(){return{kernels:this.managers.kernels.getAnimationEffect(),boxes:this.managers.boxes.getAnimationEffect(),dots:this.managers.dots.getAnimationEffect(),lines:this.managers.lines.getAnimationEffect()}}getEffectiveDuration(){return this.animationDuration*Math.max(this.managers.kernels.getDurationMultiplier(),this.managers.boxes.getDurationMultiplier(),this.managers.dots.getDurationMultiplier(),this.managers.lines.getDurationMultiplier())}select(e){const t={boxes:null==(e=e||{}).boxes?void 0:Cu(e.boxes),dots:null==e.dots?void 0:Iu(e.dots),kernels:null==e.kernels?void 0:Iu(e.kernels),lines:null==e.lines?void 0:Cu(e.lines)};return this.managers.kernels.select(t.kernels),this.managers.boxes.select(t.boxes),this.managers.dots.select(t.dots),this.managers.lines.select(t.lines),Object.values(t).some(e=>null!=e)?requestAnimationFrame(()=>{this.managers.boxes.toFront(t.boxes),t.dots&&this.managers.dots.toFront(e=>t.dots(e)>=0),t.kernels&&this.managers.kernels.toFront(e=>t.kernels(e)>=0),this.managers.lines.toFront(t.lines),this.redraw()}):this.redraw(),this}setHideEffect(e){let t=!1;return null!=(e=e||{}).boxes&&e.boxes!==this.managers.boxes.getHideEffect()&&(this.managers.boxes.setHideEffect(e.boxes),t=!0),null!=e.dots&&e.dots!==this.managers.dots.getHideEffect()&&(this.managers.dots.setHideEffect(e.dots),t=!0),null!=e.lines&&e.lines!==this.managers.lines.getHideEffect()&&(this.managers.lines.setHideEffect(e.lines),t=!0),t&&this.redraw(!0),this}getHideEffect(){return{boxes:this.managers.boxes.getHideEffect(),dots:this.managers.dots.getHideEffect(),lines:this.managers.lines.getHideEffect()}}hide(e){return e&&Bu.some(t=>null!=e[t])&&(this.managers.kernels.hide(e.kernels),this.managers.boxes.hide(e.boxes),this.managers.dots.hide(e.dots),this.managers.lines.hide(e.lines),requestAnimationFrame(()=>{this.managers.boxes.toBack(e.boxes),this.managers.dots.toBack(e.dots),this.managers.lines.toBack(e.lines),this.redraw(!0)})),this}show(e){return e&&Bu.some(t=>null!=e[t])&&(this.managers.kernels.show(e.kernels),this.managers.boxes.show(e.boxes),this.managers.dots.show(e.dots),this.managers.lines.show(e.lines),requestAnimationFrame(()=>{this.managers.boxes.toFront(e.boxes),this.managers.dots.toFront(e.dots),this.managers.lines.toFront(e.lines),this.redraw(!0)})),this}moveToFront(e){return e&&Bu.some(t=>null!=e[t])&&requestAnimationFrame(()=>{this.managers.kernels.toFront(e.kernels),this.managers.boxes.toFront(e.boxes),this.managers.dots.toFront(e.dots),this.managers.lines.toFront(e.lines)}),this}moveToBack(e){return e&&Bu.some(t=>null!=e[t])&&requestAnimationFrame(()=>{this.managers.kernels.toBack(e.kernels),this.managers.boxes.toBack(e.boxes),this.managers.dots.toBack(e.dots),this.managers.lines.toBack(e.lines)}),this}getBaseSize(){return{dots:this.managers.dots.getBaseSize(),kernels:this.managers.kernels.getBaseSize(),lines:this.managers.lines.getBaseSize()}}setBaseSize(e){e=e||{};let t=!1;return Number.isFinite(e.dots)&&e.dots>0&&e.dots!==this.managers.dots.getBaseSize()&&(this.managers.dots.setBaseSize(e.dots),t=!0),Number.isFinite(e.kernels)&&e.kernels>0&&e.kernels!==this.managers.kernels.getBaseSize()&&(this.managers.kernels.setBaseSize(e.kernels),t=!0),Number.isFinite(e.lines)&&e.lines>0&&e.lines!==this.managers.lines.getBaseSize()&&(this.managers.lines.setBaseSize(e.lines),t=!0),t&&this.redraw(!0),this}refreshStyle(){return this.managers.regions.refreshStyle(),this.managers.curves.refreshStyle(),this.managers.kernels.refreshStyle(),this.managers.boxes.refreshStyle(),this.managers.dots.refreshStyle(),this.managers.lines.refreshStyle(),super.refreshStyle(),this}}class uf extends hf{constructor(e){super(e)}initialize(e){this.canvas=ae("<canvas/>"),this.element.appendChild(this.canvas),this.context=Uu(this.canvas),this.canvasManager=new qu({context:this.context,preRender:()=>{let e=this.stageBounds();this.context.beginPath(),this.context.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),this.context.clip()}}),this.canvasManager.add(this.regionGroup=new ju),this.canvasManager.add(this.curveGroup=new ju),this.canvasManager.add(this.kernelGroup=new ju),this.canvasManager.add(this.areaGroup=new ju),this.canvasManager.add(this.dotGroup=new ju),this.managers={regions:new Wd({element:this.element,stage:this.getStage(),styleId:this.widgetId,group:this.regionGroup,type:"region"}),kernels:new zd({element:this.element,stage:this.getStage(),styleId:this.widgetId,group:this.kernelGroup,type:"kernels"}),curves:new Yc({element:this.element,stage:this.getStage(),styleId:this.widgetId,group:this.curveGroup,type:"curves"}),boxes:new Ec({element:this.element,stage:this.getStage(),styleId:this.widgetId,group:this.areaGroup,type:"boxes"}),lines:new Vd({element:this.element,stage:this.getStage(),styleId:this.widgetId,areaGroup:this.areaGroup,lineGroup:this.dotGroup,type:"lines"}),dots:new fd({element:this.element,stage:this.getStage(),styleId:this.widgetId,group:this.dotGroup,type:"dots"})},super.initialize(e),Object.values(this.managers).forEach(e=>this.animator.onAnimation(e.getAnimationProvider()))}getUITarget(e){return this.canvasManager.getUITarget(e)}onAnimationStart(){this.canvas.width!==this.layout.innerWidth&&(this.canvas.width=this.layout.innerWidth),this.canvas.height!==this.layout.innerHeight&&(this.canvas.height=this.layout.innerHeight),super.onAnimationStart()}onHover(e,t){super.onHover(e,t),requestAnimationFrame(()=>this.element.classList.add("esc-js-is-hovering"))}onUnhover(){super.onUnhover(),requestAnimationFrame(()=>{this.element.classList.remove("esc-js-is-hovering")})}}class cf extends Is{constructor(e){super(e)}initialize(e){super.initialize(e),this.maxNoSelected=Object.assign({boxes:0,dots:0,kernels:0,lines:0},e.maxNoSelected),this.type=Object.assign({boxes:bs.string,dots:bs.string,kernels:bs.string,lines:bs.string},e.type),this.plot=new uf({element:e.element,animationEffect:e.animationEffect,hideEffect:e.hideEffect,baseSize:e.baseSize,enableSound:e.enableSound,enableZoom:e.enableZoom,label:Ru(e.label),clickCallback:(e,t)=>this.handleClick(e&&e.id,t)}),this.selection=this.validateSelectionAux(e.selection||{},null)}setXAxis(e){return this.plot.setXAxis(e),this}setYAxis(e){return this.plot.setYAxis(e),this}setAxes(e){return this.plot.setAxes(e),this}getIds(e){return this.plot.getIds(e)}getDatum(e,t){return this.plot.getDatum(e,t)}setData(e){this.plot.setData(e);let t=e&&e.selection;if(!t){t={};let e=this.plot.getIds();Bu.forEach(i=>t[i]=this.selection[i].filter(t=>e[i].includes(t)))}return this.setSelection(t),this}setBaseSize(e){return this.plot.setBaseSize(e),this}getBaseSize(){return this.plot.getBaseSize()}setAnimationEffect(e){return this.plot.setAnimationEffect(e),this}getAnimationEffect(){return this.plot.getAnimationEffect()}hide(e){return this.plot.hide(e),this}show(e){return this.plot.show(e),this}moveToFront(e){return this.plot.moveToFront(e),this}moveToBack(e){return this.plot.moveToBack(e),this}setHideEffect(e){return this.plot.setHideEffect(e),this}getHideEffect(){return this.plot.getHideEffect()}incrementPanZoom(e){return this.plot.incrementPanZoom(e),this}setPanZoom(e){return this.plot.setPanZoom(e),this}getPanZoom(){return this.plot.getPanZoom()}setEnableSound(e){return this.plot.setEnableSound(e),this}getEnableSound(){return this.plot.getEnableSound()}refreshStyle(){return this.plot.refreshStyle(),this}handleClick(e,t){void 0!==e&&"regions"!==t&&"curves"!==t&&this.toggleSelectionId(t,e)}toggleSelectionId(e,t){return this.selection[e].includes(t)?this.removeSelectionId(e,t):this.addSelectionId(e,t),this}addSelectionId(e,t){if(!this.selection[e].includes(t)){let i=this.getSelection();i[e].push(t),this.setSelection(i)}return this}removeSelectionId(e,t){if(this.selection[e].includes(t)){let t=this.getSelection();t[e]=t[e].filter(e=>e!=e),this.setSelection(t)}return this}putSelection(e,t){let i=this.getSelection();return i[e]=t,this.setSelection(i),this}removeSelection(e){let t=this.getSelection();return t[e]=[],this.setSelection(t),this}setSelection(e){return e=e||{},this.updateSelection({boxes:e.boxes||[],dots:e.dots||[],kernels:e.kernels||[],lines:e.lines||[]},!0),this}_setSelection(e){super._setSelection(e),this.plot.select(this.getSelection())}getSelection(){return ki(this.selection)}equalsSelection(e,t){return Bu.every(i=>Ai(e[i],t[i],!0))}validateSelection(e){let t=this.plot.getIds();return this.validateSelectionAux(e,t)}validateSelectionAux(e,t){let i={};return Bu.forEach(n=>i[n]=Es(e[n],{type:this.type[n],allowNullValues:!0,maxNoSelected:this.maxNoSelected[n],unique:!0,options:t&&t[n]})),this._validateSelection&&(i=this._validateSelection(ki(i))),i}}function df(e,t){t=t||{};let i=si(e,"XYChartSelector",HTMLElement),n=new cf(Object.assign({},t,{element:i}));n.setAxes(t.axes||void 0),"data"in t&&n.setData(t.data),Vs(i,n,t)}bt("esc-xy-chart",df),Nu.init=df,rf||(rf={});class ff extends Cs{setSelection(e){return this.updateSelection(e,!0),this}}class mf extends ff{constructor(e){super(e),this.updateElement=gs(()=>{this.element.classList.toggle(this.className,this.selection)}),this.className=e.className||Ae,this.selection=this.element.classList.contains(this.className)}_setSelection(e){super._setSelection(e),this.updateElement()}validateSelection(e){return vs(e,!1)}}function pf(e,t){let i=si(e,"Expandable",HTMLElement);Vs(i,new mf({element:i}),t)}bt("esc-expandable",pf),rf.init=pf,of||(of={});class gf{constructor(e){this.listeners=new Set,this.adaptors=new Map,this.target=e,this.initialize()}initialize(){this.observer=new MutationObserver(()=>this.fireListeners()),this.observer.observe(this.target,{attributes:!0,attributeFilter:["class"]}),Ie(this.target,"__esc-class-change-sensor__",this)}fireListeners(){for(let e of this.listeners)et(e,[this.target],this.target)}adaptSpecificClassChangeListener(e,t){let i=this.target.classList.contains(e);return()=>{let n=this.target.classList.contains(e);n!=i&&(i=n,et(t,[i,e,this.target],this.target))}}onSpecificClassChange(e,t){if(t){let i=this.adaptors.get(e);if(i||(i=new Map,this.adaptors.set(e,i)),!i.has(t)){let n=this.adaptSpecificClassChangeListener(e,t);i.set(t,n),this.listeners.add(n)}}return this}offSpecificClassChange(e,t){if(e&&t){let i=this.adaptors.get(e),n=i&&i.get(t);n&&(i.delete(t),0===i.size&&this.adaptors.delete(e),this.offClassChange(n))}return this}onClassChange(e){return e&&this.listeners.add(e),this}offClassChange(e){return e&&this.listeners.delete(e),0===this.listeners.size&&this.destroy(),this}destroy(){this.listeners.clear(),this.adaptors.clear(),this.observer.disconnect(),ze(this.target,"__esc-class-change-sensor__")}}function bf(e,t,i,n=!1){if(null==i)return;let s=Me(e,"__esc-class-change-sensor__");if(null==s&&(s=new gf(e)),n){et(i,[e.classList.contains(t),t,e],e)}s.onSpecificClassChange(t,i)}function wf(e,t,i){let n=Me(e,"__esc-class-change-sensor__");null!=n&&n.offSpecificClassChange(t,i)}const vf=e.log.logger("esc.widgets.layout.loader");class yf{constructor(e){if(this.onSelectionCallback=e=>{e?this.load():this.unload()},this.requestAnimationFrameOnce=ps(),this.isLoaded=!1,!e)throw new Error("Loader must have non-null options.");this.element=e.element,this.id=zn(this.element)||Rt(),this.url=e.url,this.headers=Ni(e.headers),this.withCredentials=Ni(e.withCredentials),this.timeout=Ni(e.timeout),this.processor=e.processor,this.bindings=e.bindings||null,this.resolveNamespace=!1!==e.resolveNamespace,this.preProcess=!1!==e.preProcess,this.errorTemplate=ge(this.element,".esc-c-error",HTMLTemplateElement),this.initialize(!!e.loadOnSelection,!!e.loadOnParentSelection,!!e.loadOnReady)}getId(){return this.id}initialize(e,t,i){if(e&&(this.element.classList.contains(Ae)&&(i=!0),bf(this.element,Ae,this.onSelectionCallback),Ue(this.element,()=>wf(this.element,Ae,this.onSelectionCallback))),t&&this.element.parentElement){let e=this.element.parentElement;e.classList.contains(Ae)&&(i=!0),bf(e,Ae,this.onSelectionCallback),Ue(this.element,()=>wf(e,Ae,this.onSelectionCallback))}i&&this.load()}load(){return this.isLoaded?vf.debug("Loading content - already loaded."):(vf.debug("Loading content from %s.",this.url),this.doUnload(),this.doLoad()),this}unload(){return this.abortRequest(),this.isLoaded?(vf.debug("Unloading content."),this.doUnload()):vf.debug("Unloading content - no content loaded."),this}doUnload(){this.isLoaded=!1,this.requestAnimationFrameOnce(()=>{this.element.classList.remove("esc-processing"),this.clearContent()})}clearContent(){for(let e of Array.from(this.element.children))e!==this.errorTemplate&&Ze(e)}abortRequest(){this.request&&(vf.debug("Aborting existing request."),this.request.abort(),this.request=void 0)}doLoad(){this.abortRequest(),vf.debug("Requesting content from %s.",this.url);let e={url:this.url,method:pn.GET,headers:this.headers,withCredentials:this.withCredentials,timeout:this.timeout};this.request=new vn(e),this.request.then(e=>this.onSuccess(e),e=>this.onFail(e))}onFail(e){let t=fn(e.status);vf.error("Request to %s failed (%s): %s",this.url,e.status,t),this.isLoaded=!0,On(e),this.requestAnimationFrameOnce(()=>this.doOnFail())}doOnFail(){this.element.classList.remove("esc-processing"),this.clearContent();let e=document.importNode(this.errorTemplate.content,!0),t=this.preProcess?Array.from(e.children).filter(e=>e instanceof HTMLElement):null;if(ue(e.children,this.element),this.preProcess)try{Nt(t)}catch(e){vf.error("Pre-processing of error message failed: %s",e)}}onSuccess(e){if(vf.debug("Receiving content from %s.",this.url),this.isLoaded=!0,this.processor&&(e=this.processor(e)),this.resolveNamespace||this.bindings){let t=this.getId()+"--",i=this.resolveNamespace?Object.assign({},this.bindings,{"esc-sid-":t+"sid-","esc-next-id-":t+"next-id-"}):this.bindings,n=this.resolveNamespace&&this.bindings?/esc-sid-|esc-next-id-|__(.*?)__/g:this.resolveNamespace?/esc-sid-|esc-next-id-/g:/__(.*?)__/g;e=e.replace(n,e=>{let t=e.startsWith("__")?e.substring(2,e.length-2):e;return t in i?i[t]:e})}this.requestAnimationFrameOnce(()=>{let t=Array.from(he(e));if(ue(t,this.element),this.preProcess)try{Nt(t.filter(e=>e instanceof HTMLElement))}catch(e){return vf.error("Pre-processing of %s failed: %s",this.url,e),void this.doOnFail()}this.element.classList.remove("esc-processing"),vf.debug("Done setting content from %s.",this.url)})}}function xf(e,t){let i,n=si(e,"Loader");if("string"==typeof t.processor){let e=Ke(["html"],t.processor,"processor");i=t=>et(e,[t])}else i=t.processor;let s=new yf(Object.assign({},t,{element:n,processor:i}));Gs(s.element,s,t)}var Sf;bt("esc-loader",xf),of.init=xf,Sf||(Sf={});class Ef extends hs{constructor(e){super(e)}initialize(e){if(!e||!e.element)throw new Error("Target element must be non-null.");super.initialize(e),this.element=e.element,this.id=zn(this.element),this.dispatchEvents=!1!==e.dispatchEvents}doFireOnSelect(e){if(super.doFireOnSelect(e),this.dispatchEvents){let t=new is({id:this.getId(),selection:e});this.element.dispatchEvent(t)}}}const kf=e.log.logger("esc.widgets.layout.multi-loader.MultiLoader"),Nf="esc-data-multi-loaded-url",Cf="esc-data-multi-loaded-index";class If extends Ef{constructor(e){super({element:e.element,unique:!1!==e.unique}),this.updateDom=gs(()=>this.doUpdateDom()),this.id=this.id||Rt(),this.headers=Ni(e.headers),this.withCredentials=Ni(e.withCredentials),this.timeout=Ni(e.timeout),this.urlMap=e.urlMap,this.processor=e.processor,this.bindings=e.bindings||null,this.resolveNamespace=!1!==e.resolveNamespace,this.preProcess=!1!==e.preProcess,this.errorTemplate=ge(this.element,".esc-c-error",HTMLTemplateElement),void 0!==e.selection&&this.setSelection(e.selection||[])}_setSelection(e){super._setSelection(e),this.updateDom()}getSelectionCounts(){let e=new Map;for(let t of this.selection||[]){let i=e.get(t);e.set(t,null==i?1:i+1)}return e}doUpdateDom(){let e,t=this.selection||[],i=this.getSelectionCounts(),n=[],s=new Map;for(let t of Array.from(this.element.children)){if(t===this.errorTemplate)continue;let r=t.getAttribute(Nf),o=t.getAttribute(Cf),l=i.get(r),a=s.get(r);e===o?(a[a.length-1].push(t),t.remove()):l?(a||s.set(r,a=[]),e=o,i.set(r,l-1),a.push([t]),t.remove()):n.push(t)}Ze(n);for(let e=0;e<t.length;e++){let i=t[e],n=s.get(i);if(n){let t=n.shift();n.length||s.delete(i);for(let i of t)i.setAttribute(Cf,e.toString()),this.element.appendChild(i)}else{kf.debug("Adding content from %s.",i);let t=document.createElement("div");t.setAttribute(Nf,i),t.setAttribute(Cf,e.toString()),t.classList.add("esc-processing"),this.element.appendChild(t);let n=this.urlMap?this.urlMap(i):i;new vn({url:n,method:pn.GET,headers:this.headers,withCredentials:this.withCredentials,timeout:this.timeout}).then(e=>this.onSuccess(e,i,n,t),e=>this.onFail(e,n,t))}}if(s.size)throw new se("Some detatched elements are leaked.")}onFail(e,t,i){kf.isErrorEnabled&&kf.error("Request to %s failed (%s): %s",t,e.status,fn(e.status)),i.parentNode?(On(e),requestAnimationFrame(()=>this.doOnFail(i,t))):kf.debug("Discarding failure message from %s.",t)}doOnFail(e,t){if(!e.parentNode)return void kf.debug("Discarding failure message from %s.",t);let i=document.importNode(this.errorTemplate.content,!0),n=Array.from(i.children);if(this.populate(n,e),e.remove(),this.preProcess)try{Nt(n.filter(e=>e instanceof HTMLElement))}catch(e){kf.error("Pre-processing of error message failed: %s",e)}}onSuccess(e,t,i,n){if(n.parentNode){if(kf.debug("Receiving content from %s (id=%s).",i,t),this.processor&&(e=this.processor(e,t,i)),this.resolveNamespace||this.bindings){let n=this.getId()+"--"+t+"--",s=Object.assign(this.resolveNamespace?{"esc-sid-":n+"sid-","esc-next-id-":n+"next-id-",ID:t,URL:i}:{ID:t,URL:i},this.bindings),r=this.resolveNamespace&&this.bindings?/esc-sid-|esc-next-id-|__(.*?)__/g:this.resolveNamespace?/esc-sid-|esc-next-id-/g:/__(.*?)__/g;e=e.replace(r,e=>{let t=e.startsWith("__")?e.substring(2,e.length-2):e;return t in s?s[t]:e})}requestAnimationFrame(()=>{if(!n.parentNode)return void kf.debug("Discarding failure message from %s.",i);let t=Array.from(he(e));if(this.populate(t,n),this.preProcess)try{Nt(t.filter(e=>e instanceof HTMLElement))}catch(e){return kf.error("Pre-processing of %s failed: %s",i,e),Ze(t),void this.doOnFail(n,i)}n.remove(),kf.debug("Done setting content from %s.",i)})}else kf.debug("Discarding content from %s.",i)}populate(e,t){let i=t.getAttribute(Nf),n=t.getAttribute(Cf),s=Array.from(e).filter(e=>e instanceof Element);for(let e of s)e.setAttribute(Nf,i),e.setAttribute(Cf,n);fe(s,t)}}function Mf(e,t){t=t||{};let i,n,s=si(e,"Multi-loader",HTMLElement);if("string"==typeof t.processor){let e=Ke(["html","id","url"],t.processor,"processor");i=(t,i,n)=>et(e,[t,i,n])}else i=t.processor;if("string"==typeof t.urlMap){let e=Ke(["id"],t.urlMap,"url map");n=t=>et(e,[t])}else n=t.urlMap;let r=new If(Object.assign({},t,{element:s,urlMap:n,processor:i}));Vs(r.element,r,t)}var zf,Af,Tf,Lf,$f,Of,Df,Pf;bt("esc-multi-loader",Mf),Sf.init=Mf,zf||(zf={});class _f{constructor(e){this.element=e,ge(this.element,".esc-c-remove").addEventListener("click",()=>Ze(this.element))}}function Ff(e,t){let i=si(e,"Removable");Gs(i,new _f(i),t)}bt("esc-removable",Ff),zf.init=Ff,Af||(Af={});class Rf extends ff{constructor(e){super(e),this.updateDom=gs(()=>{let e=!1,t=!1;for(let i of this.element.children){let n=this.getElementId(i),s=null!=n&&n===this.selection,r=i.classList;r.remove("esc-js-enters-left","esc-js-enters-right","esc-js-exits-left","esc-js-exits-right"),s&&(e=!0,r.add(t?"esc-js-enters-right":"esc-js-enters-left")),r.contains(Ae)&&(t=!0,r.add(e?"esc-js-exits-right":"esc-js-exits-left")),r.toggle(Ae,s)}this.element.classList.remove("esc-js-is-initial")}),this.type=e.type,this.optionIds=Array.from(this.element.children).map(e=>this.getElementId(e)),this.selection=this.getSelectedId()}_setSelection(e){super._setSelection(e),this.updateDom()}validateSelection(e){if(void 0===e)return e;if(e=this.castSelection(e),!this.optionIds.includes(e))throw new Error(`Selection ${u(e)} is not available: ${u(this.optionIds)}`);return e}getSelectedId(){for(let e of this.element.children)if(e.classList.contains(Ae))return this.getElementId(e)}getElementId(e){let t=e.getAttribute("data-esc-id");if(null==t)throw new Error("Selected stack has no id.");if(t=s(t),void 0===t)throw new Error("Item has undefined id.");return this.castSelection(t)}castSelection(e){return Ss(e,this.type,!0)}selectPrevious(){let e=this.optionIds.length;if(0===e)return this;let t=null==this.selection?-1:this.optionIds.indexOf(this.selection);return t=t<=0?e-1:t-1,t>=0&&this.setSelection(this.optionIds[t]),this}selectNext(){let e=this.optionIds.length;if(0===e)return this;let t=null==this.selection?-1:this.optionIds.indexOf(this.selection);return t=t<0||t>=e-1?0:t+1,t>=0&&this.setSelection(this.optionIds[t]),this}selectFirst(){return this.optionIds.length>0&&this.setSelection(this.optionIds[0]),this}selectLast(){return this.optionIds.length>0&&this.setSelection(this.optionIds[this.optionIds.length-1]),this}}function Bf(e,t){const i=si(e,"Stackview",HTMLElement);Vs(i,new Rf(Object.assign({},t,{element:i})),t)}function Hf(e,t){t=t||{};let i,n=si(e,"Label controller",HTMLElement);if(null!=t.parent){if(i=Pe(t.parent),!i)throw new Error(`Element '${t.parent}' not found.`);if(!(i instanceof HTMLElement))throw new Error(`Parent element must be HTMLElement: ${i}`)}let s=new Nh({element:n,parent:i});Vs(s.element,s,t)}function jf(e,t){let i=Pe(t.element);if(!i)throw new Error(`Element '${t.element}' not found.`);Gs(i,function(e){let t=e.map(e=>Re(e)).reverse();return new Proxy({},{has:(e,i)=>t.some(e=>i in e),get:(e,i)=>{for(let e of t)if(i in e){let t=e[i];return"function"==typeof t?t.bind(e):t}},set:()=>!1})}(t.controllers),t)}bt("esc-stackview",Bf),Af.init=Bf,Tf||(Tf={}),bt("esc-label",Hf),Tf.init=Hf,Lf||(Lf={}),bt("esc-proxy-controller",{dependencies:null,process:jf}),Lf.init=jf,$f||($f={}),function(e){e.small="small",e.medium="medium",e.large="large"}(Of||(Of={})),function(e){e.light="light",e.dark="dark"}(Df||(Df={})),function(e){e.solid="solid",e.subtle="subtle",e.transparent="transparent",e.dots="dots",e.triangle="triangle",e.bubblesBottom="bubbles-bottom",e.gradient="gradient"}(Pf||(Pf={}));e.log.logger("esc.widgets.panel.card");var qf,Uf,Zf,Yf;function Gf(e){return function(e){let t=J(),i=t[e];if(null==i)throw new Error(`Key '${e}' not found in dictionary '${t.lang}'.`);return i}("esc.widgets.panel.modal.render")[e]}!function(e){e.plain="plain",e.grid="grid",e.column="column",e.row="row",e.none="none"}(qf||(qf={})),function(e){e.standard="standard",e.half="half",e.quarter="quarter",e.jumbo="jumbo",e.none="none"}(Uf||(Uf={})),function(e){e.plain="plain",e.info="info",e.warn="warn",e.error="error",e.success="success"}(Zf||(Zf={})),Yf||(Yf={});const Vf=e.log.logger("esc.widgets.panel.modal");function Xf(e){return Tn("esc.widgets.misc.statemanager.runtime")[e]}const Wf=e.log.logger("esc.widgets.misc.StateManager");class Kf extends Is{constructor(e){super(e)}initialize(e){if(super.initialize(e),!e.key)throw new Error("StateManager must have non-naught key.");if(!e.provider)throw new Error("StateManager must have non-null state provider.");this.key=e.key,this.version=e.version||null,this.provider=e.provider,this.optionsDiv=ge(this.element,".esc-c-options"),ge(this.element,".esc-c-add").addEventListener("click",()=>this.add()),this.load(),requestAnimationFrame(()=>{for(let e of this.entries)this.addOption(e)})}load(){let e;this.entries=[];let t=window.localStorage.getItem(this.key);if(null!=t){{let i=at(t);if(this.version!==i.version){Wf.warn("State TOC '%s' has incompatible versions: required=%s, actual=%s",this.key,this.version,i.version);for(let e of i.ids)window.localStorage.removeItem(this.getEffectiveId(e));return void window.localStorage.removeItem(this.key)}Wf.debug("State TOC '%s' found: %o",this.key,i.ids),e=i.ids}for(let t of e){let e=window.localStorage.getItem(this.getEffectiveId(t));if(null==e)throw new Error(`State entry '${this.getEffectiveId(t)}' not found.`);let i=at(e);this.entries.push(i)}}else Wf.debug("State TOC '%s' not found.",this.key)}getEffectiveId(e){return this.key+"__"+e}nextId(){let e,t=0;do{e=""+ ++t}while(this.entries.some(t=>t.id===e));return e}hasEntry(e){for(let t of this.entries)if(this.equalsSelection(e,t.value))return!0;return!1}equalsSelection(e,t){return Ii(e,t)}validateSelection(e){return this.hasEntry(e)?e:null}updateSelection(e,t){let i=super.updateSelection(e,t);return this.selection=void 0,i}getSelection(){return ki(this.selection)}add(){let e=this.provider();if(!this.hasEntry(e)){let t=this.nextId(),i={id:t,label:Xf("bookmark")+" "+t,value:e};Wf.info("Adding state entry '%s': %o",this.key,i),requestAnimationFrame(()=>this.addOption(i)),this.entries.push(i),this.writeIds(),this.writeEntry(i)}}addOption(e){let t=mt('<div class="esc-c-option" />');mt('<button class="esc-c-label esc-button esc-m-type-subtle" />').text(e.label).on("click",()=>this.updateSelection(e.value,!0)).appendTo(t),mt('<button class="esc-c-edit esc-icon-button esc-m-type-subtle esc-m-style-light esc-icon-edit" />').attr("title",Xf("edit")).on("click",()=>this.edit(e,t)).appendTo(t),mt('<button class="esc-c-clear esc-icon-button esc-m-type-subtle esc-m-style-light esc-icon-trash" />').attr("title",Xf("remove")).on("click",()=>this.remove(e.id,t)).appendTo(t),t.appendTo(mt(this.optionsDiv))}writeIds(){if(0===this.entries.length)window.localStorage.removeItem(this.key);else{let e=this.entries.map(e=>e.id),t={version:this.version,ids:e};window.localStorage.setItem(this.key,rt(t))}}writeEntry(e){window.localStorage.setItem(this.getEffectiveId(e.id),rt(e))}edit(t,i){let n,s=mt('<input type="text" tabindex="0" required>').prop("value",t.label),r=mt('<div class="esc-field"/>').append(mt('<div class="esc-c-input"/>').append(s)),o=mt('<button class="esc-button"/>').text(Xf("submit")).on("click",()=>{let e=s.prop("value");this.update(e,t,i),Re(n).close()}),l=mt('<button class="esc-button esc-m-type-ghost"/>').text(Xf("cancel")).on("click",()=>Re(n).close());n=function(t){Vf.info("Rendering module 'esc-modal'.");let i=!1!==t.live,n=!0===t.selection,s=!1!==t.closeable,r=Mt(t.type,Zf,Zf.plain),o=Mt(t.width,Of,Of.small),l=Mt(t.height,Of,Of.small),a=Mt(t.theme,Df,Df.light),h=Mt(t.background,Pf,Pf.solid),u=Mt(t.layout,qf,qf.plain),c=e.$('<div class="esc-modal"/>');c.addClass(`esc-t-${a}`),h!==Pf.solid&&c.addClass(`esc-h-background-${h}`),r!==Zf.plain&&c.addClass(`esc-m-type-${r}`),o!==Of.small&&c.addClass(`esc-m-width-${o}`),l!==Of.small&&c.addClass(`esc-m-height-${l}`),n&&c.addClass("esc-is-open");let d=e.$('<div class="esc-c-window" />').appendTo(c);if(t.title||s){let i=e.$('<div class="esc-c-titlebar" />').appendTo(d);if(t.title&&Tt(t.title,e.$('<div class="esc-c-title" />').appendTo(i)),s){let t=e.$('<div class="esc-c-buttons"/>').appendTo(i);e.$('<button class="esc-icon-button esc-m-type-subtle esc-m-style-light esc-icon-close" />').attr("title",Gf("close")).appendTo(t)}}let f=e.$('<div class="esc-c-body" />').appendTo(d);u===qf.plain?f.addClass("esc-panel"):u!==qf.none&&f.addClass(`esc-panel--${u}`),t.body&&Tt(t.body,f),t.toolbar&&Tt(t.toolbar,e.$('<div class="esc-c-toolbar" />').appendTo(d));let m={removeOnClose:t.removeOnClose||void 0,onSelection:t.onSelection,selectables:t.selectables,onDestroy:t.onDestroy};i?Yf.init(c,m):fa(c,"esc-modal",m),t.attributes&&t.attributes.id&&c.attr("id",t.attributes.id);let p=Object.assign({},t.attributes);return delete p.id,Dt(p,f),t.target&&_t(c,t.target),c}({target:{element:mt(document.body),type:Pt.append},title:Xf("edit"),body:r,toolbar:[o,l],width:Of.small,height:Of.small,selection:!0,closeable:!0,removeOnClose:!0})}update(e,t,i){(e=e.trim())&&e!==t.label&&(Wf.info("Updating state entry '%s' label '%s': %o",this.key,e,t),t.label=e,requestAnimationFrame(()=>i.children(".esc-c-label").text(t.label)),this.writeEntry(t))}remove(e,t){let i=this.entries.map(e=>e.id).indexOf(e);if(i<0)throw new Error(`State entry '${e}' not found.`);Wf.info("Removing state entry '%s': '%s'",this.key,e),requestAnimationFrame(()=>t.remove()),this.entries.splice(i,1),this.writeIds(),window.localStorage.removeItem(this.getEffectiveId(e))}}function Qf(e,t){let i=si(e,"State manager",HTMLElement),n=new Kf(function(e,t){let i;if("string"==typeof t.provider){let e=Ke([],t.provider,"state provider");i=()=>et(e,[])}else i=t.provider;return{element:e,key:t.key,version:t.version,provider:i}}(i,t));Vs(n.element,n,t)}bt("esc-state-manager",Qf),$f.init=Qf;const Jf="esc.widgets.misc.statusmanager.destroy";class em{constructor(e){if(!e||!e.element)throw new Error("StatusManager element must be non-null.");this.element=e.element,this.ttl=null==e.ttl?-1:e.ttl;for(let e of me(this.element,".esc-c-item"))this.wireItem(e);this.removeDelay=Nr(this.element,"esc-status-manager-remove-delay",0)}send(e){let t=Vt(e,mt).get(0);return di(t,e),this.wireItem(t),this.element.appendChild(t),this}wireItem(e){let t,i=e.getAttribute("data-esc-ttl"),n=i?parseInt(i):this.ttl,s=pe(e,".esc-c-remove");s&&(t=()=>{s.removeEventListener("click",t),ze(e,Jf),requestAnimationFrame(()=>e.classList.add("esc-js-is-closing")),this.removeDelay>0?setTimeout(()=>{requestAnimationFrame(()=>Ze(e))},this.removeDelay):requestAnimationFrame(()=>Ze(e))},Ie(e,Jf,t),s.addEventListener("click",t)),n>0&&(t||(t=()=>{requestAnimationFrame(()=>Ze(e))}),setTimeout(t,n))}remove(e){for(let t of me(this.element,`[data-esc-id="${e}"].esc-c-item`))this.destroy(t);return this}clear(){for(let e of me(this.element,".esc-c-item"))this.destroy(e);return this}destroy(e){let t=Me(e,Jf);t?t():Ze(e)}}function tm(e,t){let i=si(e,"Status manager");Gs(i,new em(Object.assign({},t,{element:i})),{})}var im,nm;bt("esc-status-manager",tm),Yt.init=tm,im||(im={});class sm extends ff{constructor(e){super(e)}initialize(e){this.template=e.template,super.initialize(e),void 0!==e.selection&&this.updateSelection(e.selection,!1)}_setSelection(e){super._setSelection(e),requestAnimationFrame(()=>this.applyTemplate())}applyTemplate(){let e=void 0===this.selection?void 0:this.template(this.selection);var t;(Ze(this.element.childNodes),this.element.innerHTML="",e)&&(e instanceof Element?this.element.appendChild(e):("string"==typeof(t=e)||zt(t)||ie(t)||Array.isArray(t)&&t.every(ie))&&Tt(e,mt(this.element)))}equalsSelection(e,t){return Ii(e,t)}validateSelection(e){return ki(e)}getSelection(){return ki(this.selection)}}function rm(e,t){let i=si(e,"Template controller",HTMLElement),n=function(e,t="selection"){if("string"!=typeof e)return e;let i=Ke([t],e,"template");return e=>et(i,[e])}(t.template,t.dataVariable),s=new sm({element:i,template:n,selection:t.selection});Vs(s.element,s,t)}bt("esc-template",rm),im.init=rm,nm||(nm={});const om=e.log.logger("esc.widgets.misc.video.VideoController");class lm extends Cs{constructor(e){super(e)}initialize(e){super.initialize(e),this.url=e.url||null,this.element.addEventListener("play",()=>this.updateSelection("playing",!0)),this.element.addEventListener("pause",()=>this.updateSelection("paused",!0)),this.element.addEventListener("ended",()=>this.updateSelection("ended",!0)),this.element.addEventListener("esc-destroy",()=>this.destroy()),this.isNative=!!this.element.canPlayType("application/vnd.apple.mpegurl"),this.hlsRequested=!1,this.destroyed=!1,this.audioCodecSwapThreshold=500,this.audioCodecSwapped=!1,this.onHlsError=(e,t)=>{if(t.fatal&&!this.destroyed)switch(t.type){case Hls.ErrorTypes.NETWORK_ERROR:om.error("HLS fatal network error - trying to recover: %o",t),t.networkDetails&&On({status:t.networkDetails.status,response:"Remote call failed."}),this.hls.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:null==this.lastMediaError?(this.lastMediaError=Date.now(),om.error("HLS fatal media error - trying to recover: %o",t),this.hls.recoverMediaError()):!this.audioCodecSwapped&&Date.now()-this.lastMediaError<=this.audioCodecSwapThreshold?(om.error("Repeated HLS fatal media error - swapping audio codec and trying to recover: %o",t),this.audioCodecSwapped=!0,this.hls.swapAudioCodec(),this.hls.recoverMediaError()):(om.error("Repeated HLS fatal media error - abandoning recovery attempts: %o",t),this.destroy());break;default:om.error("Fatal, non-recoverable HLS error: %o",t),this.destroy()}},this.initializeVideo()}initializeVideo(){var e;if(!this.destroyed)if(this.isNative)this.initializeNatively();else if(window.Hls)this.initializeHls();else{if(this.hlsRequested)return;this.hlsRequested=!0,(e=`/static/${sh}/TBD/js/hls.min.js`,new Promise((t,i)=>{const n=document.createElement("script");n.defer=!0,n.onerror=e=>{i(e.error),n.remove()},n.onload=()=>{t(),n.remove()},n.src=e,document.head.appendChild(n)})).then(()=>{this.destroyed||(om.debug("Done loading hls.js version %s.",Hls.version),Hls.isSupported()?this.initializeHls():om.error("Browser does not support Media Extensions: %s",window.navigator.userAgent))})}}initializeNatively(){om.info("Playing video %s natively.",this.url),this.element.src=this.url||""}initializeHls(){om.info("Playing video %s using HLS library.",this.url),this.url&&(this.hls=new Hls,this.hls.loadSource(this.url),this.hls.attachMedia(this.element),this.hls.on(Hls.Events.ERROR,this.onHlsError))}getUrl(){return this.url}setUrl(e){if((e=e||null)&&".m3u8"!==e.substring(e.length-5).toLowerCase())throw new Error(`Only HLS video format is supported: ${e}`);return this.url!==e&&(this.url&&this.hls&&(this.element.pause(),this.hls.destroy()),this.url=e,this.initializeVideo()),this}play(e){return void 0===e||this.setUrl(e),this.element.play()}pause(){return this.element.pause(),this}destroy(){return this.destroyed||(om.info("Destroying existing HLS context on video element: %o",this.element),this.element.pause(),this.hls&&this.hls.destroy(),this.destroyed=!0),this}}function am(e,t){t=t||{};let i=si(e,"Video controller",HTMLVideoElement),n=new lm({element:i,url:t.url});Vs(n.element,n,t)}var hm;bt("esc-video",am),nm.init=am,hm||(hm={});const um=e.log.logger("esc.widgets.page.Controller"),cm="esc-js-navigation-is-open",dm=new Set;class fm{constructor(e){if(this.openers=new Set,this.openerListener=e=>this.toggle(e),this.isOpen=!1,null==e)throw new Error("Options must be non-null.");if(null==e.navigation)throw new Error("Navigation element is missing.");this.navigation=e.navigation;let t=pe(this.navigation,".esc-c-toolbar");if(!t)throw new Error("Navigation element does not have unique toolbar");this.navigationToolbar=t,e.openers&&this.addOpener(...e.openers),window.addEventListener("click",e=>this.close(e)),dm.add(this)}addOpener(...e){if(e)for(let t of e)t&&this.openers.add(t)&&t.addEventListener("click",this.openerListener);return this}removeOpener(...e){if(e)for(let t of e)t&&this.openers.add(t)&&t.removeEventListener("click",this.openerListener);return this}toggle(e){return this.isOpen?this.close(e):this.open(e)}open(e){if(this.checkDestroy())return this;if(null!=e&&e.stopPropagation(),this.isOpen)return this;um.info("Opening navigation:",this.navigation),this.isOpen=!0,document.documentElement.classList.add(cm),this.navigation.classList.add(cm);for(let e of this.openers)e.classList.add(Ae);for(let e of dm)e!=this&&e.close();return this}close(e){if(this.checkDestroy())return this;if(null!=e&&e.stopPropagation(),!this.isOpen)return this;if(null!=e&&this.navigationToolbar.contains(e.target))return this;um.info("Closing navigation:",this.navigation),this.isOpen=!1,document.documentElement.classList.remove(cm),this.navigation.classList.remove(cm);for(let e of this.openers)e.classList.remove(Ae);return this}checkDestroy(){return!document.contains(this.navigation)&&(this.destroy(),!0)}destroy(){return dm.delete(this),this}}function mm(e){let t=si(e,"Navigation");Gs(t,new fm({navigation:t}),{})}function pm(t,i){let n=si(t,"Navigation opener"),s=si(e.$(i),"Navigation"),r=Me(s,"esc-controller");if(!r)throw new Error(`Element '${s.tagName}' is not wired with a Controller.`);r.addOpener(n)}var gm,bm;function wm(e,t){let i=si(e,"Scroll-to button"),n=document.querySelector(t);if(null==n)throw new Error(`Jump-to target '${t}' not found.`);i.addEventListener("click",()=>{let e=n.getBoundingClientRect(),t=window.scrollY+e.top;window.scroll?window.scroll({top:t,behavior:"smooth"}):document.documentElement.scrollTop=document.body.scrollTop=t})}bt("esc-navigation",mm),bt("esc-navigation-opener",{dependencies:["esc-navigation"],process:pm}),hm.initNavigation=mm,hm.initOpener=pm,gm||(gm={}),bt("esc-scroll-to",wm),gm.init=wm,function(e){e.none="none",e.left="left",e.right="right"}(bm||(bm={}));const vm="esc-js-is-collapsed";const ym=e.log.logger("esc.widgets.panel.divider.Controller");class xm{constructor(e){if(this.update=gs(()=>this.doUpdate()),null==e)throw new Error("Options must be non-null.");if(null==e.element)throw new Error("Divider element is missing.");this.element=e.element,this.one=ge(this.element,".esc-c-one",HTMLElement),this.two=ge(this.element,".esc-c-two",HTMLElement),this.one.classList.contains(vm)?this._collapse=bm.left:this.two.classList.contains(vm)?this._collapse=bm.right:this._collapse=bm.none,this._ratio=e.ratio,this.divider=ge(this.element,".esc-c-divider",HTMLElement),this.arrowOne=ge(this.divider,".esc-c-arrow-left",HTMLElement),this.arrowOne.addEventListener("click",()=>{this.collapse=this.collapse===bm.none?bm.left:bm.none}),this.arrowTwo=ge(this.divider,".esc-c-arrow-right",HTMLElement),this.arrowTwo.addEventListener("click",()=>{this.collapse=this.collapse===bm.none?bm.right:bm.none}),this.horizontal=!this.element.classList.contains("esc-m-orientation-vertical"),this.dragController=new ul({element:this.divider,onProgress:e=>this.onDrag(e)})}doUpdate(){let e=function(e,t){let i,n,s,r;switch(t){case bm.none:i=e.toPrecision(2),n=(1-e).toPrecision(2),s=!1,r=!1;break;case bm.left:i="0",n="1",s=!0,r=!1;break;case bm.right:i="1",n="0",s=!1,r=!0;break;default:throw new se(`Collapse state not recognized: '${t}'`)}return{weightOne:i,weightTwo:n,collapsedOne:s,collapsedTwo:r}}(this._ratio,this._collapse);this.one.style.flexGrow=e.weightOne,this.one.style.flexShrink=e.weightOne,this.one.classList.toggle(vm,e.collapsedOne),this.arrowOne.classList.toggle(vm,e.collapsedOne),this.two.style.flexGrow=e.weightTwo,this.two.style.flexShrink=e.weightTwo,this.two.classList.toggle(vm,e.collapsedTwo),this.arrowTwo.classList.toggle(vm,e.collapsedTwo),this.divider.classList.toggle(vm,this._collapse!==bm.none)}get ratio(){return this._ratio}set ratio(e){if(Number.isNaN(e))throw new Error("Ratio is NaN.");if(e<0||e>1)throw new Error(`Ratio ${e} is outside of range [0, 1].`);e=Number.parseFloat(e.toPrecision(2)),this._ratio!=e&&(ym.debug("Setting ratio to %f.",e),this._ratio=e,this._collapse===bm.none&&this.update())}get collapse(){return this._collapse}set collapse(e){let t=Mt(e,bm,bm.none);this._collapse!==t&&(ym.debug("Setting collapse to '%s'.",t),this._collapse=t,this.update())}onDrag(e){let t,i,n=this.element.getBoundingClientRect();this.horizontal?(t=e.clientX-n.left,i=n.width):(t=e.clientY-n.top,i=n.height);let s=t/i;Number.isNaN(s)?s=.5:s<0?s=0:s>1&&(s=1),ym.debug("Dragging - ratio=%f.",s,e);let r=this._collapse!==bm.none||s!==this._ratio;this._collapse=bm.none,this._ratio=s,r&&this.update()}}var Sm;function Em(e,t){let i=si(e,"Divider");Gs(i,new xm(Object.assign({},t,{element:i})),t)}Sm||(Sm={}),bt("esc-divider",Em),Sm.init=Em;const km=[Of.small,Of.medium,Of.large],Nm=[Zf.plain,Zf.info,Zf.warn,Zf.error,Zf.success];class Cm extends mf{constructor(e){super(Object.assign({},e,{className:"esc-is-open"}));let t=this.element.querySelector(".esc-c-window > .esc-c-titlebar > .esc-c-buttons > .esc-icon-close");t&&t.addEventListener("click",()=>this.close()),!0===e.removeOnClose&&this.onSelection(e=>{e||Ze(this.element)})}width(e){return requestAnimationFrame(()=>{this.element.classList.remove(...km.map(e=>`esc-m-width-${e}`)),this.element.classList.add(`esc-m-width-${e}`)}),this}height(e){return requestAnimationFrame(()=>{this.element.classList.remove(...km.map(e=>`esc-m-height-${e}`)),this.element.classList.add(`esc-m-height-${e}`)}),this}type(e){return requestAnimationFrame(()=>{this.element.classList.remove(...Nm.map(e=>`esc-m-type-${e}`)),this.element.classList.add(`esc-m-type-${e}`)}),this}setContent(e){this.body=this.body||we(this.element,".esc-c-body"),Ze(this.body.children),Tt(e,mt(this.body))}content(e){return requestAnimationFrame(()=>this.setContent(e)),this}toggle(){return this.setSelection(!this.selection)}open(){return this.setSelection(!0)}close(){return this.setSelection(!1)}}function Im(e,t){t=t||{};let i=si(e,"Modal",HTMLElement);Vs(i,new Cm({element:i,removeOnClose:t.removeOnClose}),t)}function Mm(e,t){t=t||{};let i=Array.from(e),n=f(t.offset||0),s=f(null==t.step?1:t.step);return e=>{let t=function(e,t){return w(e,{base:-t.base,power:t.power})}(f(e),n),r=Math.min(t.power,s.power),o=p(t,r)/p(s,r);return Number.isInteger(o)&&i[o]||""}}var zm;function Am(e,t,i,n){if(!e)return;let s,r;if(null==i){if(null!=n)throw new Error("Invalid signature.");s=[0,1],r={}}else if(Array.isArray(i))s=i,r=n||{};else{if(null!=n)throw new Error("Invalid signature.");s=[0,1],r=i||{}}let o=null==r.id?e=>e.id:"string"==typeof r.id?e=>e[r.id]:r.id,l=null==r.low?e=>e.low:"string"==typeof r.low?e=>e[r.low]:r.low,a=null==r.high?e=>e.high:"string"==typeof r.high?e=>e[r.high]:r.high,h=null==r.color?e=>e.color:"string"==typeof r.color?e=>e[r.color]:r.color,u=[l(e),a(e)];if(!Number.isFinite(u[0])||!Number.isFinite(u[1]))return;let c=Tm(t,s,r),d=!1!==r.vertical,[f,m]=d?c:u,[p,g]=d?u:c;return Object.assign({},e,{id:o(e),xLow:f,xHigh:m,yLow:p,yHigh:g,color:h(e),fuzz:d?oc.y:oc.x})}function Tm(e,t,i){let n,s,r;if(null==t){if(null!=i)throw new Error("Invalid signature.");n=1,s=0,r={}}else if(Array.isArray(t))[s,n]=t,r=i||{};else{if(null!=i)throw new Error("Invalid signature.");n=1,s=0,r=t||{}}if(n<0)throw new Error("The number of groupings must be positive.");if(s>=n)throw new Error(`Group index ${s} is out of range (${n}).`);let o=b(r.offset||0),l=b(null==r.step?1:r.step),a=null==r.weightBar?16:r.weightBar,h=null==r.weightCategoryGap?8:r.weightCategoryGap,u=null==r.weightGroupGap?1:r.weightGroupGap,c=l/(n*a+(n-1)*u+h),d=a*c,f=o+(e-.5)*l+h*c/2+s*(d+u*c);return[f,f+d]}function Lm(e,t,i,n){let{xLow:s,xHigh:r,yHigh:o,yLow:l,total:a}=n,h=r-s,u=o-l,c=Pm(e,t,i);if(h<u){for(c<a&&(l=o-c/a*u);t<i;){let r=e[t++];r.xLow=s,r.xHigh=t===i?n.xHigh:s+r.value/c*h,r.yHigh=o,r.yLow=l,s=r.xHigh}return a=Pm(e,i,e.length),{xLow:n.xLow,yLow:n.yLow,xHigh:n.xHigh,yHigh:l,total:a}}for(c<a&&(r=s+c/a*h);t<i;){let l=e[t++];l.xLow=s,l.xHigh=r,l.yHigh=o,l.yLow=t===i?n.yLow:o-l.value/c*u,o=l.yLow}return a=Pm(e,i,e.length),{xLow:r,yLow:n.yLow,xHigh:n.xHigh,yHigh:n.yHigh,total:a}}function $m(e,t,i,n){if(0===i.total)return Dm(e[t].value,i),!0;{let s=n.xHigh-n.xLow,r=n.yHigh-n.yLow,o=Math.min(s,r)/Math.sqrt(s*r/n.total),l=Om(i,o);return Dm(e[t].value,i),l>=Om(i,o)}}function Om(e,t){let i=Math.pow(t,2)/Math.pow(e.total,2);return Math.max(i*e.max,1/(i*e.min))}function Dm(e,t){e<t.min&&(t.min=e),e>t.max&&(t.max=e),t.total+=e}function Pm(e,t,i){let n=0;for(;t<i;)n+=e[t++].value;return n}function _m(e,t,i){!function(e){if(!function(e){return null!=e&&(2===e.length&&2===e[0].length&&2===e[1].length&&(e[0][1]===e[1][0]&&(e[0][0]>0&&e[0][0]*e[1][1]>e[0][1]*e[0][1])))}(e))throw new Error(`Matrix is not 2x2, symmetric, and positive definite: ${u(e)}`)}(t);const[n,s]=t[0],r=t[1][1],o=n*r-s*s;let l=(n+r)/2,a=Math.sqrt(l*l-o),h=l+a,c=l-a,d=n>=r?h:c,f=n>=r?c:h,m=wr([d-r,s])[1];return{center:hr(e),rx:i*Math.sqrt(d),ry:i*Math.sqrt(f),theta:m}}function Fm(e,t,i){return Bm((e||[]).map(Mo),t,i)}function Rm(e,t,i){return Bm((e||[]).map(zo),t,i)}function Bm(e,t,i){e=e||[];let n=function(e,t){let i,n=(e.max-e.min)/t,s=new Array(t+1),r=0;for(i=e.min;i<=e.max;i+=n)s[r++]=i;i<e.max&&(s[r++]=e.max);return s.length=r,s}(t,i),s=[],r=[];for(let t of e){let e=t(n),i=eo(Hr(e,e=>e[1]));r.push(i),e.unshift([Number.NEGATIVE_INFINITY,0]),e.push([Number.POSITIVE_INFINITY,0]),s.push(e)}let o=eo(r);for(let e of s)for(let t of e)t[1]/=o.max;return s}bt("esc-modal",Im),Yf.init=Im,function(e){e.clustered="clustered",e.stacked="stacked"}(zm||(zm={}));const Hm=Object.freeze({bars:function(e,t){return e=e||[],"groupings"in(t=t||{})?function(e,t){!function(e){let t=new Map,i=new Set;for(let n of e){let e=n.group;if(void 0===e)throw new Error("Grouping has undefined group.");if(t.has(e))throw new Error(`Grouping has duplicate group '${e}'.`);let s=n.color;if(!s)throw new Error(`Grouping '${e}' must have non-naught color.`);if(i.has(s))throw new Error(`Grouping '${e}' has duplicate color '${s}'.`);i.add(s),t.set(e,s)}}(t.groupings);let i=null==t.id?e=>e.id:"string"==typeof t.id?e=>e[t.id]:t.id,n=null==t.group?e=>e.group:"string"==typeof t.group?e=>e[t.group]:t.group,s=null==t.low?e=>e.low:"string"==typeof t.low?e=>e[t.low]:t.low,r=null==t.high?e=>e.high:"string"==typeof t.high?e=>e[t.high]:t.high,o=e=>{let t=s(e),o=r(e);if(0!==t&&0!==o)throw new Error(`Stacked bar ${Un([i(e),n(e)],"-")} must have either low or high zero value: low=${t}, high=${o}`);return t+o},l=t.groupingMode===zm.stacked,a=0,h=0,u=l?e=>o(e)>=0?a:h:s,c=l?e=>{let t=o(e);return t>=0?a+=t:h+=t}:r,d=Object.assign({},t,{id:e=>Un([i(e),n(e)],"-"),low:u,high:c}),f=new Set,m=new Set,p=t.groupings.length,g=[];for(let s=0;s<t.categories.length;s++){let r=t.categories[s],o=r.id;if(void 0===o)throw new Error("Category has undefined id.");if(f.has(o))throw new Error(`Category has duplicate id '${o}'.`);f.add(o);let u=r.label;if(!u)throw new Error(`Category '${o}' must have non-naught label.`);if(m.has(u))throw new Error(`Category '${o}' has duplicate label '${u}'.`);m.add(u),a=0,h=0;for(let r=0;r<p;r++){let a=t.groupings[r],h=a.group,u=e.filter(e=>!!e&&i(e)===o&&n(e)===h);if(u.length>1)throw new Error(`Duplicate data point: ${Un([o,h])}`);let c=Am(u[0],s,l?[0,1]:[r,p],d);c&&(c.color=a.color,g.push(c))}}return{boxes:g,format:Mm(m,t)}}(e,t):"categories"in t?function(e,t){let i=null==t.id?e=>e.id:"string"==typeof t.id?e=>e[t.id]:t.id,n=t.categories,s=new Set,r=new Set,o=[];for(let l=0;l<n.length;l++){let a=n[l],h=a.id;if(void 0===h)throw new Error("Category has undefined id.");if(s.has(h))throw new Error(`Category has duplicate id '${h}'.`);s.add(h);let u=a.label;if(!u)throw new Error(`Category '${h}' must have non-naught label.`);if(r.has(u))throw new Error(`Category '${h}' has duplicate label '${u}'.`);r.add(u);let c=e.filter(e=>!!e&&i(e)===h);if(c.length>1)throw new Error(`Duplicate data point: ${h}`);let d=Am(c[0],l,t);d&&(d.color=a.color,o.push(d))}return{boxes:o,format:Mm(r,t)}}(e,t):function(e,t){let i=null==t.id?e=>e.id:"string"==typeof t.id?e=>e[t.id]:t.id,n=new Set,s=new Set,r=[],o=null==t.label?e=>e.label:"string"==typeof t.label?e=>e[t.label]:t.label;for(let l=0;l<e.length;l++){let a=e[l];if(!a)continue;let h=i(a);if(void 0===h)throw new Error("Datum has undefined id.");if(n.has(h))throw new Error(`Duplicate data point: ${h}`);n.add(h);let u=o(a);if(!u)throw new Error(`Data point '${h}' must have non-naught label in absense of categories.`);if(s.has(u))throw new Error(`Data point '${h}' has duplicate label '${u}'.`);s.add(u);let c=Am(a,l,t);c&&r.push(c)}return{boxes:r,format:Mm(s,t)}}(e,t)},barPosition:Tm,squarify:function(e,t=1,i=1){if(t<=0||i<=0)throw new Error("Width and height must be positive.");let n=e.map(e=>Object.assign({},e)),s=Pm(n,0,n.length);if(!s)return[];let r={xLow:0,yLow:0,xHigh:t,yHigh:i,total:s},o={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,total:0},l=0,a=0;for(;a<n.length;)$m(n,a,o,r)?a++:(r=Lm(n,l,a,r),l=a,o.min=Number.POSITIVE_INFINITY,o.max=Number.NEGATIVE_INFINITY,o.total=0);return Lm(n,l,a,r),n},kernels:function(e){e=e||[];let t=[],i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){let r=e[s];if(i=Math.min(i,r.count),n=Math.max(n,r.count),1===r.count)t.push({id:s,center:[r.muX,r.muY],radii:[0,0],theta:0,fuzzy:!1});else{r.varX*r.varY-Math.pow(r.varXY,2)<=0&&r.count<=3&&(r.varXY=0);let e=_m([r.muX,r.muY],[[r.varX,r.varXY],[r.varXY,r.varY]],3);t.push({id:s,center:e.center,radii:[e.rx,e.ry],theta:e.theta,fuzzy:!0})}}let s=n-i;for(let n=0;n<e.length;n++){let r=e[n];t[n].opacity=1===e.length?1:(r.count-i)/s}return t},sample2region:function(e,t,i){return null==e?[]:Fm([e],t,i)[0]},samples2regions:Fm,hist2region:function(e,t,i){return null==e?[]:Rm([e],t,i)[0]},hists2regions:Rm,dist2region:function(e,t,i){return null==e?[]:Bm([e],t,i)[0]},dists2regions:Bm});const jm=Object.freeze({custom:function(t,i,n){if(null==t)throw new Error("Selection must be non-null to set custom color property.");if("string"==typeof t&&(t=e.$$(t)),i.startsWith("--")||(i="--"+i),null==n)t.css(i,"");else{let e=_r(n);if(!e)throw new Error(`Color must be a defined keyword or an RGB triple: '${n}'`);t.css(i,e)}},resolveColorVariable:_r});function qm(e){if(null==e)return e;let t=[];for(let i of e){if(null==i)throw new Error(`Coloring must have non-null elements: ${u(e)}`);let n=tn(i.filter);t.push([n,i.color])}return e=>{if(!e)return null;let i="function"==typeof e?e:t=>e[t];for(let e of t)if(e[0](i))return e[1];return null}}function Um(e,t){if(e)if("not"===e.op){if(!e.filter)throw new Error("Not filter must have non-null base filter.");Zm(e.filter,t)}else if("and"===e.op||"or"===e.op){if(!Array.isArray(e.filters))throw new Error(`And/or filter must have array of base filters: ${u(e)}`);for(let i of e.filters)Um(i,t)}else Zm(e,t)}function Zm(e,t){if(!e.variable)throw new Error(`Filter must have non-naught variable name: ${u(e)}`);t.includes(e.variable)||t.push(e.variable)}const Ym=Object.freeze({validate:function(e){if(e)for(let t of e){if(null==t)throw new Error(`Coloring must have non-null elements: ${u(e)}`);try{Gi(t.filter)}catch(t){throw new Error(`Coloring element has invalid filter: ${t}\n\t${u(e)}`)}}},compile:qm,apply:function(e,t){if(null==e||null==t)return null;let i=Array.isArray(t)?qm(t):t;if(Array.isArray(e)){let t=e.length,n=new Array(t);for(let s=0;s<t;s++)n[s]=i(e[s]);return n}return i(e)},variables:function(e){let t=[];if(e){for(let i of e)Um(i.filter,t);t.sort(Oi)}return t}});function Gm(e){let t=e.length,i=new Array(3*t-2),n=new Array(t),s=0,r=e[0],o=Number.NaN,l=Number.NaN;for(let a=0;a<t;a++){let h=e[a+1]||[Number.NaN,Number.NaN],u=h[0]-r[0],c=h[1]-r[1];0===a?(i[s++]=2/u,i[s++]=1/u,n[a]=c/Math.pow(u,2)*3):a===t-1?(i[s++]=1/o,i[s++]=2/o,n[a]=l/Math.pow(o,2)*3):(i[s++]=1/o,i[s++]=2*(1/o+1/u),i[s++]=1/u,n[a]=3*(l/Math.pow(o,2)+c/Math.pow(u,2))),r=h,o=u,l=c}return function(e,t){let i=t.length;if(0===i){if(0!==e.length)throw new Error(`Array of length ${e.length} does not represent tri-diagonal matrix of size ${i}.`);return[]}{if(i!==(e.length+2)/3)throw new Error(`Array of length ${e.length} does not represent tri-diagonal matrix of size ${i}.`);e=e.slice(),t=t.slice();for(let n=1;n<i;n++){let i=3*n-1,s=e[i]/e[i-2];e[i+1]-=s*e[i-1],t[n]-=s*t[n-1]}let n=new Array(i),s=n[i-1]=t[i-1]/e[e.length-1];for(let r=i-2;r>=0;r--){let i=3*r-1;s=n[r]=(t[r]-e[i+2]*s)/e[i+1]}return n}}(i,n)}const Vm=Object.freeze({spline:function(e){let t=function(e){let t=0,i=new Array(e.length),n=new Set;for(let s of e)if(Number.isFinite(s[0])&&Number.isFinite(s[1])){if(n.has(s[0]))throw new Error(`Knots musts have distinct x values: ${s[0]}`);n.add(s[0]),i[t++]=[s[0],s[1]]}if(t<2)throw new Error("Must have at least two distinct knots to create a natural cubic spline.");return i.length=t,i.sort((e,t)=>e[0]-t[0]),i}(e),i=Gm(t),n=t.length,s=t[0][0],r=t[n-1][0];return e=>{if(!isFinite(e)||e<s||r<e)return Number.NaN;if(e===s)return t[0][1];let o,l,a,h=t[0];for(let s=1;s<n;s++){if(o=t[s],e===o[0])return o[1];if(e<o[0]){l=i[s-1],a=i[s];break}h=o}let u=o[0]-h[0],c=o[1]-h[1],d=(e-h[0])/u,f=1-d,m=l*u-c,p=-a*u+c;return f*h[1]+d*o[1]+d*f*(m*f+p*d)}}});class Xm{constructor(){this.aborted=!1}initialize(e){this.blob=e,this.promise=new Promise((e,t)=>{this.aborted||(this.reader=new FileReader,this.reader.addEventListener("error",()=>{this.aborted||t(this.reader.error)}),this.reader.addEventListener("load",()=>{this.aborted||e(this.reader.result)}),this.read())})}then(e,t){return this.promise.then(e,t)}abort(){return this.aborted||(this.reader&&this.reader.abort(),this.aborted=!0),this}}class Wm extends Xm{constructor(e,t){super(),this.encoding=t||"UTF-8",this.initialize(e)}read(){this.reader.readAsText(this.blob,this.encoding)}}class Km{constructor(e,t,i){this.promise=new Wm(e,i),this.plus=t}abort(){return this.promise.abort(),this}then(e,t){return this.promise.then(e&&(i=>{let n;try{n=i?this.plus?at(i):JSON.parse(i):null}catch(e){return void(t&&t(new We("Failed to de-serialize JSON+.",e)))}e(n)}),t)}}class Qm extends Xm{constructor(e){super(),this.initialize(e)}read(){this.reader.readAsDataURL(this.blob)}}function Jm(e,t){if(null!=t&&e.size>t)throw new Error(`Data exceed permissible size of ${t}: ${e.size}`)}const ep=Object.freeze({read:Object.freeze({serial:function(e,t,i){return Jm(e,i),new Km(e,!0,t)},json:function(e,t,i){return Jm(e,i),new Km(e,!1,t)},text:function(e,t,i){return Jm(e,i),new Wm(e,t)},url:function(e,t){return Jm(e,t),new Qm(e)}}),save:Object.freeze({serial:function(e,t){Pn(new Blob([rt(e,2)||""],{type:"application/json"}),t)},json:function(e,t){Pn(new Blob([JSON.stringify(e,null,2)||""],{type:"application/json"}),t)},text:function(e,t){Pn(new Blob([e],{type:"text/plain"}),t)},data:Dn,blob:Pn})});function tp(...e){return np(e,"and")}function ip(...e){return np(e,"or")}function np(e,t){let i=[];for(let t of e)Array.isArray(t)?i.push(...t.filter(e=>null!=e)):null!=t&&i.push(t);return 0===i.length?void 0:1===i.length?i[0]:{op:t,filters:i}}function sp(e){let t="";for(let i=0;i<e.length;i++){let n=e.charAt(i);"%"!==n&&"_"!==n||(t+="\\"),t+=n}return t}var rp=Object.freeze({and:tp,or:ip,like:function(e,t,i=!1){return{op:"like",variable:e,value:t,caseInsensitive:i}},exact:function(e,t,i=!1){return{op:"like",variable:e,value:t=sp(t),caseInsensitive:i}},startsWith:function(e,t,i=!1){return{op:"like",variable:e,value:t=sp(t)+"%",caseInsensitive:i}},endsWith:function(e,t,i=!1){return{op:"like",variable:e,value:t="%"+sp(t),caseInsensitive:i}},contains:function(e,t,i=!1){return{op:"like",variable:e,value:t="%"+sp(t)+"%",caseInsensitive:i}}});function op(e,t){return void 0===t?void 0:Array.isArray(t)?(t.forEach(lp),1===t.length?{op:"eq",variable:e,value:t[0]}:{op:"in",variable:e,values:t.slice()}):(lp(t),{op:"eq",variable:e,value:t})}function lp(e){if(null===e)return;let t=typeof e;if("string"!==t&&"number"!==t&&"boolean"!==t)throw new Error(`Filter value must be null or be of type 'string', 'number', or 'boolean', not '${t}': ${u(e)}`)}const ap=Object.freeze({builder:rp,value2filter:op,values2filters:function(e,t,i=op){if(null==e)return[];let n;return t=t||Object.keys(e),n=Array.isArray(t)?t.map(t=>i(t,e[t])):Object.entries(t).map(t=>i(t[1],e[t[0]])),n.filter(e=>void 0!==e)},range2filter:function(e,t,i){if(null==t)return;let n=function(e){let t=[];!1!==e.isNull&&t.push(null);!1!==e.isNaN&&t.push(Number.NaN);!1!==e.isPosInf&&t.push(Number.POSITIVE_INFINITY);!1!==e.isNegInf&&t.push(Number.NEGATIVE_INFINITY);return t}(t),s=function(e,t,i,n){if(!e||!e.length)return;let s={min:e[0].low,max:e[e.length-1].high};return 1===(e=function(e){let t,i=[];for(let n of e||[])n.selected&&(t&&t.high===n.low?t.high=n.high:i.push(t=Object.assign({},n)));return i}(e)).length&&n&&e[0].low===s.min&&e[0].high===s.max?void 0:e.map(e=>function(e,t,i,n,s){if(e.low===e.high)return{op:"eq",variable:t,value:e.low};{let r=[];return s&&e.low===i.min?function(e,t,i){let n=i.indexOf(Number.NEGATIVE_INFINITY);n>=0?i.splice(n,1):t.push({op:"gt",variable:e,value:Number.NEGATIVE_INFINITY})}(t,r,n):r.push({op:"ge",variable:t,value:e.low}),s&&e.high===i.max?function(e,t,i){let n=i.indexOf(Number.POSITIVE_INFINITY);n>=0?i.splice(n,1):t.push({op:"lt",variable:e,value:Number.POSITIVE_INFINITY})}(t,r,n):r.push({op:"le",variable:t,value:e.high}),tp(r)}}(e,t,s,i,n)).filter(e=>!!e)}(t.ranges,e,n,i);return null==s?4===n.length?void 0:ip([n.length?{op:"in",variable:e,values:n}:void 0,tp([{op:"gt",variable:e,value:Number.NEGATIVE_INFINITY},{op:"lt",variable:e,value:Number.POSITIVE_INFINITY}])]):(n.length&&s.push({op:"in",variable:e,values:n}),0===s.length?{op:"in",variable:e,values:[]}:ip(s))}});const hp=Object.freeze({distBounds:function(e,t){return Math.min(e[0]<=(t.left+t.right)/2?br(e,[t.left,t.top],[t.left,t.bottom]):br(e,[t.right,t.top],[t.right,t.bottom]),e[1]<=(t.top+t.bottom)/2?br(e,[t.left,t.top],[t.right,t.top]):br(e,[t.left,t.bottom],[t.right,t.bottom]))},distPoint:cr,distSegment:br}),up=Object.freeze({serialize:rt,deserialize:at,escapeHtml:function(e){return null==e?e:e.replace(/[&<>"'\/]/g,l)},inspect:u,quote1:function(e){return null==e?e:"'"+function(e){return null==e?e:e.replace(/(['\\])/g,"\\$1")}(e)+"'"},quote2:function(e){return null==e?e:'"'+function(e){return null==e?e:e.replace(/(["\\])/g,"\\$1")}(e)+'"'},format:function(e,t){if(null==t)throw new Error("Format must be non-null.");return wl(t)(e)},formatter:wl,clone:ki,deepFreeze:function e(t){if(null==t||"object"!=typeof t||Object.isFrozen(t)||t instanceof Set||t instanceof Map||t instanceof RegExp||t instanceof Date)return t;Object.freeze(t);for(let i in Object.values(t))e(i);return t},filterProperties:function(e,...t){if(null==e)return e;let i=Object.assign({},null);for(let n of Object.keys(e))t.includes(n)&&(i[n]=e[n]);return i},accessorIterable:Hr}),cp=[];function dp(e,t){let i,n;if(.95===e)i=0;else{if(.975!==e)throw new Error("Alpha ${α} not supported for student-t.");i=1}if(t<1)throw new Error("Df must be > 1: ${df}");if(t>100)n=0;else for(n=t;!cp[n];)n--;return cp[n][i]}cp[0]=[1.65,1.96],cp[1]=[6.32,12.71],cp[2]=[2.92,4.3],cp[3]=[2.35,3.18],cp[4]=[2.13,2.78],cp[5]=[2.02,2.57],cp[6]=[1.94,2.45],cp[7]=[1.9,2.37],cp[8]=[1.86,2.31],cp[9]=[1.83,2.26],cp[10]=[1.81,2.23],cp[11]=[1.8,2.2],cp[12]=[1.78,2.18],cp[13]=[1.77,2.16],cp[14]=[1.76,2.15],cp[15]=[1.75,2.13],cp[16]=[1.74,2.12],cp[17]=[1.74,2.11],cp[18]=[1.73,2.1],cp[19]=[1.73,2.09],cp[21]=[1.72,2.08],cp[22]=[1.72,2.07],cp[23]=[1.71,2.07],cp[24]=[1.71,2.06],cp[27]=[1.7,2.05],cp[29]=[1.7,2.05],cp[30]=[1.7,2.04],cp[32]=[1.69,2.04],cp[34]=[1.69,2.03],cp[38]=[1.69,2.02],cp[40]=[1.68,2.02],cp[45]=[1.68,2.01],cp[53]=[1.67,2.01],cp[55]=[1.67,2],cp[68]=[1.6,2],cp[69]=[1.67,2],cp[70]=[1.67,1.99],cp[79]=[1.66,1.99],cp[98]=[1.66,1.98];const fp=Object.freeze({moments2XY:function(e,t=Kr.sample,i=qr.finite){if(!e)return e;if(null==i)throw new Error("Must have non-null finite mode.");let n,s,r=new No,o=new No,l=new No,a=new No,h=new No,u=0;for(let[t,c]of e)if(null!=t&&null!=c){switch(i){case qr.non_nan:if(Number.isNaN(t)||Number.isNaN(c))continue;break;case qr.finite:if(!Number.isFinite(t)||!Number.isFinite(c))continue}u++,n=t-r.sum,s=c-o.sum,r.update(n/u),o.update(s/u),l.update(n*(t-r.sum)),a.update(s*(c-o.sum)),h.update((u-1)/u*n*s)}let c=t===Kr.sample?u-1:u;return{muX:r.sum,muY:o.sum,varX:0===c?Number.NaN:l.sum/c,varY:0===c?Number.NaN:a.sum/c,varXY:0===c?Number.NaN:h.sum/c,count:u}},aggregateMoments2XY:function(e,t=Kr.sample){e=e||[];let i=t===Kr.sample?-1:0,n=new No,s=new No,r=new No,o=new No,l=new No,a=0;for(let t of e){if(!t)continue;let e=t.count,h=a;a+=t.count;let u=t.count+i,c=e/a,d=e*h/a,f=t.muX-n.sum,m=t.muY-s.sum;n.update(c*f),s.update(c*m),r.update(u*t.varX).update(d*f*f),o.update(u*t.varY).update(d*m*m),l.update(u*t.varXY).update(d*f*m)}let h=t===Kr.sample?a-1:a;return{muX:n.sum,muY:s.sum,varX:0===h?Number.NaN:r.sum/h,varY:0===h?Number.NaN:o.sum/h,varXY:0===h?Number.NaN:l.sum/h,count:a}},regression:function(e){if(!e||e.count<=2)return;let t,i=e.count,n=e.varX*(i-1),s=e.varXY/e.varX,r=e.muY-s*e.muX,o=(e.varY-e.varXY*s)*((i-1)/(i-2)),l=Math.sqrt(o),a=s*(e.varXY/e.varY),h=Math.sqrt(o*(1/i+Math.pow(e.muX,2)/n)),u=Math.sqrt(o/n),c=dp(.95,i-2),d=dp(.975,i-2);t=c*h;let f=[r-t,r+t];t=d*h;let m=[r-t,r+t];t=c*u;let p=[s-t,s+t];return t=d*u,{a:r,b:s,s:l,r2:a,s_a:h,s_b:u,ci_a_90:f,ci_a_95:m,ci_b_90:p,ci_b_95:[s-t,s+t],y_hat:e=>r+s*e,ci_y_hat_90:[t=>r+s*t-c*Math.sqrt(o*(1/i+Math.pow(t-e.muX,2)/n)),t=>r+s*t+c*Math.sqrt(o*(1/i+Math.pow(t-e.muX,2)/n))],ci_y_hat_95:[t=>r+s*t-d*Math.sqrt(o*(1/i+Math.pow(t-e.muX,2)/n)),t=>r+s*t+d*Math.sqrt(o*(1/i+Math.pow(t-e.muX,2)/n))],pi_y_hat_90:[t=>r+s*t-c*Math.sqrt(o*(1+1/i+Math.pow(t-e.muX,2)/n)),t=>r+s*t+c*Math.sqrt(o*(1+1/i+Math.pow(t-e.muX,2)/n))],pi_y_hat_95:[t=>r+s*t-d*Math.sqrt(o*(1+1/i+Math.pow(t-e.muX,2)/n)),t=>r+s*t+d*Math.sqrt(o*(1+1/i+Math.pow(t-e.muX,2)/n))]}}});function mp(e){return null!=e&&/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)}function pp(e){try{return function(e){!function(e){if(null==e)return e;let t=e.split(",");for(let i=0;i<t.length;i++){let n=t[i];if(null!=n&&(t[i]=n=n.trim()),!mp(n))throw new Error(`Email list contains invalid email: ${n} (${e})`)}}(e)}(e),!0}catch(e){return!1}}function gp(e){return Tn("esc.validate.runtime")[e]}var bp;function wp(e,t,i){return{error:function(e,t,i){if(t=t||{},void 0===e)return null;if(null===e){if(t.required)return gp("required")}else if("string"==typeof e){Sp(t,"text",vp,e,i);let n=t;if(!e&&n.required)return gp("required");if(null!=n.minLength&&e.length<n.minLength)return gp("minLengthText")(n.minLength);if(null!=n.maxLength&&n.maxLength<e.length)return gp("maxLengthText")(n.maxLength);if(n.type===bp.email&&!mp(e.trim()))return gp("email");if(n.type===bp.emailList&&pp(e))return gp("emailList");if(null!=n.pattern){if(!(n.pattern.regex instanceof RegExp?n.pattern.regex:new RegExp(n.pattern.regex)).test(e))return n.pattern.error}}else if(Array.isArray(e)){Sp(t,"multi-choice",yp,e,i);let n=t;if(null!=n.minLength&&e.length<n.minLength)return gp("minLengthMultiChoices")(n.minLength);if(n.required&&0===e.length)return gp("minLengthMultiChoices")(1);if(null!=n.maxLength&&n.maxLength<e.length)return gp("maxLengthMultiChoices")(n.maxLength)}else Sp(t,"generic",xp,e,i);let n=t.custom;return n||null}(e,t,i),enabled:Ci(t.enabled)}}!function(e){e.text="text",e.email="email",e.emailList="email-list"}(bp||(bp={}));const vp=["required","minLength","maxLength","type","pattern","custom","enabled"],yp=["required","minLength","maxLength","enabled"],xp=["required","custom","enabled"];function Sp(e,t,i,n,s){let r=Object.keys(e);if((r=r.filter(e=>!i.includes(e))).length)throw new Error(`The following flag(s) are not allowed for ${t} validation options${s?" '"+s+"'":""}: ${r.join()}\n\tselection=${u(n)}`)}const Ep=Object.freeze({simple:function(e,t){return wp(e,t,"")},aggregate:function(e,t){e=e||{};let i={};for(let[n,s]of Object.entries(t)){let t=e[n];i[n]=wp(t,s,n)}return i}});Q=K,e.live=!0,e.isDom=ie,e.isBrowserDom=function(e){return null!=e&&"object"==typeof e&&"parentsUntil"in e&&"off"in e},e.data=Re,e.onDestroy=function(e,t){if(null==e)throw new Error("Selection must be non-null to register on-destroy callback.");return Ue(Pe(e),t)},e.destroy=function(e){if(null==e)throw new Error("Selection must be non-null.");let t;t="object"==typeof e&&Symbol.iterator in e?e:Pe(e),Ze(t)},e.dom=Ve,e.lookup=Xe,e.processDom=Nt,e.status=Jt,e.refreshStyle=function(){document.querySelectorAll(".esc-js-style-refreshable").forEach(e=>Re(e).refreshStyle())},e.chart=Hm,e.color=jm,e.coloring=Ym,e.curve=Vm,e.file=ep,e.filter=ap,e.geom=hp,e.util=up,e.stats=fp,e.validate=Ep}(this.esc=this.esc||{});